var zd=(P,ft,Ut)=>{if(!ft.has(P))throw TypeError("Cannot "+Ut)};var Wt=(P,ft,Ut)=>(zd(P,ft,"read from private field"),Ut?Ut.call(P):ft.get(P)),en=(P,ft,Ut)=>{if(ft.has(P))throw TypeError("Cannot add the same private member more than once");ft instanceof WeakSet?ft.add(P):ft.set(P,Ut)},an=(P,ft,Ut,Tl)=>(zd(P,ft,"write to private field"),Tl?Tl.call(P,Ut):ft.set(P,Ut),Ut);var Od=(P,ft,Ut)=>(zd(P,ft,"access private method"),Ut);(function(P,ft){typeof exports=="object"&&typeof module<"u"?ft(exports):typeof define=="function"&&define.amd?define(["exports"],ft):(P=typeof globalThis<"u"?globalThis:P||self,ft(P.zui={}))})(this,function(P){var nl,sl,to,no,so,io,ro,oo,il,Ay,rl,Ty,fs,ps;"use strict";const ft="",Ut="",Tl="",pC="",mC="",gC="",yC="",vC="",xC="",_C="",bC="",wC="",Fy="3.0.0",Py="production",In=document,xo=window,Ud=In.documentElement,Ss=In.createElement.bind(In),Vd=Ss("div"),$l=Ss("table"),My=Ss("tbody"),Kd=Ss("tr"),{isArray:_o,prototype:qd}=Array,{concat:Ry,filter:Il,indexOf:Gd,map:Yd,push:Ly,slice:Xd,some:Bl,splice:zy}=qd,Oy=/^#(?:[\w-]|\\.|[^\x00-\xa0])*$/,Hy=/^\.(?:[\w-]|\\.|[^\x00-\xa0])*$/,jy=/<.+>/,Wy=/^\w+$/;function Nl(s,e){const t=Uy(e);return!s||!t&&!Ds(e)&&!mt(e)?[]:!t&&Hy.test(s)?e.getElementsByClassName(s.slice(1).replace(/\\/g,"")):!t&&Wy.test(s)?e.getElementsByTagName(s):e.querySelectorAll(s)}class bo{constructor(e,t){if(!e)return;if(Fl(e))return e;let n=e;if(It(e)){const i=t||In;if(n=Oy.test(e)&&Ds(i)?i.getElementById(e.slice(1).replace(/\\/g,"")):jy.test(e)?nf(e):Fl(i)?i.find(e):It(i)?_(i).find(e):Nl(e,i),!n)return}else if(Es(e))return this.ready(e);(n.nodeType||n===xo)&&(n=[n]),this.length=n.length;for(let i=0,r=this.length;i<r;i++)this[i]=n[i]}init(e,t){return new bo(e,t)}}const fe=bo.prototype,_=fe.init;_.fn=_.prototype=fe,fe.length=0,fe.splice=zy,typeof Symbol=="function"&&(fe[Symbol.iterator]=qd[Symbol.iterator]);function Fl(s){return s instanceof bo}function ui(s){return!!s&&s===s.window}function Ds(s){return!!s&&s.nodeType===9}function Uy(s){return!!s&&s.nodeType===11}function mt(s){return!!s&&s.nodeType===1}function Vy(s){return!!s&&s.nodeType===3}function Ky(s){return typeof s=="boolean"}function Es(s){return typeof s=="function"}function It(s){return typeof s=="string"}function Vt(s){return s===void 0}function sr(s){return s===null}function Zd(s){return!isNaN(parseFloat(s))&&isFinite(s)}function Pl(s){if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return e===null||e===Object.prototype}_.isWindow=ui,_.isFunction=Es,_.isArray=_o,_.isNumeric=Zd,_.isPlainObject=Pl;function Ct(s,e,t){if(t){let n=s.length;for(;n--;)if(e.call(s[n],n,s[n])===!1)return s}else if(Pl(s)){const n=Object.keys(s);for(let i=0,r=n.length;i<r;i++){const o=n[i];if(e.call(s[o],o,s[o])===!1)return s}}else for(let n=0,i=s.length;n<i;n++)if(e.call(s[n],n,s[n])===!1)return s;return s}_.each=Ct,fe.each=function(s){return Ct(this,s)},fe.empty=function(){return this.each((s,e)=>{for(;e.firstChild;)e.removeChild(e.firstChild)})};function wo(...s){const e=Ky(s[0])?s.shift():!1,t=s.shift(),n=s.length;if(!t)return{};if(!n)return wo(e,_,t);for(let i=0;i<n;i++){const r=s[i];for(const o in r)e&&(_o(r[o])||Pl(r[o]))?((!t[o]||t[o].constructor!==r[o].constructor)&&(t[o]=new r[o].constructor),wo(e,t[o],r[o])):t[o]=r[o]}return t}_.extend=wo,fe.extend=function(s){return wo(fe,s)};const qy=/\S+/g;function Co(s){return It(s)?s.match(qy)||[]:[]}fe.toggleClass=function(s,e){const t=Co(s),n=!Vt(e);return this.each((i,r)=>{mt(r)&&Ct(t,(o,a)=>{n?e?r.classList.add(a):r.classList.remove(a):r.classList.toggle(a)})})},fe.addClass=function(s){return this.toggleClass(s,!0)},fe.removeAttr=function(s){const e=Co(s);return this.each((t,n)=>{mt(n)&&Ct(e,(i,r)=>{n.removeAttribute(r)})})};function Gy(s,e){if(s){if(It(s)){if(arguments.length<2){if(!this[0]||!mt(this[0]))return;const t=this[0].getAttribute(s);return sr(t)?void 0:t}return Vt(e)?this:sr(e)?this.removeAttr(s):this.each((t,n)=>{mt(n)&&n.setAttribute(s,e)})}for(const t in s)this.attr(t,s[t]);return this}}fe.attr=Gy,fe.removeClass=function(s){return arguments.length?this.toggleClass(s,!1):this.attr("class","")},fe.hasClass=function(s){return!!s&&Bl.call(this,e=>mt(e)&&e.classList.contains(s))},fe.get=function(s){return Vt(s)?Xd.call(this):(s=Number(s),this[s<0?s+this.length:s])},fe.eq=function(s){return _(this.get(s))},fe.first=function(){return this.eq(0)},fe.last=function(){return this.eq(-1)};function Yy(s){return Vt(s)?this.get().map(e=>mt(e)||Vy(e)?e.textContent:"").join(""):this.each((e,t)=>{mt(t)&&(t.textContent=s)})}fe.text=Yy;function Bn(s,e,t){if(!mt(s))return;const n=xo.getComputedStyle(s,null);return t?n.getPropertyValue(e)||void 0:n[e]||s.style[e]}function xn(s,e){return parseInt(Bn(s,e),10)||0}function Qd(s,e){return xn(s,`border${e?"Left":"Top"}Width`)+xn(s,`padding${e?"Left":"Top"}`)+xn(s,`padding${e?"Right":"Bottom"}`)+xn(s,`border${e?"Right":"Bottom"}Width`)}const Ml={};function Xy(s){if(Ml[s])return Ml[s];const e=Ss(s);In.body.insertBefore(e,null);const t=Bn(e,"display");return In.body.removeChild(e),Ml[s]=t!=="none"?t:"block"}function Jd(s){return Bn(s,"display")==="none"}function ef(s,e){const t=s&&(s.matches||s.webkitMatchesSelector||s.msMatchesSelector);return!!t&&!!e&&t.call(s,e)}function ko(s){return It(s)?(e,t)=>ef(t,s):Es(s)?s:Fl(s)?(e,t)=>s.is(t):s?(e,t)=>t===s:()=>!1}fe.filter=function(s){const e=ko(s);return _(Il.call(this,(t,n)=>e.call(t,n,t)))};function Yn(s,e){return e?s.filter(e):s}fe.detach=function(s){return Yn(this,s).each((e,t)=>{t.parentNode&&t.parentNode.removeChild(t)}),this};const Zy=/^\s*<(\w+)[^>]*>/,Qy=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,tf={"*":Vd,tr:My,td:Kd,th:Kd,thead:$l,tbody:$l,tfoot:$l};function nf(s){if(!It(s))return[];if(Qy.test(s))return[Ss(RegExp.$1)];const e=Zy.test(s)&&RegExp.$1,t=tf[e]||tf["*"];return t.innerHTML=s,_(t.childNodes).detach().get()}_.parseHTML=nf,fe.has=function(s){const e=It(s)?(t,n)=>Nl(s,n).length:(t,n)=>n.contains(s);return this.filter(e)},fe.not=function(s){const e=ko(s);return this.filter((t,n)=>(!It(s)||mt(n))&&!e.call(n,t,n))};function Nn(s,e,t,n){const i=[],r=Es(e),o=n&&ko(n);for(let a=0,l=s.length;a<l;a++)if(r){const c=e(s[a]);c.length&&Ly.apply(i,c)}else{let c=s[a][e];for(;c!=null&&!(n&&o(-1,c));)i.push(c),c=t?c[e]:null}return i}function sf(s){return s.multiple&&s.options?Nn(Il.call(s.options,e=>e.selected&&!e.disabled&&!e.parentNode.disabled),"value"):s.value||""}function Jy(s){return arguments.length?this.each((e,t)=>{const n=t.multiple&&t.options;if(n||mf.test(t.type)){const i=_o(s)?Yd.call(s,String):sr(s)?[]:[String(s)];n?Ct(t.options,(r,o)=>{o.selected=i.indexOf(o.value)>=0},!0):t.checked=i.indexOf(t.value)>=0}else t.value=Vt(s)||sr(s)?"":s}):this[0]&&sf(this[0])}fe.val=Jy,fe.is=function(s){const e=ko(s);return Bl.call(this,(t,n)=>e.call(t,n,t))},_.guid=1;function _n(s){return s.length>1?Il.call(s,(e,t,n)=>Gd.call(n,e)===t):s}_.unique=_n,fe.add=function(s,e){return _(_n(this.get().concat(_(s,e).get())))},fe.children=function(s){return Yn(_(_n(Nn(this,e=>e.children))),s)},fe.parent=function(s){return Yn(_(_n(Nn(this,"parentNode"))),s)},fe.index=function(s){const e=s?_(s)[0]:this[0],t=s?this:_(e).parent().children();return Gd.call(t,e)},fe.closest=function(s){const e=this.filter(s);if(e.length)return e;const t=this.parent();return t.length?t.closest(s):e},fe.siblings=function(s){return Yn(_(_n(Nn(this,e=>_(e).parent().children().not(e)))),s)},fe.find=function(s){return _(_n(Nn(this,e=>Nl(s,e))))};const ev=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,tv=/^$|^module$|\/(java|ecma)script/i,nv=["type","src","nonce","noModule"];function sv(s,e){const t=_(s);t.filter("script").add(t.find("script")).each((n,i)=>{if(tv.test(i.type)&&Ud.contains(i)){const r=Ss("script");r.text=i.textContent.replace(ev,""),Ct(nv,(o,a)=>{i[a]&&(r[a]=i[a])}),e.head.insertBefore(r,null),e.head.removeChild(r)}})}function iv(s,e,t,n,i){n?s.insertBefore(e,t?s.firstChild:null):s.nodeName==="HTML"?s.parentNode.replaceChild(e,s):s.parentNode.insertBefore(e,t?s:s.nextSibling),i&&sv(e,s.ownerDocument)}function Xn(s,e,t,n,i,r,o,a){return Ct(s,(l,c)=>{Ct(_(c),(h,u)=>{Ct(_(e),(f,p)=>{const g=t?u:p,y=t?p:u,v=t?h:f;iv(g,v?y.cloneNode(!0):y,n,i,!v)},a)},o)},r),e}fe.after=function(){return Xn(arguments,this,!1,!1,!1,!0,!0)},fe.append=function(){return Xn(arguments,this,!1,!1,!0)};function rv(s){if(!arguments.length)return this[0]&&this[0].innerHTML;if(Vt(s))return this;const e=/<script[\s>]/.test(s);return this.each((t,n)=>{mt(n)&&(e?_(n).empty().append(s):n.innerHTML=s)})}fe.html=rv,fe.appendTo=function(s){return Xn(arguments,this,!0,!1,!0)},fe.wrapInner=function(s){return this.each((e,t)=>{const n=_(t),i=n.contents();i.length?i.wrapAll(s):n.append(s)})},fe.before=function(){return Xn(arguments,this,!1,!0)},fe.wrapAll=function(s){let e=_(s),t=e[0];for(;t.children.length;)t=t.firstElementChild;return this.first().before(e),this.appendTo(t)},fe.wrap=function(s){return this.each((e,t)=>{const n=_(s)[0];_(t).wrapAll(e?n.cloneNode(!0):n)})},fe.insertAfter=function(s){return Xn(arguments,this,!0,!1,!1,!1,!1,!0)},fe.insertBefore=function(s){return Xn(arguments,this,!0,!0)},fe.prepend=function(){return Xn(arguments,this,!1,!0,!0,!0,!0)},fe.prependTo=function(s){return Xn(arguments,this,!0,!0,!0,!1,!1,!0)},fe.contents=function(){return _(_n(Nn(this,s=>s.tagName==="IFRAME"?[s.contentDocument]:s.tagName==="TEMPLATE"?s.content.childNodes:s.childNodes)))},fe.next=function(s,e,t){return Yn(_(_n(Nn(this,"nextElementSibling",e,t))),s)},fe.nextAll=function(s){return this.next(s,!0)},fe.nextUntil=function(s,e){return this.next(e,!0,s)},fe.parents=function(s,e){return Yn(_(_n(Nn(this,"parentElement",!0,e))),s)},fe.parentsUntil=function(s,e){return this.parents(e,s)},fe.prev=function(s,e,t){return Yn(_(_n(Nn(this,"previousElementSibling",e,t))),s)},fe.prevAll=function(s){return this.prev(s,!0)},fe.prevUntil=function(s,e){return this.prev(e,!0,s)},fe.map=function(s){return _(Ry.apply([],Yd.call(this,(e,t)=>s.call(e,t,e))))},fe.clone=function(){return this.map((s,e)=>e.cloneNode(!0))},fe.offsetParent=function(){return this.map((s,e)=>{let t=e.offsetParent;for(;t&&Bn(t,"position")==="static";)t=t.offsetParent;return t||Ud})},fe.slice=function(s,e){return _(Xd.call(this,s,e))};const ov=/-([a-z])/g;function Rl(s){return s.replace(ov,(e,t)=>t.toUpperCase())}fe.ready=function(s){const e=()=>setTimeout(s,0,_);return In.readyState!=="loading"?e():In.addEventListener("DOMContentLoaded",e),this},fe.unwrap=function(){return this.parent().each((s,e)=>{if(e.tagName==="BODY")return;const t=_(e);t.replaceWith(t.children())}),this},fe.offset=function(){const s=this[0];if(!s)return;const e=s.getBoundingClientRect();return{top:e.top+xo.pageYOffset,left:e.left+xo.pageXOffset}},fe.position=function(){const s=this[0];if(!s)return;const e=Bn(s,"position")==="fixed",t=e?s.getBoundingClientRect():this.offset();if(!e){const n=s.ownerDocument;let i=s.offsetParent||n.documentElement;for(;(i===n.body||i===n.documentElement)&&Bn(i,"position")==="static";)i=i.parentNode;if(i!==s&&mt(i)){const r=_(i).offset();t.top-=r.top+xn(i,"borderTopWidth"),t.left-=r.left+xn(i,"borderLeftWidth")}}return{top:t.top-xn(s,"marginTop"),left:t.left-xn(s,"marginLeft")}};const rf={class:"className",contenteditable:"contentEditable",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};fe.prop=function(s,e){if(s){if(It(s))return s=rf[s]||s,arguments.length<2?this[0]&&this[0][s]:this.each((t,n)=>{n[s]=e});for(const t in s)this.prop(t,s[t]);return this}},fe.removeProp=function(s){return this.each((e,t)=>{delete t[rf[s]||s]})};const av=/^--/;function Ll(s){return av.test(s)}const zl={},{style:lv}=Vd,cv=["webkit","moz","ms"];function hv(s,e=Ll(s)){if(e)return s;if(!zl[s]){const t=Rl(s),n=`${t[0].toUpperCase()}${t.slice(1)}`,i=`${t} ${cv.join(`${n} `)}${n}`.split(" ");Ct(i,(r,o)=>{if(o in lv)return zl[s]=o,!1})}return zl[s]}const uv={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function of(s,e,t=Ll(s)){return!t&&!uv[s]&&Zd(e)?`${e}px`:e}function dv(s,e){if(It(s)){const t=Ll(s);return s=hv(s,t),arguments.length<2?this[0]&&Bn(this[0],s,t):s?(e=of(s,e,t),this.each((n,i)=>{mt(i)&&(t?i.style.setProperty(s,e):i.style[s]=e)})):this}for(const t in s)this.css(t,s[t]);return this}fe.css=dv;function af(s,e){try{return s(e)}catch{return e}}const fv=/^\s+|\s+$/;function lf(s,e){const t=s.dataset[e]||s.dataset[Rl(e)];return fv.test(t)?t:af(JSON.parse,t)}function pv(s,e,t){t=af(JSON.stringify,t),s.dataset[Rl(e)]=t}function mv(s,e){if(!s){if(!this[0])return;const t={};for(const n in this[0].dataset)t[n]=lf(this[0],n);return t}if(It(s))return arguments.length<2?this[0]&&lf(this[0],s):Vt(e)?this:this.each((t,n)=>{pv(n,s,e)});for(const t in s)this.data(t,s[t]);return this}fe.data=mv;function cf(s,e){const t=s.documentElement;return Math.max(s.body[`scroll${e}`],t[`scroll${e}`],s.body[`offset${e}`],t[`offset${e}`],t[`client${e}`])}Ct([!0,!1],(s,e)=>{Ct(["Width","Height"],(t,n)=>{const i=`${e?"outer":"inner"}${n}`;fe[i]=function(r){if(this[0])return ui(this[0])?e?this[0][`inner${n}`]:this[0].document.documentElement[`client${n}`]:Ds(this[0])?cf(this[0],n):this[0][`${e?"offset":"client"}${n}`]+(r&&e?xn(this[0],`margin${t?"Top":"Left"}`)+xn(this[0],`margin${t?"Bottom":"Right"}`):0)}})}),Ct(["Width","Height"],(s,e)=>{const t=e.toLowerCase();fe[t]=function(n){if(!this[0])return Vt(n)?void 0:this;if(!arguments.length)return ui(this[0])?this[0].document.documentElement[`client${e}`]:Ds(this[0])?cf(this[0],e):this[0].getBoundingClientRect()[t]-Qd(this[0],!s);const i=parseInt(n,10);return this.each((r,o)=>{if(!mt(o))return;const a=Bn(o,"boxSizing");o.style[t]=of(t,i+(a==="border-box"?Qd(o,!s):0))})}});const hf="___cd";fe.toggle=function(s){return this.each((e,t)=>{if(!mt(t))return;const n=Jd(t);(Vt(s)?n:s)?(t.style.display=t[hf]||"",Jd(t)&&(t.style.display=Xy(t.tagName))):n||(t[hf]=Bn(t,"display"),t.style.display="none")})},fe.hide=function(){return this.toggle(!1)},fe.show=function(){return this.toggle(!0)};const uf="___ce",Ol=".",Hl={focus:"focusin",blur:"focusout"},df={mouseenter:"mouseover",mouseleave:"mouseout"},gv=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;function jl(s){return df[s]||Hl[s]||s}function Wl(s){const e=s.split(Ol);return[e[0],e.slice(1).sort()]}fe.trigger=function(s,e){if(It(s)){const[n,i]=Wl(s),r=jl(n);if(!r)return this;const o=gv.test(r)?"MouseEvents":"HTMLEvents";s=In.createEvent(o),s.initEvent(r,!0,!0),s.namespace=i.join(Ol),s.___ot=n}s.___td=e;const t=s.___ot in Hl;return this.each((n,i)=>{t&&Es(i[s.___ot])&&(i[`___i${s.type}`]=!0,i[s.___ot](),i[`___i${s.type}`]=!1),i.dispatchEvent(s)})};function ff(s){return s[uf]=s[uf]||{}}function yv(s,e,t,n,i){const r=ff(s);r[e]=r[e]||[],r[e].push([t,n,i]),s.addEventListener(e,i)}function pf(s,e){return!e||!Bl.call(e,t=>s.indexOf(t)<0)}function So(s,e,t,n,i){const r=ff(s);if(e)r[e]&&(r[e]=r[e].filter(([o,a,l])=>{if(i&&l.guid!==i.guid||!pf(o,t)||n&&n!==a)return!0;s.removeEventListener(e,l)}));else for(e in r)So(s,e,t,n,i)}fe.off=function(s,e,t){if(Vt(s))this.each((n,i)=>{!mt(i)&&!Ds(i)&&!ui(i)||So(i)});else if(It(s))Es(e)&&(t=e,e=""),Ct(Co(s),(n,i)=>{const[r,o]=Wl(i),a=jl(r);this.each((l,c)=>{!mt(c)&&!Ds(c)&&!ui(c)||So(c,a,o,e,t)})});else for(const n in s)this.off(n,s[n]);return this},fe.remove=function(s){return Yn(this,s).detach().off(),this},fe.replaceWith=function(s){return this.before(s).remove()},fe.replaceAll=function(s){return _(s).replaceWith(this),this};function vv(s,e,t,n,i){if(!It(s)){for(const r in s)this.on(r,e,t,s[r],i);return this}return It(e)||(Vt(e)||sr(e)?e="":Vt(t)?(t=e,e=""):(n=t,t=e,e="")),Es(n)||(n=t,t=void 0),n?(Ct(Co(s),(r,o)=>{const[a,l]=Wl(o),c=jl(a),h=a in df,u=a in Hl;c&&this.each((f,p)=>{if(!mt(p)&&!Ds(p)&&!ui(p))return;const g=function(y){if(y.target[`___i${y.type}`])return y.stopImmediatePropagation();if(y.namespace&&!pf(l,y.namespace.split(Ol))||!e&&(u&&(y.target!==p||y.___ot===c)||h&&y.relatedTarget&&p.contains(y.relatedTarget)))return;let v=p;if(e){let w=y.target;for(;!ef(w,e);)if(w===p||(w=w.parentNode,!w))return;v=w}Object.defineProperty(y,"currentTarget",{configurable:!0,get(){return v}}),Object.defineProperty(y,"delegateTarget",{configurable:!0,get(){return p}}),Object.defineProperty(y,"data",{configurable:!0,get(){return t}});const b=n.call(v,y,y.___td);i&&So(p,c,l,e,g),b===!1&&(y.preventDefault(),y.stopPropagation())};g.guid=n.guid=n.guid||_.guid++,yv(p,c,l,e,g)})}),this):this}fe.on=vv;function xv(s,e,t,n){return this.on(s,e,t,n,!0)}fe.one=xv;const _v=/\r?\n/g;function bv(s,e){return`&${encodeURIComponent(s)}=${encodeURIComponent(e.replace(_v,`\r
`))}`}const wv=/file|reset|submit|button|image/i,mf=/radio|checkbox/i;fe.serialize=function(){let s="";return this.each((e,t)=>{Ct(t.elements||[t],(n,i)=>{if(i.disabled||!i.name||i.tagName==="FIELDSET"||wv.test(i.type)||mf.test(i.type)&&!i.checked)return;const r=sf(i);if(!Vt(r)){const o=_o(r)?r:[r];Ct(o,(a,l)=>{s+=bv(i.name,l)})}})}),s.slice(1)},window.$=_;function gf(s,e){if(s==null)return[s,void 0];typeof e=="string"&&(e=e.split("."));const t=e.join(".");let n=s;const i=[n];for(;typeof n=="object"&&n!==null&&e.length;){let r=e.shift(),o;const a=r.indexOf("[");if(a>0&&a<r.length-1&&r.endsWith("]")&&(o=r.substring(a+1,r.length-1),r=r.substring(0,a)),n=n[r],i.push(n),o!==void 0)if(typeof n=="object"&&n!==null)n instanceof Map?n=n.get(o):n=n[o],i.push(n);else throw new Error(`Cannot access property "${r}[${o}]", the full path is "${t}".`)}if(e.length)throw new Error(`Cannot access property with rest path "${e.join(".")}", the full path is "${t}".`);return i}function ir(s,e,t){try{const n=gf(s,e),i=n[n.length-1];return i===void 0?t:i}catch{return t}}function Zn(s,e,t,n){const i=ir(s,e);return typeof i=="function"?i.apply(n||s,t):i}function Cv(s){return typeof s=="string"&&s!==""}function Te(s,...e){if(e.length===0)return s;if(e.length===1&&typeof e[0]=="object"&&e[0]){const t=e[0];return Object.keys(t).forEach(n=>{const i=t[n]??"";s=s.replace(new RegExp(`\\{${n}\\}`,"g"),`${i}`)}),s}for(let t=0;t<e.length;t++){const n=e[t]??"";s=s.replace(new RegExp(`\\{${t}\\}`,"g"),`${n}`)}return s}var Ul=(s=>(s[s.B=1]="B",s[s.KB=1024]="KB",s[s.MB=1048576]="MB",s[s.GB=1073741824]="GB",s[s.TB=1099511627776]="TB",s))(Ul||{});function Dt(s,e=2,t){return Number.isNaN(s)?"?KB":(t||(s<1024?t="B":s<1048576?t="KB":s<1073741824?t="MB":s<1099511627776?t="GB":t="TB"),(s/Ul[t]).toFixed(e)+t)}const Fn=s=>{const e=/^[0-9]*(B|KB|MB|GB|TB)$/;s=s.toUpperCase(),s.endsWith("B")||(s+="B");const t=s.match(e);if(!t)return 0;const n=t[1];return s=s.replace(n,""),Number.parseInt(s,10)*Ul[n]};let Vl=(document.documentElement.getAttribute("lang")||"zh_cn").toLowerCase().replace("-","_"),Pn;function yf(){return Vl}function kv(s){Vl=s.toLowerCase().replace("-","_")}function vf(s,e){Pn||(Pn={}),typeof s=="string"&&(s={[s]:e??{}}),_.extend(!0,Pn,s)}function Oe(s,e,t,n,i,r){Array.isArray(s)?Pn&&s.unshift(Pn):s=Pn?[Pn,s]:[s],typeof t=="string"&&(r=i,i=n,n=t,t=void 0);const o=i||Vl;let a;for(const l of s){if(!l)continue;const c=l[o]||l.default;if(!c)continue;const h=r&&l===Pn?`${r}.${e}`:e;if(a=ir(c,h),a!==void 0)break}return a===void 0?n:t?Te(a,...Array.isArray(t)?t:[t]):a}function Sv(s,e,t,n){return Oe(void 0,s,e,t,n)}Oe.addLang=vf,Oe.getLang=Sv,Oe.getCode=yf,Oe.setCode=kv,Oe.map=Pn,vf({zh_cn:{confirm:"确定",save:"保存",cancel:"取消",delete:"删除",reset:"重置",add:"添加",copy:"复制",close:"关闭"},zh_tw:{confirm:"確定",save:"儲存",cancel:"取消",delete:"刪除",reset:"重置",add:"添加",Copy:"複製",close:"關閉"},en:{confirm:"Confirm",save:"Save",cancel:"Cancel",delete:"Delete",reset:"Reset",add:"Add",copy:"Copy",close:"Close"}});function As(s,e,t){t!=null&&(Array.isArray(t)?t.forEach(n=>As(s,e,n)):!(t instanceof Blob)&&_.isPlainObject(t)?Object.entries(t).forEach(([n,i])=>{As(s,`${e}[${n}]`,i)}):s.append(e,t instanceof Blob?t:String(t)))}function Do(s,e){const t=e||new FormData;return s&&(typeof s=="string"&&(s=new URLSearchParams(s)),s instanceof URLSearchParams?s.forEach((n,i)=>{As(t,i,n)}):Array.isArray(s)?s.forEach(([n,i])=>{As(t,n,i)}):s instanceof FormData?s.forEach((n,i)=>{As(t,i,n)}):typeof s=="object"&&s&&Object.entries(s).forEach(([n,i])=>{As(t,n,i)})),t}function xf(s,e,t){s instanceof Headers?s.set(e,t):Array.isArray(s)?s.push([e,t]):s[e]=t}function Dv(s,e){if(s){const t={text:"text/plain",html:"text/html",json:"application/json",...e};for(const[n,i]of Object.entries(t))if(i.split(",").map(r=>r.trim()).includes(s))return n}return"text"}class rr{get completed(){return this.data!==void 0||this.error!==void 0}get[Symbol.toStringTag](){return"Ajax"}constructor(e){this.setting=e,this._controller=new AbortController,this._callbacks={success:[],error:[],complete:[]}}on(e,t){return this._callbacks[e].push(t),this}success(e){return this.on("success",e)}done(e){return this.success(e)}fail(e){return this.on("error",e)}complete(e){return this.on("complete",e)}always(e){return this.complete(e)}then(e,t){return this.completed?t&&this.error?t(this.error):e(this.data):(this.success(n=>e(n)),t&&this.fail(t)),this}catch(e){return this.error?(e(this.error),this):this.on("error",t=>e(t))}finally(e){return this.completed?(e(),this):this.complete(()=>e())}abort(e){return this.completed?!1:(this._abortError=e,this._controller.abort(),!0)}getResponseHeader(e){var t;return(t=this.response)==null?void 0:t.headers.get(e)}_init(){if(this.completed)return;const{url:e,type:t,data:n,processData:i=!0,contentType:r,crossDomain:o,accepts:a,dataType:l,timeout:c,dataFilter:h,beforeSend:u,success:f,error:p,complete:g,...y}=this.setting;t&&(y.method=t);let v=n;v&&(i&&(v=Do(v)),y.body=v),o&&(y.mode="cors");const b=y.headers||{};xf(b,"X-Requested-With","XMLHttpRequest"),r&&xf(b,"Content-Type",r),y.headers=b,y.signal&&y.signal.addEventListener("abort",()=>{this.abort()});const w=[...this.constructor.globalBeforeSends,u];for(const S of w){if(!S)continue;const E=S.call(this,y);if(E===!1)return;E&&Object.assign(y,E)}f&&this.success(f),p&&this.fail(p),g&&this.complete(g),y.signal=this._controller.signal,this.url=e,this.request=y}_emit(e,...t){this._callbacks[e].forEach(n=>{n.call(this,...t)})}async send(){var h;if(this.completed)return[];this._init();const{timeout:e,dataType:t,accepts:n,dataFilter:i,throws:r,jsonParser:o}=this.setting;e&&(this._timeoutID=window.setTimeout(()=>{this.abort(new Error("timeout"))},e));let a,l,c;try{a=await fetch(this.url,this.request),this.response=a;const{statusText:u}=a;if(a.ok){const f=(h=a.headers.get("Content-Disposition"))==null?void 0:h.startsWith("attachment"),p=f?"blob":t||Dv(a.headers.get("Content-Type"),n);f||p==="blob"||p==="file"?c=await a.blob():p==="json"?typeof o=="function"?(c=await a.text(),c=o(c)):c=await a.json():c=await a.text(),this.data=c;const g=(i==null?void 0:i(c,p))??c;this._emit("success",g,u,a)}else throw this.data=await a.text(),new Error(u)}catch(u){this.data===void 0&&c!==void 0&&(this.data=c),l=u;let f=!1;l.name==="AbortError"&&(this._abortError?l=this._abortError:f=!0),this.error=l,f||this._emit("error",l,a==null?void 0:a.statusText,l.message)}if(this._timeoutID&&clearTimeout(this._timeoutID),this._emit("complete",a,a==null?void 0:a.statusText),l&&r)throw l;return[c,l,a]}}rr.globalBeforeSends=[],_.ajax=(s,e)=>{e=e||{},typeof s=="string"?e.url=s:_.extend(e,s);const t=new rr(e);return t.send(),t},_.getJSON=(s,e,t)=>(typeof e=="function"&&(t=e,e=void 0),_.ajax({url:s,data:e,success:t,dataType:"json"})),_.get=(s,e,t,n,i="GET")=>{let r,o;return typeof e=="function"?(r=e,o=void 0):o=e,typeof t=="function"?(r=t,n=void 0):n=t,_.ajax({method:i,url:s,data:o,success:r,dataType:n})},_.post=(s,e,t,n)=>_.get(s,e,t,n,"POST"),_.fn.load=function(s,e,t){typeof e=="function"&&(t=e,e=void 0);const[n,i]=s.split(" ");return _.get(n,e,(r,o,a)=>{i&&(r=_(r).find(i).html()),_(this).html(r).zuiInit(),t==null||t.call(this,r,o,a)},"html"),this};async function Et(s,e=[],t,n,i){const r={throws:!0,dataType:"json"};if(typeof s=="string")r.url=s;else if(typeof s=="object")_.extend(r,s);else if(typeof s=="function"){const l=s.call(n,...e);return l instanceof Promise?await l:l}t&&_.extend(r,typeof t=="function"?t(r):t),r.url&&(r.url=Te(r.url,...e));const o=new rr(r);i==null||i(o);const[a]=await o.send();return a}function Kl(s){return!!(s&&(typeof s=="string"||typeof s=="object"&&s.url||typeof s=="function"))}_.fetch=Et;function Bt(){return _.guid++}function Eo(s,e){if(s===e)return!1;if(s&&e){const t=typeof s,n=typeof e;if(t!==n)return!0;if(t==="object"&&n==="object"){const i=Array.isArray(s),r=Array.isArray(e);if(i!==r)return!0;if(i&&r){if(s.length!==e.length)return!0;for(let l=0;l<s.length;l++)if(Eo(s[l],e[l]))return!0;return!1}const o=Object.keys(s),a=Object.keys(e);if(o.length!==a.length)return!0;for(const l of o)if(Eo(s[l],e[l]))return!0;return!1}if(t==="function"&&n==="function")return s.toString()!==e.toString()}return s!==e}class Ts{constructor(e,t){this._compute=e,this._dependencies=t}get value(){return this.compute()}get cache(){return this._lastDependencies?this._value:this.compute()}depends(e){return this._dependencies=e,this}forceCompute(e){return this._lastDependencies=void 0,this.compute(e)}compute(e){e!==void 0&&(this._dependencies=e),e=this._dependencies,typeof e=="function"&&(e=e());const t=this._lastDependencies;return(!t||e.some((n,i)=>n instanceof Ts?n.value!==t[i]:Eo(n,t[i])))&&(this._value=this._compute(),this._lastDependencies=e.map(n=>n instanceof Ts?n.cache:n)),this._value}}function ql(...s){const e=[],t=new Map,n=(i,r)=>{if(Array.isArray(i)&&(r=i[1],i=i[0]),!i.length)return;const o=t.get(i);typeof o=="number"?e[o][1]=!!r:(t.set(i,e.length),e.push([i,!!r]))};return s.forEach(i=>{typeof i=="function"&&(i=i()),Array.isArray(i)?ql(...i).forEach(n):i&&typeof i=="object"?Object.entries(i).forEach(n):typeof i=="string"&&i.split(" ").forEach(r=>n(r,!0))}),e.sort((i,r)=>(t.get(i[0])||0)-(t.get(r[0])||0))}const ee=(...s)=>ql(...s).reduce((e,[t,n])=>(n&&e.push(t),e),[]).join(" ");_.classes=ee,_.fn.setClass=function(s,...e){return this.each((t,n)=>{const i=_(n);s===!0?i.attr("class",ee(i.attr("class"),...e)):i.addClass(ee(s,...e))})};const di=new WeakMap;function Ao(s,e,t){const n=di.has(s),i=n?di.get(s):{};typeof e=="string"?i[e]=t:e===null?Object.keys(i).forEach(r=>{delete i[r]}):Object.assign(i,e),Object.keys(i).forEach(r=>{i[r]===void 0&&delete i[r]}),Object.keys(i).length?(!n&&s instanceof Element&&Object.assign(i,_(s).dataset(),i),di.set(s,i)):di.delete(s)}function or(s,e,t){let n=di.get(s)||{};return t&&s instanceof Element&&(n=Object.assign({},_(s).dataset(),n)),e===void 0?n:n[e]}function Ev(s){di.delete(s)}_.fn.dataset=_.fn.data,_.fn.data=function(...s){const[e,t]=s;return!s.length||s.length===1&&typeof e=="string"?this.length?or(this[0],e,!0):void 0:this.each((n,i)=>Ao(i,e,t))},_.fn.removeData=function(s=null){return this.each((e,t)=>Ao(t,s))};function $s(s,...e){return s.includes("RAWJS")&&(s=s.split('"RAWJS<').join("").split('>RAWJS"').join("").split("<RAWJS_QUOTE>").join('"').split("<RAWJS_LINE>").join(`
`)),new Function(`return ${s}`)(...e)}function Gl(s,...e){return s.includes("RAWJS")?$s(s,...e):JSON.parse(s)}function Av(s){return JSON.stringify(s,(e,t)=>{if(typeof t=="function")return`RAWJS<${t.toString().split('"').join("<RAWJS_QUOTE>").split(`
`).join("<RAWJS_LINE>")}>RAWJS`})}function fi(s,e){const t=_(s)[0];if(!t)return;const{prefix:n,getter:i,evalValue:r,json:o=!0,evalArgs:a=[]}={prefix:"z-",...typeof e=="string"?{prefix:e}:e},l=Array.isArray(r)?new Set(r):void 0;return Array.from(t.attributes).reduce((c,h)=>{let{name:u}=h;const{value:f}=h;let p=f;if(u.startsWith(n)){if(u=u.slice(n.length).replace(/-([a-z])/g,g=>g[1].toUpperCase()),i)p=i(u,f);else try{r&&(!l||l.has(u))||r===void 0&&f.includes("RAWJS")?p=$s(f,...a):o&&(p=JSON.parse(f))}catch{}c[u]=p}return c},{})}function Yl(s,e,t="z-"){const n=_(s);Object.keys(e).forEach(i=>{let r=e[i];typeof r=="function"&&(r=`RAWJS<${r}>RAWJS`),typeof r!="string"&&(r=JSON.stringify(r)),i=i.replace(/[A-Z]/g,o=>`-${o.toLowerCase()}`),n.attr(`${t}${i}`,r)})}function Tv(...s){var t;const e=s.length;if(!e)return fi(this);if(e===1){const[n]=s;return typeof n=="string"?(t=fi(this))==null?void 0:t[n]:(_.isPlainObject(n)&&Yl(this,n),this)}return Yl(this,{[s[0]]:s[1]}),this}_.fn.z=Tv,_.fn._attr=_.fn.attr,_.fn.extend({attr(...s){const[e,t]=s;return!s.length||s.length===1&&typeof e=="string"?this._attr.apply(this,s):typeof e=="object"?(e&&Object.keys(e).forEach(n=>{const i=e[n];i===null?this.removeAttr(n):this._attr(n,i)}),this):t===null?this.removeAttr(e):this._attr(e,t)}}),_.Event||(_.Event=(s,e)=>{const[t,...n]=s.split("."),i=new Event(t,{bubbles:!0,cancelable:!0});return i.namespace=n.join("."),i.___ot=t,i.___td=e,i});const Is=(s,e)=>new Promise(t=>{const n=window.setTimeout(t,s);e&&e(n)}),_f={};_.share=_f;var To,Qe,bf;P.isValidElement=void 0;var Bs,wf,Cf,Xl,Zl,Ql,Jl,ar={},kf=[],$v=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,$o=Array.isArray;function Qn(s,e){for(var t in e)s[t]=e[t];return s}function Sf(s){s&&s.parentNode&&s.parentNode.removeChild(s)}function k(s,e,t){var n,i,r,o={};for(r in e)r=="key"?n=e[r]:r=="ref"?i=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?To.call(arguments,2):t),typeof s=="function"&&s.defaultProps!=null)for(r in s.defaultProps)o[r]===void 0&&(o[r]=s.defaultProps[r]);return Io(s,o,n,i,null)}function Io(s,e,t,n,i){var r={type:s,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:i??++bf,__i:-1,__u:0};return i==null&&Qe.vnode!=null&&Qe.vnode(r),r}function Ce(){return{current:null}}function Mn(s){return s.children}function ke(s,e){this.props=s,this.context=e}function pi(s,e){if(e==null)return s.__?pi(s.__,s.__i+1):null;for(var t;e<s.__k.length;e++)if((t=s.__k[e])!=null&&t.__e!=null)return t.__e;return typeof s.type=="function"?pi(s):null}function Df(s){var e,t;if((s=s.__)!=null&&s.__c!=null){for(s.__e=s.__c.base=null,e=0;e<s.__k.length;e++)if((t=s.__k[e])!=null&&t.__e!=null){s.__e=s.__c.base=t.__e;break}return Df(s)}}function Ef(s){(!s.__d&&(s.__d=!0)&&Bs.push(s)&&!Bo.__r++||wf!==Qe.debounceRendering)&&((wf=Qe.debounceRendering)||Cf)(Bo)}function Bo(){var s,e,t,n,i,r,o,a;for(Bs.sort(Xl);s=Bs.shift();)s.__d&&(e=Bs.length,n=void 0,r=(i=(t=s).__v).__e,o=[],a=[],t.__P&&((n=Qn({},i)).__v=i.__v+1,Qe.vnode&&Qe.vnode(n),ec(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[r]:null,o,r??pi(i),!!(32&i.__u),a),n.__v=i.__v,n.__.__k[n.__i]=n,Bf(o,n,a),n.__e!=r&&Df(n)),Bs.length>e&&Bs.sort(Xl));Bo.__r=0}function Af(s,e,t,n,i,r,o,a,l,c,h){var u,f,p,g,y,v=n&&n.__k||kf,b=e.length;for(t.__d=l,Iv(t,e,v),l=t.__d,u=0;u<b;u++)(p=t.__k[u])!=null&&(f=p.__i===-1?ar:v[p.__i]||ar,p.__i=u,ec(s,p,f,i,r,o,a,l,c,h),g=p.__e,p.ref&&f.ref!=p.ref&&(f.ref&&tc(f.ref,null,p),h.push(p.ref,p.__c||g,p)),y==null&&g!=null&&(y=g),65536&p.__u||f.__k===p.__k?l=Tf(p,l,s):typeof p.type=="function"&&p.__d!==void 0?l=p.__d:g&&(l=g.nextSibling),p.__d=void 0,p.__u&=-196609);t.__d=l,t.__e=y}function Iv(s,e,t){var n,i,r,o,a,l=e.length,c=t.length,h=c,u=0;for(s.__k=[],n=0;n<l;n++)(i=e[n])!=null&&typeof i!="boolean"&&typeof i!="function"?(o=n+u,(i=s.__k[n]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?Io(null,i,null,null,null):$o(i)?Io(Mn,{children:i},null,null,null):i.constructor===void 0&&i.__b>0?Io(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=s,i.__b=s.__b+1,r=null,(a=i.__i=Bv(i,t,o,h))!==-1&&(h--,(r=t[a])&&(r.__u|=131072)),r==null||r.__v===null?(a==-1&&u--,typeof i.type!="function"&&(i.__u|=65536)):a!==o&&(a==o-1?u--:a==o+1?u++:(a>o?u--:u++,i.__u|=65536))):i=s.__k[n]=null;if(h)for(n=0;n<c;n++)(r=t[n])!=null&&!(131072&r.__u)&&(r.__e==s.__d&&(s.__d=pi(r)),Nf(r,r))}function Tf(s,e,t){var n,i;if(typeof s.type=="function"){for(n=s.__k,i=0;n&&i<n.length;i++)n[i]&&(n[i].__=s,e=Tf(n[i],e,t));return e}s.__e!=e&&(e&&s.type&&!t.contains(e)&&(e=pi(s)),t.insertBefore(s.__e,e||null),e=s.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function No(s,e){return e=e||[],s==null||typeof s=="boolean"||($o(s)?s.some(function(t){No(t,e)}):e.push(s)),e}function Bv(s,e,t,n){var i=s.key,r=s.type,o=t-1,a=t+1,l=e[t];if(l===null||l&&i==l.key&&r===l.type&&!(131072&l.__u))return t;if(n>(l!=null&&!(131072&l.__u)?1:0))for(;o>=0||a<e.length;){if(o>=0){if((l=e[o])&&!(131072&l.__u)&&i==l.key&&r===l.type)return o;o--}if(a<e.length){if((l=e[a])&&!(131072&l.__u)&&i==l.key&&r===l.type)return a;a++}}return-1}function $f(s,e,t){e[0]==="-"?s.setProperty(e,t??""):s[e]=t==null?"":typeof t!="number"||$v.test(e)?t:t+"px"}function Fo(s,e,t,n,i){var r;e:if(e==="style")if(typeof t=="string")s.style.cssText=t;else{if(typeof n=="string"&&(s.style.cssText=n=""),n)for(e in n)t&&e in t||$f(s.style,e,"");if(t)for(e in t)n&&t[e]===n[e]||$f(s.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")r=e!==(e=e.replace(/(PointerCapture)$|Capture$/i,"$1")),e=e.toLowerCase()in s||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),s.l||(s.l={}),s.l[e+r]=t,t?n?t.u=n.u:(t.u=Zl,s.addEventListener(e,r?Jl:Ql,r)):s.removeEventListener(e,r?Jl:Ql,r);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in s)try{s[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!=="-"?s.removeAttribute(e):s.setAttribute(e,e=="popover"&&t==1?"":t))}}function If(s){return function(e){if(this.l){var t=this.l[e.type+s];if(e.t==null)e.t=Zl++;else if(e.t<t.u)return;return t(Qe.event?Qe.event(e):e)}}}function ec(s,e,t,n,i,r,o,a,l,c){var h,u,f,p,g,y,v,b,w,S,E,$,B,N,L,V,M=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(l=!!(32&t.__u),r=[a=e.__e=t.__e]),(h=Qe.__b)&&h(e);e:if(typeof M=="function")try{if(b=e.props,w="prototype"in M&&M.prototype.render,S=(h=M.contextType)&&n[h.__c],E=h?S?S.props.value:h.__:n,t.__c?v=(u=e.__c=t.__c).__=u.__E:(w?e.__c=u=new M(b,E):(e.__c=u=new ke(b,E),u.constructor=M,u.render=Fv),S&&S.sub(u),u.props=b,u.state||(u.state={}),u.context=E,u.__n=n,f=u.__d=!0,u.__h=[],u._sb=[]),w&&u.__s==null&&(u.__s=u.state),w&&M.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=Qn({},u.__s)),Qn(u.__s,M.getDerivedStateFromProps(b,u.__s))),p=u.props,g=u.state,u.__v=e,f)w&&M.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),w&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(w&&M.getDerivedStateFromProps==null&&b!==p&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(b,E),!u.__e&&(u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(b,u.__s,E)===!1||e.__v===t.__v)){for(e.__v!==t.__v&&(u.props=b,u.state=u.__s,u.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(F){F&&(F.__=e)}),$=0;$<u._sb.length;$++)u.__h.push(u._sb[$]);u._sb=[],u.__h.length&&o.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(b,u.__s,E),w&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(p,g,y)})}if(u.context=E,u.props=b,u.__P=s,u.__e=!1,B=Qe.__r,N=0,w){for(u.state=u.__s,u.__d=!1,B&&B(e),h=u.render(u.props,u.state,u.context),L=0;L<u._sb.length;L++)u.__h.push(u._sb[L]);u._sb=[]}else do u.__d=!1,B&&B(e),h=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++N<25);u.state=u.__s,u.getChildContext!=null&&(n=Qn(Qn({},n),u.getChildContext())),w&&!f&&u.getSnapshotBeforeUpdate!=null&&(y=u.getSnapshotBeforeUpdate(p,g)),Af(s,$o(V=h!=null&&h.type===Mn&&h.key==null?h.props.children:h)?V:[V],e,t,n,i,r,o,a,l,c),u.base=e.__e,e.__u&=-161,u.__h.length&&o.push(u),v&&(u.__E=u.__=null)}catch(F){if(e.__v=null,l||r!=null){for(e.__u|=l?160:128;a&&a.nodeType===8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else e.__e=t.__e,e.__k=t.__k;Qe.__e(F,e,t)}else r==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=Nv(t.__e,e,t,n,i,r,o,l,c);(h=Qe.diffed)&&h(e)}function Bf(s,e,t){e.__d=void 0;for(var n=0;n<t.length;n++)tc(t[n],t[++n],t[++n]);Qe.__c&&Qe.__c(e,s),s.some(function(i){try{s=i.__h,i.__h=[],s.some(function(r){r.call(i)})}catch(r){Qe.__e(r,i.__v)}})}function Nv(s,e,t,n,i,r,o,a,l){var c,h,u,f,p,g,y,v=t.props,b=e.props,w=e.type;if(w==="svg"?i="http://www.w3.org/2000/svg":w==="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),r!=null){for(c=0;c<r.length;c++)if((p=r[c])&&"setAttribute"in p==!!w&&(w?p.localName===w:p.nodeType===3)){s=p,r[c]=null;break}}if(s==null){if(w===null)return document.createTextNode(b);s=document.createElementNS(i,w,b.is&&b),a&&(Qe.__m&&Qe.__m(e,r),a=!1),r=null}if(w===null)v===b||a&&s.data===b||(s.data=b);else{if(r=r&&To.call(s.childNodes),v=t.props||ar,!a&&r!=null)for(v={},c=0;c<s.attributes.length;c++)v[(p=s.attributes[c]).name]=p.value;for(c in v)if(p=v[c],c!="children"){if(c=="dangerouslySetInnerHTML")u=p;else if(!(c in b)){if(c=="value"&&"defaultValue"in b||c=="checked"&&"defaultChecked"in b)continue;Fo(s,c,null,p,i)}}for(c in b)p=b[c],c=="children"?f=p:c=="dangerouslySetInnerHTML"?h=p:c=="value"?g=p:c=="checked"?y=p:a&&typeof p!="function"||v[c]===p||Fo(s,c,p,v[c],i);if(h)a||u&&(h.__html===u.__html||h.__html===s.innerHTML)||(s.innerHTML=h.__html),e.__k=[];else if(u&&(s.innerHTML=""),Af(s,$o(f)?f:[f],e,t,n,w==="foreignObject"?"http://www.w3.org/1999/xhtml":i,r,o,r?r[0]:t.__k&&pi(t,0),a,l),r!=null)for(c=r.length;c--;)Sf(r[c]);a||(c="value",w==="progress"&&g==null?s.removeAttribute("value"):g!==void 0&&(g!==s[c]||w==="progress"&&!g||w==="option"&&g!==v[c])&&Fo(s,c,g,v[c],i),c="checked",y!==void 0&&y!==s[c]&&Fo(s,c,y,v[c],i))}return s}function tc(s,e,t){try{if(typeof s=="function"){var n=typeof s.__u=="function";n&&s.__u(),n&&e==null||(s.__u=s(e))}else s.current=e}catch(i){Qe.__e(i,t)}}function Nf(s,e,t){var n,i;if(Qe.unmount&&Qe.unmount(s),(n=s.ref)&&(n.current&&n.current!==s.__e||tc(n,null,e)),(n=s.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(r){Qe.__e(r,e)}n.base=n.__P=null}if(n=s.__k)for(i=0;i<n.length;i++)n[i]&&Nf(n[i],e,t||typeof s.type!="function");t||Sf(s.__e),s.__c=s.__=s.__e=s.__d=void 0}function Fv(s,e,t){return this.constructor(s,t)}function Ns(s,e,t){var n,i,r,o;Qe.__&&Qe.__(s,e),i=(n=typeof t=="function")?null:t&&t.__k||e.__k,r=[],o=[],ec(e,s=(!n&&t||e).__k=k(Mn,null,[s]),i||ar,ar,e.namespaceURI,!n&&t?[t]:i?null:e.firstChild?To.call(e.childNodes):null,r,!n&&t?t:i?i.__e:e.firstChild,n,o),Bf(r,s,o)}To=kf.slice,Qe={__e:function(s,e,t,n){for(var i,r,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((r=i.constructor)&&r.getDerivedStateFromError!=null&&(i.setState(r.getDerivedStateFromError(s)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(s,n||{}),o=i.__d),o)return i.__E=i}catch(a){s=a}throw s}},bf=0,P.isValidElement=function(s){return s!=null&&s.constructor==null},ke.prototype.setState=function(s,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Qn({},this.state),typeof s=="function"&&(s=s(Qn({},t),this.props)),s&&Qn(t,s),s!=null&&this.__v&&(e&&this._sb.push(e),Ef(this))},ke.prototype.forceUpdate=function(s){this.__v&&(this.__e=!0,s&&this.__h.push(s),Ef(this))},ke.prototype.render=Mn,Bs=[],Cf=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Xl=function(s,e){return s.__v.__b-e.__v.__b},Bo.__r=0,Zl=0,Ql=If(!1),Jl=If(!0);function Ie(s,...e){return e.forEach(t=>{!t||typeof t!="object"||Object.keys(t).forEach(n=>{let i=t[n];const r=s[n];i!==r&&(r!==void 0&&(n==="className"||n.endsWith("Class")?i=[r,i]:n==="children"?i=[...No(r),...No(i)]:typeof r=="object"&&(n==="style"||n.endsWith("Style")||n==="attrs"||n.endsWith("Attrs")||n==="props")&&(i=_.extend(r,i))),s[n]=i)})}),s}function nc(s){return Object.keys(s).forEach(e=>{s[e]===void 0&&delete s[e]}),s}function Ff(s,e=!0){const t=_(s),n=t[0],i="zui-disable-scroll";if(e){if(t.data(i))return;if((t.css("scrollbar-gutter")||"").includes("stable")){t.data(i,{overflow:t.css("overflow")}).css("overflow","hidden");return}const r=n===document.body||t.is("html")?window.innerWidth-document.body.clientWidth:n.offsetWidth-n.clientWidth;if(!r)return;const o=t.css("paddingRight")||"0";t.data(i,{paddingRight:o,overflow:t.css("overflow")}).css({paddingRight:`${r+Number.parseInt(o,10)}px`,overflow:"hidden"})}else{const r=t.data(i);if(!r)return;t.css(r).removeData(i)}}_.fn.disableScroll=function(s=!0){return this.each((e,t)=>{Ff(t,s)})},_.fn.enableScroll=function(s=!0){return this.disableScroll(!s)};function sc(s,e,t){if(!(t.on||"click").split(" ").includes(e.type))return;const n=t.selector?_(e.target).closest(t.selector):s;if(!n.length)return;const i=c=>c===""?!0:c,r=c=>{if(typeof c=="string")try{c=JSON.parse(c)}catch{}return c};if(i(t.once)){if(t.onceCalled)return;s.dataset("once-called",!0)}if(i(t.prevent)&&e.preventDefault(),i(t.stop)&&e.stopPropagation(),i(t.self)&&e.currentTarget!==e.target)return;const o=[["$element",s],["event",e],["options",t],["$target",n]],a=c=>typeof c=="function"?c(...o):_.runJS(c,...o);if(t.if!==void 0&&!a(t.if))return;const l=t.call;if(l){let c;if(typeof l=="string"?c=/^[$A-Z_][0-9A-Z_$.]*$/i.test(l)?ir(window,l):a(l):c=l,typeof c=="function"){const h=[],u=t.params;t.params=h,typeof u=="string"&&u.length?u[0]==="["?h.push(...r(u)):h.push(...u.split(", ").map(f=>(f=f.trim(),f==="$element"?s:f==="event"?e:f==="options"?t:f.startsWith("$element.")||f.startsWith("event.")||f.startsWith("options.")?a(f):r(f)))):Array.isArray(u)?h.push(...u):h.push(u),c(...h)}}t.do&&a(t.do)}function Pv(s){const e=_(this),t=s.type,n=e.attr("zui-on");if(n){const[o,a]=n.split("~").map(l=>l.trim());o&&o.split(" ").includes(t)&&sc(e,s,_.extend({on:o},a?a.startsWith("{")?$s(a):{do:a}:fi(e,{prefix:"data-",evalValue:["call","if","do"]})))}const i=e.attr(`zui-on-${t}`);i&&sc(e,s,_.extend({on:t},i.startsWith("{")?$s(i):{do:i}));const r=e.attr("data-on");r&&r.split(" ").includes(t)&&sc(e,s,fi(e,{prefix:"data-",evalValue:["call","if","do"]}))}function Pf(s){_(document).off(".zui.global").on(s.map(e=>`${e}.zui.global`).join(" "),`[zui-on],${s.map(e=>`[zui-on-${e}]`)},[data-on]`,Pv)}_(()=>{Pf(["click","change","inited"])});function Fs(s,e){if(typeof s=="function")return Fs(s(...e||[]));if(typeof s=="number")return[s];let t=s.match(/(\d+)(%|px)?/);return t?[parseInt(t[1]),t[2]]:(t=s.match(/(\d+)\/(\d+)/),t?[100*parseInt(t[1])/parseInt(t[2]),"%"]:[NaN])}function nt(s,e){if(s==null)return null;const[t,n="px"]=Fs(s,e);return Number.isNaN(t)?typeof s=="string"?s:null:`${t}${n}`}async function mi(s,e){var n,i,r;if(s instanceof Blob){const o=document.createElement("a");return o.href=window.URL.createObjectURL(s),e&&(o.download=decodeURIComponent(e)),o.click(),o.remove(),s}if(s instanceof Response){const o=await s.blob();return e=e||((r=(i=(n=s.headers.get("Content-Disposition"))==null?void 0:n.split(";")[1])==null?void 0:i.split("=")[1])==null?void 0:r.replace(/"/g,"")),mi(o,e)}const t=await fetch(s);return mi(t)}class Mf{constructor(e){this._$target=_(e)}on(...e){return this._$target.on(...e),this}one(...e){return this._$target.one(...e),this}off(...e){return this._$target.off(...e),this}trigger(...e){return this._$target.trigger(...e),this}}const bn=new Mf(document);_.bus=bn,_.on=bn.on.bind(bn),_.one=bn.one.bind(bn),_.off=bn.off.bind(bn),_.trigger=bn.trigger.bind(bn);var Mv=["Shift","Meta","Alt","Control"],Rf=typeof navigator=="object"?navigator.platform:"",Lf=/Mac|iPod|iPhone|iPad/.test(Rf),Rv=Lf?"Meta":"Control",Lv=Rf==="Win32"?["Control","Alt"]:Lf?["Alt"]:[];function ic(s,e){return typeof s.getModifierState=="function"&&(s.getModifierState(e)||Lv.includes(e)&&s.getModifierState("AltGraph"))}function zv(s){return s.trim().split(" ").map(function(e){var t=e.split(/\b\+/),n=t.pop();return[t=t.map(function(i){return i==="$mod"?Rv:i}),n]})}function zf(s,e){var t;e===void 0&&(e={});var n=(t=e.timeout)!=null?t:1e3,i=Object.keys(s).map(function(a){return[zv(a),s[a]]}),r=new Map,o=null;return function(a){a instanceof KeyboardEvent&&(i.forEach(function(l){var c=l[0],h=l[1],u=r.get(c)||c;(function(f,p){return!(p[1].toUpperCase()!==f.key.toUpperCase()&&p[1]!==f.code||p[0].find(function(g){return!ic(f,g)})||Mv.find(function(g){return!p[0].includes(g)&&p[1]!==g&&ic(f,g)}))})(a,u[0])?u.length>1?r.set(c,u.slice(1)):(r.delete(c),h(a)):ic(a,a.key)||r.delete(c)}),o&&clearTimeout(o),o=setTimeout(r.clear.bind(r),n))}}function Ov(s,e,t){var n;t===void 0&&(t={});var i=(n=t.event)!=null?n:"keydown",r=zf(e,t);return s.addEventListener(i,r),function(){s.removeEventListener(i,r)}}function rc(s,e={}){if(!s)return;const t=Object.keys(e).reduce((n,i)=>(e[i].optional||(n[i]={...e[i]}),n),{});return Object.keys(s).forEach(n=>{const i=s[n];i?i===!0?e[n]&&(t[n]={...e[n]}):t[n]=i:delete t[n]}),Object.keys(t).reduce((n,i)=>{const{keys:r,handler:o}=t[i];return typeof r=="string"?n[r]=o:r.forEach(a=>{n[a]=o}),n},{})}function oc(s,e,t){const{timeout:n,event:i="keydown",scope:r,when:o}=t||{},a=zf(e,{timeout:n}),l=`.zui.hotkeys${r?`.${r}`:""}`,c="zui-hotkeys-composing";return _(s).on(`${i}${l}`,function(h){o&&o(h)===!1||_(h.target).data(c)||a(h)}).on(`compositionstart${l}`,h=>{_(h.target).data(c,!0)}).on(`compositionend${l}`,h=>{_(h.target).removeData(c)})}function ac(s,e){return _(s).off(`.zui.hotkeys${e?`.${e}`:""}`)}const Hv=Ov;_.fn.hotkeys=function(s,e){return oc(this,s,e)},_.fn.unbindHotkeys=function(s){return ac(this,s)},_.hotkeys=function(s,e){oc(window,s,e)},_.unbindHotkeys=function(s){ac(window,s)};function Po(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}async function Of(s){(typeof s=="string"||s instanceof Element||s instanceof _)&&(s={target:s});const{target:e,onError:t,onSuccess:n,afterExit:i,afterEnter:r}=s,o=_(e),a=o[0];if(!a)return;const l=a.requestFullscreen||a.webkitRequestFullscreen||a.mozRequestFullScreen;if(!l){t==null||t.call(a,new Error("[ZUI] The browser does not support full screen feature."));return}try{await l.call(a),n==null||n.call(a),_(a).off(".zui.fullscreen"),i&&o.on("exitFullscreen.zui.fullscreen",i),r&&o.on("enterFullscreen.zui.fullscreen",r)}catch(c){t==null||t.call(a,c)}document.zuiBindFullscreenChange||(document.zuiBindFullscreenChange=!0,_(document).on("fullscreenchange.zui webkitfullscreenchange.zui mozfullscreenchange.zui",c=>{const h=Po();let u=h;h?_(h).addClass("is-in-fullscreen"):(u=_(document).find(".is-in-fullscreen")[0]||document,_(u).removeClass("is-in-fullscreen")),_("body").toggleClass("has-in-fullscreen",!!h);const f={event:c,target:u,fullscreenElement:h};_(u).trigger(h?"enterFullscreen":"exitFullscreen",f).trigger("toggleFullscreen",f)}))}async function lc(s){const e=Po();return s===!1&&!!e===s?s:e?(document.exitFullscreen(),!1):(await Of(s),!0)}_.fn.fullscreen=function(s){return lc({target:this,...s})},_.getFullscreenElement=Po,_.toggleFullscreen=lc;function Jn(s){return!s||s.parentNode===document?!1:s.parentNode?Jn(s.parentNode):!0}_.isDetached=Jn,_.fn.isDetached=function(){const s=this[0];return!s||Jn(s)};const Ps=class wy{constructor(e,t){var g;this._inited=!1,this._autoDestory=0,this._destroyed=!1;const{KEY:n,DATA_KEY:i,MULTI_INSTANCE:r,NAME:o,ATTR_KEY:a,ALL:l,TYPED_ALL:c}=this.constructor;if(!o)throw new Error('[ZUI] The component must have a "NAME" static property.');const h=_(e);if(h.data(n)&&!r)throw new Error(`[ZUI] The component "${o}" has been initialized on element.`);const u=h[0];if(!u)throw new Error(`[ZUI] Invalid selector "${e}" for component "${o}", can not find the element matched.`);const f=Bt();this._gid=f,this._element=u,this.resetOptions(t),this._key=this.options.key??`__${f}`;let p=l.get(u);if(p?p.add(this):(p=new Set([this]),l.set(u,p)),c.has(o)?c.get(o).add(this):c.set(o,new Set([this])),h.data(n,this).attr(a,"").attr(i,`${f}`).attr("z-use",[...new Set([...p].map(y=>y.constructor.NAME))].join(",")),r){const y=`${n}:ALL`;let v=h.data(y);v||(v=new Map,h.data(y,v)),v.set(this._key,this)}this.init(),(g=this.options.$onCreate)==null||g.call(this),requestAnimationFrame(async()=>{var y;this._inited=!0,await this.afterInit(),this.emit("inited",this.options),(y=this.options.$onInited)==null||y.call(this)})}static get ZUI(){return this.NAME.replace(/(^[A-Z]+)/,e=>e.toLowerCase())}static get KEY(){return`zui.${this.NAME}`}static get NAMESPACE(){return`.zui.${this.ZUI}`}static get DATA_KEY(){return`data-zui-${this.NAME}`}static get ATTR_KEY(){return`z-use-${this.NAME}`}static get SELECTOR(){return`[${this.DATA_KEY}]`}get inited(){return this._inited}get destroyed(){return this._destroyed}get element(){return this._element}get key(){return this._key}get options(){return this._options}get gid(){return this._gid}get $element(){return _(this.element)}get $emitter(){return this.$element}get i18nData(){return[this.options.i18n,this.constructor.i18n]}init(){}afterInit(){}render(e,t){this.setOptions(e,t)}destroy(){var p;const{KEY:e,DATA_KEY:t,ALL:n,TYPED_ALL:i,NAME:r,MULTI_INSTANCE:o,ATTR_KEY:a}=this.constructor,{$element:l,element:c}=this;if(this.emit("destroyed"),this._destroyed=!0,l.off(this.namespace).removeData(e).removeAttr(a).removeAttr(t),o){const g=this.$element.data(`${e}:ALL`);if(g)if(g.delete(this._key),g.size===0)this.$element.removeData(`${e}:ALL`);else{const y=g.values().next().value;l.data(e,y).attr(t,String(y==null?void 0:y.gid))}}const h=n.get(c);h&&(h.delete(this),h.size===0&&n.delete(c));const u=i.get(r);u&&(u.delete(this),u.size===0&&i.delete(r));const f=n.get(c);f!=null&&f.size?l.attr("z-use",[...new Set([...f].map(g=>g.constructor.NAME))].join(",")):l.removeAttr("z-use"),(p=this.options.$onDestroy)==null||p.call(this)}autoDestroy(e=100){this._autoDestory&&clearTimeout(this._autoDestory),this._autoDestory=window.setTimeout(()=>{this._autoDestory=0,Jn(this.element)&&this.destroy()},e)}setOptions(e,t){if(t){const n={...this.constructor.DEFAULT,...(e==null?void 0:e.$optionsFromDataset)!==!1?this.$element.dataset():{},...e},{$options:i}=n;if(i){const r=typeof i=="function"?i.call(this,this.element,n):i;r&&_.extend(n,r),delete n.$options}this._options=n}else e&&_.extend(this._options,e);return this._options}resetOptions(e){return this.setOptions(e,!0)}emit(e,...t){const n=_.Event(e);return n.__src=this,this.$emitter.trigger(n,[this,...t]),n}on(e,t,n){const i=this;this.$element[n!=null&&n.once?"one":"on"](this._wrapEvent(e),function(r,o){(!r.__src||r.__src===i)&&t.call(this,r,o)})}one(e,t){this.on(e,t,{once:!0})}off(e){this.$element.off(this._wrapEvent(e))}i18n(e,t,n){const{i18nData:i}=this;return Oe(i,e,t,n,this.options.lang,this.constructor.NAME)??Oe(i,e,t,n,this.options.lang)??`{i18n:${e}}`}get namespace(){return`${this.constructor.NAMESPACE}.${this._key}`}_wrapEvent(e){return e.split(" ").map(t=>t.includes(".")?t:`${t}${this.namespace}`).join(" ")}static get(e,t){const n=_(e);if(this.MULTI_INSTANCE&&t!==void 0){const i=n.data(`${this.KEY}:ALL`);return i?i.get(t):void 0}return n.data(this.KEY)}static isValid(e){return!0}static ensure(e,t){const n=this.get(e,t==null?void 0:t.key);if(n){if(this.isValid(n))return t&&n.setOptions(t),n;n.destroy()}return new this(e,t)}static getAll(e,t){var l;const{SELECTOR:n,ALL:i,TYPED_ALL:r}=this,o=[],a=c=>{c instanceof this&&(!t||t(c)!==!1)&&o.push(c)};return e?_(e).find(n).each((c,h)=>{var u;(u=i.get(h))==null||u.forEach(a)}):this!==wy?(l=r.get(this.NAME))==null||l.forEach(a):i.forEach(c=>{c.forEach(a)}),o.sort((c,h)=>c.gid-h.gid)}static query(e,t,n){return e===void 0?this.getAll(void 0,n).pop():this.get(_(e).closest(this.SELECTOR),t)}static defineFn(e){let t=e||this.ZUI;_.fn[t]&&(t=`zui${this.NAME}`);const n=this;_.fn.extend({[t](i,...r){const o=typeof i=="object"?i:void 0,a=typeof i=="string"?i:void 0;let l;return this.each((c,h)=>{let u=n.get(h);if(u)o&&u.render(o);else{if(a)return;u=new n(h,o)}if(a){let f=u[a],p=u;f===void 0&&(p=u.$,f=p[a]),typeof f=="function"?l=f.call(p,...r):l=f}}),l!==void 0?l:this}})}static register(e,t){var i,r;e=e||this,t=(t??e.NAME).toLowerCase(),this.map.set(t,e);const n=(r=(i=e.toggle)==null?void 0:i.name)==null?void 0:r.toLowerCase();n&&n!==t&&this.toggleMap.set(n,e)}};Ps.DEFAULT={},Ps.MULTI_INSTANCE=!1,Ps.ALL=new Map,Ps.TYPED_ALL=new Map,Ps.map=new Map,Ps.toggleMap=new Map;let Je=Ps;function lr(s){return Je.map.get(s.toLowerCase())}function Mo(s,e,t={}){let n=lr(s);if(n||(n=cc(s)),!n)return null;const{$update:i,...r}=t;if(!n.MULTI_INSTANCE){const o=n.get(e);if(o)return i&&o.render(r,i==="reset"),o}return new n(e,r)}function jv(s,e,t={}){requestAnimationFrame(()=>Mo(s,e,t))}function Hf(s,e){Je.register(s,e)}function cc(s){const{zui:e}=window;if(e){s=s==null?void 0:s.toLowerCase();for(const t in e){const n=t.toLowerCase()===s;if(s&&!n)continue;const i=e[t];if(!(typeof i!="function"||!i.NAME||!i.ZUI)&&(Je.map.has(t.toLowerCase())||Hf(i),n))return i}}}function Wv(s){var e;s?(e=lr(s))==null||e.defineFn():window._zuiDefined||(cc(),Je.map.forEach(t=>{t.defineFn()}),Object.assign(window,{_zuiDefined:!0}))}function Uv(s,e={}){const t=_(s);let n=t.attr("zui-create");const{update:i,onCreate:r}=e,o=(a,l)=>{if(l={$update:i,$optionsFromDataset:!1,...l},r){const h=r(a,l);if(h===!1)return;h&&(l=h)}const c=l.$lib;if(c){delete l.$lib,_.getLib(c).then(()=>Mo(a,s,l));return}jv(a,s,l)};if(typeof n=="string"){n=n.trim();const a=n.length?n.split(",").map(h=>h.trim()):[],l=fi(s,{prefix:"zui-create-",evalValue:!0}),c=Object.keys(l);if(!c.length&&a.length===1)o(a[0],t.dataset());else{const h=new Set;[...a,...c].forEach(u=>{if(h.has(u))return;const f=l[u];o(u,f),delete l[u],h.add(u)})}}else{const a=t.dataset(),l=a==null?void 0:a.zui;if(!l)return;console.warn("[ZUI] create component instance with [data-zui] is deprecated, use [zui-create] instead.",{element:s,options:e}),delete a.zui,o(l,a)}}function Vv(){_(document).on("click.zui.toggle mouseenter.zui.toggle","[data-toggle],[zui-toggle]",function(s){const e=_(this),t=e.dataset("toggle")||e.attr("zui-toggle");if(!t)return;const n=Je.toggleMap.get(t)||lr(t),i=n==null?void 0:n.toggle;if(!i)return;const{trigger:r="click",skip:o="[disabled],.disabled",check:a}=i,l=s.type==="mouseover"?"hover":"click";if(!r.includes(l)||a&&!a.call(n,this,l,s)||o&&e.is(o))return;const{onGet:c,onCreate:h,setOptions:u=!0,getOptions:f,prevent:p=!0,handler:g,onToggle:y,convertHref:v}=i;let b=e.dataset();const w=e.attr(`zui-toggle-${t}`);if(w&&(b=_.extend(b,$s(w))),v&&e.is("a")){const E=e.attr("href");if(E){const $=v===!0?{selector:"target",url:"url"}:v;"#.".includes(E[0])?$.selector&&b[$.selector]===void 0&&(b[$.selector]=E):$.url&&b[$.url]===void 0&&(b[$.url]=E)}}if(f&&(b=f.call(n,this,b,s)),g){g.call(n,this,b,l,s),p&&s.preventDefault();return}let S=c?c.call(n,this):n.get(this);if(S)u&&S.setOptions(b);else{const E=h?h.call(n,this,s,b):new n(this,b);if(!E)return;S=E}if(y){if(y.call(n,S,this,s)===!1)return}else{const{shown:E,show:$,hide:B,toggle:N}=S;let L;if(N?L=N:$&&B?E?L=B:L=$:$&&(L=$),L)L.call(S);else return}p&&s.preventDefault()})}function Kv(s,e){const t=or(s),n=[];return Object.keys(t).forEach(i=>{if(!i.startsWith("zui."))return;const r=t[i];(e==null?void 0:e(r,i))!==!1&&n.push(t[i])}),n}let Ro=0;function jf(s=100){if(Ro&&clearTimeout(Ro),s){Ro=window.setTimeout(()=>jf(0),s);return}Ro=0,Je.ALL.forEach(e=>{e.forEach(t=>t.autoDestroy())})}function qv(){if(!document.body||or(document.body,"_autoDestoryMob"))return;const s=new MutationObserver(e=>{let t=!1;for(const n of e)if(n.removedNodes.length){t=!0;break}t&&jf()});s.observe(document.body,{childList:!0,subtree:!0}),Ao(document.body,"_autoDestoryMob",s)}function hc(s,e){const t=_(s);t.find("[zui-create],[data-zui]").each(function(){var n;((n=e==null?void 0:e.beforeCreate)==null?void 0:n.call(e,this))!==!1&&Uv(this,e)}),t.find("[zui-init]").each(function(){this.hasAttribute("z-zui-inited")||(this.setAttribute("z-zui-inited",""),_.runJS(this.getAttribute("zui-init"),["$element",_(this)]))}),t.find(".hide-before-init").removeClass("invisible hidden opacity-0"),t.find(".scroll-into-view").scrollIntoView(),t.find('[data-on="inited"],[zui-on-inited]').each((n,i)=>{const r=_(i);r.zui()||r.trigger("inited")}),e!=null&&e.runJS&&t.runJS()}_.fn.zuiInit=function(s){return hc(this,s),this},_.fn.zui=function(s,e){const t=this[0];if(!t)return;if(typeof s!="string"){const i={};let r;return Kv(t,(o,a)=>{i[a]=o,(!r||r.gid<o.gid)&&(r=i[a])}),s===!0?i:r}const n=lr(s);return n?e===!0?n.getAll(t):n.query(t,e):_(t).data(`zui.${s}`)},_.fn.zuiCall=function(s,e=[]){return this.each(function(){const t=s.split("."),n=t.length>1?t[0]:void 0,i=t[t.length>1?1:0],r=_(this).zui(n),o=r==null?void 0:r[i];typeof o=="function"&&o.apply(r,e)}),this},_(()=>{_("body").zuiInit({update:!0}),Vv(),qv()});class Lo extends Je{get $targets(){const{$element:e}=this,{targets:t}=this.options;return t?e.find(t):e}_handleScroll(e,t,n){const{offset:i=1}=this.options,r=this.$targets,o=e.getBoundingClientRect(),{scrollTop:a,scrollLeft:l}=e;r.each((c,h)=>{const u=h.getBoundingClientRect(),f=t==="top"&&a>0&&u.top<=o.top+i||t==="bottom"&&u.bottom>=o.bottom-i||t==="left"&&l>0&&u.left<=o.left+i||t==="right"&&l<e.scrollWidth-e.clientWidth;h.classList.toggle(n,f)})}init(){const{offset:e=1,side:t="top",zIndex:n,pinnedClass:i="is-pinned",scrollContainer:r}=this.options,{$element:o,$targets:a}=this;if(a.css({position:"sticky",zIndex:n,[t]:0}),r){const l=o.closest(r)[0]||o.find(r)[0];if(l){const c=()=>{this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0,this._handleScroll(l,t,i)})};this._scrollListener=c,l.addEventListener("scroll",c)}this._container=l,requestAnimationFrame(()=>{this._handleScroll(l,t,i)})}else this._ob=new IntersectionObserver(l=>{l.forEach(c=>{c.target.classList.toggle(i,c.intersectionRatio<e)})},{threshold:[1]}),a.css("side",-e).each((l,c)=>this._ob.observe(c))}destroy(){var e;(e=this._ob)==null||e.disconnect(),this._container&&(this._container.removeEventListener("scroll",this._scrollListener),this._raf&&cancelAnimationFrame(this._raf))}}Lo.NAME="Sticky";const gi=24*60*60*1e3,et=s=>s===void 0?new Date:(s instanceof Date||(typeof s=="string"&&(s=s.trim(),/^\d+$/.test(s)&&(s=Number.parseInt(s,10))),typeof s=="number"&&s<1e10&&(s*=1e3),s=new Date(s)),s),Wf=(s,e,t="day")=>{if(typeof e=="string"){const n=Number.parseInt(e,10);t=e.replace(n.toString(),""),e=n}return s=new Date(et(s).getTime()),t==="month"?s.setMonth(s.getMonth()+e):t==="year"?s.setFullYear(s.getFullYear()+e):t==="week"?s.setDate(s.getDate()+e*7):t==="hour"?s.setHours(s.getHours()+e):t==="minute"?s.setMinutes(s.getMinutes()+e):t==="second"?s.setSeconds(s.getSeconds()+e):s.setDate(s.getDate()+e),s},es=(s,e=new Date)=>et(s).toDateString()===et(e).toDateString(),cr=(s,e=new Date)=>et(s).getFullYear()===et(e).getFullYear(),uc=(s,e=new Date)=>(s=et(s),e=et(e),s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth()),Gv=(s,e=new Date)=>{s=et(s),e=et(e);const t=1e3*60*60*24,n=Math.floor(s.getTime()/t),i=Math.floor(e.getTime()/t);return Math.floor((n+4)/7)===Math.floor((i+4)/7)},Yv=(s,e)=>es(et(e),s),Xv=(s,e)=>es(et(e).getTime()-gi,s),Zv=(s,e)=>es(et(e).getTime()+gi,s),dc=s=>s!=null&&!isNaN(et(s).getTime()),gt=(s,e="yyyy-MM-dd hh:mm",t="")=>{if(s=et(s),!dc(s))return t;if(typeof e=="function")return e(s);const n={"M+":s.getMonth()+1,"d+":s.getDate(),"h+":s.getHours(),"H+":s.getHours()%12,"m+":s.getMinutes(),"s+":s.getSeconds(),"S+":s.getMilliseconds()};return/(y+)/i.test(e)&&(e.includes("[yyyy-]")&&(e=e.replace("[yyyy-]",cr(s)?"":"yyyy-")),e=e.replace(RegExp.$1,`${s.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(n).forEach(i=>{if(new RegExp(`(${i})`).test(e)){const r=`${n[i]}`;e=e.replace(RegExp.$1,RegExp.$1.length===1?r:`00${r}`.substring(r.length))}}),e},Qv=(s,e,t)=>{const n={full:"yyyy-M-d",month:"M-d",day:"d",str:"{0} ~ {1}",...t},i=gt(s,cr(s)?n.month:n.full);if(es(s,e))return i;const r=gt(e,cr(s,e)?uc(s,e)?n.day:n.month:n.full);return n.str.replace("{0}",i).replace("{1}",r)};function fc(s){let e=0;if(typeof s!="string"&&(s=String(s)),s&&s.length)for(let t=0;t<s.length;++t)e+=(t+1)*s.charCodeAt(t);return e}function zo(s){if(!s)return;if(typeof s=="object")return s;if(s=s.replace(/^#/,""),!s.length)return;s.startsWith("/")||(s=`/${s}`);const e=new URL(window.location.origin+s),[,t="",...n]=e.pathname.split("/");let i=t.trim();if(!i.length)return;let r="";return i.includes("~")&&([r,i]=i.split("~")),{name:i,scope:r,options:Object.fromEntries([...e.searchParams.entries()].map(([o,a])=>{try{a.includes("%")&&(a=decodeURIComponent(a)),a=JSON.parse(a)}catch{}return[o,a]})),params:n.map(o=>{if(o!=="undefined"){if(o==="null")return null;try{return o.includes("%")&&(o=decodeURIComponent(o)),JSON.parse(o)}catch{return o}}})}}function Uf(s){if(Array.isArray(s))return{commands:s.map(zo).filter(Boolean)};if(typeof s=="object")return s;s=s.replace(/^#!?/,"");const e=s.includes(">"),t=s.split(e?">":"|").map(zo);return{async:e,commands:t.filter(Boolean)}}function pc(s,e,t){if(typeof s=="string"&&(s=zo(s)),!s)return;const{execute:n,event:i,scope:r}=e;if(!(r&&s.scope&&s.scope!==r))return n({name:s.name,options:{...e.options,...s.options},event:i,scope:s.scope,prevResult:t},s.params)}async function Vf(s,e){const{async:t,commands:n}=Uf(s);if(!n.length)return[];const{signal:i}=e;if(t){const o=[];let a;for(const l of n){if(!(i!=null&&i.aborted))break;a=await pc(l,e,a),i!=null&&i.aborted&&(a=void 0),o.push(a)}return o}return await Promise.all(n.map(o=>{if(!(i!=null&&i.aborted))return pc(o,e)}))}const yi="zui.commands",vi="z-commands",mc="zui-commands-proxy",Kf="zui-command",Oo={};function Jv(s,e){typeof s=="string"&&e?Oo[s]=e:typeof s=="object"&&Object.assign(Oo,s)}function Ho(s,e){typeof e=="string"?e={scope:e}:typeof e=="function"&&(e={onCommand:e});const{scope:t="",events:n="click"}=e??{},i=_(s),r=(i.attr(vi)||"").split(",");t&&!r.includes(t)&&r.push(t),i.attr(vi,r.join(",")).data(yi,{[t]:{...e,scope:t,events:n,gid:Bt()},...i.data(yi)})}function jo(s,e=!0){const t=_(s);if(e===!0)t.removeAttr(vi),t.removeData(yi);else if(e.length){const n=t.data(yi)||{};e.split(",").forEach(r=>{delete n[r]});const i=Object.keys(n);i.length?t.attr(vi,i.join(",")).data(yi,Ho):jo(t,!0)}}function qf(s,e){let t=s.closest(`[${vi}],[${mc}]`).first();if(t.attr(mc)!==void 0&&(t=_(t.data("zui.commandProxy")||t.attr(mc)).closest(`[${vi}]`)),!t.length)return;const n=t.data(yi)||{},i=Object.values(n).sort((o,a)=>a.gid-o.gid);let r;return e!=null&&e.length?(r=i.find(o=>o.scope===e),r||(r=i.find(o=>{var a;return!((a=o.scope)!=null&&a.length)&&!o.scoped})),r):(r=i.find(o=>{var a;return!((a=o.scope)!=null&&a.length)&&!o.scoped}),r||(r=i.find(o=>!o.scoped)),r?r.element=t[0]:r=qf(s.parent(),e),r)}function ex(s){if(!s.currentTarget)return;const e=_(s.currentTarget);if(e.closest(".disabled,[disabled]").length)return;const t=e.attr(Kf)||(e.is('a[href^="#!"]')?e.attr("href"):"");if(!t)return;const n=new AbortController,i=()=>n.abort();Vf(t,{signal:n.signal,execute:(r,o)=>{const{scope:a,name:l}=r,c={...r,abort:i};let h;const u=qf(e,a);if(u){c.element=u.element;const p=(u.commands?u.commands[`${a}~${l}`]||u.commands[l]:null)||u.onCommand;if(p&&(h=p(c,o),s.commandHandled))return h}const f=[c,o];if(e.trigger("command",f).trigger(`command:${a?`${l}.${a}`:l}`,f),a&&e.trigger(`command:.${a}`,f),s.commandHandled)return h;if(a==="event"){l==="stop"?s.stopPropagation():l==="prevent"?s.preventDefault():Zn(s,l,o);return}return a==="window"?Zn(window,l,o):a==="zui"?Zn(window.zui,l,o):a==="target"?Zn(e[0],l,o):a==="$target"?Zn(e,l,o):a==="$"?Zn(_,l,o):a===""&&Oo[l]!==void 0?Oo[l](c,o):h},event:s})}_.fn.command=function(s,e){return this.on(`command:${s}`,e)},_.fn.offCommand=function(s,e){return this.off(`command:${s}`,e)},_.fn.commands=function(s){return this.each((e,t)=>Ho(t,s)),this},_.fn.unbindCommands=function(s){return this.each((e,t)=>jo(t,s)),this},_(()=>{_(document).on("click.zui.command",`[${Kf}],a[href^="#!"]`,ex)});function hr(s,e,t=!1){var i;const n=_(s);if(e!==void 0){if(typeof e=="string"&&e.length){const r=`zui-runjs-${Bt()}`;n.append(`<script id="${r}">${e}<\/script>`),t&&n.find(`#${r}`).remove()}return}if(n.is("script")){const r=(i=n[0])==null?void 0:i.textContent;r&&hr(n.parent(),r);return}n.find("script").each((r,o)=>{hr(n,o.textContent),o.remove()})}_.runJS=(s,...e)=>(s=s.trim(),!s.startsWith("return ")&&!s.endsWith(";")&&(s=`return ${s}`),new Function(...e.map(([n])=>n),s)(...e.map(([,n])=>n))),_.fn.runJS=function(s){return this.each((e,t)=>{hr(t,s)})};function tx(s){return new Promise(e=>{typeof s=="string"&&(s={accept:s});const t=document.createElement("input");t.type="file",t.accept=(s==null?void 0:s.accept)||"*/*",t.multiple=(s==null?void 0:s.multiple)||!1,t.onchange=()=>{t.files?e(t.multiple?t.files:t.files[0]):e(null),t.remove()},t.click()})}function nx(s){return new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=i=>{t(i)},n.readAsText(s)})}function ur(s,e={}){const t=_(s)[0];if(!t)return!1;let{viewport:n}=e;const{left:i,top:r,width:o,height:a}=t.getBoundingClientRect();if(e.checkZeroSize&&!(o*a))return!1;if(!n)if(e.container)n=_(t).closest(e.container)[0].getBoundingClientRect();else{const{innerHeight:g,innerWidth:y}=window,{clientHeight:v,clientWidth:b}=document.documentElement;n={left:0,top:0,width:y||b,height:g||v}}const{left:l,top:c,width:h,height:u}=n;if(e.fullyCheck)return i>=l&&r>=c&&i+o<=h+l&&r+a<=u+c;const f=i<=l+h&&i+o>=l;return r<=c+u&&r+a>=c&&f}_.fn.isVisible=function(s){return ur(this,s)};function sx(s,e="both"){return(e==="vert"||e==="both")&&s.clientHeight<s.scrollHeight||(e==="horz"||e==="both")&&s.clientWidth<s.scrollWidth}function Gf(s,e){const t=_(s),{ifNeeded:n=!0,container:i,...r}=e||{};return t.each((o,a)=>{if(i){const l=_(a).closest(i);if(!l.length||!sx(l[0]))return}if(n){if(a.scrollIntoViewIfNeeded)return a.scrollIntoViewIfNeeded(r);if(ur(a,{viewport:a.getBoundingClientRect()}))return}a.scrollIntoView(r)}),t}_.fn.scrollIntoView=function(s){return this.each((e,t)=>{Gf(t,s)})},_.setLibRoot=function(s,e){_.libRoot=s,e&&(_.libVersion=e)},_.registerLib=function(s,e){_.libMap||(_.libMap={}),!e.name&&e.id&&(e.id=`zui-lib-${s}`),_.libMap[s]=e},_.libVersion=1747356558548 .toString(36);function Yf(s){return new Promise((e,t)=>{typeof s=="string"&&(s={src:s});const{src:n,id:i,version:r}=s;if(_(i?`#${i}`:`link[href^="${n}"]`).length){e();return}const a=document.createElement("link");a.onload=()=>{e()},a.onerror=()=>{t(new Error(`[ZUI] Failed to load CSS from: ${n}`))},a.rel="stylesheet",a.href=`${n}${r?`${n.includes("?")?"&":"?"}v=${r}`:""}`,i&&(a.id=i),_("head").append(a)})}function Xf(s){return new Promise((e,t)=>{typeof s=="string"&&(s={src:s});const{src:n,id:i,version:r}=s,o=_(i?`#${i}`:`script[src^="${n}"]`);if(o.length){if(o.dataset("loaded"))e();else{const p=o.data("loadCalls")||[];p.push(e),o.data("loadCalls",p)}return}const{async:a=!0,defer:l=!1,noModule:c=!1,type:h,integrity:u}=s,f=document.createElement("script");f.async=a,f.defer=l,f.noModule=c,h&&(f.type=h),u&&(f.integrity=u),f.onload=()=>{e(),(_(f).dataset("loaded",!0).data("loadCalls")||[]).forEach(g=>g()),_(f).removeData("loadCalls")},f.onerror=()=>{t(new Error(`[ZUI] Failed to load JS from: ${n}`))},_("head").append(f),f.src=`${n}${r?`${n.includes("?")?"&":"?"}v=${r}`:""}`})}function Zf(s){return new Promise(e=>{typeof s=="string"&&(s={type:"module",src:s});const{src:t,imports:n,srcList:i=[],id:r}=s;t&&i.unshift({src:t,imports:n});const o=i.map(b=>b.src).join(","),a=_(r?`#${r}`:`script[data-src-list="${o}"]`);if(a.length){const b=a.data("module");if(b)e(b);else{const w=a.data("resolves")||[];w.push(e),a.data("resolves",w)}return}const{async:l=!0,defer:c=!1,integrity:h,globalVar:u,resolve:f}=s,p=document.createElement("script"),g=`zui-module-resolve-${_.guid++}`,y=_(p);Object.assign(window,{[g]:b=>{(y.data("module",b).data("resolves")||[]).forEach(S=>S(b)),y.removeData("resolves"),f==null||f(b),e(b),delete window[g]}}),p.async=l,p.defer=c,p.type="module",y.attr("data-src-list",o).attr("data-resolve-id",g);const v=[];p.text=[...i.map(({src:b,imports:w})=>{if(n){if(typeof w=="string")return v.push(w),`import * as ${w} from '${b}';`;if(w)return v.push(...Object.values(w)),`import {${Object.entries(w).map(([S,E])=>`${S} as ${E}`).join(",")}} from '${b}';`}return`import '${b}';`}),`const zuiImportResult = {${v.map(b=>`${b}: ${b},`)}};`,u?`Object.assign(window, ${u===!0?"zuiImportResult":`{${u}: zuiImportResult}`});`:"",`if(window['${g}']) window['${g}'](zuiImportResult);`].join(`
`),h&&(p.integrity=h),_("head").append(p)})}_.getLib=async function(s,e,t){var y;typeof s=="string"&&(s=((y=_.libMap)==null?void 0:y[s])||{src:s});let n=Array.isArray(s)?{src:s}:_.extend({},s);typeof e=="function"?n.success=e:e&&_.extend(n,e),t&&(n.success=t);let{src:i}=n;const{name:r,success:o}=n,a=_.libMap&&r?_.libMap[r]:null;if(a&&(n=_.extend({},a,n),i=a.src||n.src),typeof i=="string"&&(i=[i]),!i||!i.length)throw new Error("[ZUI] No src provided for $.getLib.");let{check:l=!0}=n;l===!0&&r&&(l=r);const c=typeof l=="string"?l:r;let h;const u=()=>c?window[c]||h:void 0;typeof l=="string"&&(l=()=>!!u());const f=()=>(o==null||o(),u());if(typeof l=="function"&&await l())return f();const{root:p=_.libRoot,version:g=_.libVersion}=n;for(let v of i){typeof v=="string"&&(v={src:v});let{src:b}=v;p&&!/https?:\/\//.test(b)&&(b=`${p}${p.endsWith("/")||b.startsWith("/")?"":"/"}${b}`);const w={...n,...v,version:g,src:b};if(v.type==="css"||!v.type&&b.endsWith(".css")){await Yf(w);continue}if(w.type==="module"){h=await Zf(w);continue}await Xf(w)}return f()},_.getScript=_.getLib;function Qf(s,e){const t=_(s),n=new ResizeObserver(e);return t.each((i,r)=>{n.observe(r)}),n}_.fn.resize=function(s){return Qf(this,s)};const ix=Object.freeze(Object.defineProperty({__proto__:null,isElementDetached:Jn,isVisible:ur,listenResize:Qf,loadCSS:Yf,loadJS:Xf,loadModule:Zf,scrollIntoView:Gf},Symbol.toStringTag,{value:"Module"}));var gc,Kt,yc,Jf,ep=0,tp=[],pt=Qe,np=pt.__b,sp=pt.__r,ip=pt.diffed,rp=pt.__c,op=pt.unmount,ap=pt.__;function rx(s,e){pt.__h&&pt.__h(Kt,s,ep||e),ep=0;var t=Kt.__H||(Kt.__H={__:[],__h:[]});return s>=t.__.length&&t.__.push({}),t.__[s]}function lp(s,e){var t=rx(gc++,7);return lx(t.__H,e)&&(t.__=s(),t.__H=e,t.__h=s),t.__}function ox(){for(var s;s=tp.shift();)if(s.__P&&s.__H)try{s.__H.__h.forEach(Wo),s.__H.__h.forEach(vc),s.__H.__h=[]}catch(e){s.__H.__h=[],pt.__e(e,s.__v)}}pt.__b=function(s){Kt=null,np&&np(s)},pt.__=function(s,e){s&&e.__k&&e.__k.__m&&(s.__m=e.__k.__m),ap&&ap(s,e)},pt.__r=function(s){sp&&sp(s),gc=0;var e=(Kt=s.__c).__H;e&&(yc===Kt?(e.__h=[],Kt.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.i=t.__N=void 0})):(e.__h.forEach(Wo),e.__h.forEach(vc),e.__h=[],gc=0)),yc=Kt},pt.diffed=function(s){ip&&ip(s);var e=s.__c;e&&e.__H&&(e.__H.__h.length&&(tp.push(e)!==1&&Jf===pt.requestAnimationFrame||((Jf=pt.requestAnimationFrame)||ax)(ox)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.i=void 0})),yc=Kt=null},pt.__c=function(s,e){e.some(function(t){try{t.__h.forEach(Wo),t.__h=t.__h.filter(function(n){return!n.__||vc(n)})}catch(n){e.some(function(i){i.__h&&(i.__h=[])}),e=[],pt.__e(n,t.__v)}}),rp&&rp(s,e)},pt.unmount=function(s){op&&op(s);var e,t=s.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{Wo(n)}catch(i){e=i}}),t.__H=void 0,e&&pt.__e(e,t.__v))};var cp=typeof requestAnimationFrame=="function";function ax(s){var e,t=function(){clearTimeout(n),cp&&cancelAnimationFrame(e),setTimeout(s)},n=setTimeout(t,100);cp&&(e=requestAnimationFrame(t))}function Wo(s){var e=Kt,t=s.__c;typeof t=="function"&&(s.__c=void 0,t()),Kt=e}function vc(s){var e=Kt;s.__c=s.__(),Kt=e}function lx(s,e){return!s||s.length!==e.length||e.some(function(t,n){return t!==s[n]})}var cx=Symbol.for("preact-signals");function Uo(){if(ts>1)ts--;else{for(var s,e=!1;fr!==void 0;){var t=fr;for(fr=void 0,xc++;t!==void 0;){var n=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&up(t))try{t.c()}catch(i){e||(s=i,e=!0)}t=n}}if(xc=0,ts--,e)throw s}}function dr(s){if(ts>0)return s();ts++;try{return s()}finally{Uo()}}var Ge=void 0;function hx(s){var e=Ge;Ge=void 0;try{return s()}finally{Ge=e}}var fr=void 0,ts=0,xc=0,Vo=0;function hp(s){if(Ge!==void 0){var e=s.n;if(e===void 0||e.t!==Ge)return e={i:0,S:s,p:Ge.s,n:void 0,t:Ge,e:void 0,x:void 0,r:e},Ge.s!==void 0&&(Ge.s.n=e),Ge.s=e,s.n=e,32&Ge.f&&s.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=Ge.s,e.n=void 0,Ge.s.n=e,Ge.s=e),e}}function yt(s){this.v=s,this.i=0,this.n=void 0,this.t=void 0}yt.prototype.brand=cx,yt.prototype.h=function(){return!0},yt.prototype.S=function(s){this.t!==s&&s.e===void 0&&(s.x=this.t,this.t!==void 0&&(this.t.e=s),this.t=s)},yt.prototype.U=function(s){if(this.t!==void 0){var e=s.e,t=s.x;e!==void 0&&(e.x=t,s.e=void 0),t!==void 0&&(t.e=e,s.x=void 0),s===this.t&&(this.t=t)}},yt.prototype.subscribe=function(s){var e=this;return ln(function(){var t=e.value,n=Ge;Ge=void 0;try{s(t)}finally{Ge=n}})},yt.prototype.valueOf=function(){return this.value},yt.prototype.toString=function(){return this.value+""},yt.prototype.toJSON=function(){return this.value},yt.prototype.peek=function(){var s=Ge;Ge=void 0;try{return this.value}finally{Ge=s}},Object.defineProperty(yt.prototype,"value",{get:function(){var s=hp(this);return s!==void 0&&(s.i=this.i),this.v},set:function(s){if(s!==this.v){if(xc>100)throw new Error("Cycle detected");this.v=s,this.i++,Vo++,ts++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{Uo()}}}});function at(s){return new yt(s)}function up(s){for(var e=s.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function dp(s){for(var e=s.s;e!==void 0;e=e.n){var t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){s.s=e;break}}}function fp(s){for(var e=s.s,t=void 0;e!==void 0;){var n=e.p;e.i===-1?(e.S.U(e),n!==void 0&&(n.n=e.n),e.n!==void 0&&(e.n.p=n)):t=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=n}s.s=t}function xi(s){yt.call(this,void 0),this.x=s,this.s=void 0,this.g=Vo-1,this.f=4}(xi.prototype=new yt).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Vo))return!0;if(this.g=Vo,this.f|=1,this.i>0&&!up(this))return this.f&=-2,!0;var s=Ge;try{dp(this),Ge=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return Ge=s,fp(this),this.f&=-2,!0},xi.prototype.S=function(s){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}yt.prototype.S.call(this,s)},xi.prototype.U=function(s){if(this.t!==void 0&&(yt.prototype.U.call(this,s),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}},xi.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var s=this.t;s!==void 0;s=s.x)s.t.N()}},Object.defineProperty(xi.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var s=hp(this);if(this.h(),s!==void 0&&(s.i=this.i),16&this.f)throw this.v;return this.v}});function Ye(s){return new xi(s)}function pp(s){var e=s.u;if(s.u=void 0,typeof e=="function"){ts++;var t=Ge;Ge=void 0;try{e()}catch(n){throw s.f&=-2,s.f|=8,_c(s),n}finally{Ge=t,Uo()}}}function _c(s){for(var e=s.s;e!==void 0;e=e.n)e.S.U(e);s.x=void 0,s.s=void 0,pp(s)}function ux(s){if(Ge!==this)throw new Error("Out-of-order effect");fp(this),Ge=s,this.f&=-2,8&this.f&&_c(this),Uo()}function pr(s){this.x=s,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}pr.prototype.c=function(){var s=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{s()}},pr.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,pp(this),dp(this),ts++;var s=Ge;return Ge=this,ux.bind(this,s)},pr.prototype.N=function(){2&this.f||(this.f|=2,this.o=fr,fr=this)},pr.prototype.d=function(){this.f|=8,1&this.f||_c(this)};function ln(s){var e=new pr(s);try{e.c()}catch(t){throw e.d(),t}return e.d.bind(e)}var bc;function _i(s,e){Qe[s]=e.bind(null,Qe[s]||function(){})}function Ko(s){bc&&bc(),bc=s&&s.S()}function mp(s){var e=this,t=s.data,n=fx(t);n.value=t;var i=lp(function(){for(var r=e.__v;r=r.__;)if(r.__c){r.__c.__$f|=4;break}return e.__$u.c=function(){var o;!P.isValidElement(i.peek())&&((o=e.base)==null?void 0:o.nodeType)===3?e.base.data=i.peek():(e.__$f|=1,e.setState({}))},Ye(function(){var o=n.value.value;return o===0?0:o===!0?"":o||""})},[]);return i.value}mp.displayName="_st",Object.defineProperties(yt.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:mp},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}}),_i("__b",function(s,e){if(typeof e.type=="string"){var t,n=e.props;for(var i in n)if(i!=="children"){var r=n[i];r instanceof yt&&(t||(e.__np=t={}),t[i]=r,n[i]=r.peek())}}s(e)}),_i("__r",function(s,e){Ko();var t,n=e.__c;n&&(n.__$f&=-2,(t=n.__$u)===void 0&&(n.__$u=t=function(i){var r;return ln(function(){r=this}),r.c=function(){n.__$f|=1,n.setState({})},r}())),Ko(t),s(e)}),_i("__e",function(s,e,t,n){Ko(),s(e,t,n)}),_i("diffed",function(s,e){Ko();var t;if(typeof e.type=="string"&&(t=e.__e)){var n=e.__np,i=e.props;if(n){var r=t.U;if(r)for(var o in r){var a=r[o];a!==void 0&&!(o in n)&&(a.d(),r[o]=void 0)}else t.U=r={};for(var l in n){var c=r[l],h=n[l];c===void 0?(c=dx(t,l,h,i),r[l]=c):c.o(h,i)}}}s(e)});function dx(s,e,t,n){var i=e in s&&s.ownerSVGElement===void 0,r=at(t);return{o:function(o,a){r.value=o,n=a},d:ln(function(){var o=r.value.value;n[e]!==o&&(n[e]=o,i?s[e]=o:o?s.setAttribute(e,o):s.removeAttribute(e))})}}_i("unmount",function(s,e){if(typeof e.type=="string"){var t=e.__e;if(t){var n=t.U;if(n){t.U=void 0;for(var i in n){var r=n[i];r&&r.d()}}}}else{var o=e.__c;if(o){var a=o.__$u;a&&(o.__$u=void 0,a.d())}}s(e)}),_i("__h",function(s,e,t,n){(n<3||n===9)&&(e.__$f|=2),s(e,t,n)}),ke.prototype.shouldComponentUpdate=function(s,e){var t=this.__$u;if(!(t&&t.s!==void 0||4&this.__$f)||3&this.__$f)return!0;for(var n in e)return!0;for(var i in s)if(i!=="__source"&&s[i]!==this.props[i])return!0;for(var r in this.props)if(!(r in s))return!0;return!1};function fx(s){return lp(function(){return at(s)},[])}const wc={};function ut(s,e){typeof s=="object"?Object.keys(s).forEach(t=>{ut(t,s[t])}):e&&(wc[s.toLowerCase()]=e)}function gp(s){return wc[s.toLowerCase()]}class tt extends ke{constructor(e){super(e),this._gid=Bt(),this.state=this.getDefaultState(e)}get gid(){return this._gid}get element(){return document.querySelector(`[z-gid-${this._gid}]`)}get i18nData(){return[this.props.i18n,this.constructor.i18n]}get commandScope(){return this.constructor.NAME}getDefaultState(e){return{}}resetState(e,t){const n=this.getDefaultState(e);t?this.state=n:this.changeState(n)}i18n(e,t,n){const{i18nData:i}=this;return Oe(i,e,t,n,this.props.lang,this.constructor.NAME)??Oe(i,e,t,n,this.props.lang)??`{i18n:${e}}`}changeState(e,t){return new Promise(n=>{this.setState(e,()=>{t==null||t(),n(this.state)})})}executeCommand(e,t=[]){const{onCommand:n,commands:i}=this.props;let r;typeof e=="string"&&(e={name:e});const{scope:o,name:a}=e,l=i?i[`${o}~${a}`]||i[a]:null;return l?l.call(this,e,t):((!e.scope||e.scope===this.commandScope)&&(r=Zn(this,e.name,t)),n&&(r=n.call(this,e,t)),r)}_getClassName(e){return e.className}_getProps(e){const{className:t,attrs:n,props:i,data:r,forwardRef:o,children:a,component:l,style:c,class:h,commands:u,onCommand:f,...p}=e,g=new Set(this.constructor.customProps),y="dangerouslySetInnerHTML",v=Object.keys(p).reduce((b,w)=>{if(!g.has(w)&&(w===y||/^(on[A-Z]|data-|zui-|z-)[a-zA-Z-]+/.test(w))){const S=p[w];b[w]=w!==y&&S&&typeof S=="object"?JSON.stringify(S):S}return b},{});return{ref:o,className:ee(this._getClassName(e),h)||void 0,style:c,[`z-gid-${this._gid}`]:"",...v,...n,...i}}_getComponent(e){const{component:t="div"}=e;return(typeof t=="string"?gp(t):t)||t}_getChildren(e){return e.children}_beforeRender(e){return e}_onRender(e,t,n,i){return[e,t,n]}componentDidMount(){const{commands:e,onCommand:t}=this.props;(e||t)&&Ho(this.element,{commands:e,scope:this.commandScope,onCommand:this.executeCommand.bind(this)})}componentWillUnmount(){const{commands:e,onCommand:t}=this.props;(e||t)&&jo(this.element,this.commandScope)}render(e){e=this._beforeRender(e)||e;let t=this._getComponent(e),n=this._getChildren(e),i=this._getProps(e);const r=this._onRender(t,i,n,e);return r&&([t,i,n]=r),k(t,i,n)}}tt.HElement=!0,tt.customProps=[];class Cc extends tt{constructor(e){super(e),this.signals={};const{state:t}=this;this.changeState(t),this.state={}}changeState(e,t){return new Promise(n=>{dr(()=>{typeof e=="function"&&(e=e(this.state));for(const i in e){const r=this.signals[i];r?r.value=e[i]:this.signals[i]=at(e[i])}n(this.state),t==null||t()})})}resetState(e){this.changeState(this.getDefaultState(e))}}Cc.HElementSignals=!0;var px=0;function A(s,e,t,n,i,r){e||(e={});var o,a,l=e;"ref"in e&&(o=e.ref,delete e.ref);var c={type:s,props:l,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--px,__i:-1,__u:0,__source:i,__self:r};if(typeof s=="function"&&(o=s.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return Qe.vnode&&Qe.vnode(c),c}class Rn extends ke{constructor(){super(...arguments),this._ref=Ce()}_runJS(){this.props.executeScript&&_(this._ref.current).runJS().zuiInit()}componentDidMount(){this._runJS()}componentDidUpdate(e){this.props.html!==e.html&&this._runJS()}render(e){const{executeScript:t,html:n,...i}=e;return A(tt,{forwardRef:this._ref,dangerouslySetInnerHTML:{__html:n},...i})}}function yp(s){const{tag:e,className:t,style:n,renders:i,generateArgs:r=[],generatorThis:o,generators:a,onGenerate:l,onRenderItem:c,...h}=s,u=[t],f={...n},p=[],g=[];return i.forEach(y=>{const v=[];if(typeof y=="string"&&a&&a[y]&&(y=a[y]),typeof y=="function")if(l)v.push(...l.call(o,y,p,...r));else{const b=y.call(o,p,...r);b&&(Array.isArray(b)?v.push(...b):v.push(b))}else v.push(y);v.forEach(b=>{b!=null&&(typeof b=="object"&&!P.isValidElement(b)&&("html"in b||"__html"in b||"className"in b||"style"in b||"attrs"in b||"children"in b)?b.html?p.push(A("div",{className:ee(b.className),style:b.style,dangerouslySetInnerHTML:{__html:b.html},...b.attrs??{}})):b.__html?g.push(b.__html):(b.style&&Object.assign(f,b.style),b.className&&u.push(b.className),b.children&&p.push(b.children),b.attrs&&Object.assign(h,b.attrs)):p.push(b))})}),g.length&&Object.assign(h,{dangerouslySetInnerHTML:{__html:g}}),[{className:ee(u),style:f,...h},p]}function kc({tag:s="div",...e}){const[t,n]=yp(e);return k(s,t,...n)}class qo extends ke{constructor(){super(...arguments),this.state={},this._ref=Ce()}async load(e){const{props:t}=this,{fetcher:n,type:i,fetcherArgs:r,fetcherThis:o=this,clearBeforeLoad:a}=t;this.setState({loading:!0,error:void 0,...a?{content:void 0}:{}});try{const l=await Et(e||n,r,{throws:!0,dataType:i==="custom"?"json":"text"},o,c=>{this._ajax=c});this.setState({content:l,loading:!1})}catch(l){this.setState({error:l,loading:!1})}this._ajax=void 0}componentDidMount(){this.load(),_(this._ref.current).on("loadContent.zui",(e,t)=>{e.stopPropagation(),this.load(t)})}componentDidUpdate(e){(this.props.fetcher!==e.fetcher||this.props.fetcherArgs!==e.fetcherArgs||this.props.fetcherThis!==e.fetcherThis)&&this.load()}componentWillUnmount(){var e;(e=this._ajax)==null||e.abort(),_(this._ref.current).off(".zui")}_renderContent(e,t){const{loading:n,error:i,content:r=""}=this.state,{loadingContent:o,errorText:a,type:l,clearBeforeLoad:c,...h}=t;return n&&c?o:i?a??i.message:l==="html"?A(Rn,{html:r,executeScript:!0,...h}):l==="text"?r:A(Se,{content:r,...h})}render(e){const{loading:t}=this.state,{id:n,loadingClass:i,loadingIndicator:r,className:o,style:a,attrs:l,loadingText:c,...h}=e;return A("div",{id:n,ref:this._ref,className:ee("lazy-content",o,t?i:"",r?"load-indicator":""),"data-loading":c,style:a,...l,children:this._renderContent(e,h)})}}qo.defaultProps={type:"html",loadingIndicator:!0,loadingClass:"loading",clearBeforeLoad:!0};function Go(s){const{content:e,generatorArgs:t,generatorThis:n,...i}=s;let r=e;if(typeof r=="function"&&(r=r.call(n,...t||[])),Array.isArray(r))return r.map(o=>Go({...i,content:o,generatorThis:n,generatorArgs:t}));if(typeof r=="string"||typeof r=="number")return Object.keys(i).length?A("div",{...i,children:r}):r;if(r&&typeof r=="object"&&(typeof r.html=="string"||r.component||r.fetcher)){if(r.fetcher)return A(qo,{...Ie(i,r)});if(r.html)return A(Rn,{...Ie(i,r)});const{children:o,...a}=r;return o&&(r=Ie({children:(Array.isArray(o)?o:[o]).map(l=>Go({...i,content:l,generatorThis:n,generatorArgs:t}))},a)),A(tt,{...Ie(i,r)})}return P.isValidElement(r)?r:(r&&(console.groupCollapsed("[ZUI] CustomContent format error"),console.trace("content:",r),console.log("props:",s),console.groupEnd()),null)}function Se(s){const e=Go(s);return e==null||typeof e=="boolean"?null:P.isValidElement(e)?e:A(Mn,{children:e})}class vp extends ke{render(e){return Se(e)}}const xp=s=>s.startsWith("icon-")?s:`icon-${s}`;function Re(s){const{icon:e,className:t,...n}=s;if(!e)return null;if(P.isValidElement(e))return e;const i=["icon",t];if(typeof e=="string")i.push(xp(e));else if(typeof e=="object"){const{className:r,icon:o,...a}=e;i.push(r,o?xp(o):""),Object.assign(n,a)}return A("i",{className:ee(i),...n})}function mx(s){return this.getChildContext=()=>s.context,s.children}function Sc(s){const e=this,t=s._container;e.componentWillUnmount=function(){Ns(null,e._temp),e._temp=null,e._container=null},e._container&&e._container!==t&&e.componentWillUnmount(),s._vnode?(e._temp||(e._container=t,e._temp={nodeType:1,parentNode:t,childNodes:[],appendChild(n){this.childNodes.push(n),e._container.appendChild(n)},insertBefore(n,i){this.childNodes.push(n),e._container.appendChild(n)},removeChild(n){this.childNodes.splice(this.childNodes.indexOf(n)>>>1,1),e._container.removeChild(n)}}),Ns(k(mx,{context:e.context},s._vnode),e._temp)):e._temp&&e.componentWillUnmount()}function _p(s,e){const t=k(Sc,{_vnode:s,_container:e});return t.containerInfo=e,t}ut({HElement:tt,element:tt,HtmlContent:Rn,html:Rn,CustomContent:Se,LazyContent:qo,custom:Se,lazy:qo,Icon:Re,Portal:Sc});class Ee extends Je{constructor(){super(...arguments),this._ref=Ce()}get $(){return this._ref.current}get i18nData(){const{i18n:e,i18nData:t}=this.constructor.Component;return t?[...t,this.constructor.i18n]:[e,...super.i18nData]}afterInit(){this.render()}destroy(){var e,t;(t=(e=this.$)==null?void 0:e.componentWillUnmount)==null||t.call(e),this.element&&(this.element.innerHTML=""),super.destroy()}_getRenderProps(e){return{ref:this._ref,...e}}render(e,t){var u;const{element:n,$:i}=this,{Component:r,replace:o}=this.constructor,{$replace:a=o,$optionsFromDataset:l,...c}=this.setOptions(e,t),h=this._getRenderProps(c);if(t&&((u=i==null?void 0:i.resetState)==null||u.call(i,c)),a&&r.HElement&&(n.tagName.toLowerCase()===a||a===!0)){const f=Array.from(n.attributes).reduce((p,g)=>{const{name:y,value:v}=g;return p[y==="class"?"className":y]=v,p},{});Ns(k(r,Ie({component:n.tagName.toLowerCase(),attrs:f},h)),n.parentElement,n)}else Ns(k(r,h),n)}static renderHTML(e){const t=document.createElement("div");return Ns(k(this.Component,e),t),t.innerHTML}}Ee.replace=!1;class Yo extends Ee{}Yo.NAME="Custom",Yo.Component=vp,Yo.register();class $e extends tt{_beforeRender(e){const{text:t,loading:n,loadingText:i,caret:r,icon:o,trailingIcon:a,children:l}=e;this._isEmptyText=t==null||typeof t=="string"&&!t.length||n&&!i,this._onlyCaret=r&&this._isEmptyText&&!o&&!a&&!l&&!n}_getChildren(e){const{loading:t,loadingIcon:n,loadingText:i,icon:r,iconClass:o,text:a,textClass:l,children:c,trailingIcon:h,trailingIconClass:u,caret:f}=e;return[t?A(Re,{icon:n||"icon-spinner-snake",className:"spin"}):A(Re,{icon:r,className:o}),this._isEmptyText?null:A("span",{className:ee("text",l),children:t?i:a}),t?null:c,t?null:A(Re,{icon:h,className:u}),t?null:f?A("span",{className:typeof f=="string"?`caret-${f}`:"caret"}):null]}_getClassName(e){const{type:t,className:n,disabled:i,loading:r,active:o,children:a,square:l,size:c,rounded:h}=e;return["btn",t,n,{"btn-caret":this._onlyCaret,disabled:i||r,active:o,loading:r,square:l===void 0?!this._onlyCaret&&!a&&this._isEmptyText:l},c?`size-${c}`:"",typeof h=="string"?`rounded-${h}`:{rounded:h}]}_getComponent(e){return e.component||(e.url?"a":"button")}_getProps(e){const t=this._getComponent(e),{url:n,target:i,disabled:r,btnType:o="button",hint:a,command:l}=e,c=t==="a",h={...super._getProps(e),type:c?void 0:"button",disabled:!c&&r?"":void 0,title:a};return o&&(["button","reset","submit"].includes(o)?t==="button"&&(h.type=o):h.className=ee([h.className,o])),r||(n!==void 0&&(h[c?"href":"data-url"]=n),i!==void 0&&(h[c?"target":"data-target"]=i),l&&(h["zui-command"]=l)),h}}ut(Object.freeze(Object.defineProperty({__proto__:null,Button:$e},Symbol.toStringTag,{value:"Module"})));const SC="",DC="",EC="",AC="",TC="";let Nt=class extends tt{constructor(e){super(e),this._handleClick=this._handleClick.bind(this)}get name(){return this.props.name||this.constructor.NAME}get itemName(){return this.props.itemName||this.constructor.ITEM_NAME}getItems(){return this._items}getRenderedItem(e){return this._renderedItems.find(t=>t.key===e)}getItem(e){return this._items[this.getItemIndex(e)]}getItemIndex(e){return this._renderedItems.findIndex(t=>t.key===e)}getItemByIndex(e){return this._items[e]}getKey(e){var t,n;return(n=(t=this._renderedItems)==null?void 0:t[e])==null?void 0:n.key}_getItemFromEvent(e,t){var l;const n=(t||e.target).closest("[z-item]");if(!n||!((l=n.parentElement)!=null&&l.hasAttribute(`z-gid-${this._gid}`)))return;const i=+n.getAttribute("z-item"),r=this._items[i];if(!r)return;const o=this.getKey(i);if(o===void 0)return;const a=this._renderedItems[i];return{index:i,item:r,element:n,event:e,key:o,renderedItem:a,relativeTarget:this.props.relativeTarget}}_handleClick(e){var n,i;const t=this._getItemFromEvent(e);if(t)return(n=this.props.onClickItem)==null||n.call(this,t),(i=t.item.onClick)==null||i.call(this,e,t),t}_renderItem(e,t,n){const{beforeRenderItem:i}=e;if(i){const c=i.call(this,t,n);c!==void 0&&(t=c)}const{type:r}=t;let{itemRender:o}=e;if(o&&typeof o=="object"&&(o=o[r]),o){const c=o.call(this,t,n);if(c!==void 0)return A(Se,{"z-key":t.key,"z-item":n,"z-type":r,content:c})}const{ItemComponents:a}=this.constructor;let l=a[r];if(!l&&t.component)return A(Se,{"z-key":t.key,"z-item":n,"z-type":r,content:{...t}});if(l=l||a.default||tt,Array.isArray(l)){let c=l[1];typeof c=="function"&&(c=c.call(this,t,e)),t=Ie({},c,t),l=l[0]}return A(l,{"z-key":t.key,"z-item":n,"z-type":r,...t})}_getItem(e,t,n){if(!t)return!1;const{itemProps:i,itemPropsMap:r={},getItem:o,itemKey:a}=e,{type:l=this.constructor.defaultItemType}=t,{name:c,itemName:h}=this,{defaultItemProps:u={},defaultItemPropsMap:f={}}=this.constructor;if(t=Ie({type:l},u,f[l],i,r[l],{className:[c?`${c}-${l}`:"",h]},t,{_item:t,_index:n,key:String((a?t[a]:t.key)??t.key??n),onClick:void 0}),o){const p=o.call(this,t,n);if(p!==void 0)return p}return t}_getProps(e){const t=super._getProps(e);return{onClick:this._handleClick,...t}}_getClassName(e){return[this.name,e.className]}_getItems(e){let{items:t=[]}=e;typeof t=="function"?t=t.call(this):Array.isArray(t)||(t=[]);const{getItems:n}=e;if(n){const i=n.call(this,t);if(i!==void 0)return i}return t}_renderItems(e,t){return this._renderedItems=t.map((n,i)=>{const r=this._getItem(e,n,i);return r||void 0}),this._renderedItems.reduce((n,i,r)=>(i&&n.push(this._renderItem(e,i,r)),n),[])}_getChildren(e){const t=this._getItems(e);this._items=t;const n=this._renderItems(e,t);return e.children&&n.push(e.children),n}_getComponent(e){return e.component||this.constructor.TAG}};Nt.NAME="",Nt.ITEM_NAME="item",Nt.TAG="ul",Nt.ItemComponents={default:tt,divider:[tt,{className:"divider"}],space:[tt,s=>{const{space:e,flex:t,style:n}=s;return{style:{width:e,height:e,flex:t,...n}}}]},Nt.defaultItemProps={component:"li"},Nt.defaultItemPropsMap={},Nt.defaultItemType="item",Nt.defaultProps={itemKey:"id"};const gx=Object.freeze(Object.defineProperty({__proto__:null,CommonList:Nt},Symbol.toStringTag,{value:"Module"}));class mr extends Ee{}mr.NAME="CommonList",mr.Component=Nt,mr.replace=Nt.TAG,mr.register(),ut(gx);const $C="",IC="",BC="",NC="",FC="",PC="";function yx(s){if(s.indexOf("#")===0&&(s=s.slice(1)),s.length===3&&(s=s[0]+s[0]+s[1]+s[1]+s[2]+s[2]),s.length!==6)throw new Error(`Invalid HEX color "${s}".`);return[parseInt(s.slice(0,2),16),parseInt(s.slice(2,4),16),parseInt(s.slice(4,6),16)]}function vx(s){const[e,t,n]=typeof s=="string"?yx(s):s;return e*.299+t*.587+n*.114>186}function bp(s,e){return vx(s)?(e==null?void 0:e.dark)??"#333333":(e==null?void 0:e.light)??"#ffffff"}function wp(s,e=255){return Math.min(Math.max(s,0),e)}function xx(s,e,t){s=s%360/360,e=wp(e),t=wp(t);const n=t<=.5?t*(e+1):t+e-t*e,i=t*2-n,r=o=>(o=o<0?o+1:o>1?o-1:o,o*6<1?i+(n-i)*o*6:o*2<1?n:o*3<2?i+(n-i)*(2/3-o)*6:i);return[r(s+1/3)*255,r(s)*255,r(s-1/3)*255]}function _x(s,e){return/^[\u4e00-\u9fa5\s]+$/.test(s)?s.length<=e?s:s.substring(s.length-e):/^[A-Za-z\d\s]+$/.test(s)?s[0].toUpperCase():s.length<=e?s:s.substring(0,e)}let bi=class extends ke{render(){const{className:e,style:t,size:n="",circle:i,rounded:r,background:o,foreColor:a,icon:l,text:c,code:h,displayText:u,maxTextLength:f=2,src:p,hueDistance:g=43,saturation:y=.4,lightness:v=.6,children:b,...w}=this.props,S=["avatar",e],E={...t,background:o,color:a};let $=32;n&&(typeof n=="number"?(E.width=`${n}px`,E.height=`${n}px`,E.fontSize=`${Math.max(12,Math.round(n/2))}px`,$=n):(S.push(`size-${n}`),$={xs:20,sm:24,lg:48,xl:80}[n])),i?S.push("circle"):r&&(typeof r=="number"?E.borderRadius=`${r}px`:S.push(`rounded-${r}`));let B;if(p)S.push("has-img"),B=A("img",{className:"avatar-img",src:p,alt:c});else if(l)S.push("has-icon"),B=A(Re,{icon:l});else if(c!=null&&c.length||u!=null&&u.length){const N=u??_x(c,f),L=N.length;S.push("has-text",`has-text-${L}`);let V;$&&$<16*L&&(V={transform:`scale(${$/(16*L)})`,whiteSpace:"nowrap"}),B=A("div",{"data-actualSize":$,className:"avatar-text",style:V,children:N})}if(!p)if(o===void 0){const N=h??c??u,L=(typeof N=="number"?N:fc(N))*g%360;if(E.background=`hsl(${L},${y*100}%,${v*100}%)`,!a){const V=xx(L,y,v);E.color=bp(V)}}else!a&&o&&/#?[0-9a-fA-F]{6}/.test(o)&&(E.color=bp(o));return A("div",{className:ee(S),style:E,...w,children:[B,b]})}};const bx=Object.freeze(Object.defineProperty({__proto__:null,Avatar:bi},Symbol.toStringTag,{value:"Module"}));let cn=class extends Nt{_isBtnType({type:e}){return e==="item"||e==="dropdown"}_getItem(e,t,n){if(!t)return!1;t.type||(t=_.extend({type:t.dropdown||t.items?"dropdown":"item"},t));let i=super._getItem(e,t,n);return i&&(this._isBtnType(i)&&(i=Ie({},this._shareBtnProps,i)),i)}_beforeRender(e){const{btnProps:t,btnType:n,size:i}=e;this._shareBtnProps=Ie({},t,nc({btnType:n,size:i}))}};cn.NAME="btn-group",cn.TAG="nav",cn.ItemComponents={...Nt.ItemComponents,default:$e},cn.defaultItemProps={component:void 0};const Xo=class Cy extends cn{_getProps(e){const{gap:t}=e,n=super._getProps(e);return t&&(typeof t=="number"?n.className=ee(n.className,`gap-${t}`):n.style=_.extend(n.style||{},{gap:t})),n}_getItem(e,t,n){const i=super._getItem(e,t,n);if(!i)return i;const{type:r}=i,o=r==="btn-group"||r==="btnGroup";return o&&(i.btnProps=Ie({},this._shareBtnProps,i.btnProps)),(o||r==="dropdown")&&!i.relativeTarget&&(i.relativeTarget=e.relativeTarget),i}static render(e,t,n,i){let r=typeof e=="function"?e.call(i??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),n&&(r=Ie(n,r)),A(Cy,{...r})}};Xo.NAME="toolbar",Xo.defaultProps={btnProps:{btnType:"ghost"}},Xo.ItemComponents={...cn.ItemComponents,btnGroup:cn,"btn-group":cn};let Xe=Xo;const wx=Object.freeze(Object.defineProperty({__proto__:null,Toolbar:Xe},Symbol.toStringTag,{value:"Module"}));class wi extends tt{constructor(e){super(e),this._handleChange=t=>{const{onChange:n}=this.props,i=t.target.indeterminate?"indeterminate":t.target.checked;n&&n.call(this,t,i),this._controlled||this.setState({checked:i})},this.state={checked:e.checked??e.defaultChecked??!1},this._controlled=e.checked!==void 0}get checked(){return this._controlled?this.props.checked:this.state.checked}_getClassName(e){const{disabled:t,type:n="checkbox"}=e,{checked:i}=this;return[e.className,n==="switch"?n:`${n}-primary`,{disabled:t,checked:i===!0,indeterminate:i==="indeterminate"}]}_getChildren(e){const{name:t,type:n,value:i,id:r,label:o}=e,{checked:a}=this;return[t?A("input",{type:n==="radio"?n:"checkbox",name:t,id:r,value:i,onChange:this._handleChange,indeterminate:a==="indeterminate",checked:typeof a=="boolean"?a:void 0},"input"):null,A("label",{htmlFor:r,children:A(Se,{content:o})},"label")]}}class Cx extends wi{}Cx.defaultProps={type:"radio"};class kx extends wi{}kx.defaultProps={type:"switch"};class wn extends tt{_renderLeading(e){const{icon:t,iconClass:n,avatar:i,toggleIcon:r,leading:o,leadingClass:a,checked:l,checkbox:c,multiline:h}=e,u=[];if(r&&u.push(A(Se,{content:r},"toggleIcon")),l!==void 0&&u.push(A(wi,{className:"item-checkbox",checked:l,...c},"checkbox")),t&&u.push(A(Re,{className:ee("item-icon",n),icon:t},"icon")),i){const p=typeof i=="function"?i.call(this,e):i;p&&(p.className=ee("item-avatar",p.className),u.push(A(bi,{...p},"avatar")))}const f=o?A(Se,{content:o},"leading"):null;return f&&u.push(f),h?u.length?[A("div",{className:ee("item-leading",a),children:u},"leading")]:[]:u}_renderContent(e,t){const{textClass:n,titleClass:i,titleAttrs:r,subtitle:o,subtitleClass:a,url:l,target:c,content:h,contentClass:u,contentAttrs:f}=e,p=l&&!t,g=p?"a":"div";let{title:y,text:v}=e;return y===void 0&&(y=v,v=null),[A("div",{className:ee("item-content",u),...f,children:[y?A(g,{className:ee("item-title",i),href:p?l:void 0,target:p?c:void 0,...r,children:A(Se,{content:y})},"title"):null,o?A("div",{className:ee("item-subtitle",a),children:A(Se,{content:o})},"subtitle"):null,v?A("div",{className:ee("item-text text",n),children:v},"text"):null,h?A(Se,{content:h},"extraContent"):null]},"content")]}_renderTrailing(e){const{multiline:t,trailing:n,trailingClass:i,trailingIcon:r,trailingIconClass:o,actions:a}=e,l=[];r&&l.push(A(Re,{className:ee("item-trailing-icon",o),icon:r},"trailing-icon")),a&&l.push(Xe.render(a,[e],{key:"actions",className:"item-actions",relativeTarget:e,size:"sm"},this));const c=n?A(Se,{content:n},"trailing"):null;return c&&l.push(c),t?l.length?[A("div",{className:ee("item-trailing",i),children:[l,c]},"trailing")]:[]:l}_render(e,t){const{innerComponent:n,innerClass:i,innerAttrs:r,url:o,actions:a,target:l,active:c,disabled:h,divider:u,checked:f,multiline:p,title:g,subtitle:y,hint:v,selected:b,command:w,hover:S}=e,E=n||(o&&!a?"a":"div"),$=E==="a",B=Ie({key:"item",title:v,className:ee("listitem",i,{active:c,disabled:h,"has-divider":u,"no-hover":S===!1,selected:b,checked:f,multiline:p??!!(g&&y),state:$&&!h})},w?{"zui-command":w}:null,$?{href:o||"javascript:;",target:l}:null,t,r);return A(E,{...B,children:[this._renderLeading(e),this._renderContent(e,$),this._renderTrailing(e)]})}_onRender(e,t,n,i){const r=Object.keys(t).reduce((o,a)=>(a.startsWith("data-")&&(o[a]=t[a],delete t[a]),o),{});return[e,t,[this._render(i,r),...No(n)]]}}let kt=class extends Nt{constructor(e){super(e),this._activeSet=new Ts(()=>{const t=new Set,{active:n}=this.props;Array.isArray(n)?n.forEach(r=>t.add(r)):typeof n=="string"?t.add(n):n&&Object.keys(n).forEach(r=>n[r]&&t.add(r));const{activeMap:i}=this.state;return Object.keys(i).forEach(r=>i[r]?t.add(r):t.delete(r)),t},()=>[this.state.activeMap,this.props.active]),this.state={checked:{},activeMap:{}}}get namespace(){return`.zui.${this.constructor.NAME}.list_${this.gid}`}get isLazyItems(){const{items:e}=this.props;return e&&!Array.isArray(e)}componentDidMount(){this._afterRender(!0),this.tryLoad(),this.props.activeOnHover&&!this.props.multipleActive&&_(this.element).on(`mouseenter${this.namespace}`,"[z-item]",e=>{const t=this._getItemFromEvent(e);t&&t.renderedItem.type==="item"&&!t.renderedItem.disabled&&t.renderedItem.hover!==!1&&!this.isActive(t.key)&&this.toggleActive(t.key,!0)})}componentDidUpdate(){this._afterRender(!1),this.tryLoad()}componentWillUnmount(){var e;_(this.element).off(this.namespace),(e=this.props.beforeDestroy)==null||e.call(this)}setItems(e,t){const{onLoadFail:n}=this.props;return this.changeState({loading:!1,items:e||[],loadFailed:t?(typeof n=="function"?n.call(this,t):n)||String(t):void 0})}load(){const{items:e,onLoad:t}=this.props;this._loadedSetting=e,this.setState({loading:!0,items:[]},async()=>{try{const n=await Et(e,[this],{throws:!0});this.setItems((t==null?void 0:t.call(this,n))||n)}catch(n){this.setItems(void 0,n)}})}tryLoad(){const{loading:e}=this.state,{items:t}=this.props;return e||!t||Array.isArray(t)||t===this._loadedSetting?!1:(this.load(),!0)}isChecked(e,t,n=!1){const i=(typeof t=="number"?this._items[t]:this.getItem(e))||{};return this.state.checked[e]??i.checked??n}isAllChecked(){return this._renderedItems.every(({key:e},t)=>this.isChecked(e,t)===!0)}toggleAllChecked(e){return e===void 0&&(e=!this.isAllChecked()),this.toggleChecked(this._renderedItems.map(t=>t.key),e)}async toggleChecked(e,t){let n;if(Array.isArray(e)){if(!e.length)return;t===void 0&&(t=!this.isChecked(e[0])),n=e.reduce((i,r)=>(i[r]=t,i),{})}else if(typeof e=="object")n=e;else{const i=this.isChecked(e);t===void 0&&(t=!i),n={[e]:t}}Object.keys(n).length&&await this.changeState(i=>({checked:{...i.checked,...n}}),()=>{var r;const i=this.state.checked;(r=this.props.onCheck)==null||r.call(this,n,Object.keys(i).filter(o=>i[o]===!0))})}getChecks(){return this._renderedItems.reduce((e,{key:t},n)=>(t!==void 0&&this.isChecked(t,n)===!0&&e.push(t),e),[])}isActive(e){return typeof e=="object"&&(e=e.key),this._activeSet.cache.has(e)}getActiveKeys(){return[...this._activeSet.value]}getActiveKey(){return this.getActiveKeys()[0]}async toggleActive(e,t){typeof e=="string"&&(e=[e]),e.length&&(t=t??!this.isActive(e[0]),await this.changeState(n=>({activeMap:this.props.multipleActive?e.reduce((r,o)=>(r[o]=t,r),{...n.activeMap}):{[e[0]]:t}}),()=>{var n;(n=this.props.onActive)==null||n.call(this,e,t)}))}getNextItem(e,t,n=1,i=void 0){i=i||this._renderedItems,t=t||(l=>l.type==="item"&&!l.disabled);const r=i.length;let o=e===void 0?r-1:i.findIndex(l=>l.key===e),a=0;for(;a<r;){o=(o+n+r)%r;const l=i[o];if(l&&!l.hidden&&t.call(this,l,o))return l;a++}}getPrevItem(e,t){return this.getNextItem(e,t,-1)}activeNext(e,t=1){const n=this.getNextItem(this.getActiveKey(),e,t);n&&this.toggleActive(n.key)}activePrev(e){this.activeNext(e,-1)}_afterRender(e){var t;(t=this.props.afterRender)==null||t.call(this,e)}_beforeRender(e){var t;return(t=this.props.beforeRender)==null?void 0:t.call(this,e)}_getItems(e){const{items:t}=e,{items:n}=this.state;return n||(Array.isArray(t)?t:[])}_getRenderedItem(e,t,n){const{divider:i,multiline:r}=e;t=Ie({},nc({divider:i,multiline:r}),t);const{itemName:o,name:a}=this;if(t.innerClass=[o?`${o}-inner${a?` ${a}-${t.type}-inner`:""}`:"",t.innerClass],t.type==="item"){const{checkbox:l}=e;t.checkbox===!1?t.checked=void 0:(l||t.checkbox)&&(t.checked=this.isChecked(t.key,n,t.checked),typeof l=="object"&&t.checkbox!==!1&&(t.checkbox=t.checkbox?_.extend({},l,t.checkbox):l),e.selectOnChecked&&t.checked===!0&&(t.selected=!0)),t.active===void 0&&this.isActive(t)&&(t.active=!0)}return t.icon&&(this._hasIcons=!0),t.checked!==void 0&&(this._hasCheckbox=!0),t}_getItem(e,t,n){const i=super._getItem(e,t,n);return i&&this._getRenderedItem(e,i,n)}_renderItem(e,t,n){return t.type==="item"&&this._hasIcons&&t.icon===void 0&&(t.icon="EMPTY"),super._renderItem(e,t,n)}_handleClick(e){const t=super._handleClick(e);let{checkOnClick:n}=this.props;if(n==="any"?n=".item-checkbox,.item-content,.item-icon":n===!0&&(n=".item-checkbox"),!n||!t||!t.renderedItem)return t;const i=t.renderedItem,r=i.checkbox;if(r!==!1&&(this.props.checkbox||r||i.checked!==void 0)&&!i.disabled&&t&&e.target.closest(n)){this.toggleChecked(t.key),e.stopPropagation();return}return t}_getClassName(e){const{loading:t,loadFailed:n}=this.state;return[super._getClassName(e),t?"loading":n?"is-load-failed":"",e.hoverItemActions?"with-hover-actions":""]}_getProps(e){const{className:t,...n}=super._getProps(e);return{...n,className:ee(t,this._hasIcons?"has-icons":"",this._hasCheckbox?"has-checkbox":"")}}_getChildren(e){this._hasIcons=!1,this._hasCheckbox=!1,this._activeSet.compute();const t=super._getChildren(e),{loadFailed:n}=this.state;return n&&t.push(n),t}};kt.ItemComponents={...Nt.ItemComponents,default:tt,item:wn,heading:wn},kt.NAME="list";const Dc="```ZUI_STR\n";class gr{constructor(e="",t="local"){this._cache=new Map,this._type=t,this._id=e,this._name=`ZUI_STORE:${this._id}`,this._storage=t==="local"?localStorage:sessionStorage}get type(){return this._type}get session(){return this.type==="session"?this:(this._altStorage||(this._altStorage=new gr(this._id,"session")),this._altStorage)}_getKey(e){return`${this._name}:${e}`}switch(e){this._id=e,this._name=`ZUI_STORE:${this._id}`,this._cache.clear()}get(e,t){if(this._cache.has(e))return this._cache.get(e);const n=this._storage.getItem(this._getKey(e));if(typeof n=="string"){if(n.startsWith(Dc))return n.substring(Dc.length);try{return JSON.parse(n)}catch{}}return n??t}setCache(e,t){this._cache.set(e,t)}set(e,t){if(t==null)return this.remove(e);try{this._storage.setItem(this._getKey(e),typeof t=="string"?`${Dc}${t}`:JSON.stringify(t))}catch(n){this.setCache(e,t),console.warn(`[ZUI] Failed to set value to ${this._type} store: ${this._getKey(e)}, use cache instead.`,n)}}remove(e){this._cache.delete(e),this._storage.removeItem(this._getKey(e))}each(e){const t=[];for(let n=0;n<this._storage.length;n++){const i=this._storage.key(n);if(i!=null&&i.startsWith(this._name)){const r=this._storage.getItem(i),o=i.substring(this._name.length+1);typeof r=="string"&&e(o,JSON.parse(r)),t.push(o)}}for(const n of this._cache.keys())t.includes(n)||e(n,this._cache.get(n))}getAll(){const e={};this.each((t,n)=>{e[t]=n});for(const t of this._cache.keys())e[t]=this._cache.get(t);return e}}const rt=new gr("DEFAULT");function Sx(s,e="local"){return new gr(s,e)}Object.assign(rt,{create:Sx});const MC="";function Cp(s,e){const{children:t}=s;t.length&&t.forEach(n=>{e(n),Cp(n,e)})}function Dx(s,e){let t=s.parent;for(;t;)e(t),t=t.parent}function kp(s){return s.split(":").reduce((e,t,n)=>(e.push(n?e[n-1]+":"+t:t),e),[])}function Ec(s,e,t,n,i=0,r){return s.reduce((o,a,l)=>{if(!a)return o;const c=String((e?a[e]:a.key)??a.key??l),h=r?`${r.keyPath}:${c}`:c,u={key:c,level:i,keyPath:h,parentKey:r==null?void 0:r.keyPath,parent:r,data:a,children:[]};return r&&r.children.push(u),o=t(o,u),Array.isArray(a.items)?Ec(a.items,e,t,o,i+1,u):o},n)}let Ln=class extends kt{constructor(e){super(e);const{defaultNestedShow:t,preserve:n,nestedShow:i}=e;if(_.extend(this.state,typeof t=="boolean"?{defaultShow:t,nestedShow:{}}:{nestedShow:t||{}},i!==void 0?{nestedShow:i}:null),n&&i===void 0){this._storeID=`${this.constructor.NAME}:${n}:state`;const r=rt.get(this._storeID);r&&(this.state.nestedShow=r.nestedShow)}if(!e.level){const r=this.state.nestedShow;r&&Object.keys(r).forEach(o=>{r[o]&&kp(o).forEach(a=>{r[a]=!0})}),this._needInitChecks=!0}this._renderedItemMap=new Map,this._handleClick=this._handleClick.bind(this),this._beforeRenderNestedItem=this._beforeRenderNestedItem.bind(this),this._handleNestedToggle=this._handleNestedToggle.bind(this),this._handleNestedCheck=this._handleNestedCheck.bind(this),this._preserveState=this._preserveState.bind(this)}get isRoot(){return!this.props.level}get nestedShow(){return this.props.nestedShow??this.state.nestedShow??!1}async setItems(e,t){var i;this.isRoot&&(this._needInitChecks=!0);const n=await super.setItems(e,t);return e&&((i=this.props.parent)==null?void 0:i.checked)===!0?this.toggleChecked(this._renderedItems.map(r=>r.key),!0):e!=null&&e.some(r=>r.checked)&&(this._needInitChecks=!0,this.forceUpdate()),n}getItemMap(e){if(e&&(this._itemMap||this._itemMapCache))return this._itemMap||this._itemMapCache;if(!this._itemMap){let t=!1;const n=Ec(this._items,this.props.itemKey,(i,r)=>(i.set(r.keyPath,r),r.data.items&&!Array.isArray(r.data.items)&&(t=!0),i),new Map);if(t)return this._renderedItemMap.forEach((i,r)=>{n.has(r)||n.set(r,{key:i.key,level:i._level,keyPath:r,parentKey:`${r.split(":").slice(0,-1).join(":")}`,children:[],data:i})}),n.forEach(i=>{const{parentKey:r}=i;if(!r)return;const o=n.get(r);o&&(o.children.push(i),i.parent=o)}),this._itemMapCache=n,n;this._itemMap=n}return this._itemMap}getRenderedItem(e){return this._renderedItemMap.get(e)}getItem(e){var i;const t=this._itemMap||this._itemMapCache;if(t)return(i=t.get(e))==null?void 0:i.data;const n=this.getRenderedItem(e);return n?n._item:super.getItem(e)}isExpanded(e){const{nestedShow:t}=this;return typeof t=="boolean"?t:!!(t[e]??this.state.defaultShow)}async toggle(e,t,n){const i=this.isExpanded(e);if(!n&&t===i)return;t===void 0&&(t=!i);const{nestedShow:r,onToggle:o,accordion:a}=this.props;o&&o.call(this,e,t,n)===!1||r===void 0&&await this.changeState(l=>{let c={...n?{}:l.nestedShow,[e]:t};if(t&&a){let h=`${e.split(":").slice(0,-1).join(":")}`;h.length&&(h+=":"),Object.keys(c).forEach(u=>{u!==e&&u.startsWith(h)&&(c[u]=!1)})}return c=t?kp(e).reduce((h,u)=>(h[u]=t,h),c):c,{nestedShow:c}},this._preserveState)}toggleAll(e){if(this.props.nestedShow===void 0)return this.setState({nestedShow:{},defaultShow:e},this._preserveState)}getChecks(){return Array.from(this.getItemMap(!0).values()).reduce((e,{keyPath:t,data:n})=>{const i=this.state.checked[t];return(i===!0||n.checked&&i!==!1)===!0&&e.push(t),e},[])}isChecked(e,t,n=!1){const i=(typeof t=="number"?this._items[t]:this.getItem(e))||{};return this.isRoot?this.state.checked[e]??i.checked??n:this.props.checkedState[`${this.props.parentKey}:${e}`]??i.checked??n}async toggleChecked(e,t){let n;if(Array.isArray(e)){if(!e.length)return;t===void 0&&(t=!this.isChecked(e[0])),n=e.reduce((a,l)=>(a[l]=t,a),{})}else typeof e=="object"?n=e:(t===void 0&&(t=!this.isChecked(e)),n={[e]:t});if(!Object.keys(n).length)return;if(this.isRoot){await this.changeState(({checked:a,nestedShow:l})=>{const c=p=>n[p.keyPath]??a[p.keyPath]??p.data.checked??!1,h=this.getItemMap(),u={},{expandChildrenOnCheck:f}=this.props;return Object.keys(n).forEach(p=>{t=n[p];const g=h.get(p);g&&(Cp(g,y=>{c(y)!==t&&(n[y.keyPath]=t)}),Dx(g,y=>{const{children:v}=y,b=v.reduce((w,S)=>(c(S)&&w++,w),0);n[y.keyPath]=b===v.length?!0:b?"indeterminate":!1}),f&&t&&g.data.items&&(u[p]=!0))}),{checked:{...a,...n},nestedShow:{...l,...u}}},()=>{var l;const a=this.state.checked;(l=this.props.onCheck)==null||l.call(this,n,Object.keys(a).filter(c=>a[c]===!0))});return}const{parentKey:i,onCheck:r}=this.props,o=Object.keys(n).reduce((a,l)=>(a[`${i!==void 0?`${i}:`:""}${l}`]=n[l],a),{});r.call(this,o,[])}getKeyPath(e){if(this.isRoot)return e;const t=this.props.parentKey;return e.startsWith(t+":")?e:`${t}:${e}`}isActive(e){if(typeof e=="object"){const t=e._keyPath??e.key;if(t===void 0)return!1;e=t}return this._activeSet.cache.has(this.getKeyPath(e))}async toggleActive(e,t){if(typeof e=="string"&&(e=[e]),e=e.map(n=>this.getKeyPath(n)),this.isRoot){await super.toggleActive(e,t),this.props.toggleOnActive&&e.forEach(n=>{this.isActive(n)&&!this.isExpanded(n)&&this.toggle(n,!0)});return}this.props.onActive.call(this,e,t??!this.isActive(e[0]))}activeNext(e,t=1){const n=this.getNextItem(this.getActiveKey(),e,t);n&&this.toggleActive(n._keyPath)}getNextItem(e,t,n=1,i=void 0){return i=i||Ec(this._items,this.props.itemKey,(r,o)=>(o.data.disabled||r.push({_keyPath:o.keyPath,type:"item",...o.data,...this._renderedItemMap.get(o.keyPath),key:o.keyPath}),r),[]),super.getNextItem(e,t,n,i)}_afterRender(e){if(super._afterRender(e),this._needInitChecks){const t={};this.getItemMap().forEach(i=>{i.data.checked!==void 0&&(t[i.keyPath]=i.data.checked)}),this.toggleChecked(t),this._needInitChecks=!1}}_preserveState(){this._storeID&&rt.set(this._storeID,{nestedShow:this.state.nestedShow})}_getClassName(e){return[super._getClassName(e),"is-nested",e.level?"is-nested-sub":"is-nested-root"]}_getNestedProps(e,t,n,i){const{parentKey:r,level:o=0}=e,{isRoot:a}=this;return Ie(this.constructor.inheritNestedProps.reduce((l,c)=>(l[c]=e[c],l),{}),{key:n.key,level:o+1,className:`is-nested-${i?"expanded":"collapsed"}`,items:t,parent:n,parentKey:r?`${r}:${n.key}`:n.key,nestedShow:this.nestedShow,defaultNestedShow:this.state.defaultShow,checkedState:e.checkedState||this.state.checked,onCheck:a?this._handleNestedCheck:e.onCheck,onToggle:a?this._handleNestedToggle:e.onToggle,beforeRenderItem:a?this._beforeRenderNestedItem:e.beforeRenderItem,active:a?this.getActiveKeys():e.active,onActive:a?this.toggleActive.bind(this):e.onActive},n.listProps)}_renderNestedList(e,t,n,i){if(!i&&!e.renderCollapsedList)return;const r=this._getNestedProps(e,t,n,i),o=this.constructor;return A(o,{...r},`nested:${n.key}`)}_renderNestedToggle(e,t){let n,i="";const{toggleIcons:r={}}=e;return typeof t=="boolean"?(n=t?r.expanded||A("span",{className:"caret-down"}):r.collapsed||A("span",{className:"caret-right"}),i=`state is-${t?"expanded":"collapsed"}`,P.isValidElement(n)||(n=A(Re,{icon:n}))):(n=A(Re,{icon:r.normal}),i="is-empty"),A("span",{className:ee(`${this.name}-toggle nested-toggle-icon`,i),children:n})}_getItems(e){const t=super._getItems(e);return this.isRoot&&t!==this._items&&(this._itemMap=void 0),t}_getItem(e,t,n){const i=super._getItem(e,t,n)??t;if(!i)return i;const{parentKey:r}=e,o=i.key,a=`${r!==void 0?`${r}:`:""}${o}`;if(i.items){const l=i.expanded??this.isExpanded(a);Ie(i,{expanded:l,className:["is-nested",`is-nested-${l?"show":"hide"}`]}),this._hasNestedItems=!0}return Ie(i,{_level:e.level,_keyPath:a,parentKey:r})}_beforeRenderNestedItem(e,t){const{beforeRenderItem:n}=this.props;if(n){const i=n.call(this,e,t);i!==void 0&&(e=i)}return this._renderedItemMap.set(e._keyPath,e),e}_renderItem(e,t,n){(this._hasNestedItems||!this.isRoot)&&t.type==="item"&&t.toggleIcon===void 0&&(t.toggleIcon=this._renderNestedToggle(e,t.expanded));const i=t.items?this._renderNestedList(e,t.items,t,t.expanded):null;return t=Ie(t,{"z-parent":t.parentKey,"z-key-path":t._keyPath},i?{children:i}:null),this._renderedItemMap.set(t._keyPath,t),super._renderItem(e,t,n)}_getItemFromEvent(e,t){t=t||e.target;let n=super._getItemFromEvent(e,t);if(!n){const r=t.closest("[z-list]");if(r){const o=r.getAttribute("z-list"),a=this.getItem(o),l=this.getRenderedItem(o);if(!a||!l)return;n={target:t,index:l._index,item:a,element:r,event:e,key:o,keyPath:o,renderedItem:l}}return}(e.type==="mouseenter"||e.type==="mouseleave"||e.type==="mouseover")&&(n.hover=e.type!=="mouseleave");const{parentKey:i}=this.props;return{...n,parentKey:i,keyPath:`${i!==void 0?`${i}:`:""}${n.key}`,target:t}}_handleNestedToggle(e,t,n){this.toggle(e,t,n)}_handleClick(e){const t=super._handleClick(e);if(t){const{renderedItem:n,keyPath:i,target:r}=t,{nestedToggle:o}=this.props;if(!n.items||e.defaultPrevented||r.closest(".not-nested-toggle")||o&&!n.disabled&&!r.closest(o)||!o&&!n.disabled&&r.closest("a,.btn,.item-checkbox,.open-url,input,select,textarea")&&!r.closest(".nested-toggle-icon,.item-icon"))return t;this.toggle(i),e.preventDefault()}return t}_handleNestedCheck(e){this.toggleChecked(e)}_getProps(e){const{level:t=0,indent:n=20,parentKey:i}=e,r=Ie(super._getProps(e),{"z-level":t,"z-list":i,style:{"--list-nested-indent":`${t*n}px`,"--list-indent":`${n}px`},className:this._hasNestedItems?"has-nested-items":"no-nested-items"});return r.className=ee(r.className),r}_beforeRender(e){return this._renderedItemMap.clear(),this._hasIcons=!1,this._hasNestedItems=!1,super._beforeRender(e)}};Ln.defaultProps={...kt.defaultProps,defaultNestedShow:!1,level:0,indent:20},Ln.inheritNestedProps=["component","name","itemName","itemKey","indent","hover","divider","multiline","toggleIcons","nestedToggle","accordion","itemRender","itemProps","onToggle","checkbox","getItem","getItems","checkOnClick","selectOnChecked","checkedState","onClickItem","activeOnHover","multipleActive","onActive","hoverItemActions"];const Ex=Object.freeze(Object.defineProperty({__proto__:null,List:kt,Listitem:wn,NestedList:Ln},Symbol.toStringTag,{value:"Module"}));class yr extends Ee{}yr.NAME="List",yr.Component=kt,yr.replace=kt.TAG,yr.register();class vr extends Ee{}vr.NAME="NestedList",vr.Component=Ln,vr.replace=Ln.TAG,vr.register(),ut(Ex);const RC="",LC="",zC="",Ci=class ky extends Ln{constructor(e){super(e),this._handleHover=this._handleHover.bind(this)}get isHoverTrigger(){return this.props.nestedTrigger==="hover"}_getClassName(e){return[super._getClassName(e),this._hasNestedItems?"menu-nested":"",e.className,e.wrap?{"scrollbar-thin":e.scrollbarThin,"scrollbar-hover":e.scrollbarHover}:{popup:e.popup,compact:e.compact}]}_getWrapClass(e){return["menu-wrapper",e.wrapClass,{popup:e.popup,compact:e.compact}]}_getWrapperProps(e){const{wrapAttrs:t,height:n,maxHeight:i,parentKey:r}=e,o=Ie({"z-list-wrapper":r},t,n||i?{style:{height:n,maxHeight:i}}:null,this.isRoot&&this.isHoverTrigger?{onMouseEnter:this._handleHover,onMouseLeave:this._handleHover,onMouseOver:this._handleHover}:null);return o.className=ee(this._getWrapClass(e),o.className),o}_renderWrapperHeader(e){return A(Se,{content:e.header,generatorThis:this},"header")}_renderWrapperFooter(e){return A(Se,{content:e.footer,generatorThis:this},"footer")}_handleHover(e){const t=e.target;if(!(t instanceof HTMLElement)||!this.isHoverTrigger)return;let n;if(e.type!=="mouseleave"){const c=t.closest("[z-item]");if(c)n=c.getAttribute("z-key-path"),c.classList.contains("is-nested")||(n=c.getAttribute("z-parent"));else{const h=t.closest("[z-list-wrapper]");n=h==null?void 0:h.getAttribute("z-list-wrapper")}}const i=this._hoverInfo,r=i==null?void 0:i.keyPath;if(r===n)return;i!=null&&i.timer&&clearTimeout(i.timer);const o=typeof n=="string",l=o?typeof r=="string"&&(i!=null&&i.shown)?50:200:i!=null&&i.shown?100:200;this._hoverInfo={keyPath:n,timer:window.setTimeout(()=>{o?(this.toggle(n,!0,!0),this._hoverInfo.shown=!0):(this.toggleAll(!1),this._hoverInfo=void 0)},l)}}componentWillUnmount(){var t;super.componentWillUnmount();const e=(t=this._hoverInfo)==null?void 0:t.timer;e&&clearTimeout(e)}render(e){const t=super.render(e);return e.wrap?A("menu",{...this._getWrapperProps(e),children:[this._renderWrapperHeader(e),t,this._renderWrapperFooter(e)]}):t}static render(e,t,n,i){let r=typeof e=="function"?e.call(i??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),n&&(r=Ie(n,r)),A(ky,{...r})}};Ci.NAME="menu",Ci.TAG="menu",Ci.inheritNestedProps=[...Ln.inheritNestedProps,"compact"],Ci.ItemComponents={...Ln.ItemComponents,item:[wn,{innerComponent:"a"}]},Ci.defaultProps={...Ln.defaultProps,scrollbarHover:!0};let Lt=Ci;const OC="",HC="",jC="";let Ms=class extends ke{constructor(e){super(e),this._input=Ce(),this._timer=0,this._handleClearBtnClick=t=>{t.stopPropagation(),this.clear(t)},this._handleChange=t=>{const n=this.state.value,i=t.target.value,{onChange:r,delay:o}=this.props;this.setState({value:i},()=>{!r||n===i||(o?(this._clearTimer(),this._timer=window.setTimeout(()=>{r(i,t),this._timer=0},o)):r(i,t))})},this._handleFocus=t=>{const n=t.type==="focus";this.setState({focus:n},()=>{const i=n?this.props.onFocus:this.props.onBlur;i==null||i(t)})},this.state={focus:!1,value:e.defaultValue||""},this._gid=e.id||`search-box-${Bt()}`}componentDidMount(){const{hotkeys:e}=this.props;if(e){const t=rc(e,{clear:{keys:"Escape",handler:n=>{this.clear(n)}},enter:{keys:"Enter",handler:n=>{var i,r;(r=(i=this.props).onEnter)==null||r.call(i,this.state.value,n)}}});t&&(this._hotkeysScope=`SearchBox_${this._gid}`,_(this.input).hotkeys(t,{scope:this._hotkeysScope,event:"keydown"}))}}componentWillUnmount(){this._hotkeysScope&&_(this.input).unbindHotkeys(this._hotkeysScope)}get id(){return this._gid}get input(){return this._input.current}focus(){var e;(e=this.input)==null||e.focus()}blur(){var e;(e=this.input)==null||e.blur()}clear(e){const t=this.state.value;this.setState({value:""},()=>{const{onChange:n,onClear:i}=this.props;i==null||i(e),this.focus(),t.trim()!==""&&(n==null||n("",e))})}_clearTimer(){this._timer&&clearTimeout(this._timer),this._timer=0}render(e,t){const{style:n,className:i,rootClass:r,rootStyle:o,readonly:a,disabled:l,circle:c,placeholder:h,mergeIcon:u,searchIcon:f,clearIcon:p,value:g,compact:y,prefixClass:v,suffixClass:b}=e,{focus:w,value:S}=t,{id:E}=this,$=g??S,B=typeof $!="string"||!$.trim().length;let N,L,V;return f&&(V=f===!0?A("span",{class:"magnifier"}):A(Re,{icon:f})),!u&&f&&(N=A("label",{for:E,class:ee("input-control-prefix",v),children:V},"prefix")),p&&!B?L=A("button",{type:"button",class:"btn ghost size-sm square rounded-full",onClick:this._handleClearBtnClick,children:p===!0?A("span",{class:"close"}):A(Re,{icon:p})}):u&&f&&(L=V),L&&(L=A("label",{for:E,class:ee("input-control-suffix",b),children:L},"suffix")),A("div",{class:ee("search-box input-control",r,{focus:w,empty:B,compact:y,"has-prefix-icon":N,"has-suffix-icon":L}),style:o,children:[N,A("input",{ref:this._input,id:E,type:"text",class:ee("form-control",{"rounded-full":c,"size-sm":y},i),style:n,placeholder:h,disabled:l,readonly:a,value:$,onInput:this._handleChange,onChange:this._handleChange,onFocus:this._handleFocus,onBlur:this._handleFocus},"input"),L]})}};Ms.defaultProps={clearIcon:!0,searchIcon:!0,delay:500,hotkeys:!0};const Ax=Object.freeze(Object.defineProperty({__proto__:null,SearchBox:Ms},Symbol.toStringTag,{value:"Module"}));let vt=class extends Lt{constructor(e){super(e),this._handleSearchChange=t=>{const n=this.constructor.getSearchKeys(t);this._searchKeys=n,this.setState({search:n.join(" ")})},this.state.search=e.search??e.defaultSearch,this._searchKeys=this.constructor.getSearchKeys(this.state.search),this._isNestedItemMatch=this._isNestedItemMatch.bind(this)}componentWillUpdate(e){this.isRoot&&e.search!==void 0&&e.search!==this.props.search&&(this._searchKeys=this.constructor.getSearchKeys(e.search))}componentDidMount(){super.componentDidMount(),this._updateMatchedParents()}componentDidUpdate(){super.componentDidUpdate(),this._updateMatchedParents()}isExpanded(e){return this.props.expandOnSearch&&this._searchKeys.length?!0:super.isExpanded(e)}_updateMatchedParents(){var n;if(!this.isRoot)return;const e=_(this.element),t=e.find(".item.is-nested.is-not-match").filter((i,r)=>this._matchedParents.has(r.getAttribute("z-key-path")||"")).addClass("has-match-child");e.parent().toggleClass("no-match-child",!!((n=this._searchKeys)!=null&&n.length)&&!t.length&&!e.children(".item").not(".is-not-match").length)}_isItemMatch(e,t,n,i){const{isItemMatch:r,nestedSearch:o}=e,a=r?r.call(this,t,this._searchKeys,n,i):this.constructor.isItemMatch(t,this._searchKeys,e.searchProps);if(o&&this.isRoot&&a&&i!==void 0){let l="";String(i).split(":").forEach(c=>{l+=`${l.length?":":""}${c}`,this._matchedParents.add(l)})}return a}_isNestedItemMatch(e,t,n,i){return this._isItemMatch(this.props,e,n,i)}_getNestedProps(e,t,n,i){const r=super._getNestedProps(e,t,n,i);return this.isRoot&&e.nestedSearch?(r.isItemMatch=this._isNestedItemMatch,r.search=this._searchKeys.join(" ")):e.nestedSearch||Ie(r,{search:void 0,defaultSearch:void 0},n.listProps),r}_getItem(e,t,n){const i=super._getItem(e,t,n);return i&&(this.isRoot&&this.props.limit&&this._showCount>=this.props.limit?!1:(i.hidden=!this._isItemMatch(e,t,n,e.parentKey),i.hidden||this._showCount++,i))}_renderItem(e,t,n){return t.hidden&&!this._hasNestedItems?null:(t.className=[t.className,t.hidden?"is-not-match":""],!t.hidden&&e.underlineKeys&&this._searchKeys.length&&["text","title","subtitle","content"].forEach(i=>{typeof t[i]=="string"&&(t[i]=this.constructor.underlineKeys(this._searchKeys,[t[i]]))}),super._renderItem(e,t,n))}_getWrapClass(e){const t=this.isRoot&&this._searchKeys.length;return ee(super._getWrapClass(e),"search-menu",e.searchBox?`search-menu-on-${e.searchPlacement||"top"}`:"",t?"is-search-mode":"",t&&e.expandOnSearch?"no-toggle-on-search":"")}_getSearchBoxProps(e){const{searchBox:t}=e,n={compact:!0,className:"not-nested-toggle",onChange:this._handleSearchChange};return typeof t=="object"&&Ie(n,t),e.search!==void 0&&(n.value=this._searchKeys.join(" "),n.disabled=!0),n}_renderSearchBox(e){const t=this._getSearchBoxProps(e);return A(Ms,{...t},"search")}_renderWrapperHeader(e){const t=e.header,{noMatchHint:n,searchBox:i,searchPlacement:r,nestedSearch:o,headerClass:a}=e,l=(!o||this.isRoot)&&i&&r!=="bottom";return!t&&!l&&!n?null:[n?A("div",{className:"search-menu-no-match-hint",children:n},"noMatchHint"):null,t||l?A("header",{className:ee("search-menu-header",a),children:[t?super._renderWrapperHeader(e):null,l?this._renderSearchBox(e):null]},"header"):null]}_renderWrapperFooter(e){const t=e.footer,{searchBox:n,searchPlacement:i,nestedSearch:r,footerClass:o,exceedLimitHint:a,limit:l}=e,c=(!r||this.isRoot)&&n&&i==="bottom",h=a&&l&&this._items.length>l;return!t&&!c&&!h?null:A("footer",{className:ee("search-menu-footer",o),children:[h?A("div",{className:"search-menu-exceed-limit-hint",children:Te(a,this._items.length-l)}):null,t?super._renderWrapperFooter(e):null,c?this._renderSearchBox(e):null]},"footer")}_beforeRender(e){return this.isRoot&&(this._matchedParents=new Set,this._showCount=0),super._beforeRender(e)}static isItemMatch(e,t,n=["keys","text","title","subtitle"]){return t.length?t.every(i=>n.some(r=>{const o=typeof r=="function"?r(e):e[r];return typeof o=="string"&&o.length&&o.toLowerCase().includes(i)})):!0}static getSearchKeys(e=""){return _.unique(e.toLowerCase().split(" ").filter(t=>t.length))}static underlineKeys(e,t,n="is-match-keys"){return e.reduce((i,r)=>[...i].reduce((o,a)=>{if(typeof a!="string")return o.push(a),o;const l=a.toLowerCase().split(r);if(l.length===1)return o.push(a),o;let c=0;return l.forEach((h,u)=>{u&&(o.push(A("span",{class:n,children:a.substring(c,c+r.length)})),c+=r.length),o.push(a.substring(c,c+h.length)),c+=h.length}),o},[]),t)}};vt.inheritNestedProps=[...Lt.inheritNestedProps,"isItemMatch","search","underlineKeys","nestedSearch"],vt.defaultProps={...Lt.defaultProps,defaultNestedShow:!0,wrap:!0,nestedSearch:!0,underlineKeys:!0,limit:200};const Tx=Object.freeze(Object.defineProperty({__proto__:null,Menu:Lt,SearchMenu:vt},Symbol.toStringTag,{value:"Module"}));class Zo extends Ee{}Zo.NAME="Menu",Zo.Component=Lt,Zo.replace=Lt.TAG;class Qo extends Ee{}Qo.NAME="SearchMenu",Qo.Component=vt,Qo.replace=vt.TAG,ut(Tx);const WC="",UC="",VC="",KC="",qC="",GC="",YC="",XC="",ZC="",QC="",JC="";function $x({className:s,style:e,actions:t,heading:n,content:i,contentClass:r,children:o,close:a,onClose:l,icon:c,iconClass:h,...u}){let f;a===!0?f=A($e,{className:"alert-close btn ghost square text-inherit",square:!0,onClick:l,children:A("span",{class:"close"})}):P.isValidElement(a)?f=a:typeof a=="object"&&(f=A($e,{...a,onClick:l}));const p=Xe.render(t,[]);return A("div",{className:ee("alert",s),style:e,...u,children:[A(Re,{icon:c,className:ee("alert-icon",h)}),typeof i!="string"?A(Se,{content:i}):A("div",{className:ee("alert-content",r),children:[typeof n!="string"?A(Se,{content:n}):n&&A("div",{className:"alert-heading",children:n}),A("div",{className:"alert-text",children:i}),n?p:null]}),n?null:p,f,o]})}function Ix(s){if(s==="center")return"fade-from-center";if(s){if(s.includes("top"))return"fade-from-top";if(s.includes("bottom"))return"fade-from-bottom"}return"fade"}let Bx=class extends ke{render(e){const{margin:t,type:n,placement:i,animation:r,show:o,className:a,time:l,...c}=e;return typeof c.html=="string"&&(c.content={html:c.html},delete c.html),A($x,{className:ee("messager",a,n,r===!0?Ix(i):r,o?"in":""),...c})}};class Ac extends Ee{constructor(){super(...arguments),this._show=!1,this._showTimer=0,this._afterRender=({firstRender:e})=>{e&&this.show();const{margin:t}=this.options;t&&this.$element.css("margin",`${t}px`)}}get isShown(){return this._show}afterInit(){this.on("click",e=>{_(e.target).closest('.alert-close,[data-dismiss="messager"]').length&&(e.preventDefault(),e.stopPropagation(),this.hide())})}setOptions(e,t){return e=super.setOptions(e,t),{...e,show:this._show,afterRender:this._afterRender}}show(){this.render(),this.emit("show"),this._resetTimer(()=>{this._show=!0,this.render(),this._resetTimer(()=>{this.emit("shown");const{time:e}=this.options;e&&this._resetTimer(()=>this.hide(),e)})},100)}hide(){this._show&&this._resetTimer(()=>{this.emit("hide"),this._show=!1,this.render(),this._resetTimer(()=>{this.emit("hidden")})},50)}_resetTimer(e,t=200){this._showTimer&&clearTimeout(this._showTimer),this._showTimer=window.setTimeout(()=>{e(),this._showTimer=0},t)}}Ac.NAME="MessagerItem",Ac.Component=Bx;const xr=class Sy extends Je{get isShown(){var e;return!!((e=this._item)!=null&&e.isShown)}show(e){this.setOptions(e),this._getItem().show()}hide(){var e;(e=this._item)==null||e.hide()}_getItem(){const e={...this.options};if(this._item)this._item.setOptions(e);else{const t=this._getHolder(),n=new Ac(t,e);n.on("hidden",()=>{n.destroy(),t==null||t.remove(),this._holder=void 0,this._item=void 0}),this._item=n}return this._item}_getHolder(){if(this._holder)return this._holder;const{placement:e="top"}=this.options;let t=this.$element.find(`.messagers-${e}`);t.length||(t=_(`<div class="messagers messagers-${e}"></div>`).appendTo(this.$element));let n=t.find(`#messager-${this.gid}`);return n.length||(n=_(`<div class="messager-holder" id="messager-${this.gid}"></div>`).appendTo(t),this._holder=n[0]),n[0]}static show(e,t){typeof e=="string"&&(e={content:e});const{container:n,...i}=e,r={type:t,key:`messager_${Bt()}`,...i};r.type&&_.extend(r,this.TypeOptions[r.type]);const o=Sy.ensure(n||"body",r);return o.hide(),o.show(),o}};xr.NAME="messager",xr.DEFAULT={placement:"top",animation:!0,close:!0,margin:6,time:5e3},xr.MULTI_INSTANCE=!0,xr.TypeOptions={};let ns=xr,Jo=class extends ke{render(e){const{percent:t=50,color:n,background:i=null,height:r,width:o,children:a,className:l,style:c}=e;return A("div",{class:ee("progress",l),style:{width:o,height:r,"--progress-bg":i,"--progress-bar-color":n,...c},children:[A("div",{class:"progress-bar",style:{width:`${t}%`}}),a]})}};Jo.defaultProps={percent:50,height:20,width:"auto"},ut(Object.freeze(Object.defineProperty({__proto__:null,ProgressBar:Jo},Symbol.toStringTag,{value:"Module"})));class Tc extends Ee{}Tc.NAME="ProgressBar",Tc.Component=Jo,Tc.register();const tk="",nk="";let ea=class extends ke{render(e){const{percent:t=50,size:n=24,circleBg:i,circleColor:r,text:o,className:a,textStyle:l,textX:c,textY:h,children:u}=e,f=n/2;let{circleWidth:p=.1}=e;p<1&&(p=n*p);const g=(n-p)/2;return A("svg",{className:a,width:n,height:n,children:[A("circle",{cx:f,cy:f,r:g,"stroke-width":p,stroke:i,fill:"transparent"}),A("circle",{cx:f,cy:f,r:g,"stroke-width":p,stroke:r,fill:"transparent","stroke-linecap":"round","stroke-dasharray":Math.PI*g*2,"stroke-dashoffset":Math.PI*g*2*(100-t)/100,style:{transformOrigin:"center",transform:"rotate(-90deg)"}}),o?A("text",{x:c??f,y:h??f+p/2,"dominant-baseline":"middle","text-anchor":"middle",style:l||{fontSize:`${g}px`,stroke:"currentColor"},children:o===!0?Math.floor(t):o}):null,u]})}};ea.defaultProps={circleBg:"var(--color-surface)",circleColor:"var(--color-primary-500)",text:!0};class ta extends Ee{}ta.NAME="ProgressCircle",ta.Component=ea,ta.register(),ut(Object.freeze(Object.defineProperty({__proto__:null,ProgressCircle:ea},Symbol.toStringTag,{value:"Module"})));const ik="",rk="",ok="",ak="",lk="",ck="",hk="",uk="",dk="",_r='[droppable="true"]';class br extends Je{constructor(){super(...arguments),this._state={dragging:null,dropping:null},this._handleMouseDown=e=>{const{selector:t,handle:n,beforeDrag:i}=this.options,r=_(e.target),o=r.closest(t),a=o[0];!a||n&&!r.closest(n).length||i&&i.call(this,e,a)===!1||(o.attr("draggable","true"),this._setState({dragging:a}))},this._handleDragStart=e=>{const{dragElement:t}=this;if(!t){e.preventDefault();return}const{options:n}=this,{onDragStart:i}=n;if(i&&i.call(this,e,t)===!1){this._clean();return}const{$element:r}=this,{target:o,selector:a,draggingClass:l,droppableClass:c,hasDraggingClass:h,canDrop:u}=n;l&&(this.$element.find(l).removeClass(l),_(t).addClass(l));let f=typeof o=="function"?_(o.call(this,t)):r.find(o||a||_r);if(u&&(f=f.filter((p,g)=>u.call(this,e,t,g)!==!1)),!f.length){this._clean();return}c&&(r.find(c).removeClass(c),f.addClass(c)),h&&r.addClass(h),r.find(_r).removeAttr("droppable"),f.attr("droppable","true"),this._$targets=f},this._handleDrag=e=>{var n;const{dragElement:t}=this;t&&(this._setDragEffect(e),(n=this.options.onDrag)==null||n.call(this,e,t))},this._handleDragEnd=e=>{var n;const{dragElement:t}=this;t&&((n=this.options.onDragEnd)==null||n.call(this,e,t)),this._clean()},this._handleDragEnter=e=>{this._handleDragOver(e)},this._handleDragOver=e=>{var o,a;const{dragElement:t}=this,i=_(e.target).closest(_r)[0];if(!t||!i)return;const r=this.state.dropping;if(e.preventDefault(),this._setDragEffect(e),r!==i){const{droppingClass:l}=this.options;l&&(r&&this._leaveDropElement(e,r),_(i).addClass(l)),this._setState({dropping:i}),(o=this.options.onDragEnter)==null||o.call(this,e,t,i)}(a=this.options.onDragOver)==null||a.call(this,e,t,i)},this._handleDragLeave=e=>{const{dragElement:t}=this,n=_(e.target).filter(_r)[0];!t||!n||(e.preventDefault(),this._leaveDropElement(e,n),this._setState({dropping:null}))},this._handleDrop=e=>{var n;const t=_(e.target).closest(_r)[0];t&&(e.preventDefault(),(n=this.options.onDrop)==null||n.call(this,e,this.dragElement,t)),this._needClean=!0,setTimeout(()=>{this._needClean&&this._clean()},50)}}get state(){return this._state}get dragElement(){return this._state.dragging}get dropElement(){return this._state.dropping}async afterInit(){const{namespace:e}=this,{dragContainer:t,dropContainer:n,onDrag:i}=this.options;this._$dragContainer=t?_(t):this.$element,this._$dropContainer=n?_(n):this._$dragContainer,this._$dragContainer.on("mousedown"+e,this._handleMouseDown).on("dragstart"+e,this._handleDragStart).on("dragend"+e,this._handleDragEnd),i&&this._$dragContainer.on("drag"+e,this._handleDrag),this._$dropContainer.on("dragover"+e,this._handleDragOver).on("dragenter"+e,this._handleDragEnter).on("dragleave"+e,this._handleDragLeave).on("drop"+e,this._handleDrop),_(document).on(`mouseup${this.namespace}`,this._clean.bind(this))}destroy(){this._clean(),_(document).off(this.namespace),this._$dragContainer.off(this.namespace),this._$dropContainer.off(this.namespace),super.destroy()}_setState(e){var r;const t=this._state,{dragging:n=t.dragging,dropping:i=t.dropping}=e;n===t.dragging&&i===t.dropping||(this._state={dragging:n,dropping:i},(r=this.options.onChange)==null||r.call(this,this._state,t))}_setDragEffect(e){const{dropEffect:t}=this.options;t&&(e.dataTransfer.dropEffect=t)}_leaveDropElement(e,t){var i;const{droppingClass:n}=this.options;n&&_(t).removeClass(n),(i=this.options.onDragLeave)==null||i.call(this,e,this.dragElement,t)}_clean(){this._needClean=!0;const{draggingClass:e,droppableClass:t,droppingClass:n,hasDraggingClass:i}=this.options;i&&this.$element.removeClass(i);const{dragElement:r}=this;if(r){const a=_(r);e&&a.removeClass(e)}this._setState({dropping:null,dragging:null});const o=this._$targets;o&&(t&&o.removeClass(t),n&&o.removeClass(n),this._$targets=void 0)}}br.NAME="Draggable",br.DEFAULT={selector:'[draggable="true"]',dropEffect:"move",hasDraggingClass:"has-dragging",draggingClass:"is-dragging",droppableClass:"is-droppable",droppingClass:"is-dropping"};const Nx='[moveable="true"]',$c=class Dy extends Je{constructor(){super(...arguments),this._handleMouseDown=e=>{const{options:t}=this,{selector:n,handle:i,onMoveStart:r}=t,o=_(e.target),a=n==="self"?this.$element:o.closest(n),l=a[0];if(!l||i&&!o.closest(i).length||r&&r.call(this,e,l)===!1)return;a.attr("moveable","true");const{movingClass:c,hasMovingClass:h}=t;c&&a.addClass(c),h&&this.$element.addClass(h),e.preventDefault(),this._setState(e,l),_(document).off("mousemove mouseup").on(`mousemove${this.namespace}`,this._handleMouseMove.bind(this)).on(`mouseup${this.namespace}`,this._handleMouseUp.bind(this))},this._handleMouseMove=e=>{!this._state||!e.buttons||(e.preventDefault(),this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{var t;this._raf=0,this._setState(e),(t=this.options.onMove)==null||t.call(this,e,this._state)}))},this._handleMouseUp=e=>{var t,n;this._state&&(this._raf&&(cancelAnimationFrame(this._raf),this._raf=0),this._setState(e),(t=this.options.onMove)==null||t.call(this,e,this._state),(n=this.options.onMoveEnd)==null||n.call(this,e,this._state),this._clean())}}get state(){return this._state}get moveElement(){var e;return(e=this._state)==null?void 0:e.target}async afterInit(){this.on("mousedown",this._handleMouseDown)}destroy(){this._clean(),_(document).off(this.namespace),super.destroy()}_setState(e,t){var l;let n={x:e.pageX,y:e.pageY};const i=this._state;if(t){const c=_(t);let h;if(this.options.move===!0){const f=c.css("position");h=f==="fixed"||f==="absolute"||f==="relative"?"position":"transform"}else h=this.options.move||"none";const u=h==="transform"?Dy.getTranslate(t):h==="scroll"?{left:t.scrollLeft,top:t.scrollTop}:c.position();n=_.extend(n,{strategy:h,target:t,startX:n.x,startY:n.y,deltaX:0,deltaY:0,startLeft:u.left,startTop:u.top,left:u.left,top:u.top,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop})}else if(i){const c=n.x-i.startX,h=n.y-i.startY;n=_.extend({},i,n,{deltaX:c,deltaY:h,left:i.startLeft+c,top:i.startTop+h})}this._state=n;const{strategy:r,target:o}=n,a=_(o);r==="position"?a.css({left:n.left,top:n.top}):r==="transform"?a.css("transform",`translate(${n.left}px, ${n.top}px)`):r==="scroll"&&(o.scrollLeft=n.scrollLeft-n.deltaX,o.scrollTop=n.scrollTop-n.deltaY),(l=this.options.onChange)==null||l.call(this,n,i,e)}_clean(){_(document).off("mousemove mouseup");const{hasMovingClass:e,movingClass:t}=this.options;e&&this.$element.removeClass(e);const{moveElement:n}=this;if(n){const i=_(n);t&&i.removeClass(t)}this._state=void 0}static getTranslate(e){const n=window.getComputedStyle(e).getPropertyValue("transform");if(n==="none")return{left:0,top:0};const i=n.match(/^matrix\((.+)\)$/);if(!i)return{left:0,top:0};const r=i[1].split(", ");return{left:parseFloat(r[4]),top:parseFloat(r[5])}}};$c.NAME="Moveable",$c.DEFAULT={selector:Nx,hasMovingClass:"has-moving",movingClass:"is-moving",move:!0};let wr=$c;const Ic=class Ey extends Je{async afterInit(){const e=await Ey.loadModule(),{options:t}=this;if(t.dragShadow!==void 0&&t.dragShadow!==!0){const{dragShadow:n,onEnd:i,setData:r}=t;t.setData=(o,a)=>{n===!1&&!this._emptyShadow&&(this._emptyShadow=a.cloneNode(!0),this._emptyShadow.classList.add("sortable-empty-shadow"),document.body.appendChild(this._emptyShadow)),o.setDragImage(n===!1?this._emptyShadow:n,0,0),r==null||r(o,a)},t.onEnd=o=>{var a;i==null||i(o),(a=this._emptyShadow)==null||a.remove(),this._emptyShadow=void 0},delete t.dragShadow}this.module=new e(this.element,t)}option(e,t){if(t===void 0)return this.module.option(e);this.module.option(e,t)}closest(e,t){return this.module.closest(e,t)}sort(e,t){this.module.sort(e,t)}save(){this.module.save()}destroy(){super.destroy(),this.module.destroy()}toArray(){return this.module.toArray()}static async loadModule(){return this.Module||(this.Module=await _.getLib("sortablejs")),this.Module}};Ic.NAME="Sortable",Ic.DEFAULT={animation:150};let na=Ic;_.registerLib("sortablejs",{src:"sortable/sortable.min.js",check:"Sortable"});let Cr=class extends kt{componentDidMount(){super.componentDidMount();const e=this._getSortableOptions();e&&(this._sortable=new na(this.element,e))}getOrders(){var e;return((e=this._sortable)==null?void 0:e.toArray())||[]}_getClassName(e){return[super._getClassName(e),"sortable-list"]}_getSortableOptions(){const{sortable:e,canSortTo:t}=this.props;if(!e)return;const n=typeof e=="object"?e:{};return{group:`SortableList.${this.gid}`,dataIdAttr:"z-key",draggable:".list-item",...n,onSort:i=>{var o,a;const r=this.getOrders();(o=this.props.onSort)==null||o.call(this,i,r),(a=n.onSort)==null||a.call(this,i)},onMove:(i,r)=>{var o;if(t){const a=i.dragged.getAttribute("z-key-path"),l=i.related.getAttribute("z-key-path"),c=this.getItem(a),h=this.getItem(l),u=t.call(this,i,c,h);if(u!==void 0)return u}return(o=n.onMove)==null?void 0:o.call(this,i,r)}}}};Cr.defaultProps={...kt.defaultProps,sortable:!0};let Ft=class extends Lt{_getClassName(e){return[super._getClassName(e),e.lines?"tree-lines":""]}_getItem(e,t,n){return this.constructor.getTreeItem(e,super._getItem(e,t,n))}static getTreeItem(e,t){return t&&(t.type==="item"&&(t.icon===void 0&&(t.icon=t.items?t.expanded?e.expandedIcon:e.collapsedIcon:e.normalIcon),t.actions===void 0&&(t.actions=e.itemActions)),t)}};Ft.NAME="tree",Ft.defaultProps={...Lt.defaultProps,indent:12},Ft.defaultItemProps={...Lt.defaultItemProps,innerComponent:"div"},Ft.inheritNestedProps=[...Lt.inheritNestedProps,"itemActions","expandedIcon","collapsedIcon","normalIcon"];let Rs=class extends vt{_getClassName(e){return[super._getClassName(e),e.lines?"tree-lines":""]}_getItem(e,t,n){return Ft.getTreeItem(e,super._getItem(e,t,n))}};Rs.NAME="tree",Rs.inheritNestedProps=[...vt.inheritNestedProps,"itemActions","expandedIcon","collapsedIcon","normalIcon"],Rs.ItemComponents={...vt.ItemComponents,item:[wn,{innerComponent:"div"}]};const Fx=Object.freeze(Object.defineProperty({__proto__:null,SearchTree:Rs,Tree:Ft},Symbol.toStringTag,{value:"Module"}));let ki=class extends Ft{componentDidMount(){super.componentDidMount();const e=this._getSortableOptions();e&&(this._sortable=new na(this.element,e))}getOrders(){var e;return((e=this._sortable)==null?void 0:e.toArray())||[]}_getClassName(e){return[super._getClassName(e),"sortable-tree"]}_getSortableOptions(){const{sortable:e}=this.props;if(!e)return;const t=typeof e=="object"?e:{},{onSort:n,canSortTo:i,parentKey:r}=this.props;return{group:`SortableTree.${this.gid}`,dataIdAttr:"z-key",draggable:".tree-item",...t,onSort:o=>{var l;const a=this.getOrders();n==null||n.call(this,o,a,r),(l=t.onSort)==null||l.call(this,o)},onMove:(o,a)=>{var l;if(i){const c=o.dragged.getAttribute("z-key-path"),h=o.related.getAttribute("z-key-path"),u=this.getItem(c),f=this.getItem(h),p=i.call(this,o,u,f,r);if(p!==void 0)return p}return(l=t.onMove)==null?void 0:l.call(this,o,a)}}}};ki.defaultProps={...Ft.defaultProps,sortable:!0},ki.inheritNestedProps=[...Ft.inheritNestedProps,"onSort","sortable","canSortTo"];class sa extends Ee{}sa.NAME="SortableList",sa.Component=Cr,sa.replace=Cr.TAG;class ia extends Ee{}ia.NAME="SortableTree",ia.Component=ki,ia.replace=ki.TAG;const fk="";/*! js-cookie v3.0.1 | MIT */function ra(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)s[n]=t[n]}return s}var Px={read:function(s){return s[0]==='"'&&(s=s.slice(1,-1)),s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(s){return encodeURIComponent(s).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Bc(s,e){function t(i,r,o){if(!(typeof document>"u")){o=ra({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var l in o)o[l]&&(a+="; "+l,o[l]!==!0&&(a+="="+o[l].split(";")[0]));return document.cookie=i+"="+s.write(r,i)+a}}function n(i){if(!(typeof document>"u"||arguments.length&&!i)){for(var r=document.cookie?document.cookie.split("; "):[],o={},a=0;a<r.length;a++){var l=r[a].split("="),c=l.slice(1).join("=");try{var h=decodeURIComponent(l[0]);if(o[h]=s.read(c,h),i===h)break}catch{}}return i?o[i]:o}}return Object.create({set:t,get:n,remove:function(i,r){t(i,"",ra({},r,{expires:-1}))},withAttributes:function(i){return Bc(this.converter,ra({},this.attributes,i))},withConverter:function(i){return Bc(ra({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(s)}})}var Sp=Bc(Px,{path:"/"});window.$&&Object.assign(window.$,{cookie:Sp});var Ne=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dp(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Mx(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var i=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return s[n]}})}),t}var Ep={exports:{}};(function(s,e){(function(t,n){s.exports=n()})(Ne,function(){var t=function(d,m){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,C){x.__proto__=C}||function(x,C){for(var D in C)Object.prototype.hasOwnProperty.call(C,D)&&(x[D]=C[D])})(d,m)},n=function(){return(n=Object.assign||function(d){for(var m,x=1,C=arguments.length;x<C;x++)for(var D in m=arguments[x])Object.prototype.hasOwnProperty.call(m,D)&&(d[D]=m[D]);return d}).apply(this,arguments)};function i(d,m,x){if(x||arguments.length===2)for(var C,D=0,T=m.length;D<T;D++)!C&&D in m||((C=C||Array.prototype.slice.call(m,0,D))[D]=m[D]);return d.concat(C||Array.prototype.slice.call(m))}var r=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ne,o=Object.keys,a=Array.isArray;function l(d,m){return typeof m!="object"||o(m).forEach(function(x){d[x]=m[x]}),d}typeof Promise>"u"||r.Promise||(r.Promise=Promise);var c=Object.getPrototypeOf,h={}.hasOwnProperty;function u(d,m){return h.call(d,m)}function f(d,m){typeof m=="function"&&(m=m(c(d))),(typeof Reflect>"u"?o:Reflect.ownKeys)(m).forEach(function(x){g(d,x,m[x])})}var p=Object.defineProperty;function g(d,m,x,C){p(d,m,l(x&&u(x,"get")&&typeof x.get=="function"?{get:x.get,set:x.set,configurable:!0}:{value:x,configurable:!0,writable:!0},C))}function y(d){return{from:function(m){return d.prototype=Object.create(m.prototype),g(d.prototype,"constructor",d),{extend:f.bind(null,d.prototype)}}}}var v=Object.getOwnPropertyDescriptor,b=[].slice;function w(d,m,x){return b.call(d,m,x)}function S(d,m){return m(d)}function E(d){if(!d)throw new Error("Assertion Failed")}function $(d){r.setImmediate?setImmediate(d):setTimeout(d,0)}function B(d,m){if(typeof m=="string"&&u(d,m))return d[m];if(!m)return d;if(typeof m!="string"){for(var x=[],C=0,D=m.length;C<D;++C){var T=B(d,m[C]);x.push(T)}return x}var I=m.indexOf(".");if(I!==-1){var R=d[m.substr(0,I)];return R==null?void 0:B(R,m.substr(I+1))}}function N(d,m,x){if(d&&m!==void 0&&!("isFrozen"in Object&&Object.isFrozen(d)))if(typeof m!="string"&&"length"in m){E(typeof x!="string"&&"length"in x);for(var C=0,D=m.length;C<D;++C)N(d,m[C],x[C])}else{var T,I,R=m.indexOf(".");R!==-1?(T=m.substr(0,R),(I=m.substr(R+1))===""?x===void 0?a(d)&&!isNaN(parseInt(T))?d.splice(T,1):delete d[T]:d[T]=x:N(R=!(R=d[T])||!u(d,T)?d[T]={}:R,I,x)):x===void 0?a(d)&&!isNaN(parseInt(m))?d.splice(m,1):delete d[m]:d[m]=x}}function L(d){var m,x={};for(m in d)u(d,m)&&(x[m]=d[m]);return x}var V=[].concat;function M(d){return V.apply([],d)}var qn="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(M([8,16,32,64].map(function(d){return["Int","Uint","Float"].map(function(m){return m+d+"Array"})}))).filter(function(d){return r[d]}),F=new Set(qn.map(function(d){return r[d]})),K=null;function X(d){return K=new WeakMap,d=function m(x){if(!x||typeof x!="object")return x;var C=K.get(x);if(C)return C;if(a(x)){C=[],K.set(x,C);for(var D=0,T=x.length;D<T;++D)C.push(m(x[D]))}else if(F.has(x.constructor))C=x;else{var I,R=c(x);for(I in C=R===Object.prototype?{}:Object.create(R),K.set(x,C),x)u(x,I)&&(C[I]=m(x[I]))}return C}(d),K=null,d}var ae={}.toString;function ue(d){return ae.call(d).slice(8,-1)}var ye=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ce=typeof ye=="symbol"?function(d){var m;return d!=null&&(m=d[ye])&&m.apply(d)}:function(){return null};function ne(d,m){return m=d.indexOf(m),0<=m&&d.splice(m,1),0<=m}var _e={};function pe(d){var m,x,C,D;if(arguments.length===1){if(a(d))return d.slice();if(this===_e&&typeof d=="string")return[d];if(D=ce(d)){for(x=[];!(C=D.next()).done;)x.push(C.value);return x}if(d==null)return[d];if(typeof(m=d.length)!="number")return[d];for(x=new Array(m);m--;)x[m]=d[m];return x}for(m=arguments.length,x=new Array(m);m--;)x[m]=arguments[m];return x}var J=typeof Symbol<"u"?function(d){return d[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},gs=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],on=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(gs),le={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function re(d,m){this.name=d,this.message=m}function oe(d,m){return d+". Errors: "+Object.keys(m).map(function(x){return m[x].toString()}).filter(function(x,C,D){return D.indexOf(x)===C}).join(`
`)}function He(d,m,x,C){this.failures=m,this.failedKeys=C,this.successCount=x,this.message=oe(d,m)}function Be(d,m){this.name="BulkError",this.failures=Object.keys(m).map(function(x){return m[x]}),this.failuresByPos=m,this.message=oe(d,this.failures)}y(re).from(Error).extend({toString:function(){return this.name+": "+this.message}}),y(He).from(re),y(Be).from(re);var ot=on.reduce(function(d,m){return d[m]=m+"Error",d},{}),De=re,be=on.reduce(function(d,m){var x=m+"Error";function C(D,T){this.name=x,D?typeof D=="string"?(this.message="".concat(D).concat(T?`
 `+T:""),this.inner=T||null):typeof D=="object"&&(this.message="".concat(D.name," ").concat(D.message),this.inner=D):(this.message=le[m]||x,this.inner=null)}return y(C).from(De),d[m]=C,d},{});be.Syntax=SyntaxError,be.Type=TypeError,be.Range=RangeError;var nn=gs.reduce(function(d,m){return d[m+"Error"]=be[m],d},{}),ms=on.reduce(function(d,m){return["Syntax","Type","Range"].indexOf(m)===-1&&(d[m+"Error"]=be[m]),d},{});function je(){}function St(d){return d}function Pt(d,m){return d==null||d===St?m:function(x){return m(d(x))}}function sn(d,m){return function(){d.apply(this,arguments),m.apply(this,arguments)}}function Ys(d,m){return d===je?m:function(){var x=d.apply(this,arguments);x!==void 0&&(arguments[0]=x);var C=this.onsuccess,D=this.onerror;this.onsuccess=null,this.onerror=null;var T=m.apply(this,arguments);return C&&(this.onsuccess=this.onsuccess?sn(C,this.onsuccess):C),D&&(this.onerror=this.onerror?sn(D,this.onerror):D),T!==void 0?T:x}}function Ui(d,m){return d===je?m:function(){d.apply(this,arguments);var x=this.onsuccess,C=this.onerror;this.onsuccess=this.onerror=null,m.apply(this,arguments),x&&(this.onsuccess=this.onsuccess?sn(x,this.onsuccess):x),C&&(this.onerror=this.onerror?sn(C,this.onerror):C)}}function Xs(d,m){return d===je?m:function(x){var C=d.apply(this,arguments);l(x,C);var D=this.onsuccess,T=this.onerror;return this.onsuccess=null,this.onerror=null,x=m.apply(this,arguments),D&&(this.onsuccess=this.onsuccess?sn(D,this.onsuccess):D),T&&(this.onerror=this.onerror?sn(T,this.onerror):T),C===void 0?x===void 0?void 0:x:l(C,x)}}function ao(d,m){return d===je?m:function(){return m.apply(this,arguments)!==!1&&d.apply(this,arguments)}}function Wn(d,m){return d===je?m:function(){var x=d.apply(this,arguments);if(x&&typeof x.then=="function"){for(var C=this,D=arguments.length,T=new Array(D);D--;)T[D]=arguments[D];return x.then(function(){return m.apply(C,T)})}return m.apply(this,arguments)}}ms.ModifyError=He,ms.DexieError=re,ms.BulkError=Be;var lt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Mt(d){lt=d}var Ht={},Zs=100,qn=typeof Promise>"u"?[]:function(){var d=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[d,c(d),d];var m=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[m,c(m),d]}(),gs=qn[0],on=qn[1],qn=qn[2],on=on&&on.then,rn=gs&&gs.constructor,Un=!!qn,Qs=function(d,m){ei.push([d,m]),Js&&(queueMicrotask(ll),Js=!1)},Vi=!0,Js=!0,jt=[],En=[],lo=St,yn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:je,pgp:!1,env:{},finalize:je},we=yn,ei=[],Vn=0,ti=[];function ve(d){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var m=this._PSD=we;if(typeof d!="function"){if(d!==Ht)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&qi(this,this._value))}this._state=null,this._value=null,++m.ref,function x(C,D){try{D(function(T){if(C._state===null){if(T===C)throw new TypeError("A promise cannot be resolved with itself.");var I=C._lib&&ys();T&&typeof T.then=="function"?x(C,function(R,j){T instanceof ve?T._then(R,j):T.then(R,j)}):(C._state=!0,C._value=T,al(C)),I&&vs()}},qi.bind(null,C))}catch(T){qi(C,T)}}(this,d)}var Ki={get:function(){var d=we,m=cl;function x(C,D){var T=this,I=!d.global&&(d!==we||m!==cl),R=I&&!_s(),j=new ve(function(O,q){co(T,new ol(Yg(C,d,I,R),Yg(D,d,I,R),O,q,d))});return this._consoleTask&&(j._consoleTask=this._consoleTask),j}return x.prototype=Ht,x},set:function(d){g(this,"then",d&&d.prototype===Ht?Ki:{get:function(){return d},set:Ki.set})}};function ol(d,m,x,C,D){this.onFulfilled=typeof d=="function"?d:null,this.onRejected=typeof m=="function"?m:null,this.resolve=x,this.reject=C,this.psd=D}function qi(d,m){var x,C;En.push(m),d._state===null&&(x=d._lib&&ys(),m=lo(m),d._state=!1,d._value=m,C=d,jt.some(function(D){return D._value===C._value})||jt.push(C),al(d),x&&vs())}function al(d){var m=d._listeners;d._listeners=[];for(var x=0,C=m.length;x<C;++x)co(d,m[x]);var D=d._PSD;--D.ref||D.finalize(),Vn===0&&(++Vn,Qs(function(){--Vn==0&&Gi()},[]))}function co(d,m){if(d._state!==null){var x=d._state?m.onFulfilled:m.onRejected;if(x===null)return(d._state?m.resolve:m.reject)(d._value);++m.psd.ref,++Vn,Qs(ld,[x,d,m])}else d._listeners.push(m)}function ld(d,m,x){try{var C,D=m._value;!m._state&&En.length&&(En=[]),C=lt&&m._consoleTask?m._consoleTask.run(function(){return d(D)}):d(D),m._state||En.indexOf(D)!==-1||function(T){for(var I=jt.length;I;)if(jt[--I]._value===T._value)return jt.splice(I,1)}(m),x.resolve(C)}catch(T){x.reject(T)}finally{--Vn==0&&Gi(),--x.psd.ref||x.psd.finalize()}}function ll(){si(yn,function(){ys()&&vs()})}function ys(){var d=Vi;return Js=Vi=!1,d}function vs(){var d,m,x;do for(;0<ei.length;)for(d=ei,ei=[],x=d.length,m=0;m<x;++m){var C=d[m];C[0].apply(null,C[1])}while(0<ei.length);Js=Vi=!0}function Gi(){var d=jt;jt=[],d.forEach(function(C){C._PSD.onunhandled.call(null,C._value,C)});for(var m=ti.slice(0),x=m.length;x;)m[--x]()}function Yi(d){return new ve(Ht,!1,d)}function st(d,m){var x=we;return function(){var C=ys(),D=we;try{return bs(x,!0),d.apply(this,arguments)}catch(T){m&&m(T)}finally{bs(D,!1),C&&vs()}}}f(ve.prototype,{then:Ki,_then:function(d,m){co(this,new ol(null,null,d,m,we))},catch:function(d){if(arguments.length===1)return this.then(null,d);var m=d,x=arguments[1];return typeof m=="function"?this.then(null,function(C){return(C instanceof m?x:Yi)(C)}):this.then(null,function(C){return(C&&C.name===m?x:Yi)(C)})},finally:function(d){return this.then(function(m){return ve.resolve(d()).then(function(){return m})},function(m){return ve.resolve(d()).then(function(){return Yi(m)})})},timeout:function(d,m){var x=this;return d<1/0?new ve(function(C,D){var T=setTimeout(function(){return D(new be.Timeout(m))},d);x.then(C,D).finally(clearTimeout.bind(null,T))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&g(ve.prototype,Symbol.toStringTag,"Dexie.Promise"),yn.env=Gg(),f(ve,{all:function(){var d=pe.apply(null,arguments).map(hl);return new ve(function(m,x){d.length===0&&m([]);var C=d.length;d.forEach(function(D,T){return ve.resolve(D).then(function(I){d[T]=I,--C||m(d)},x)})})},resolve:function(d){return d instanceof ve?d:d&&typeof d.then=="function"?new ve(function(m,x){d.then(m,x)}):new ve(Ht,!0,d)},reject:Yi,race:function(){var d=pe.apply(null,arguments).map(hl);return new ve(function(m,x){d.map(function(C){return ve.resolve(C).then(m,x)})})},PSD:{get:function(){return we},set:function(d){return we=d}},totalEchoes:{get:function(){return cl}},newPSD:xs,usePSD:si,scheduler:{get:function(){return Qs},set:function(d){Qs=d}},rejectionMapper:{get:function(){return lo},set:function(d){lo=d}},follow:function(d,m){return new ve(function(x,C){return xs(function(D,T){var I=we;I.unhandleds=[],I.onunhandled=T,I.finalize=sn(function(){var R,j=this;R=function(){j.unhandleds.length===0?D():T(j.unhandleds[0])},ti.push(function O(){R(),ti.splice(ti.indexOf(O),1)}),++Vn,Qs(function(){--Vn==0&&Gi()},[])},I.finalize),d()},m,x,C)})}}),rn&&(rn.allSettled&&g(ve,"allSettled",function(){var d=pe.apply(null,arguments).map(hl);return new ve(function(m){d.length===0&&m([]);var x=d.length,C=new Array(x);d.forEach(function(D,T){return ve.resolve(D).then(function(I){return C[T]={status:"fulfilled",value:I}},function(I){return C[T]={status:"rejected",reason:I}}).then(function(){return--x||m(C)})})})}),rn.any&&typeof AggregateError<"u"&&g(ve,"any",function(){var d=pe.apply(null,arguments).map(hl);return new ve(function(m,x){d.length===0&&x(new AggregateError([]));var C=d.length,D=new Array(C);d.forEach(function(T,I){return ve.resolve(T).then(function(R){return m(R)},function(R){D[I]=R,--C||x(new AggregateError(D))})})})}));var We={awaits:0,echoes:0,id:0},An=0,ni=[],Xi=0,cl=0,K1=0;function xs(d,m,x,C){var D=we,T=Object.create(D);return T.parent=D,T.ref=0,T.global=!1,T.id=++K1,yn.env,T.env=Un?{Promise:ve,PromiseProp:{value:ve,configurable:!0,writable:!0},all:ve.all,race:ve.race,allSettled:ve.allSettled,any:ve.any,resolve:ve.resolve,reject:ve.reject}:{},m&&l(T,m),++D.ref,T.finalize=function(){--this.parent.ref||this.parent.finalize()},C=si(T,d,x,C),T.ref===0&&T.finalize(),C}function Zi(){return We.id||(We.id=++An),++We.awaits,We.echoes+=Zs,We.id}function _s(){return!!We.awaits&&(--We.awaits==0&&(We.id=0),We.echoes=We.awaits*Zs,!0)}function hl(d){return We.echoes&&d&&d.constructor===rn?(Zi(),d.then(function(m){return _s(),m},function(m){return _s(),ct(m)})):d}function q1(){var d=ni[ni.length-1];ni.pop(),bs(d,!1)}function bs(d,m){var x,C=we;(m?!We.echoes||Xi++&&d===we:!Xi||--Xi&&d===we)||queueMicrotask(m?(function(D){++cl,We.echoes&&--We.echoes!=0||(We.echoes=We.awaits=We.id=0),ni.push(we),bs(D,!0)}).bind(null,d):q1),d!==we&&(we=d,C===yn&&(yn.env=Gg()),Un&&(x=yn.env.Promise,m=d.env,(C.global||d.global)&&(Object.defineProperty(r,"Promise",m.PromiseProp),x.all=m.all,x.race=m.race,x.resolve=m.resolve,x.reject=m.reject,m.allSettled&&(x.allSettled=m.allSettled),m.any&&(x.any=m.any))))}function Gg(){var d=r.Promise;return Un?{Promise:d,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:d.all,race:d.race,allSettled:d.allSettled,any:d.any,resolve:d.resolve,reject:d.reject}:{}}function si(d,m,x,C,D){var T=we;try{return bs(d,!0),m(x,C,D)}finally{bs(T,!1)}}function Yg(d,m,x,C){return typeof d!="function"?d:function(){var D=we;x&&Zi(),bs(m,!0);try{return d.apply(this,arguments)}finally{bs(D,!1),C&&queueMicrotask(_s)}}}function cd(d){Promise===rn&&We.echoes===0?Xi===0?d():enqueueNativeMicroTask(d):setTimeout(d,0)}(""+on).indexOf("[native code]")===-1&&(Zi=_s=je);var ct=ve.reject,ii=String.fromCharCode(65535),Kn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Xg="String expected.",Qi=[],ul="__dbnames",hd="readonly",ud="readwrite";function ri(d,m){return d?m?function(){return d.apply(this,arguments)&&m.apply(this,arguments)}:d:m}var Zg={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function dl(d){return typeof d!="string"||/\./.test(d)?function(m){return m}:function(m){return m[d]===void 0&&d in m&&delete(m=X(m))[d],m}}function Qg(){throw be.Type()}function qe(d,m){try{var x=Jg(d),C=Jg(m);if(x!==C)return x==="Array"?1:C==="Array"?-1:x==="binary"?1:C==="binary"?-1:x==="string"?1:C==="string"?-1:x==="Date"?1:C!=="Date"?NaN:-1;switch(x){case"number":case"Date":case"string":return m<d?1:d<m?-1:0;case"binary":return function(D,T){for(var I=D.length,R=T.length,j=I<R?I:R,O=0;O<j;++O)if(D[O]!==T[O])return D[O]<T[O]?-1:1;return I===R?0:I<R?-1:1}(ey(d),ey(m));case"Array":return function(D,T){for(var I=D.length,R=T.length,j=I<R?I:R,O=0;O<j;++O){var q=qe(D[O],T[O]);if(q!==0)return q}return I===R?0:I<R?-1:1}(d,m)}}catch{}return NaN}function Jg(d){var m=typeof d;return m!="object"?m:ArrayBuffer.isView(d)?"binary":(d=ue(d),d==="ArrayBuffer"?"binary":d)}function ey(d){return d instanceof Uint8Array?d:ArrayBuffer.isView(d)?new Uint8Array(d.buffer,d.byteOffset,d.byteLength):new Uint8Array(d)}var ty=(it.prototype._trans=function(d,m,x){var C=this._tx||we.trans,D=this.name,T=lt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(d==="readonly"?"read":"write"," ").concat(this.name));function I(O,q,z){if(!z.schema[D])throw new be.NotFound("Table "+D+" not part of transaction");return m(z.idbtrans,z)}var R=ys();try{var j=C&&C.db._novip===this.db._novip?C===we.trans?C._promise(d,I,x):xs(function(){return C._promise(d,I,x)},{trans:C,transless:we.transless||we}):function O(q,z,G,H){if(q.idbdb&&(q._state.openComplete||we.letThrough||q._vip)){var U=q._createTransaction(z,G,q._dbSchema);try{U.create(),q._state.PR1398_maxLoop=3}catch(Y){return Y.name===ot.InvalidState&&q.isOpen()&&0<--q._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),q.close({disableAutoOpen:!1}),q.open().then(function(){return O(q,z,G,H)})):ct(Y)}return U._promise(z,function(Y,W){return xs(function(){return we.trans=U,H(Y,W,U)})}).then(function(Y){if(z==="readwrite")try{U.idbtrans.commit()}catch{}return z==="readonly"?Y:U._completion.then(function(){return Y})})}if(q._state.openComplete)return ct(new be.DatabaseClosed(q._state.dbOpenError));if(!q._state.isBeingOpened){if(!q._state.autoOpen)return ct(new be.DatabaseClosed);q.open().catch(je)}return q._state.dbReadyPromise.then(function(){return O(q,z,G,H)})}(this.db,d,[this.name],I);return T&&(j._consoleTask=T,j=j.catch(function(O){return console.trace(O),ct(O)})),j}finally{R&&vs()}},it.prototype.get=function(d,m){var x=this;return d&&d.constructor===Object?this.where(d).first(m):d==null?ct(new be.Type("Invalid argument to Table.get()")):this._trans("readonly",function(C){return x.core.get({trans:C,key:d}).then(function(D){return x.hook.reading.fire(D)})}).then(m)},it.prototype.where=function(d){if(typeof d=="string")return new this.db.WhereClause(this,d);if(a(d))return new this.db.WhereClause(this,"[".concat(d.join("+"),"]"));var m=o(d);if(m.length===1)return this.where(m[0]).equals(d[m[0]]);var x=this.schema.indexes.concat(this.schema.primKey).filter(function(j){if(j.compound&&m.every(function(q){return 0<=j.keyPath.indexOf(q)})){for(var O=0;O<m.length;++O)if(m.indexOf(j.keyPath[O])===-1)return!1;return!0}return!1}).sort(function(j,O){return j.keyPath.length-O.keyPath.length})[0];if(x&&this.db._maxKey!==ii){var I=x.keyPath.slice(0,m.length);return this.where(I).equals(I.map(function(O){return d[O]}))}!x&&lt&&console.warn("The query ".concat(JSON.stringify(d)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(m.join("+"),"]"));var C=this.schema.idxByName,D=this.db._deps.indexedDB;function T(j,O){return D.cmp(j,O)===0}var R=m.reduce(function(G,O){var q=G[0],z=G[1],G=C[O],H=d[O];return[q||G,q||!G?ri(z,G&&G.multi?function(U){return U=B(U,O),a(U)&&U.some(function(Y){return T(H,Y)})}:function(U){return T(H,B(U,O))}):z]},[null,null]),I=R[0],R=R[1];return I?this.where(I.name).equals(d[I.keyPath]).filter(R):x?this.filter(R):this.where(m).equals("")},it.prototype.filter=function(d){return this.toCollection().and(d)},it.prototype.count=function(d){return this.toCollection().count(d)},it.prototype.offset=function(d){return this.toCollection().offset(d)},it.prototype.limit=function(d){return this.toCollection().limit(d)},it.prototype.each=function(d){return this.toCollection().each(d)},it.prototype.toArray=function(d){return this.toCollection().toArray(d)},it.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},it.prototype.orderBy=function(d){return new this.db.Collection(new this.db.WhereClause(this,a(d)?"[".concat(d.join("+"),"]"):d))},it.prototype.reverse=function(){return this.toCollection().reverse()},it.prototype.mapToClass=function(d){var m,x=this.db,C=this.name;function D(){return m!==null&&m.apply(this,arguments)||this}(this.schema.mappedClass=d).prototype instanceof Qg&&(function(j,O){if(typeof O!="function"&&O!==null)throw new TypeError("Class extends value "+String(O)+" is not a constructor or null");function q(){this.constructor=j}t(j,O),j.prototype=O===null?Object.create(O):(q.prototype=O.prototype,new q)}(D,m=d),Object.defineProperty(D.prototype,"db",{get:function(){return x},enumerable:!1,configurable:!0}),D.prototype.table=function(){return C},d=D);for(var T=new Set,I=d.prototype;I;I=c(I))Object.getOwnPropertyNames(I).forEach(function(j){return T.add(j)});function R(j){if(!j)return j;var O,q=Object.create(d.prototype);for(O in j)if(!T.has(O))try{q[O]=j[O]}catch{}return q}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=R,this.hook("reading",R),d},it.prototype.defineClass=function(){return this.mapToClass(function(d){l(this,d)})},it.prototype.add=function(d,m){var x=this,C=this.schema.primKey,D=C.auto,T=C.keyPath,I=d;return T&&D&&(I=dl(T)(d)),this._trans("readwrite",function(R){return x.core.mutate({trans:R,type:"add",keys:m!=null?[m]:null,values:[I]})}).then(function(R){return R.numFailures?ve.reject(R.failures[0]):R.lastResult}).then(function(R){if(T)try{N(d,T,R)}catch{}return R})},it.prototype.update=function(d,m){return typeof d!="object"||a(d)?this.where(":id").equals(d).modify(m):(d=B(d,this.schema.primKey.keyPath),d===void 0?ct(new be.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(d).modify(m))},it.prototype.put=function(d,m){var x=this,C=this.schema.primKey,D=C.auto,T=C.keyPath,I=d;return T&&D&&(I=dl(T)(d)),this._trans("readwrite",function(R){return x.core.mutate({trans:R,type:"put",values:[I],keys:m!=null?[m]:null})}).then(function(R){return R.numFailures?ve.reject(R.failures[0]):R.lastResult}).then(function(R){if(T)try{N(d,T,R)}catch{}return R})},it.prototype.delete=function(d){var m=this;return this._trans("readwrite",function(x){return m.core.mutate({trans:x,type:"delete",keys:[d]})}).then(function(x){return x.numFailures?ve.reject(x.failures[0]):void 0})},it.prototype.clear=function(){var d=this;return this._trans("readwrite",function(m){return d.core.mutate({trans:m,type:"deleteRange",range:Zg})}).then(function(m){return m.numFailures?ve.reject(m.failures[0]):void 0})},it.prototype.bulkGet=function(d){var m=this;return this._trans("readonly",function(x){return m.core.getMany({keys:d,trans:x}).then(function(C){return C.map(function(D){return m.hook.reading.fire(D)})})})},it.prototype.bulkAdd=function(d,m,x){var C=this,D=Array.isArray(m)?m:void 0,T=(x=x||(D?void 0:m))?x.allKeys:void 0;return this._trans("readwrite",function(I){var O=C.schema.primKey,R=O.auto,O=O.keyPath;if(O&&D)throw new be.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(D&&D.length!==d.length)throw new be.InvalidArgument("Arguments objects and keys must have the same length");var j=d.length,O=O&&R?d.map(dl(O)):d;return C.core.mutate({trans:I,type:"add",keys:D,values:O,wantResults:T}).then(function(U){var z=U.numFailures,G=U.results,H=U.lastResult,U=U.failures;if(z===0)return T?G:H;throw new Be("".concat(C.name,".bulkAdd(): ").concat(z," of ").concat(j," operations failed"),U)})})},it.prototype.bulkPut=function(d,m,x){var C=this,D=Array.isArray(m)?m:void 0,T=(x=x||(D?void 0:m))?x.allKeys:void 0;return this._trans("readwrite",function(I){var O=C.schema.primKey,R=O.auto,O=O.keyPath;if(O&&D)throw new be.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(D&&D.length!==d.length)throw new be.InvalidArgument("Arguments objects and keys must have the same length");var j=d.length,O=O&&R?d.map(dl(O)):d;return C.core.mutate({trans:I,type:"put",keys:D,values:O,wantResults:T}).then(function(U){var z=U.numFailures,G=U.results,H=U.lastResult,U=U.failures;if(z===0)return T?G:H;throw new Be("".concat(C.name,".bulkPut(): ").concat(z," of ").concat(j," operations failed"),U)})})},it.prototype.bulkUpdate=function(d){var m=this,x=this.core,C=d.map(function(I){return I.key}),D=d.map(function(I){return I.changes}),T=[];return this._trans("readwrite",function(I){return x.getMany({trans:I,keys:C,cache:"clone"}).then(function(R){var j=[],O=[];d.forEach(function(z,G){var H=z.key,U=z.changes,Y=R[G];if(Y){for(var W=0,Z=Object.keys(U);W<Z.length;W++){var Q=Z[W],te=U[Q];if(Q===m.schema.primKey.keyPath){if(qe(te,H)!==0)throw new be.Constraint("Cannot update primary key in bulkUpdate()")}else N(Y,Q,te)}T.push(G),j.push(H),O.push(Y)}});var q=j.length;return x.mutate({trans:I,type:"put",keys:j,values:O,updates:{keys:C,changeSpecs:D}}).then(function(z){var G=z.numFailures,H=z.failures;if(G===0)return q;for(var U=0,Y=Object.keys(H);U<Y.length;U++){var W,Z=Y[U],Q=T[Number(Z)];Q!=null&&(W=H[Z],delete H[Z],H[Q]=W)}throw new Be("".concat(m.name,".bulkUpdate(): ").concat(G," of ").concat(q," operations failed"),H)})})})},it.prototype.bulkDelete=function(d){var m=this,x=d.length;return this._trans("readwrite",function(C){return m.core.mutate({trans:C,type:"delete",keys:d})}).then(function(I){var D=I.numFailures,T=I.lastResult,I=I.failures;if(D===0)return T;throw new Be("".concat(m.name,".bulkDelete(): ").concat(D," of ").concat(x," operations failed"),I)})},it);function it(){}function ho(d){function m(I,R){if(R){for(var j=arguments.length,O=new Array(j-1);--j;)O[j-1]=arguments[j];return x[I].subscribe.apply(null,O),d}if(typeof I=="string")return x[I]}var x={};m.addEventType=T;for(var C=1,D=arguments.length;C<D;++C)T(arguments[C]);return m;function T(I,R,j){if(typeof I!="object"){var O;R=R||ao;var q={subscribers:[],fire:j=j||je,subscribe:function(z){q.subscribers.indexOf(z)===-1&&(q.subscribers.push(z),q.fire=R(q.fire,z))},unsubscribe:function(z){q.subscribers=q.subscribers.filter(function(G){return G!==z}),q.fire=q.subscribers.reduce(R,j)}};return x[I]=m[I]=q}o(O=I).forEach(function(z){var G=O[z];if(a(G))T(z,O[z][0],O[z][1]);else{if(G!=="asap")throw new be.InvalidArgument("Invalid event config");var H=T(z,St,function(){for(var U=arguments.length,Y=new Array(U);U--;)Y[U]=arguments[U];H.subscribers.forEach(function(W){$(function(){W.apply(null,Y)})})})}})}}function uo(d,m){return y(m).from({prototype:d}),m}function Ji(d,m){return!(d.filter||d.algorithm||d.or)&&(m?d.justLimit:!d.replayFilter)}function dd(d,m){d.filter=ri(d.filter,m)}function fd(d,m,x){var C=d.replayFilter;d.replayFilter=C?function(){return ri(C(),m())}:m,d.justLimit=x&&!C}function fl(d,m){if(d.isPrimKey)return m.primaryKey;var x=m.getIndexByKeyPath(d.index);if(!x)throw new be.Schema("KeyPath "+d.index+" on object store "+m.name+" is not indexed");return x}function ny(d,m,x){var C=fl(d,m.schema);return m.openCursor({trans:x,values:!d.keysOnly,reverse:d.dir==="prev",unique:!!d.unique,query:{index:C,range:d.range}})}function pl(d,m,x,C){var D=d.replayFilter?ri(d.filter,d.replayFilter()):d.filter;if(d.or){var T={},I=function(R,j,O){var q,z;D&&!D(j,O,function(G){return j.stop(G)},function(G){return j.fail(G)})||((z=""+(q=j.primaryKey))=="[object ArrayBuffer]"&&(z=""+new Uint8Array(q)),u(T,z)||(T[z]=!0,m(R,j,O)))};return Promise.all([d.or._iterate(I,x),sy(ny(d,C,x),d.algorithm,I,!d.keysOnly&&d.valueMapper)])}return sy(ny(d,C,x),ri(d.algorithm,D),m,!d.keysOnly&&d.valueMapper)}function sy(d,m,x,C){var D=st(C?function(T,I,R){return x(C(T),I,R)}:x);return d.then(function(T){if(T)return T.start(function(){var I=function(){return T.continue()};m&&!m(T,function(R){return I=R},function(R){T.stop(R),I=je},function(R){T.fail(R),I=je})||D(T.value,T,function(R){return I=R}),I()})})}var qn=Symbol(),pd=(iy.prototype.execute=function(d){var m=(m=this.replacePrefix)===null||m===void 0?void 0:m[0];return m&&typeof d=="string"&&d.startsWith(m)?this.replacePrefix[1]+d.substring(m.length):d},iy);function iy(d){Object.assign(this,d)}var G1=(Ue.prototype._read=function(d,m){var x=this._ctx;return x.error?x.table._trans(null,ct.bind(null,x.error)):x.table._trans("readonly",d).then(m)},Ue.prototype._write=function(d){var m=this._ctx;return m.error?m.table._trans(null,ct.bind(null,m.error)):m.table._trans("readwrite",d,"locked")},Ue.prototype._addAlgorithm=function(d){var m=this._ctx;m.algorithm=ri(m.algorithm,d)},Ue.prototype._iterate=function(d,m){return pl(this._ctx,d,m,this._ctx.table.core)},Ue.prototype.clone=function(d){var m=Object.create(this.constructor.prototype),x=Object.create(this._ctx);return d&&l(x,d),m._ctx=x,m},Ue.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ue.prototype.each=function(d){var m=this._ctx;return this._read(function(x){return pl(m,d,x,m.table.core)})},Ue.prototype.count=function(d){var m=this;return this._read(function(x){var C=m._ctx,D=C.table.core;if(Ji(C,!0))return D.count({trans:x,query:{index:fl(C,D.schema),range:C.range}}).then(function(I){return Math.min(I,C.limit)});var T=0;return pl(C,function(){return++T,!1},x,D).then(function(){return T})}).then(d)},Ue.prototype.sortBy=function(d,m){var x=d.split(".").reverse(),C=x[0],D=x.length-1;function T(j,O){return O?T(j[x[O]],O-1):j[C]}var I=this._ctx.dir==="next"?1:-1;function R(j,O){return j=T(j,D),O=T(O,D),j<O?-I:O<j?I:0}return this.toArray(function(j){return j.sort(R)}).then(m)},Ue.prototype.toArray=function(d){var m=this;return this._read(function(x){var C=m._ctx;if(C.dir==="next"&&Ji(C,!0)&&0<C.limit){var D=C.valueMapper,T=fl(C,C.table.core.schema);return C.table.core.query({trans:x,limit:C.limit,values:!0,query:{index:T,range:C.range}}).then(function(R){return R=R.result,D?R.map(D):R})}var I=[];return pl(C,function(R){return I.push(R)},x,C.table.core).then(function(){return I})},d)},Ue.prototype.offset=function(d){var m=this._ctx;return d<=0||(m.offset+=d,Ji(m)?fd(m,function(){var x=d;return function(C,D){return x===0||(x===1?--x:D(function(){C.advance(x),x=0}),!1)}}):fd(m,function(){var x=d;return function(){return--x<0}})),this},Ue.prototype.limit=function(d){return this._ctx.limit=Math.min(this._ctx.limit,d),fd(this._ctx,function(){var m=d;return function(x,C,D){return--m<=0&&C(D),0<=m}},!0),this},Ue.prototype.until=function(d,m){return dd(this._ctx,function(x,C,D){return!d(x.value)||(C(D),m)}),this},Ue.prototype.first=function(d){return this.limit(1).toArray(function(m){return m[0]}).then(d)},Ue.prototype.last=function(d){return this.reverse().first(d)},Ue.prototype.filter=function(d){var m;return dd(this._ctx,function(x){return d(x.value)}),(m=this._ctx).isMatch=ri(m.isMatch,d),this},Ue.prototype.and=function(d){return this.filter(d)},Ue.prototype.or=function(d){return new this.db.WhereClause(this._ctx.table,d,this)},Ue.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ue.prototype.desc=function(){return this.reverse()},Ue.prototype.eachKey=function(d){var m=this._ctx;return m.keysOnly=!m.isMatch,this.each(function(x,C){d(C.key,C)})},Ue.prototype.eachUniqueKey=function(d){return this._ctx.unique="unique",this.eachKey(d)},Ue.prototype.eachPrimaryKey=function(d){var m=this._ctx;return m.keysOnly=!m.isMatch,this.each(function(x,C){d(C.primaryKey,C)})},Ue.prototype.keys=function(d){var m=this._ctx;m.keysOnly=!m.isMatch;var x=[];return this.each(function(C,D){x.push(D.key)}).then(function(){return x}).then(d)},Ue.prototype.primaryKeys=function(d){var m=this._ctx;if(m.dir==="next"&&Ji(m,!0)&&0<m.limit)return this._read(function(C){var D=fl(m,m.table.core.schema);return m.table.core.query({trans:C,values:!1,limit:m.limit,query:{index:D,range:m.range}})}).then(function(C){return C.result}).then(d);m.keysOnly=!m.isMatch;var x=[];return this.each(function(C,D){x.push(D.primaryKey)}).then(function(){return x}).then(d)},Ue.prototype.uniqueKeys=function(d){return this._ctx.unique="unique",this.keys(d)},Ue.prototype.firstKey=function(d){return this.limit(1).keys(function(m){return m[0]}).then(d)},Ue.prototype.lastKey=function(d){return this.reverse().firstKey(d)},Ue.prototype.distinct=function(){var d=this._ctx,d=d.index&&d.table.schema.idxByName[d.index];if(!d||!d.multi)return this;var m={};return dd(this._ctx,function(D){var C=D.primaryKey.toString(),D=u(m,C);return m[C]=!0,!D}),this},Ue.prototype.modify=function(d){var m=this,x=this._ctx;return this._write(function(C){var D,T,I;I=typeof d=="function"?d:(D=o(d),T=D.length,function(W){for(var Z=!1,Q=0;Q<T;++Q){var te=D[Q],se=d[te],ie=B(W,te);se instanceof pd?(N(W,te,se.execute(ie)),Z=!0):ie!==se&&(N(W,te,se),Z=!0)}return Z});function R(W,te){var Q=te.failures,te=te.numFailures;U+=W-te;for(var se=0,ie=o(Q);se<ie.length;se++){var me=ie[se];H.push(Q[me])}}var j=x.table.core,O=j.schema.primaryKey,q=O.outbound,z=O.extractKey,G=m.db._options.modifyChunkSize||200,H=[],U=0,Y=[];return m.clone().primaryKeys().then(function(W){function Z(Q){var te=Math.min(G,W.length-Q);return j.getMany({trans:C,keys:W.slice(Q,Q+te),cache:"immutable"}).then(function(se){for(var ie=[],me=[],he=q?[]:null,de=[],ge=0;ge<te;++ge){var xe=se[ge],Ae={value:X(xe),primKey:W[Q+ge]};I.call(Ae,Ae.value,Ae)!==!1&&(Ae.value==null?de.push(W[Q+ge]):q||qe(z(xe),z(Ae.value))===0?(me.push(Ae.value),q&&he.push(W[Q+ge])):(de.push(W[Q+ge]),ie.push(Ae.value)))}var Fe=Ji(x)&&x.limit===1/0&&(typeof d!="function"||d===md)&&{index:x.index,range:x.range};return Promise.resolve(0<ie.length&&j.mutate({trans:C,type:"add",values:ie}).then(function(Le){for(var Pe in Le.failures)de.splice(parseInt(Pe),1);R(ie.length,Le)})).then(function(){return(0<me.length||Fe&&typeof d=="object")&&j.mutate({trans:C,type:"put",keys:he,values:me,criteria:Fe,changeSpec:typeof d!="function"&&d}).then(function(Le){return R(me.length,Le)})}).then(function(){return(0<de.length||Fe&&d===md)&&j.mutate({trans:C,type:"delete",keys:de,criteria:Fe}).then(function(Le){return R(de.length,Le)})}).then(function(){return W.length>Q+te&&Z(Q+G)})})}return Z(0).then(function(){if(0<H.length)throw new He("Error modifying one or more objects",H,U,Y);return W.length})})})},Ue.prototype.delete=function(){var d=this._ctx,m=d.range;return Ji(d)&&(d.isPrimKey||m.type===3)?this._write(function(x){var C=d.table.core.schema.primaryKey,D=m;return d.table.core.count({trans:x,query:{index:C,range:D}}).then(function(T){return d.table.core.mutate({trans:x,type:"deleteRange",range:D}).then(function(I){var R=I.failures;if(I.lastResult,I.results,I=I.numFailures,I)throw new He("Could not delete some values",Object.keys(R).map(function(j){return R[j]}),T-I);return T-I})})}):this.modify(md)},Ue);function Ue(){}var md=function(d,m){return m.value=null};function Y1(d,m){return d<m?-1:d===m?0:1}function X1(d,m){return m<d?-1:d===m?0:1}function Jt(d,m,x){return d=d instanceof oy?new d.Collection(d):d,d._ctx.error=new(x||TypeError)(m),d}function er(d){return new d.Collection(d,function(){return ry("")}).limit(0)}function ml(d,m,x,C){var D,T,I,R,j,O,q,z=x.length;if(!x.every(function(U){return typeof U=="string"}))return Jt(d,Xg);function G(U){D=U==="next"?function(W){return W.toUpperCase()}:function(W){return W.toLowerCase()},T=U==="next"?function(W){return W.toLowerCase()}:function(W){return W.toUpperCase()},I=U==="next"?Y1:X1;var Y=x.map(function(W){return{lower:T(W),upper:D(W)}}).sort(function(W,Z){return I(W.lower,Z.lower)});R=Y.map(function(W){return W.upper}),j=Y.map(function(W){return W.lower}),q=(O=U)==="next"?"":C}G("next"),d=new d.Collection(d,function(){return ws(R[0],j[z-1]+C)}),d._ondirectionchange=function(U){G(U)};var H=0;return d._addAlgorithm(function(U,Y,W){var Z=U.key;if(typeof Z!="string")return!1;var Q=T(Z);if(m(Q,j,H))return!0;for(var te=null,se=H;se<z;++se){var ie=function(me,he,de,ge,xe,Ae){for(var Fe=Math.min(me.length,ge.length),Le=-1,Pe=0;Pe<Fe;++Pe){var vn=he[Pe];if(vn!==ge[Pe])return xe(me[Pe],de[Pe])<0?me.substr(0,Pe)+de[Pe]+de.substr(Pe+1):xe(me[Pe],ge[Pe])<0?me.substr(0,Pe)+ge[Pe]+de.substr(Pe+1):0<=Le?me.substr(0,Le)+he[Le]+de.substr(Le+1):null;xe(me[Pe],vn)<0&&(Le=Pe)}return Fe<ge.length&&Ae==="next"?me+de.substr(me.length):Fe<me.length&&Ae==="prev"?me.substr(0,de.length):Le<0?null:me.substr(0,Le)+ge[Le]+de.substr(Le+1)}(Z,Q,R[se],j[se],I,O);ie===null&&te===null?H=se+1:(te===null||0<I(te,ie))&&(te=ie)}return Y(te!==null?function(){U.continue(te+q)}:W),!1}),d}function ws(d,m,x,C){return{type:2,lower:d,upper:m,lowerOpen:x,upperOpen:C}}function ry(d){return{type:1,lower:d,upper:d}}var oy=(Object.defineProperty(wt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),wt.prototype.between=function(d,m,x,C){x=x!==!1,C=C===!0;try{return 0<this._cmp(d,m)||this._cmp(d,m)===0&&(x||C)&&(!x||!C)?er(this):new this.Collection(this,function(){return ws(d,m,!x,!C)})}catch{return Jt(this,Kn)}},wt.prototype.equals=function(d){return d==null?Jt(this,Kn):new this.Collection(this,function(){return ry(d)})},wt.prototype.above=function(d){return d==null?Jt(this,Kn):new this.Collection(this,function(){return ws(d,void 0,!0)})},wt.prototype.aboveOrEqual=function(d){return d==null?Jt(this,Kn):new this.Collection(this,function(){return ws(d,void 0,!1)})},wt.prototype.below=function(d){return d==null?Jt(this,Kn):new this.Collection(this,function(){return ws(void 0,d,!1,!0)})},wt.prototype.belowOrEqual=function(d){return d==null?Jt(this,Kn):new this.Collection(this,function(){return ws(void 0,d)})},wt.prototype.startsWith=function(d){return typeof d!="string"?Jt(this,Xg):this.between(d,d+ii,!0,!0)},wt.prototype.startsWithIgnoreCase=function(d){return d===""?this.startsWith(d):ml(this,function(m,x){return m.indexOf(x[0])===0},[d],ii)},wt.prototype.equalsIgnoreCase=function(d){return ml(this,function(m,x){return m===x[0]},[d],"")},wt.prototype.anyOfIgnoreCase=function(){var d=pe.apply(_e,arguments);return d.length===0?er(this):ml(this,function(m,x){return x.indexOf(m)!==-1},d,"")},wt.prototype.startsWithAnyOfIgnoreCase=function(){var d=pe.apply(_e,arguments);return d.length===0?er(this):ml(this,function(m,x){return x.some(function(C){return m.indexOf(C)===0})},d,ii)},wt.prototype.anyOf=function(){var d=this,m=pe.apply(_e,arguments),x=this._cmp;try{m.sort(x)}catch{return Jt(this,Kn)}if(m.length===0)return er(this);var C=new this.Collection(this,function(){return ws(m[0],m[m.length-1])});C._ondirectionchange=function(T){x=T==="next"?d._ascending:d._descending,m.sort(x)};var D=0;return C._addAlgorithm(function(T,I,R){for(var j=T.key;0<x(j,m[D]);)if(++D===m.length)return I(R),!1;return x(j,m[D])===0||(I(function(){T.continue(m[D])}),!1)}),C},wt.prototype.notEqual=function(d){return this.inAnyRange([[-1/0,d],[d,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},wt.prototype.noneOf=function(){var d=pe.apply(_e,arguments);if(d.length===0)return new this.Collection(this);try{d.sort(this._ascending)}catch{return Jt(this,Kn)}var m=d.reduce(function(x,C){return x?x.concat([[x[x.length-1][1],C]]):[[-1/0,C]]},null);return m.push([d[d.length-1],this.db._maxKey]),this.inAnyRange(m,{includeLowers:!1,includeUppers:!1})},wt.prototype.inAnyRange=function(Z,m){var x=this,C=this._cmp,D=this._ascending,T=this._descending,I=this._min,R=this._max;if(Z.length===0)return er(this);if(!Z.every(function(Q){return Q[0]!==void 0&&Q[1]!==void 0&&D(Q[0],Q[1])<=0}))return Jt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",be.InvalidArgument);var j=!m||m.includeLowers!==!1,O=m&&m.includeUppers===!0,q,z=D;function G(Q,te){return z(Q[0],te[0])}try{(q=Z.reduce(function(Q,te){for(var se=0,ie=Q.length;se<ie;++se){var me=Q[se];if(C(te[0],me[1])<0&&0<C(te[1],me[0])){me[0]=I(me[0],te[0]),me[1]=R(me[1],te[1]);break}}return se===ie&&Q.push(te),Q},[])).sort(G)}catch{return Jt(this,Kn)}var H=0,U=O?function(Q){return 0<D(Q,q[H][1])}:function(Q){return 0<=D(Q,q[H][1])},Y=j?function(Q){return 0<T(Q,q[H][0])}:function(Q){return 0<=T(Q,q[H][0])},W=U,Z=new this.Collection(this,function(){return ws(q[0][0],q[q.length-1][1],!j,!O)});return Z._ondirectionchange=function(Q){z=Q==="next"?(W=U,D):(W=Y,T),q.sort(G)},Z._addAlgorithm(function(Q,te,se){for(var ie,me=Q.key;W(me);)if(++H===q.length)return te(se),!1;return!U(ie=me)&&!Y(ie)||(x._cmp(me,q[H][1])===0||x._cmp(me,q[H][0])===0||te(function(){z===D?Q.continue(q[H][0]):Q.continue(q[H][1])}),!1)}),Z},wt.prototype.startsWithAnyOf=function(){var d=pe.apply(_e,arguments);return d.every(function(m){return typeof m=="string"})?d.length===0?er(this):this.inAnyRange(d.map(function(m){return[m,m+ii]})):Jt(this,"startsWithAnyOf() only works with strings")},wt);function wt(){}function Tn(d){return st(function(m){return fo(m),d(m.target.error),!1})}function fo(d){d.stopPropagation&&d.stopPropagation(),d.preventDefault&&d.preventDefault()}var po="storagemutated",gd="x-storagemutated-1",Cs=ho(null,po),Z1=($n.prototype._lock=function(){return E(!we.global),++this._reculock,this._reculock!==1||we.global||(we.lockOwnerFor=this),this},$n.prototype._unlock=function(){if(E(!we.global),--this._reculock==0)for(we.global||(we.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var d=this._blockedFuncs.shift();try{si(d[1],d[0])}catch{}}return this},$n.prototype._locked=function(){return this._reculock&&we.lockOwnerFor!==this},$n.prototype.create=function(d){var m=this;if(!this.mode)return this;var x=this.db.idbdb,C=this.db._state.dbOpenError;if(E(!this.idbtrans),!d&&!x)switch(C&&C.name){case"DatabaseClosedError":throw new be.DatabaseClosed(C);case"MissingAPIError":throw new be.MissingAPI(C.message,C);default:throw new be.OpenFailed(C)}if(!this.active)throw new be.TransactionInactive;return E(this._completion._state===null),(d=this.idbtrans=d||(this.db.core||x).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=st(function(D){fo(D),m._reject(d.error)}),d.onabort=st(function(D){fo(D),m.active&&m._reject(new be.Abort(d.error)),m.active=!1,m.on("abort").fire(D)}),d.oncomplete=st(function(){m.active=!1,m._resolve(),"mutatedParts"in d&&Cs.storagemutated.fire(d.mutatedParts)}),this},$n.prototype._promise=function(d,m,x){var C=this;if(d==="readwrite"&&this.mode!=="readwrite")return ct(new be.ReadOnly("Transaction is readonly"));if(!this.active)return ct(new be.TransactionInactive);if(this._locked())return new ve(function(T,I){C._blockedFuncs.push([function(){C._promise(d,m,x).then(T,I)},we])});if(x)return xs(function(){var T=new ve(function(I,R){C._lock();var j=m(I,R,C);j&&j.then&&j.then(I,R)});return T.finally(function(){return C._unlock()}),T._lib=!0,T});var D=new ve(function(T,I){var R=m(T,I,C);R&&R.then&&R.then(T,I)});return D._lib=!0,D},$n.prototype._root=function(){return this.parent?this.parent._root():this},$n.prototype.waitFor=function(d){var m,x=this._root(),C=ve.resolve(d);x._waitingFor?x._waitingFor=x._waitingFor.then(function(){return C}):(x._waitingFor=C,x._waitingQueue=[],m=x.idbtrans.objectStore(x.storeNames[0]),function T(){for(++x._spinCount;x._waitingQueue.length;)x._waitingQueue.shift()();x._waitingFor&&(m.get(-1/0).onsuccess=T)}());var D=x._waitingFor;return new ve(function(T,I){C.then(function(R){return x._waitingQueue.push(st(T.bind(null,R)))},function(R){return x._waitingQueue.push(st(I.bind(null,R)))}).finally(function(){x._waitingFor===D&&(x._waitingFor=null)})})},$n.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new be.Abort))},$n.prototype.table=function(d){var m=this._memoizedTables||(this._memoizedTables={});if(u(m,d))return m[d];var x=this.schema[d];if(!x)throw new be.NotFound("Table "+d+" not part of transaction");return x=new this.db.Table(d,x,this),x.core=this.db.core.table(d),m[d]=x},$n);function $n(){}function yd(d,m,x,C,D,T,I){return{name:d,keyPath:m,unique:x,multi:C,auto:D,compound:T,src:(x&&!I?"&":"")+(C?"*":"")+(D?"++":"")+ay(m)}}function ay(d){return typeof d=="string"?d:d?"["+[].join.call(d,"+")+"]":""}function vd(d,m,x){return{name:d,primKey:m,indexes:x,mappedClass:null,idxByName:(C=function(D){return[D.name,D]},x.reduce(function(D,T,I){return I=C(T,I),I&&(D[I[0]]=I[1]),D},{}))};var C}var mo=function(d){try{return d.only([[]]),mo=function(){return[[]]},[[]]}catch{return mo=function(){return ii},ii}};function xd(d){return d==null?function(){}:typeof d=="string"?(m=d).split(".").length===1?function(x){return x[m]}:function(x){return B(x,m)}:function(x){return B(x,d)};var m}function ly(d){return[].slice.call(d)}var Q1=0;function go(d){return d==null?":id":typeof d=="string"?d:"[".concat(d.join("+"),"]")}function J1(d,m,j){function C(W){if(W.type===3)return null;if(W.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var H=W.lower,U=W.upper,Y=W.lowerOpen,W=W.upperOpen;return H===void 0?U===void 0?null:m.upperBound(U,!!W):U===void 0?m.lowerBound(H,!!Y):m.bound(H,U,!!Y,!!W)}function D(G){var H,U=G.name;return{name:U,schema:G,mutate:function(Y){var W=Y.trans,Z=Y.type,Q=Y.keys,te=Y.values,se=Y.range;return new Promise(function(ie,me){ie=st(ie);var he=W.objectStore(U),de=he.keyPath==null,ge=Z==="put"||Z==="add";if(!ge&&Z!=="delete"&&Z!=="deleteRange")throw new Error("Invalid operation type: "+Z);var xe,Ae=(Q||te||{length:1}).length;if(Q&&te&&Q.length!==te.length)throw new Error("Given keys array must have same length as given values array.");if(Ae===0)return ie({numFailures:0,failures:{},results:[],lastResult:void 0});function Fe(Rt){++vn,fo(Rt)}var Le=[],Pe=[],vn=0;if(Z==="deleteRange"){if(se.type===4)return ie({numFailures:vn,failures:Pe,results:[],lastResult:void 0});se.type===3?Le.push(xe=he.clear()):Le.push(xe=he.delete(C(se)))}else{var de=ge?de?[te,Q]:[te,null]:[Q,null],Me=de[0],Tt=de[1];if(ge)for(var $t=0;$t<Ae;++$t)Le.push(xe=Tt&&Tt[$t]!==void 0?he[Z](Me[$t],Tt[$t]):he[Z](Me[$t])),xe.onerror=Fe;else for($t=0;$t<Ae;++$t)Le.push(xe=he[Z](Me[$t])),xe.onerror=Fe}function Al(Rt){Rt=Rt.target.result,Le.forEach(function(li,Ld){return li.error!=null&&(Pe[Ld]=li.error)}),ie({numFailures:vn,failures:Pe,results:Z==="delete"?Q:Le.map(function(li){return li.result}),lastResult:Rt})}xe.onerror=function(Rt){Fe(Rt),Al(Rt)},xe.onsuccess=Al})},getMany:function(Y){var W=Y.trans,Z=Y.keys;return new Promise(function(Q,te){Q=st(Q);for(var se,ie=W.objectStore(U),me=Z.length,he=new Array(me),de=0,ge=0,xe=function(Le){Le=Le.target,he[Le._pos]=Le.result,++ge===de&&Q(he)},Ae=Tn(te),Fe=0;Fe<me;++Fe)Z[Fe]!=null&&((se=ie.get(Z[Fe]))._pos=Fe,se.onsuccess=xe,se.onerror=Ae,++de);de===0&&Q(he)})},get:function(Y){var W=Y.trans,Z=Y.key;return new Promise(function(Q,te){Q=st(Q);var se=W.objectStore(U).get(Z);se.onsuccess=function(ie){return Q(ie.target.result)},se.onerror=Tn(te)})},query:(H=O,function(Y){return new Promise(function(W,Z){W=st(W);var Q,te,se,de=Y.trans,ie=Y.values,me=Y.limit,xe=Y.query,he=me===1/0?void 0:me,ge=xe.index,xe=xe.range,de=de.objectStore(U),ge=ge.isPrimaryKey?de:de.index(ge.name),xe=C(xe);if(me===0)return W({result:[]});H?((he=ie?ge.getAll(xe,he):ge.getAllKeys(xe,he)).onsuccess=function(Ae){return W({result:Ae.target.result})},he.onerror=Tn(Z)):(Q=0,te=!ie&&"openKeyCursor"in ge?ge.openKeyCursor(xe):ge.openCursor(xe),se=[],te.onsuccess=function(Ae){var Fe=te.result;return Fe?(se.push(ie?Fe.value:Fe.primaryKey),++Q===me?W({result:se}):void Fe.continue()):W({result:se})},te.onerror=Tn(Z))})}),openCursor:function(Y){var W=Y.trans,Z=Y.values,Q=Y.query,te=Y.reverse,se=Y.unique;return new Promise(function(ie,me){ie=st(ie);var ge=Q.index,he=Q.range,de=W.objectStore(U),de=ge.isPrimaryKey?de:de.index(ge.name),ge=te?se?"prevunique":"prev":se?"nextunique":"next",xe=!Z&&"openKeyCursor"in de?de.openKeyCursor(C(he),ge):de.openCursor(C(he),ge);xe.onerror=Tn(me),xe.onsuccess=st(function(Ae){var Fe,Le,Pe,vn,Me=xe.result;Me?(Me.___id=++Q1,Me.done=!1,Fe=Me.continue.bind(Me),Le=(Le=Me.continuePrimaryKey)&&Le.bind(Me),Pe=Me.advance.bind(Me),vn=function(){throw new Error("Cursor not stopped")},Me.trans=W,Me.stop=Me.continue=Me.continuePrimaryKey=Me.advance=function(){throw new Error("Cursor not started")},Me.fail=st(me),Me.next=function(){var Tt=this,$t=1;return this.start(function(){return $t--?Tt.continue():Tt.stop()}).then(function(){return Tt})},Me.start=function(Tt){function $t(){if(xe.result)try{Tt()}catch(Rt){Me.fail(Rt)}else Me.done=!0,Me.start=function(){throw new Error("Cursor behind last entry")},Me.stop()}var Al=new Promise(function(Rt,li){Rt=st(Rt),xe.onerror=Tn(li),Me.fail=li,Me.stop=function(Ld){Me.stop=Me.continue=Me.continuePrimaryKey=Me.advance=vn,Rt(Ld)}});return xe.onsuccess=st(function(Rt){xe.onsuccess=$t,$t()}),Me.continue=Fe,Me.continuePrimaryKey=Le,Me.advance=Pe,$t(),Al},ie(Me)):ie(null)},me)})},count:function(Y){var W=Y.query,Z=Y.trans,Q=W.index,te=W.range;return new Promise(function(se,ie){var me=Z.objectStore(U),he=Q.isPrimaryKey?me:me.index(Q.name),me=C(te),he=me?he.count(me):he.count();he.onsuccess=st(function(de){return se(de.target.result)}),he.onerror=Tn(ie)})}}}var T,I,R,q=(I=j,R=ly((T=d).objectStoreNames),{schema:{name:T.name,tables:R.map(function(G){return I.objectStore(G)}).map(function(G){var H=G.keyPath,W=G.autoIncrement,U=a(H),Y={},W={name:G.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:H==null,compound:U,keyPath:H,autoIncrement:W,unique:!0,extractKey:xd(H)},indexes:ly(G.indexNames).map(function(Z){return G.index(Z)}).map(function(se){var Q=se.name,te=se.unique,ie=se.multiEntry,se=se.keyPath,ie={name:Q,compound:a(se),keyPath:se,unique:te,multiEntry:ie,extractKey:xd(se)};return Y[go(se)]=ie}),getIndexByKeyPath:function(Z){return Y[go(Z)]}};return Y[":id"]=W.primaryKey,H!=null&&(Y[go(H)]=W.primaryKey),W})},hasGetAll:0<R.length&&"getAll"in I.objectStore(R[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),j=q.schema,O=q.hasGetAll,q=j.tables.map(D),z={};return q.forEach(function(G){return z[G.name]=G}),{stack:"dbcore",transaction:d.transaction.bind(d),table:function(G){if(!z[G])throw new Error("Table '".concat(G,"' not found"));return z[G]},MIN_KEY:-1/0,MAX_KEY:mo(m),schema:j}}function eC(d,m,x,C){var D=x.IDBKeyRange;return x.indexedDB,{dbcore:(C=J1(m,D,C),d.dbcore.reduce(function(T,I){return I=I.create,n(n({},T),I(T))},C))}}function gl(d,C){var x=C.db,C=eC(d._middlewares,x,d._deps,C);d.core=C.dbcore,d.tables.forEach(function(D){var T=D.name;d.core.schema.tables.some(function(I){return I.name===T})&&(D.core=d.core.table(T),d[T]instanceof d.Table&&(d[T].core=D.core))})}function yl(d,m,x,C){x.forEach(function(D){var T=C[D];m.forEach(function(I){var R=function j(O,q){return v(O,q)||(O=c(O))&&j(O,q)}(I,D);(!R||"value"in R&&R.value===void 0)&&(I===d.Transaction.prototype||I instanceof d.Transaction?g(I,D,{get:function(){return this.table(D)},set:function(j){p(this,D,{value:j,writable:!0,configurable:!0,enumerable:!0})}}):I[D]=new d.Table(D,T))})})}function _d(d,m){m.forEach(function(x){for(var C in x)x[C]instanceof d.Table&&delete x[C]})}function tC(d,m){return d._cfg.version-m._cfg.version}function nC(d,m,x,C){var D=d._dbSchema;x.objectStoreNames.contains("$meta")&&!D.$meta&&(D.$meta=vd("$meta",hy("")[0],[]),d._storeNames.push("$meta"));var T=d._createTransaction("readwrite",d._storeNames,D);T.create(x),T._completion.catch(C);var I=T._reject.bind(T),R=we.transless||we;xs(function(){return we.trans=T,we.transless=R,m!==0?(gl(d,x),O=m,((j=T).storeNames.includes("$meta")?j.table("$meta").get("version").then(function(q){return q??O}):ve.resolve(O)).then(function(q){return G=q,H=T,U=x,Y=[],q=(z=d)._versions,W=z._dbSchema=xl(0,z.idbdb,U),(q=q.filter(function(Z){return Z._cfg.version>=G})).length!==0?(q.forEach(function(Z){Y.push(function(){var Q=W,te=Z._cfg.dbschema;_l(z,Q,U),_l(z,te,U),W=z._dbSchema=te;var se=bd(Q,te);se.add.forEach(function(ge){wd(U,ge[0],ge[1].primKey,ge[1].indexes)}),se.change.forEach(function(ge){if(ge.recreate)throw new be.Upgrade("Not yet support for changing primary key");var xe=U.objectStore(ge.name);ge.add.forEach(function(Ae){return vl(xe,Ae)}),ge.change.forEach(function(Ae){xe.deleteIndex(Ae.name),vl(xe,Ae)}),ge.del.forEach(function(Ae){return xe.deleteIndex(Ae)})});var ie=Z._cfg.contentUpgrade;if(ie&&Z._cfg.version>G){gl(z,U),H._memoizedTables={};var me=L(te);se.del.forEach(function(ge){me[ge]=Q[ge]}),_d(z,[z.Transaction.prototype]),yl(z,[z.Transaction.prototype],o(me),me),H.schema=me;var he,de=J(ie);return de&&Zi(),se=ve.follow(function(){var ge;(he=ie(H))&&de&&(ge=_s.bind(null,null),he.then(ge,ge))}),he&&typeof he.then=="function"?ve.resolve(he):se.then(function(){return he})}}),Y.push(function(Q){var te,se,ie=Z._cfg.dbschema;te=ie,se=Q,[].slice.call(se.db.objectStoreNames).forEach(function(me){return te[me]==null&&se.db.deleteObjectStore(me)}),_d(z,[z.Transaction.prototype]),yl(z,[z.Transaction.prototype],z._storeNames,z._dbSchema),H.schema=z._dbSchema}),Y.push(function(Q){z.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(z.idbdb.version/10)===Z._cfg.version?(z.idbdb.deleteObjectStore("$meta"),delete z._dbSchema.$meta,z._storeNames=z._storeNames.filter(function(te){return te!=="$meta"})):Q.objectStore("$meta").put(Z._cfg.version,"version"))})}),function Z(){return Y.length?ve.resolve(Y.shift()(H.idbtrans)).then(Z):ve.resolve()}().then(function(){cy(W,U)})):ve.resolve();var z,G,H,U,Y,W}).catch(I)):(o(D).forEach(function(q){wd(x,q,D[q].primKey,D[q].indexes)}),gl(d,x),void ve.follow(function(){return d.on.populate.fire(T)}).catch(I));var j,O})}function sC(d,m){cy(d._dbSchema,m),m.db.version%10!=0||m.objectStoreNames.contains("$meta")||m.db.createObjectStore("$meta").add(Math.ceil(m.db.version/10-1),"version");var x=xl(0,d.idbdb,m);_l(d,d._dbSchema,m);for(var C=0,D=bd(x,d._dbSchema).change;C<D.length;C++){var T=function(I){if(I.change.length||I.recreate)return console.warn("Unable to patch indexes of table ".concat(I.name," because it has changes on the type of index or primary key.")),{value:void 0};var R=m.objectStore(I.name);I.add.forEach(function(j){lt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(I.name,".").concat(j.src)),vl(R,j)})}(D[C]);if(typeof T=="object")return T.value}}function bd(d,m){var x,C={del:[],add:[],change:[]};for(x in d)m[x]||C.del.push(x);for(x in m){var D=d[x],T=m[x];if(D){var I={name:x,def:T,recreate:!1,del:[],add:[],change:[]};if(""+(D.primKey.keyPath||"")!=""+(T.primKey.keyPath||"")||D.primKey.auto!==T.primKey.auto)I.recreate=!0,C.change.push(I);else{var R=D.idxByName,j=T.idxByName,O=void 0;for(O in R)j[O]||I.del.push(O);for(O in j){var q=R[O],z=j[O];q?q.src!==z.src&&I.change.push(z):I.add.push(z)}(0<I.del.length||0<I.add.length||0<I.change.length)&&C.change.push(I)}}else C.add.push([x,T])}return C}function wd(d,m,x,C){var D=d.db.createObjectStore(m,x.keyPath?{keyPath:x.keyPath,autoIncrement:x.auto}:{autoIncrement:x.auto});return C.forEach(function(T){return vl(D,T)}),D}function cy(d,m){o(d).forEach(function(x){m.db.objectStoreNames.contains(x)||(lt&&console.debug("Dexie: Creating missing table",x),wd(m,x,d[x].primKey,d[x].indexes))})}function vl(d,m){d.createIndex(m.name,m.keyPath,{unique:m.unique,multiEntry:m.multi})}function xl(d,m,x){var C={};return w(m.objectStoreNames,0).forEach(function(D){for(var T=x.objectStore(D),I=yd(ay(O=T.keyPath),O||"",!0,!1,!!T.autoIncrement,O&&typeof O!="string",!0),R=[],j=0;j<T.indexNames.length;++j){var q=T.index(T.indexNames[j]),O=q.keyPath,q=yd(q.name,O,!!q.unique,!!q.multiEntry,!1,O&&typeof O!="string",!1);R.push(q)}C[D]=vd(D,I,R)}),C}function _l(d,m,x){for(var C=x.db.objectStoreNames,D=0;D<C.length;++D){var T=C[D],I=x.objectStore(T);d._hasGetAll="getAll"in I;for(var R=0;R<I.indexNames.length;++R){var j=I.indexNames[R],O=I.index(j).keyPath,q=typeof O=="string"?O:"["+w(O).join("+")+"]";!m[T]||(O=m[T].idxByName[q])&&(O.name=j,delete m[T].idxByName[q],m[T].idxByName[j]=O)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(d._hasGetAll=!1)}function hy(d){return d.split(",").map(function(m,x){var C=(m=m.trim()).replace(/([&*]|\+\+)/g,""),D=/^\[/.test(C)?C.match(/^\[(.*)\]$/)[1].split("+"):C;return yd(C,D||null,/\&/.test(m),/\*/.test(m),/\+\+/.test(m),a(D),x===0)})}var iC=(bl.prototype._parseStoresSpec=function(d,m){o(d).forEach(function(x){if(d[x]!==null){var C=hy(d[x]),D=C.shift();if(D.unique=!0,D.multi)throw new be.Schema("Primary key cannot be multi-valued");C.forEach(function(T){if(T.auto)throw new be.Schema("Only primary key can be marked as autoIncrement (++)");if(!T.keyPath)throw new be.Schema("Index must have a name and cannot be an empty string")}),m[x]=vd(x,D,C)}})},bl.prototype.stores=function(x){var m=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,x):x;var x=m._versions,C={},D={};return x.forEach(function(T){l(C,T._cfg.storesSource),D=T._cfg.dbschema={},T._parseStoresSpec(C,D)}),m._dbSchema=D,_d(m,[m._allTables,m,m.Transaction.prototype]),yl(m,[m._allTables,m,m.Transaction.prototype,this._cfg.tables],o(D),D),m._storeNames=o(D),this},bl.prototype.upgrade=function(d){return this._cfg.contentUpgrade=Wn(this._cfg.contentUpgrade||je,d),this},bl);function bl(){}function Cd(d,m){var x=d._dbNamesDB;return x||(x=d._dbNamesDB=new Gn(ul,{addons:[],indexedDB:d,IDBKeyRange:m})).version(1).stores({dbnames:"name"}),x.table("dbnames")}function kd(d){return d&&typeof d.databases=="function"}function Sd(d){return xs(function(){return we.letThrough=!0,d()})}function Dd(d){return!("from"in d)}var At=function(d,m){if(!this){var x=new At;return d&&"d"in d&&l(x,d),x}l(this,arguments.length?{d:1,from:d,to:1<arguments.length?m:d}:{d:0})};function yo(d,m,x){var C=qe(m,x);if(!isNaN(C)){if(0<C)throw RangeError();if(Dd(d))return l(d,{from:m,to:x,d:1});var D=d.l,C=d.r;if(qe(x,d.from)<0)return D?yo(D,m,x):d.l={from:m,to:x,d:1,l:null,r:null},uy(d);if(0<qe(m,d.to))return C?yo(C,m,x):d.r={from:m,to:x,d:1,l:null,r:null},uy(d);qe(m,d.from)<0&&(d.from=m,d.l=null,d.d=C?C.d+1:1),0<qe(x,d.to)&&(d.to=x,d.r=null,d.d=d.l?d.l.d+1:1),x=!d.r,D&&!d.l&&vo(d,D),C&&x&&vo(d,C)}}function vo(d,m){Dd(m)||function x(C,j){var T=j.from,I=j.to,R=j.l,j=j.r;yo(C,T,I),R&&x(C,R),j&&x(C,j)}(d,m)}function wl(d,m){var x=Ed(m),C=x.next();if(C.done)return!1;for(var D=C.value,T=Ed(d),I=T.next(D.from),R=I.value;!C.done&&!I.done;){if(qe(R.from,D.to)<=0&&0<=qe(R.to,D.from))return!0;qe(D.from,R.from)<0?D=(C=x.next(R.from)).value:R=(I=T.next(D.from)).value}return!1}function Ed(d){var m=Dd(d)?null:{s:0,n:d};return{next:function(x){for(var C=0<arguments.length;m;)switch(m.s){case 0:if(m.s=1,C)for(;m.n.l&&qe(x,m.n.from)<0;)m={up:m,n:m.n.l,s:1};else for(;m.n.l;)m={up:m,n:m.n.l,s:1};case 1:if(m.s=2,!C||qe(x,m.n.to)<=0)return{value:m.n,done:!1};case 2:if(m.n.r){m.s=3,m={up:m,n:m.n.r,s:0};continue}case 3:m=m.up}return{done:!0}}}}function uy(d){var m,x,C=(((m=d.r)===null||m===void 0?void 0:m.d)||0)-(((x=d.l)===null||x===void 0?void 0:x.d)||0),D=1<C?"r":C<-1?"l":"";D&&(m=D=="r"?"l":"r",x=n({},d),C=d[D],d.from=C.from,d.to=C.to,d[D]=C[D],x[D]=C[m],(d[m]=x).d=dy(x)),d.d=dy(d)}function dy(x){var m=x.r,x=x.l;return(m?x?Math.max(m.d,x.d):m.d:x?x.d:0)+1}function Cl(d,m){return o(m).forEach(function(x){d[x]?vo(d[x],m[x]):d[x]=function C(D){var T,I,R={};for(T in D)u(D,T)&&(I=D[T],R[T]=!I||typeof I!="object"||F.has(I.constructor)?I:C(I));return R}(m[x])}),d}function Ad(d,m){return d.all||m.all||Object.keys(d).some(function(x){return m[x]&&wl(m[x],d[x])})}f(At.prototype,((on={add:function(d){return vo(this,d),this},addKey:function(d){return yo(this,d,d),this},addKeys:function(d){var m=this;return d.forEach(function(x){return yo(m,x,x)}),this}})[ye]=function(){return Ed(this)},on));var oi={},Td={},$d=!1;function kl(d){Cl(Td,d),$d||($d=!0,setTimeout(function(){$d=!1,Id(Td,!(Td={}))},0))}function Id(d,m){m===void 0&&(m=!1);var x=new Set;if(d.all)for(var C=0,D=Object.values(oi);C<D.length;C++)fy(I=D[C],d,x,m);else for(var T in d){var I,R=/^idb\:\/\/(.*)\/(.*)\//.exec(T);R&&(T=R[1],R=R[2],(I=oi["idb://".concat(T,"/").concat(R)])&&fy(I,d,x,m))}x.forEach(function(j){return j()})}function fy(d,m,x,C){for(var D=[],T=0,I=Object.entries(d.queries.query);T<I.length;T++){for(var R=I[T],j=R[0],O=[],q=0,z=R[1];q<z.length;q++){var G=z[q];Ad(m,G.obsSet)?G.subscribers.forEach(function(W){return x.add(W)}):C&&O.push(G)}C&&D.push([j,O])}if(C)for(var H=0,U=D;H<U.length;H++){var Y=U[H],j=Y[0],O=Y[1];d.queries.query[j]=O}}function rC(d){var m=d._state,x=d._deps.indexedDB;if(m.isBeingOpened||d.idbdb)return m.dbReadyPromise.then(function(){return m.dbOpenError?ct(m.dbOpenError):d});m.isBeingOpened=!0,m.dbOpenError=null,m.openComplete=!1;var C=m.openCanceller,D=Math.round(10*d.verno),T=!1;function I(){if(m.openCanceller!==C)throw new be.DatabaseClosed("db.open() was cancelled")}function R(){return new ve(function(G,H){if(I(),!x)throw new be.MissingAPI;var U=d.name,Y=m.autoSchema||!D?x.open(U):x.open(U,D);if(!Y)throw new be.MissingAPI;Y.onerror=Tn(H),Y.onblocked=st(d._fireOnBlocked),Y.onupgradeneeded=st(function(W){var Z;q=Y.transaction,m.autoSchema&&!d._options.allowEmptyDB?(Y.onerror=fo,q.abort(),Y.result.close(),(Z=x.deleteDatabase(U)).onsuccess=Z.onerror=st(function(){H(new be.NoSuchDatabase("Database ".concat(U," doesnt exist")))})):(q.onerror=Tn(H),W=W.oldVersion>Math.pow(2,62)?0:W.oldVersion,z=W<1,d.idbdb=Y.result,T&&sC(d,q),nC(d,W/10,q,H))},H),Y.onsuccess=st(function(){q=null;var W,Z,Q,te,se,ie=d.idbdb=Y.result,me=w(ie.objectStoreNames);if(0<me.length)try{var he=ie.transaction((te=me).length===1?te[0]:te,"readonly");if(m.autoSchema)Z=ie,Q=he,(W=d).verno=Z.version/10,Q=W._dbSchema=xl(0,Z,Q),W._storeNames=w(Z.objectStoreNames,0),yl(W,[W._allTables],o(Q),Q);else if(_l(d,d._dbSchema,he),((se=bd(xl(0,(se=d).idbdb,he),se._dbSchema)).add.length||se.change.some(function(de){return de.add.length||de.change.length}))&&!T)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),ie.close(),D=ie.version+1,T=!0,G(R());gl(d,he)}catch{}Qi.push(d),ie.onversionchange=st(function(de){m.vcFired=!0,d.on("versionchange").fire(de)}),ie.onclose=st(function(de){d.on("close").fire(de)}),z&&(se=d._deps,he=U,ie=se.indexedDB,se=se.IDBKeyRange,kd(ie)||he===ul||Cd(ie,se).put({name:he}).catch(je)),G()},H)}).catch(function(G){switch(G==null?void 0:G.name){case"UnknownError":if(0<m.PR1398_maxLoop)return m.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),R();break;case"VersionError":if(0<D)return D=0,R()}return ve.reject(G)})}var j,O=m.dbReadyResolve,q=null,z=!1;return ve.race([C,(typeof navigator>"u"?ve.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(G){function H(){return indexedDB.databases().finally(G)}j=setInterval(H,100),H()}).finally(function(){return clearInterval(j)}):Promise.resolve()).then(R)]).then(function(){return I(),m.onReadyBeingFired=[],ve.resolve(Sd(function(){return d.on.ready.fire(d.vip)})).then(function G(){if(0<m.onReadyBeingFired.length){var H=m.onReadyBeingFired.reduce(Wn,je);return m.onReadyBeingFired=[],ve.resolve(Sd(function(){return H(d.vip)})).then(G)}})}).finally(function(){m.openCanceller===C&&(m.onReadyBeingFired=null,m.isBeingOpened=!1)}).catch(function(G){m.dbOpenError=G;try{q&&q.abort()}catch{}return C===m.openCanceller&&d._close(),ct(G)}).finally(function(){m.openComplete=!0,O()}).then(function(){var G;return z&&(G={},d.tables.forEach(function(H){H.schema.indexes.forEach(function(U){U.name&&(G["idb://".concat(d.name,"/").concat(H.name,"/").concat(U.name)]=new At(-1/0,[[[]]]))}),G["idb://".concat(d.name,"/").concat(H.name,"/")]=G["idb://".concat(d.name,"/").concat(H.name,"/:dels")]=new At(-1/0,[[[]]])}),Cs(po).fire(G),Id(G,!0)),d})}function Bd(d){function m(T){return d.next(T)}var x=D(m),C=D(function(T){return d.throw(T)});function D(T){return function(j){var R=T(j),j=R.value;return R.done?j:j&&typeof j.then=="function"?j.then(x,C):a(j)?Promise.all(j).then(x,C):x(j)}}return D(m)()}function Sl(d,m,x){for(var C=a(d)?d.slice():[d],D=0;D<x;++D)C.push(m);return C}var oC={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(d){return n(n({},d),{table:function(m){var x=d.table(m),C=x.schema,D={},T=[];function I(z,G,H){var U=go(z),Y=D[U]=D[U]||[],W=z==null?0:typeof z=="string"?1:z.length,Z=0<G,Z=n(n({},H),{name:Z?"".concat(U,"(virtual-from:").concat(H.name,")"):H.name,lowLevelIndex:H,isVirtual:Z,keyTail:G,keyLength:W,extractKey:xd(z),unique:!Z&&H.unique});return Y.push(Z),Z.isPrimaryKey||T.push(Z),1<W&&I(W===2?z[0]:z.slice(0,W-1),G+1,H),Y.sort(function(Q,te){return Q.keyTail-te.keyTail}),Z}m=I(C.primaryKey.keyPath,0,C.primaryKey),D[":id"]=[m];for(var R=0,j=C.indexes;R<j.length;R++){var O=j[R];I(O.keyPath,0,O)}function q(z){var G,H=z.query.index;return H.isVirtual?n(n({},z),{query:{index:H.lowLevelIndex,range:(G=z.query.range,H=H.keyTail,{type:G.type===1?2:G.type,lower:Sl(G.lower,G.lowerOpen?d.MAX_KEY:d.MIN_KEY,H),lowerOpen:!0,upper:Sl(G.upper,G.upperOpen?d.MIN_KEY:d.MAX_KEY,H),upperOpen:!0})}}):z}return n(n({},x),{schema:n(n({},C),{primaryKey:m,indexes:T,getIndexByKeyPath:function(z){return(z=D[go(z)])&&z[0]}}),count:function(z){return x.count(q(z))},query:function(z){return x.query(q(z))},openCursor:function(z){var G=z.query.index,H=G.keyTail,U=G.isVirtual,Y=G.keyLength;return U?x.openCursor(q(z)).then(function(Z){return Z&&W(Z)}):x.openCursor(z);function W(Z){return Object.create(Z,{continue:{value:function(Q){Q!=null?Z.continue(Sl(Q,z.reverse?d.MAX_KEY:d.MIN_KEY,H)):z.unique?Z.continue(Z.key.slice(0,Y).concat(z.reverse?d.MIN_KEY:d.MAX_KEY,H)):Z.continue()}},continuePrimaryKey:{value:function(Q,te){Z.continuePrimaryKey(Sl(Q,d.MAX_KEY,H),te)}},primaryKey:{get:function(){return Z.primaryKey}},key:{get:function(){var Q=Z.key;return Y===1?Q[0]:Q.slice(0,Y)}},value:{get:function(){return Z.value}}})}}})}})}};function Nd(d,m,x,C){return x=x||{},C=C||"",o(d).forEach(function(D){var T,I,R;u(m,D)?(T=d[D],I=m[D],typeof T=="object"&&typeof I=="object"&&T&&I?(R=ue(T))!==ue(I)?x[C+D]=m[D]:R==="Object"?Nd(T,I,x,C+D+"."):T!==I&&(x[C+D]=m[D]):T!==I&&(x[C+D]=m[D])):x[C+D]=void 0}),o(m).forEach(function(D){u(d,D)||(x[C+D]=m[D])}),x}function Fd(d,m){return m.type==="delete"?m.keys:m.keys||m.values.map(d.extractKey)}var aC={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(d){return n(n({},d),{table:function(m){var x=d.table(m),C=x.schema.primaryKey;return n(n({},x),{mutate:function(D){var T=we.trans,I=T.table(m).hook,R=I.deleting,j=I.creating,O=I.updating;switch(D.type){case"add":if(j.fire===je)break;return T._promise("readwrite",function(){return q(D)},!0);case"put":if(j.fire===je&&O.fire===je)break;return T._promise("readwrite",function(){return q(D)},!0);case"delete":if(R.fire===je)break;return T._promise("readwrite",function(){return q(D)},!0);case"deleteRange":if(R.fire===je)break;return T._promise("readwrite",function(){return function z(G,H,U){return x.query({trans:G,values:!1,query:{index:C,range:H},limit:U}).then(function(Y){var W=Y.result;return q({type:"delete",keys:W,trans:G}).then(function(Z){return 0<Z.numFailures?Promise.reject(Z.failures[0]):W.length<U?{failures:[],numFailures:0,lastResult:void 0}:z(G,n(n({},H),{lower:W[W.length-1],lowerOpen:!0}),U)})})}(D.trans,D.range,1e4)},!0)}return x.mutate(D);function q(z){var G,H,U,Y=we.trans,W=z.keys||Fd(C,z);if(!W)throw new Error("Keys missing");return(z=z.type==="add"||z.type==="put"?n(n({},z),{keys:W}):n({},z)).type!=="delete"&&(z.values=i([],z.values,!0)),z.keys&&(z.keys=i([],z.keys,!0)),G=x,U=W,((H=z).type==="add"?Promise.resolve([]):G.getMany({trans:H.trans,keys:U,cache:"immutable"})).then(function(Z){var Q=W.map(function(te,se){var ie,me,he,de=Z[se],ge={onerror:null,onsuccess:null};return z.type==="delete"?R.fire.call(ge,te,de,Y):z.type==="add"||de===void 0?(ie=j.fire.call(ge,te,z.values[se],Y),te==null&&ie!=null&&(z.keys[se]=te=ie,C.outbound||N(z.values[se],C.keyPath,te))):(ie=Nd(de,z.values[se]),(me=O.fire.call(ge,ie,te,de,Y))&&(he=z.values[se],Object.keys(me).forEach(function(xe){u(he,xe)?he[xe]=me[xe]:N(he,xe,me[xe])}))),ge});return x.mutate(z).then(function(te){for(var se=te.failures,ie=te.results,me=te.numFailures,te=te.lastResult,he=0;he<W.length;++he){var de=(ie||W)[he],ge=Q[he];de==null?ge.onerror&&ge.onerror(se[he]):ge.onsuccess&&ge.onsuccess(z.type==="put"&&Z[he]?z.values[he]:de)}return{failures:se,results:ie,numFailures:me,lastResult:te}}).catch(function(te){return Q.forEach(function(se){return se.onerror&&se.onerror(te)}),Promise.reject(te)})})}}})}})}};function py(d,m,x){try{if(!m||m.keys.length<d.length)return null;for(var C=[],D=0,T=0;D<m.keys.length&&T<d.length;++D)qe(m.keys[D],d[T])===0&&(C.push(x?X(m.values[D]):m.values[D]),++T);return C.length===d.length?C:null}catch{return null}}var lC={stack:"dbcore",level:-1,create:function(d){return{table:function(m){var x=d.table(m);return n(n({},x),{getMany:function(C){if(!C.cache)return x.getMany(C);var D=py(C.keys,C.trans._cache,C.cache==="clone");return D?ve.resolve(D):x.getMany(C).then(function(T){return C.trans._cache={keys:C.keys,values:C.cache==="clone"?X(T):T},T})},mutate:function(C){return C.type!=="add"&&(C.trans._cache=null),x.mutate(C)}})}}}};function my(d,m){return d.trans.mode==="readonly"&&!!d.subscr&&!d.trans.explicit&&d.trans.db._options.cache!=="disabled"&&!m.schema.primaryKey.outbound}function gy(d,m){switch(d){case"query":return m.values&&!m.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var cC={stack:"dbcore",level:0,name:"Observability",create:function(d){var m=d.schema.name,x=new At(d.MIN_KEY,d.MAX_KEY);return n(n({},d),{transaction:function(C,D,T){if(we.subscr&&D!=="readonly")throw new be.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(we.querier));return d.transaction(C,D,T)},table:function(C){var D=d.table(C),T=D.schema,I=T.primaryKey,z=T.indexes,R=I.extractKey,j=I.outbound,O=I.autoIncrement&&z.filter(function(H){return H.compound&&H.keyPath.includes(I.keyPath)}),q=n(n({},D),{mutate:function(H){function U(xe){return xe="idb://".concat(m,"/").concat(C,"/").concat(xe),te[xe]||(te[xe]=new At)}var Y,W,Z,Q=H.trans,te=H.mutatedParts||(H.mutatedParts={}),se=U(""),ie=U(":dels"),me=H.type,ge=H.type==="deleteRange"?[H.range]:H.type==="delete"?[H.keys]:H.values.length<50?[Fd(I,H).filter(function(xe){return xe}),H.values]:[],he=ge[0],de=ge[1],ge=H.trans._cache;return a(he)?(se.addKeys(he),(ge=me==="delete"||he.length===de.length?py(he,ge):null)||ie.addKeys(he),(ge||de)&&(Y=U,W=ge,Z=de,T.indexes.forEach(function(xe){var Ae=Y(xe.name||"");function Fe(Pe){return Pe!=null?xe.extractKey(Pe):null}function Le(Pe){return xe.multiEntry&&a(Pe)?Pe.forEach(function(vn){return Ae.addKey(vn)}):Ae.addKey(Pe)}(W||Z).forEach(function(Pe,Tt){var Me=W&&Fe(W[Tt]),Tt=Z&&Fe(Z[Tt]);qe(Me,Tt)!==0&&(Me!=null&&Le(Me),Tt!=null&&Le(Tt))})}))):he?(de={from:he.lower,to:he.upper},ie.add(de),se.add(de)):(se.add(x),ie.add(x),T.indexes.forEach(function(xe){return U(xe.name).add(x)})),D.mutate(H).then(function(xe){return!he||H.type!=="add"&&H.type!=="put"||(se.addKeys(xe.results),O&&O.forEach(function(Ae){var Fe=H.values.map(function(Pe){return Ae.extractKey(Pe)}),Le=Ae.keyPath.findIndex(function(Pe){return Pe===I.keyPath});xe.results.forEach(function(Pe){return Fe[Le]=Pe}),U(Ae.name).addKeys(Fe)})),Q.mutatedParts=Cl(Q.mutatedParts||{},te),xe})}}),z=function(U){var Y=U.query,U=Y.index,Y=Y.range;return[U,new At((U=Y.lower)!==null&&U!==void 0?U:d.MIN_KEY,(Y=Y.upper)!==null&&Y!==void 0?Y:d.MAX_KEY)]},G={get:function(H){return[I,new At(H.key)]},getMany:function(H){return[I,new At().addKeys(H.keys)]},count:z,query:z,openCursor:z};return o(G).forEach(function(H){q[H]=function(U){var Y=we.subscr,W=!!Y,Z=my(we,D)&&gy(H,U)?U.obsSet={}:Y;if(W){var Q=function(de){return de="idb://".concat(m,"/").concat(C,"/").concat(de),Z[de]||(Z[de]=new At)},te=Q(""),se=Q(":dels"),Y=G[H](U),W=Y[0],Y=Y[1];if((H==="query"&&W.isPrimaryKey&&!U.values?se:Q(W.name||"")).add(Y),!W.isPrimaryKey){if(H!=="count"){var ie=H==="query"&&j&&U.values&&D.query(n(n({},U),{values:!1}));return D[H].apply(this,arguments).then(function(de){if(H==="query"){if(j&&U.values)return ie.then(function(Fe){return Fe=Fe.result,te.addKeys(Fe),de});var ge=U.values?de.result.map(R):de.result;(U.values?te:se).addKeys(ge)}else if(H==="openCursor"){var xe=de,Ae=U.values;return xe&&Object.create(xe,{key:{get:function(){return se.addKey(xe.primaryKey),xe.key}},primaryKey:{get:function(){var Fe=xe.primaryKey;return se.addKey(Fe),Fe}},value:{get:function(){return Ae&&te.addKey(xe.primaryKey),xe.value}}})}return de})}se.add(x)}}return D[H].apply(this,arguments)}}),q}})}};function yy(d,m,x){if(x.numFailures===0)return m;if(m.type==="deleteRange")return null;var C=m.keys?m.keys.length:"values"in m&&m.values?m.values.length:1;return x.numFailures===C?null:(m=n({},m),a(m.keys)&&(m.keys=m.keys.filter(function(D,T){return!(T in x.failures)})),"values"in m&&a(m.values)&&(m.values=m.values.filter(function(D,T){return!(T in x.failures)})),m)}function Pd(d,m){return x=d,((C=m).lower===void 0||(C.lowerOpen?0<qe(x,C.lower):0<=qe(x,C.lower)))&&(d=d,(m=m).upper===void 0||(m.upperOpen?qe(d,m.upper)<0:qe(d,m.upper)<=0));var x,C}function vy(d,m,G,C,D,T){if(!G||G.length===0)return d;var I=m.query.index,R=I.multiEntry,j=m.query.range,O=C.schema.primaryKey.extractKey,q=I.extractKey,z=(I.lowLevelIndex||I).extractKey,G=G.reduce(function(H,U){var Y=H,W=U.type==="add"||U.type==="put"?U.values.filter(function(se){return se=q(se),R&&a(se)?se.some(function(ie){return Pd(ie,j)}):Pd(se,j)}).map(function(se){return se=X(se),T&&Object.freeze(se),se}):[];switch(U.type){case"add":Y=H.concat(m.values?W:W.map(function(ie){return O(ie)}));break;case"put":var Z=new At().addKeys(U.values.map(function(ie){return O(ie)})),Y=H.filter(function(ie){return ie=m.values?O(ie):ie,!wl(new At(ie),Z)}).concat(m.values?W:W.map(function(ie){return O(ie)}));break;case"delete":var Q=new At().addKeys(U.keys);Y=H.filter(function(ie){return ie=m.values?O(ie):ie,!wl(new At(ie),Q)});break;case"deleteRange":var te=U.range;Y=H.filter(function(ie){return!Pd(O(ie),te)})}return Y},d);return G===d?d:(G.sort(function(H,U){return qe(z(H),z(U))||qe(O(H),O(U))}),m.limit&&m.limit<1/0&&(G.length>m.limit?G.length=m.limit:d.length===m.limit&&G.length<m.limit&&(D.dirty=!0)),T?Object.freeze(G):G)}function xy(d,m){return qe(d.lower,m.lower)===0&&qe(d.upper,m.upper)===0&&!!d.lowerOpen==!!m.lowerOpen&&!!d.upperOpen==!!m.upperOpen}function hC(d,m){return function(x,C,D,T){if(x===void 0)return C!==void 0?-1:0;if(C===void 0)return 1;if((C=qe(x,C))===0){if(D&&T)return 0;if(D)return 1;if(T)return-1}return C}(d.lower,m.lower,d.lowerOpen,m.lowerOpen)<=0&&0<=function(x,C,D,T){if(x===void 0)return C!==void 0?1:0;if(C===void 0)return-1;if((C=qe(x,C))===0){if(D&&T)return 0;if(D)return-1;if(T)return 1}return C}(d.upper,m.upper,d.upperOpen,m.upperOpen)}function uC(d,m,x,C){d.subscribers.add(x),C.addEventListener("abort",function(){var D,T;d.subscribers.delete(x),d.subscribers.size===0&&(D=d,T=m,setTimeout(function(){D.subscribers.size===0&&ne(T,D)},3e3))})}var dC={stack:"dbcore",level:0,name:"Cache",create:function(d){var m=d.schema.name;return n(n({},d),{transaction:function(x,C,D){var T,I,R=d.transaction(x,C,D);return C==="readwrite"&&(I=(T=new AbortController).signal,D=function(j){return function(){if(T.abort(),C==="readwrite"){for(var O=new Set,q=0,z=x;q<z.length;q++){var G=z[q],H=oi["idb://".concat(m,"/").concat(G)];if(H){var U=d.table(G),Y=H.optimisticOps.filter(function(Ae){return Ae.trans===R});if(R._explicit&&j&&R.mutatedParts)for(var W=0,Z=Object.values(H.queries.query);W<Z.length;W++)for(var Q=0,te=(me=Z[W]).slice();Q<te.length;Q++)Ad((he=te[Q]).obsSet,R.mutatedParts)&&(ne(me,he),he.subscribers.forEach(function(Ae){return O.add(Ae)}));else if(0<Y.length){H.optimisticOps=H.optimisticOps.filter(function(Ae){return Ae.trans!==R});for(var se=0,ie=Object.values(H.queries.query);se<ie.length;se++)for(var me,he,de,ge=0,xe=(me=ie[se]).slice();ge<xe.length;ge++)(he=xe[ge]).res!=null&&R.mutatedParts&&(j&&!he.dirty?(de=Object.isFrozen(he.res),de=vy(he.res,he.req,Y,U,he,de),he.dirty?(ne(me,he),he.subscribers.forEach(function(Ae){return O.add(Ae)})):de!==he.res&&(he.res=de,he.promise=ve.resolve({result:de}))):(he.dirty&&ne(me,he),he.subscribers.forEach(function(Ae){return O.add(Ae)})))}}}O.forEach(function(Ae){return Ae()})}}},R.addEventListener("abort",D(!1),{signal:I}),R.addEventListener("error",D(!1),{signal:I}),R.addEventListener("complete",D(!0),{signal:I})),R},table:function(x){var C=d.table(x),D=C.schema.primaryKey;return n(n({},C),{mutate:function(T){var I=we.trans;if(D.outbound||I.db._options.cache==="disabled"||I.explicit)return C.mutate(T);var R=oi["idb://".concat(m,"/").concat(x)];return R?(I=C.mutate(T),T.type!=="add"&&T.type!=="put"||!(50<=T.values.length||Fd(D,T).some(function(j){return j==null}))?(R.optimisticOps.push(T),T.mutatedParts&&kl(T.mutatedParts),I.then(function(j){0<j.numFailures&&(ne(R.optimisticOps,T),(j=yy(0,T,j))&&R.optimisticOps.push(j),T.mutatedParts&&kl(T.mutatedParts))}),I.catch(function(){ne(R.optimisticOps,T),T.mutatedParts&&kl(T.mutatedParts)})):I.then(function(j){var O=yy(0,n(n({},T),{values:T.values.map(function(H,z){var G,H=(G=D.keyPath)!==null&&G!==void 0&&G.includes(".")?X(H):n({},H);return N(H,D.keyPath,j.results[z]),H})}),j);R.optimisticOps.push(O),queueMicrotask(function(){return T.mutatedParts&&kl(T.mutatedParts)})}),I):C.mutate(T)},query:function(T){if(!my(we,C)||!gy("query",T))return C.query(T);var I=((O=we.trans)===null||O===void 0?void 0:O.db._options.cache)==="immutable",z=we,R=z.requery,j=z.signal,O=function(U,Y,W,Z){var Q=oi["idb://".concat(U,"/").concat(Y)];if(!Q)return[];if(!(Y=Q.queries[W]))return[null,!1,Q,null];var te=Y[(Z.query?Z.query.index.name:null)||""];if(!te)return[null,!1,Q,null];switch(W){case"query":var se=te.find(function(ie){return ie.req.limit===Z.limit&&ie.req.values===Z.values&&xy(ie.req.query.range,Z.query.range)});return se?[se,!0,Q,te]:[te.find(function(ie){return("limit"in ie.req?ie.req.limit:1/0)>=Z.limit&&(!Z.values||ie.req.values)&&hC(ie.req.query.range,Z.query.range)}),!1,Q,te];case"count":return se=te.find(function(ie){return xy(ie.req.query.range,Z.query.range)}),[se,!!se,Q,te]}}(m,x,"query",T),q=O[0],z=O[1],G=O[2],H=O[3];return q&&z?q.obsSet=T.obsSet:(z=C.query(T).then(function(U){var Y=U.result;if(q&&(q.res=Y),I){for(var W=0,Z=Y.length;W<Z;++W)Object.freeze(Y[W]);Object.freeze(Y)}else U.result=X(Y);return U}).catch(function(U){return H&&q&&ne(H,q),Promise.reject(U)}),q={obsSet:T.obsSet,promise:z,subscribers:new Set,type:"query",req:T,dirty:!1},H?H.push(q):(H=[q],(G=G||(oi["idb://".concat(m,"/").concat(x)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[T.query.index.name||""]=H)),uC(q,H,R,j),q.promise.then(function(U){return{result:vy(U.result,T,G==null?void 0:G.optimisticOps,C,q,I)}})}})}})}};function Dl(d,m){return new Proxy(d,{get:function(x,C,D){return C==="db"?m:Reflect.get(x,C,D)}})}var Gn=(ht.prototype.version=function(d){if(isNaN(d)||d<.1)throw new be.Type("Given version is not a positive number");if(d=Math.round(10*d)/10,this.idbdb||this._state.isBeingOpened)throw new be.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,d);var m=this._versions,x=m.filter(function(C){return C._cfg.version===d})[0];return x||(x=new this.Version(d),m.push(x),m.sort(tC),x.stores({}),this._state.autoSchema=!1,x)},ht.prototype._whenReady=function(d){var m=this;return this.idbdb&&(this._state.openComplete||we.letThrough||this._vip)?d():new ve(function(x,C){if(m._state.openComplete)return C(new be.DatabaseClosed(m._state.dbOpenError));if(!m._state.isBeingOpened){if(!m._state.autoOpen)return void C(new be.DatabaseClosed);m.open().catch(je)}m._state.dbReadyPromise.then(x,C)}).then(d)},ht.prototype.use=function(d){var m=d.stack,x=d.create,C=d.level,D=d.name;return D&&this.unuse({stack:m,name:D}),d=this._middlewares[m]||(this._middlewares[m]=[]),d.push({stack:m,create:x,level:C??10,name:D}),d.sort(function(T,I){return T.level-I.level}),this},ht.prototype.unuse=function(d){var m=d.stack,x=d.name,C=d.create;return m&&this._middlewares[m]&&(this._middlewares[m]=this._middlewares[m].filter(function(D){return C?D.create!==C:!!x&&D.name!==x})),this},ht.prototype.open=function(){var d=this;return si(yn,function(){return rC(d)})},ht.prototype._close=function(){var d=this._state,m=Qi.indexOf(this);if(0<=m&&Qi.splice(m,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}d.isBeingOpened||(d.dbReadyPromise=new ve(function(x){d.dbReadyResolve=x}),d.openCanceller=new ve(function(x,C){d.cancelOpen=C}))},ht.prototype.close=function(x){var m=(x===void 0?{disableAutoOpen:!0}:x).disableAutoOpen,x=this._state;m?(x.isBeingOpened&&x.cancelOpen(new be.DatabaseClosed),this._close(),x.autoOpen=!1,x.dbOpenError=new be.DatabaseClosed):(this._close(),x.autoOpen=this._options.autoOpen||x.isBeingOpened,x.openComplete=!1,x.dbOpenError=null)},ht.prototype.delete=function(d){var m=this;d===void 0&&(d={disableAutoOpen:!0});var x=0<arguments.length&&typeof arguments[0]!="object",C=this._state;return new ve(function(D,T){function I(){m.close(d);var R=m._deps.indexedDB.deleteDatabase(m.name);R.onsuccess=st(function(){var j,O,q;j=m._deps,O=m.name,q=j.indexedDB,j=j.IDBKeyRange,kd(q)||O===ul||Cd(q,j).delete(O).catch(je),D()}),R.onerror=Tn(T),R.onblocked=m._fireOnBlocked}if(x)throw new be.InvalidArgument("Invalid closeOptions argument to db.delete()");C.isBeingOpened?C.dbReadyPromise.then(I):I()})},ht.prototype.backendDB=function(){return this.idbdb},ht.prototype.isOpen=function(){return this.idbdb!==null},ht.prototype.hasBeenClosed=function(){var d=this._state.dbOpenError;return d&&d.name==="DatabaseClosed"},ht.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ht.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ht.prototype,"tables",{get:function(){var d=this;return o(this._allTables).map(function(m){return d._allTables[m]})},enumerable:!1,configurable:!0}),ht.prototype.transaction=function(){var d=(function(m,x,C){var D=arguments.length;if(D<2)throw new be.InvalidArgument("Too few arguments");for(var T=new Array(D-1);--D;)T[D-1]=arguments[D];return C=T.pop(),[m,M(T),C]}).apply(this,arguments);return this._transaction.apply(this,d)},ht.prototype._transaction=function(d,m,x){var C=this,D=we.trans;D&&D.db===this&&d.indexOf("!")===-1||(D=null);var T,I,R=d.indexOf("?")!==-1;d=d.replace("!","").replace("?","");try{if(I=m.map(function(O){if(O=O instanceof C.Table?O.name:O,typeof O!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return O}),d=="r"||d===hd)T=hd;else{if(d!="rw"&&d!=ud)throw new be.InvalidArgument("Invalid transaction mode: "+d);T=ud}if(D){if(D.mode===hd&&T===ud){if(!R)throw new be.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");D=null}D&&I.forEach(function(O){if(D&&D.storeNames.indexOf(O)===-1){if(!R)throw new be.SubTransaction("Table "+O+" not included in parent transaction.");D=null}}),R&&D&&!D.active&&(D=null)}}catch(O){return D?D._promise(null,function(q,z){z(O)}):ct(O)}var j=(function O(q,z,G,H,U){return ve.resolve().then(function(){var Y=we.transless||we,W=q._createTransaction(z,G,q._dbSchema,H);if(W.explicit=!0,Y={trans:W,transless:Y},H)W.idbtrans=H.idbtrans;else try{W.create(),W.idbtrans._explicit=!0,q._state.PR1398_maxLoop=3}catch(te){return te.name===ot.InvalidState&&q.isOpen()&&0<--q._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),q.close({disableAutoOpen:!1}),q.open().then(function(){return O(q,z,G,null,U)})):ct(te)}var Z,Q=J(U);return Q&&Zi(),Y=ve.follow(function(){var te;(Z=U.call(W,W))&&(Q?(te=_s.bind(null,null),Z.then(te,te)):typeof Z.next=="function"&&typeof Z.throw=="function"&&(Z=Bd(Z)))},Y),(Z&&typeof Z.then=="function"?ve.resolve(Z).then(function(te){return W.active?te:ct(new be.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Y.then(function(){return Z})).then(function(te){return H&&W._resolve(),W._completion.then(function(){return te})}).catch(function(te){return W._reject(te),ct(te)})})}).bind(null,this,T,I,D,x);return D?D._promise(T,j,"lock"):we.trans?si(we.transless,function(){return C._whenReady(j)}):this._whenReady(j)},ht.prototype.table=function(d){if(!u(this._allTables,d))throw new be.InvalidTable("Table ".concat(d," does not exist"));return this._allTables[d]},ht);function ht(d,m){var x=this;this._middlewares={},this.verno=0;var C=ht.dependencies;this._options=m=n({addons:ht.addons,autoOpen:!0,indexedDB:C.indexedDB,IDBKeyRange:C.IDBKeyRange,cache:"cloned"},m),this._deps={indexedDB:m.indexedDB,IDBKeyRange:m.IDBKeyRange},C=m.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var D,T,I,R,j,O={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:je,dbReadyPromise:null,cancelOpen:je,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:m.autoOpen};O.dbReadyPromise=new ve(function(z){O.dbReadyResolve=z}),O.openCanceller=new ve(function(z,G){O.cancelOpen=G}),this._state=O,this.name=d,this.on=ho(this,"populate","blocked","versionchange","close",{ready:[Wn,je]}),this.on.ready.subscribe=S(this.on.ready.subscribe,function(z){return function(G,H){ht.vip(function(){var U,Y=x._state;Y.openComplete?(Y.dbOpenError||ve.resolve().then(G),H&&z(G)):Y.onReadyBeingFired?(Y.onReadyBeingFired.push(G),H&&z(G)):(z(G),U=x,H||z(function W(){U.on.ready.unsubscribe(G),U.on.ready.unsubscribe(W)}))})}}),this.Collection=(D=this,uo(G1.prototype,function(Z,W){this.db=D;var H=Zg,U=null;if(W)try{H=W()}catch(Q){U=Q}var Y=Z._ctx,W=Y.table,Z=W.hook.reading.fire;this._ctx={table:W,index:Y.index,isPrimKey:!Y.index||W.schema.primKey.keyPath&&Y.index===W.schema.primKey.name,range:H,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:U,or:Y.or,valueMapper:Z!==St?Z:null}})),this.Table=(T=this,uo(ty.prototype,function(z,G,H){this.db=T,this._tx=H,this.name=z,this.schema=G,this.hook=T._allTables[z]?T._allTables[z].hook:ho(null,{creating:[Ys,je],reading:[Pt,St],updating:[Xs,je],deleting:[Ui,je]})})),this.Transaction=(I=this,uo(Z1.prototype,function(z,G,H,U,Y){var W=this;this.db=I,this.mode=z,this.storeNames=G,this.schema=H,this.chromeTransactionDurability=U,this.idbtrans=null,this.on=ho(this,"complete","error","abort"),this.parent=Y||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ve(function(Z,Q){W._resolve=Z,W._reject=Q}),this._completion.then(function(){W.active=!1,W.on.complete.fire()},function(Z){var Q=W.active;return W.active=!1,W.on.error.fire(Z),W.parent?W.parent._reject(Z):Q&&W.idbtrans&&W.idbtrans.abort(),ct(Z)})})),this.Version=(R=this,uo(iC.prototype,function(z){this.db=R,this._cfg={version:z,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(j=this,uo(oy.prototype,function(z,G,H){if(this.db=j,this._ctx={table:z,index:G===":id"?null:G,or:H},this._cmp=this._ascending=qe,this._descending=function(U,Y){return qe(Y,U)},this._max=function(U,Y){return 0<qe(U,Y)?U:Y},this._min=function(U,Y){return qe(U,Y)<0?U:Y},this._IDBKeyRange=j._deps.IDBKeyRange,!this._IDBKeyRange)throw new be.MissingAPI})),this.on("versionchange",function(z){0<z.newVersion?console.warn("Another connection wants to upgrade database '".concat(x.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(x.name,"'. Closing db now to resume the delete request.")),x.close({disableAutoOpen:!1})}),this.on("blocked",function(z){!z.newVersion||z.newVersion<z.oldVersion?console.warn("Dexie.delete('".concat(x.name,"') was blocked")):console.warn("Upgrade '".concat(x.name,"' blocked by other connection holding version ").concat(z.oldVersion/10))}),this._maxKey=mo(m.IDBKeyRange),this._createTransaction=function(z,G,H,U){return new x.Transaction(z,G,H,x._options.chromeTransactionDurability,U)},this._fireOnBlocked=function(z){x.on("blocked").fire(z),Qi.filter(function(G){return G.name===x.name&&G!==x&&!G._state.vcFired}).map(function(G){return G.on("versionchange").fire(z)})},this.use(lC),this.use(dC),this.use(cC),this.use(oC),this.use(aC);var q=new Proxy(this,{get:function(z,G,H){if(G==="_vip")return!0;if(G==="table")return function(Y){return Dl(x.table(Y),q)};var U=Reflect.get(z,G,H);return U instanceof ty?Dl(U,q):G==="tables"?U.map(function(Y){return Dl(Y,q)}):G==="_createTransaction"?function(){return Dl(U.apply(this,arguments),q)}:U}});this.vip=q,C.forEach(function(z){return z(x)})}var El,on=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",fC=(Md.prototype.subscribe=function(d,m,x){return this._subscribe(d&&typeof d!="function"?d:{next:d,error:m,complete:x})},Md.prototype[on]=function(){return this},Md);function Md(d){this._subscribe=d}try{El={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch{El={indexedDB:null,IDBKeyRange:null}}function _y(d){var m,x=!1,C=new fC(function(D){var T=J(d),I,R=!1,j={},O={},q={get closed(){return R},unsubscribe:function(){R||(R=!0,I&&I.abort(),z&&Cs.storagemutated.unsubscribe(H))}};D.start&&D.start(q);var z=!1,G=function(){return cd(U)},H=function(Y){Cl(j,Y),Ad(O,j)&&G()},U=function(){var Y,W,Z;!R&&El.indexedDB&&(j={},Y={},I&&I.abort(),I=new AbortController,Z=function(Q){var te=ys();try{T&&Zi();var se=xs(d,Q);return se=T?se.finally(_s):se}finally{te&&vs()}}(W={subscr:Y,signal:I.signal,requery:G,querier:d,trans:null}),Promise.resolve(Z).then(function(Q){x=!0,m=Q,R||W.signal.aborted||(j={},function(te){for(var se in te)if(u(te,se))return;return 1}(O=Y)||z||(Cs(po,H),z=!0),cd(function(){return!R&&D.next&&D.next(Q)}))},function(Q){x=!1,["DatabaseClosedError","AbortError"].includes(Q==null?void 0:Q.name)||R||cd(function(){R||D.error&&D.error(Q)})}))};return setTimeout(G,0),q});return C.hasValue=function(){return x},C.getValue=function(){return m},C}var ai=Gn;function Rd(d){var m=ks;try{ks=!0,Cs.storagemutated.fire(d),Id(d,!0)}finally{ks=m}}f(ai,n(n({},ms),{delete:function(d){return new ai(d,{addons:[]}).delete()},exists:function(d){return new ai(d,{addons:[]}).open().then(function(m){return m.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(d){try{return m=ai.dependencies,x=m.indexedDB,m=m.IDBKeyRange,(kd(x)?Promise.resolve(x.databases()).then(function(C){return C.map(function(D){return D.name}).filter(function(D){return D!==ul})}):Cd(x,m).toCollection().primaryKeys()).then(d)}catch{return ct(new be.MissingAPI)}var m,x},defineClass:function(){return function(d){l(this,d)}},ignoreTransaction:function(d){return we.trans?si(we.transless,d):d()},vip:Sd,async:function(d){return function(){try{var m=Bd(d.apply(this,arguments));return m&&typeof m.then=="function"?m:ve.resolve(m)}catch(x){return ct(x)}}},spawn:function(d,m,x){try{var C=Bd(d.apply(x,m||[]));return C&&typeof C.then=="function"?C:ve.resolve(C)}catch(D){return ct(D)}},currentTransaction:{get:function(){return we.trans||null}},waitFor:function(d,m){return m=ve.resolve(typeof d=="function"?ai.ignoreTransaction(d):d).timeout(m||6e4),we.trans?we.trans.waitFor(m):m},Promise:ve,debug:{get:function(){return lt},set:function(d){Mt(d)}},derive:y,extend:l,props:f,override:S,Events:ho,on:Cs,liveQuery:_y,extendObservabilitySet:Cl,getByKeyPath:B,setByKeyPath:N,delByKeyPath:function(d,m){typeof m=="string"?N(d,m,void 0):"length"in m&&[].map.call(m,function(x){N(d,x,void 0)})},shallowClone:L,deepClone:X,getObjectDiff:Nd,cmp:qe,asap:$,minKey:-1/0,addons:[],connections:Qi,errnames:ot,dependencies:El,cache:oi,semVer:"4.0.4",version:"4.0.4".split(".").map(function(d){return parseInt(d)}).reduce(function(d,m,x){return d+m/Math.pow(10,2*x)})})),ai.maxKey=mo(ai.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Cs(po,function(d){ks||(d=new CustomEvent(gd,{detail:d}),ks=!0,dispatchEvent(d),ks=!1)}),addEventListener(gd,function(d){d=d.detail,ks||Rd(d)}));var tr,ks=!1,by=function(){};return typeof BroadcastChannel<"u"&&((by=function(){(tr=new BroadcastChannel(gd)).onmessage=function(d){return d.data&&Rd(d.data)}})(),typeof tr.unref=="function"&&tr.unref(),Cs(po,function(d){ks||tr.postMessage(d)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(d){if(!Gn.disableBfCache&&d.persisted){lt&&console.debug("Dexie: handling persisted pagehide"),tr!=null&&tr.close();for(var m=0,x=Qi;m<x.length;m++)x[m].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(d){!Gn.disableBfCache&&d.persisted&&(lt&&console.debug("Dexie: handling persisted pageshow"),by(),Rd({all:new At(-1/0,[[]])}))})),ve.rejectionMapper=function(d,m){return!d||d instanceof re||d instanceof TypeError||d instanceof SyntaxError||!d.name||!nn[d.name]?d:(m=new nn[d.name](m||d.message,d),"stack"in d&&g(m,"stack",{get:function(){return this.inner.stack}}),m)},Mt(lt),n(Gn,Object.freeze({__proto__:null,Dexie:Gn,liveQuery:_y,Entity:Qg,cmp:qe,PropModSymbol:qn,PropModification:pd,replacePrefix:function(d,m){return new pd({replacePrefix:[d,m]})},default:Gn,RangeSet:At,mergeRanges:vo,rangesOverlap:wl}),{default:Gn}),Gn})})(Ep);var Rx=Ep.exports;const Nc=Dp(Rx),Ap=Symbol.for("Dexie"),kr=globalThis[Ap]||(globalThis[Ap]=Nc);if(Nc.semVer!==kr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Nc.semVer} and ${kr.semVer}`);const{liveQuery:Lx,mergeRanges:zx,rangesOverlap:Ox,RangeSet:Hx,cmp:jx,Entity:Wx,PropModSymbol:Ux,PropModification:Vx,replacePrefix:Kx}=kr;class zn{}zn.TABLE={name:"cache",schema:"++id, type, key, data, createTime, updateTime, [type+key]",version:1},zn.DEFAULT_TYPE="cache";const Tp=Object.freeze(Object.defineProperty({__proto__:null,CacheData:zn},Symbol.toStringTag,{value:"Module"})),qx=Object.values(Tp).reduce((s,e)=>Math.max(e.TABLE.version,s),1),Gx=Object.values(Tp).reduce((s,{TABLE:e})=>(s[e.name]=e.schema,s),{});class $p extends kr{constructor(e="DataHub"){super(e),this.version(qx).stores(Gx),this.cache.mapToClass(zn)}async getCache(e,t=zn.DEFAULT_TYPE){return this.cache.where("[type+key]").equals([t,e]).first()}async getCacheData(e,t=zn.DEFAULT_TYPE){const n=await this.getCache(e,t);return n==null?void 0:n.data}async limitSize(e=zn.DEFAULT_TYPE,t=1e3){let n=await this.cache.where("type").equals(e).count();for(;n>=t;){const i=await this.cache.where("type").equals(e).first();if(!i)break;await this.cache.delete(i.id),n=await this.cache.where("type").equals(e).count()}}async setCacheData(e,t,n,i=zn.DEFAULT_TYPE){if(t===null)return this.deleteCacheData(e,i);const r=await this.getCache(e,i);return n=n||Date.now(),r?(await this.cache.update(r.id,{data:t,updateTime:n}),r.id):await this.cache.add({key:e,data:t,type:i,createTime:n,updateTime:n})}async deleteCacheData(e,t=zn.DEFAULT_TYPE){return typeof e=="number"?this.cache.delete(e):this.cache.where("[type+key]").equals([t,e]).delete()}async getPageData(e,t,n){const{currentModule:i,currentMethod:r}=window.config;return this.getCacheData(e,`PAGE_${t||i}_${n||r}`)}setPageData(e,t,n,i){const{currentModule:r,currentMethod:o}=window.config;return this.setCacheData(e,t,void 0,`PAGE_${n||r}_${i||o}`)}}Object.defineProperty(window.$,"db",{get(){var s;return this._db||(window.parent!==window?this._db=window.parent.$.db:this._db=new $p(`zentao_${((s=window.config)==null?void 0:s.account)||""}`)),this._db}});class Fc extends Ee{}Fc.NAME="Avatar",Fc.Component=bi,ut(bx);const pk="",mk="",gk="",yk="";class Pc extends Ee{}Pc.NAME="BtnGroup",Pc.Component=cn,ut(Object.freeze(Object.defineProperty({__proto__:null,BtnGroup:cn},Symbol.toStringTag,{value:"Module"})));const xk="",_k="",Ip=Symbol("EVENT_PICK");class oa extends ke{constructor(e){super(e),this._handleClick=this._handleClick.bind(this),this._hasInput=!!_(`#${e.id}`).length}get hasInput(){return this._hasInput}_handleClick(e){const{togglePop:t,clickType:n,onClick:i}=this.props;let r=n==="open"?!0:void 0;const o=_(e.target),a=i==null?void 0:i(e);if(!e.defaultPrevented){if(typeof a=="boolean")r=a;else{if(o.closest('[data-dismiss="pick"]').length){t(!1);return}if(o.closest("a,input").length)return}requestAnimationFrame(()=>t(r))}}_getClass(e){const{state:t,className:n,disabled:i,readonly:r,pickerName:o,empty:a}=e,{open:l}=t;return ee("pick",n,o?`${o}-pick`:"",l&&"is-open focus",i&&"disabled",r&&"readonly",a?"is-empty-value":"")}_getProps(e){const{id:t,style:n,attrs:i}=e;return{id:`pick-${t}`,className:this._getClass(e),style:n,tabIndex:-1,onClick:this._handleClick,...i}}_renderTrigger(e){const{children:t,state:n}=e;return t??n.value}_renderValue(e){const{name:t,state:{value:n=""},disabled:i,readonly:r,id:o}=e;if(t)if(this._hasInput)_(`#${o}`).val(n);else return A("input",{id:o,type:"hidden",className:"pick-value",name:t,value:n,readonly:r,disabled:i});return null}componentDidMount(){const{id:e}=this.props;_(`#${e}`).on(`change.zui.pick.${e} syncValue.zui.pick.${e}`,(t,n)=>{if(typeof n=="symbol")return;const i=_.isPlainObject(n)&&typeof n.setValue=="string"?n.setValue:t.target.value;this._skipTriggerChange=i,this.props.changeState({value:i})})}componentWillUnmount(){const{id:e}=this.props;_(`#${e}`).off(`change.zui.pick.${e}`)}componentDidUpdate(e){const{id:t,state:n,name:i}=this.props;i&&e.state.value!==n.value&&(this._skipTriggerChange!==n.value&&_(`#${t}`).trigger("change",Ip),this._skipTriggerChange=!1)}render(e){return k(e.tagName||"div",this._getProps(e),this._renderTrigger(e),this._renderValue(e))}}const ss=Math.min,qt=Math.max,aa=Math.round,la=Math.floor,Cn=s=>({x:s,y:s}),Yx={left:"right",right:"left",bottom:"top",top:"bottom"},Xx={start:"end",end:"start"};function Mc(s,e,t){return qt(s,ss(e,t))}function Si(s,e){return typeof s=="function"?s(e):s}function is(s){return s.split("-")[0]}function Di(s){return s.split("-")[1]}function Bp(s){return s==="x"?"y":"x"}function Rc(s){return s==="y"?"height":"width"}function Ls(s){return["top","bottom"].includes(is(s))?"y":"x"}function Lc(s){return Bp(Ls(s))}function Zx(s,e,t){t===void 0&&(t=!1);const n=Di(s),i=Lc(s),r=Rc(i);let o=i==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=ca(o)),[o,ca(o)]}function Qx(s){const e=ca(s);return[zc(s),e,zc(e)]}function zc(s){return s.replace(/start|end/g,e=>Xx[e])}function Jx(s,e,t){const n=["left","right"],i=["right","left"],r=["top","bottom"],o=["bottom","top"];switch(s){case"top":case"bottom":return t?e?i:n:e?n:i;case"left":case"right":return e?r:o;default:return[]}}function e_(s,e,t,n){const i=Di(s);let r=Jx(is(s),t==="start",n);return i&&(r=r.map(o=>o+"-"+i),e&&(r=r.concat(r.map(zc)))),r}function ca(s){return s.replace(/left|right|bottom|top/g,e=>Yx[e])}function t_(s){return{top:0,right:0,bottom:0,left:0,...s}}function Np(s){return typeof s!="number"?t_(s):{top:s,right:s,bottom:s,left:s}}function ha(s){const{x:e,y:t,width:n,height:i}=s;return{width:n,height:i,top:t,left:e,right:e+n,bottom:t+i,x:e,y:t}}function Fp(s,e,t){let{reference:n,floating:i}=s;const r=Ls(e),o=Lc(e),a=Rc(o),l=is(e),c=r==="y",h=n.x+n.width/2-i.width/2,u=n.y+n.height/2-i.height/2,f=n[a]/2-i[a]/2;let p;switch(l){case"top":p={x:h,y:n.y-i.height};break;case"bottom":p={x:h,y:n.y+n.height};break;case"right":p={x:n.x+n.width,y:u};break;case"left":p={x:n.x-i.width,y:u};break;default:p={x:n.x,y:n.y}}switch(Di(e)){case"start":p[o]-=f*(t&&c?-1:1);break;case"end":p[o]+=f*(t&&c?-1:1);break}return p}const n_=async(s,e,t)=>{const{placement:n="bottom",strategy:i="absolute",middleware:r=[],platform:o}=t,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:s,floating:e,strategy:i}),{x:h,y:u}=Fp(c,n,l),f=n,p={},g=0;for(let y=0;y<a.length;y++){const{name:v,fn:b}=a[y],{x:w,y:S,data:E,reset:$}=await b({x:h,y:u,initialPlacement:n,placement:f,strategy:i,middlewareData:p,rects:c,platform:o,elements:{reference:s,floating:e}});h=w??h,u=S??u,p={...p,[v]:{...p[v],...E}},$&&g<=50&&(g++,typeof $=="object"&&($.placement&&(f=$.placement),$.rects&&(c=$.rects===!0?await o.getElementRects({reference:s,floating:e,strategy:i}):$.rects),{x:h,y:u}=Fp(c,f,l)),y=-1)}return{x:h,y:u,placement:f,strategy:i,middlewareData:p}};async function Oc(s,e){var t;e===void 0&&(e={});const{x:n,y:i,platform:r,rects:o,elements:a,strategy:l}=s,{boundary:c="clippingAncestors",rootBoundary:h="viewport",elementContext:u="floating",altBoundary:f=!1,padding:p=0}=Si(e,s),g=Np(p),v=a[f?u==="floating"?"reference":"floating":u],b=ha(await r.getClippingRect({element:(t=await(r.isElement==null?void 0:r.isElement(v)))==null||t?v:v.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:h,strategy:l})),w=u==="floating"?{x:n,y:i,width:o.floating.width,height:o.floating.height}:o.reference,S=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),E=await(r.isElement==null?void 0:r.isElement(S))?await(r.getScale==null?void 0:r.getScale(S))||{x:1,y:1}:{x:1,y:1},$=ha(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:w,offsetParent:S,strategy:l}):w);return{top:(b.top-$.top+g.top)/E.y,bottom:($.bottom-b.bottom+g.bottom)/E.y,left:(b.left-$.left+g.left)/E.x,right:($.right-b.right+g.right)/E.x}}const s_=s=>({name:"arrow",options:s,async fn(e){const{x:t,y:n,placement:i,rects:r,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:h=0}=Si(s,e)||{};if(c==null)return{};const u=Np(h),f={x:t,y:n},p=Lc(i),g=Rc(p),y=await o.getDimensions(c),v=p==="y",b=v?"top":"left",w=v?"bottom":"right",S=v?"clientHeight":"clientWidth",E=r.reference[g]+r.reference[p]-f[p]-r.floating[g],$=f[p]-r.reference[p],B=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let N=B?B[S]:0;(!N||!await(o.isElement==null?void 0:o.isElement(B)))&&(N=a.floating[S]||r.floating[g]);const L=E/2-$/2,V=N/2-y[g]/2-1,M=ss(u[b],V),F=ss(u[w],V),K=M,X=N-y[g]-F,ae=N/2-y[g]/2+L,ue=Mc(K,ae,X),ye=!l.arrow&&Di(i)!=null&&ae!==ue&&r.reference[g]/2-(ae<K?M:F)-y[g]/2<0,ce=ye?ae<K?ae-K:ae-X:0;return{[p]:f[p]+ce,data:{[p]:ue,centerOffset:ae-ue-ce,...ye&&{alignmentOffset:ce}},reset:ye}}}),i_=function(s){return s===void 0&&(s={}),{name:"flip",options:s,async fn(e){var t,n;const{placement:i,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:h=!0,crossAxis:u=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:y=!0,...v}=Si(s,e);if((t=r.arrow)!=null&&t.alignmentOffset)return{};const b=is(i),w=Ls(a),S=is(a)===a,E=await(l.isRTL==null?void 0:l.isRTL(c.floating)),$=f||(S||!y?[ca(a)]:Qx(a)),B=g!=="none";!f&&B&&$.push(...e_(a,y,g,E));const N=[a,...$],L=await Oc(e,v),V=[];let M=((n=r.flip)==null?void 0:n.overflows)||[];if(h&&V.push(L[b]),u){const ae=Zx(i,o,E);V.push(L[ae[0]],L[ae[1]])}if(M=[...M,{placement:i,overflows:V}],!V.every(ae=>ae<=0)){var F,K;const ae=(((F=r.flip)==null?void 0:F.index)||0)+1,ue=N[ae];if(ue)return{data:{index:ae,overflows:M},reset:{placement:ue}};let ye=(K=M.filter(ce=>ce.overflows[0]<=0).sort((ce,ne)=>ce.overflows[1]-ne.overflows[1])[0])==null?void 0:K.placement;if(!ye)switch(p){case"bestFit":{var X;const ce=(X=M.filter(ne=>{if(B){const _e=Ls(ne.placement);return _e===w||_e==="y"}return!0}).map(ne=>[ne.placement,ne.overflows.filter(_e=>_e>0).reduce((_e,pe)=>_e+pe,0)]).sort((ne,_e)=>ne[1]-_e[1])[0])==null?void 0:X[0];ce&&(ye=ce);break}case"initialPlacement":ye=a;break}if(i!==ye)return{reset:{placement:ye}}}return{}}}};async function r_(s,e){const{placement:t,platform:n,elements:i}=s,r=await(n.isRTL==null?void 0:n.isRTL(i.floating)),o=is(t),a=Di(t),l=Ls(t)==="y",c=["left","top"].includes(o)?-1:1,h=r&&l?-1:1,u=Si(e,s);let{mainAxis:f,crossAxis:p,alignmentAxis:g}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&typeof g=="number"&&(p=a==="end"?g*-1:g),l?{x:p*h,y:f*c}:{x:f*c,y:p*h}}const o_=function(s){return s===void 0&&(s=0),{name:"offset",options:s,async fn(e){var t,n;const{x:i,y:r,placement:o,middlewareData:a}=e,l=await r_(e,s);return o===((t=a.offset)==null?void 0:t.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:i+l.x,y:r+l.y,data:{...l,placement:o}}}}},a_=function(s){return s===void 0&&(s={}),{name:"shift",options:s,async fn(e){const{x:t,y:n,placement:i}=e,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:v=>{let{x:b,y:w}=v;return{x:b,y:w}}},...l}=Si(s,e),c={x:t,y:n},h=await Oc(e,l),u=Ls(is(i)),f=Bp(u);let p=c[f],g=c[u];if(r){const v=f==="y"?"top":"left",b=f==="y"?"bottom":"right",w=p+h[v],S=p-h[b];p=Mc(w,p,S)}if(o){const v=u==="y"?"top":"left",b=u==="y"?"bottom":"right",w=g+h[v],S=g-h[b];g=Mc(w,g,S)}const y=a.fn({...e,[f]:p,[u]:g});return{...y,data:{x:y.x-t,y:y.y-n,enabled:{[f]:r,[u]:o}}}}}},l_=function(s){return s===void 0&&(s={}),{name:"size",options:s,async fn(e){var t,n;const{placement:i,rects:r,platform:o,elements:a}=e,{apply:l=()=>{},...c}=Si(s,e),h=await Oc(e,c),u=is(i),f=Di(i),p=Ls(i)==="y",{width:g,height:y}=r.floating;let v,b;u==="top"||u==="bottom"?(v=u,b=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(b=u,v=f==="end"?"top":"bottom");const w=y-h.top-h.bottom,S=g-h.left-h.right,E=ss(y-h[v],w),$=ss(g-h[b],S),B=!e.middlewareData.shift;let N=E,L=$;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(L=S),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(N=w),B&&!f){const M=qt(h.left,0),F=qt(h.right,0),K=qt(h.top,0),X=qt(h.bottom,0);p?L=g-2*(M!==0||F!==0?M+F:qt(h.left,h.right)):N=y-2*(K!==0||X!==0?K+X:qt(h.top,h.bottom))}await l({...e,availableWidth:L,availableHeight:N});const V=await o.getDimensions(a.floating);return g!==V.width||y!==V.height?{reset:{rects:!0}}:{}}}};function ua(){return typeof window<"u"}function Ei(s){return Pp(s)?(s.nodeName||"").toLowerCase():"#document"}function Gt(s){var e;return(s==null||(e=s.ownerDocument)==null?void 0:e.defaultView)||window}function kn(s){var e;return(e=(Pp(s)?s.ownerDocument:s.document)||window.document)==null?void 0:e.documentElement}function Pp(s){return ua()?s instanceof Node||s instanceof Gt(s).Node:!1}function hn(s){return ua()?s instanceof Element||s instanceof Gt(s).Element:!1}function Sn(s){return ua()?s instanceof HTMLElement||s instanceof Gt(s).HTMLElement:!1}function Mp(s){return!ua()||typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof Gt(s).ShadowRoot}function Sr(s){const{overflow:e,overflowX:t,overflowY:n,display:i}=un(s);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!["inline","contents"].includes(i)}function c_(s){return["table","td","th"].includes(Ei(s))}function da(s){return[":popover-open",":modal"].some(e=>{try{return s.matches(e)}catch{return!1}})}function Hc(s){const e=jc(),t=hn(s)?un(s):s;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(t.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(t.contain||"").includes(n))}function h_(s){let e=rs(s);for(;Sn(e)&&!Ai(e);){if(Hc(e))return e;if(da(e))return null;e=rs(e)}return null}function jc(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Ai(s){return["html","body","#document"].includes(Ei(s))}function un(s){return Gt(s).getComputedStyle(s)}function fa(s){return hn(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.scrollX,scrollTop:s.scrollY}}function rs(s){if(Ei(s)==="html")return s;const e=s.assignedSlot||s.parentNode||Mp(s)&&s.host||kn(s);return Mp(e)?e.host:e}function Rp(s){const e=rs(s);return Ai(e)?s.ownerDocument?s.ownerDocument.body:s.body:Sn(e)&&Sr(e)?e:Rp(e)}function Dr(s,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=Rp(s),r=i===((n=s.ownerDocument)==null?void 0:n.body),o=Gt(i);if(r){const a=Wc(o);return e.concat(o,o.visualViewport||[],Sr(i)?i:[],a&&t?Dr(a):[])}return e.concat(i,Dr(i,[],t))}function Wc(s){return s.parent&&Object.getPrototypeOf(s.parent)?s.frameElement:null}function Lp(s){const e=un(s);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const i=Sn(s),r=i?s.offsetWidth:t,o=i?s.offsetHeight:n,a=aa(t)!==r||aa(n)!==o;return a&&(t=r,n=o),{width:t,height:n,$:a}}function Uc(s){return hn(s)?s:s.contextElement}function Ti(s){const e=Uc(s);if(!Sn(e))return Cn(1);const t=e.getBoundingClientRect(),{width:n,height:i,$:r}=Lp(e);let o=(r?aa(t.width):t.width)/n,a=(r?aa(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const u_=Cn(0);function zp(s){const e=Gt(s);return!jc()||!e.visualViewport?u_:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function d_(s,e,t){return e===void 0&&(e=!1),!t||e&&t!==Gt(s)?!1:e}function zs(s,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=s.getBoundingClientRect(),r=Uc(s);let o=Cn(1);e&&(n?hn(n)&&(o=Ti(n)):o=Ti(s));const a=d_(r,t,n)?zp(r):Cn(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,h=i.width/o.x,u=i.height/o.y;if(r){const f=Gt(r),p=n&&hn(n)?Gt(n):n;let g=f,y=Wc(g);for(;y&&n&&p!==g;){const v=Ti(y),b=y.getBoundingClientRect(),w=un(y),S=b.left+(y.clientLeft+parseFloat(w.paddingLeft))*v.x,E=b.top+(y.clientTop+parseFloat(w.paddingTop))*v.y;l*=v.x,c*=v.y,h*=v.x,u*=v.y,l+=S,c+=E,g=Gt(y),y=Wc(g)}}return ha({width:h,height:u,x:l,y:c})}function Vc(s,e){const t=fa(s).scrollLeft;return e?e.left+t:zs(kn(s)).left+t}function Op(s,e,t){t===void 0&&(t=!1);const n=s.getBoundingClientRect(),i=n.left+e.scrollLeft-(t?0:Vc(s,n)),r=n.top+e.scrollTop;return{x:i,y:r}}function f_(s){let{elements:e,rect:t,offsetParent:n,strategy:i}=s;const r=i==="fixed",o=kn(n),a=e?da(e.floating):!1;if(n===o||a&&r)return t;let l={scrollLeft:0,scrollTop:0},c=Cn(1);const h=Cn(0),u=Sn(n);if((u||!u&&!r)&&((Ei(n)!=="body"||Sr(o))&&(l=fa(n)),Sn(n))){const p=zs(n);c=Ti(n),h.x=p.x+n.clientLeft,h.y=p.y+n.clientTop}const f=o&&!u&&!r?Op(o,l,!0):Cn(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+h.x+f.x,y:t.y*c.y-l.scrollTop*c.y+h.y+f.y}}function p_(s){return Array.from(s.getClientRects())}function m_(s){const e=kn(s),t=fa(s),n=s.ownerDocument.body,i=qt(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),r=qt(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let o=-t.scrollLeft+Vc(s);const a=-t.scrollTop;return un(n).direction==="rtl"&&(o+=qt(e.clientWidth,n.clientWidth)-i),{width:i,height:r,x:o,y:a}}function g_(s,e){const t=Gt(s),n=kn(s),i=t.visualViewport;let r=n.clientWidth,o=n.clientHeight,a=0,l=0;if(i){r=i.width,o=i.height;const c=jc();(!c||c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:r,height:o,x:a,y:l}}function y_(s,e){const t=zs(s,!0,e==="fixed"),n=t.top+s.clientTop,i=t.left+s.clientLeft,r=Sn(s)?Ti(s):Cn(1),o=s.clientWidth*r.x,a=s.clientHeight*r.y,l=i*r.x,c=n*r.y;return{width:o,height:a,x:l,y:c}}function Hp(s,e,t){let n;if(e==="viewport")n=g_(s,t);else if(e==="document")n=m_(kn(s));else if(hn(e))n=y_(e,t);else{const i=zp(s);n={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return ha(n)}function jp(s,e){const t=rs(s);return t===e||!hn(t)||Ai(t)?!1:un(t).position==="fixed"||jp(t,e)}function v_(s,e){const t=e.get(s);if(t)return t;let n=Dr(s,[],!1).filter(a=>hn(a)&&Ei(a)!=="body"),i=null;const r=un(s).position==="fixed";let o=r?rs(s):s;for(;hn(o)&&!Ai(o);){const a=un(o),l=Hc(o);!l&&a.position==="fixed"&&(i=null),(r?!l&&!i:!l&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||Sr(o)&&!l&&jp(s,o))?n=n.filter(h=>h!==o):i=a,o=rs(o)}return e.set(s,n),n}function x_(s){let{element:e,boundary:t,rootBoundary:n,strategy:i}=s;const o=[...t==="clippingAncestors"?da(e)?[]:v_(e,this._c):[].concat(t),n],a=o[0],l=o.reduce((c,h)=>{const u=Hp(e,h,i);return c.top=qt(u.top,c.top),c.right=ss(u.right,c.right),c.bottom=ss(u.bottom,c.bottom),c.left=qt(u.left,c.left),c},Hp(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function __(s){const{width:e,height:t}=Lp(s);return{width:e,height:t}}function b_(s,e,t){const n=Sn(e),i=kn(e),r=t==="fixed",o=zs(s,!0,r,e);let a={scrollLeft:0,scrollTop:0};const l=Cn(0);if(n||!n&&!r)if((Ei(e)!=="body"||Sr(i))&&(a=fa(e)),n){const f=zs(e,!0,r,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else i&&(l.x=Vc(i));const c=i&&!n&&!r?Op(i,a):Cn(0),h=o.left+a.scrollLeft-l.x-c.x,u=o.top+a.scrollTop-l.y-c.y;return{x:h,y:u,width:o.width,height:o.height}}function Kc(s){return un(s).position==="static"}function Wp(s,e){if(!Sn(s)||un(s).position==="fixed")return null;if(e)return e(s);let t=s.offsetParent;return kn(s)===t&&(t=t.ownerDocument.body),t}function Up(s,e){const t=Gt(s);if(da(s))return t;if(!Sn(s)){let i=rs(s);for(;i&&!Ai(i);){if(hn(i)&&!Kc(i))return i;i=rs(i)}return t}let n=Wp(s,e);for(;n&&c_(n)&&Kc(n);)n=Wp(n,e);return n&&Ai(n)&&Kc(n)&&!Hc(n)?t:n||h_(s)||t}const w_=async function(s){const e=this.getOffsetParent||Up,t=this.getDimensions,n=await t(s.floating);return{reference:b_(s.reference,await e(s.floating),s.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function C_(s){return un(s).direction==="rtl"}const k_={convertOffsetParentRelativeRectToViewportRelativeRect:f_,getDocumentElement:kn,getClippingRect:x_,getOffsetParent:Up,getElementRects:w_,getClientRects:p_,getDimensions:__,getScale:Ti,isElement:hn,isRTL:C_};function S_(s,e){let t=null,n;const i=kn(s);function r(){var a;clearTimeout(n),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),r();const{left:c,top:h,width:u,height:f}=s.getBoundingClientRect();if(a||e(),!u||!f)return;const p=la(h),g=la(i.clientWidth-(c+u)),y=la(i.clientHeight-(h+f)),v=la(c),w={rootMargin:-p+"px "+-g+"px "+-y+"px "+-v+"px",threshold:qt(0,ss(1,l))||1};let S=!0;function E($){const B=$[0].intersectionRatio;if(B!==l){if(!S)return o();B?o(!1,B):n=setTimeout(()=>{o(!1,1e-7)},1e3)}S=!1}try{t=new IntersectionObserver(E,{...w,root:i.ownerDocument})}catch{t=new IntersectionObserver(E,w)}t.observe(s)}return o(!0),r}function Vp(s,e,t,n){n===void 0&&(n={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=Uc(s),h=i||r?[...c?Dr(c):[],...Dr(e)]:[];h.forEach(b=>{i&&b.addEventListener("scroll",t,{passive:!0}),r&&b.addEventListener("resize",t)});const u=c&&a?S_(c,t):null;let f=-1,p=null;o&&(p=new ResizeObserver(b=>{let[w]=b;w&&w.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var S;(S=p)==null||S.observe(e)})),t()}),c&&!l&&p.observe(c),p.observe(e));let g,y=l?zs(s):null;l&&v();function v(){const b=zs(s);y&&(b.x!==y.x||b.y!==y.y||b.width!==y.width||b.height!==y.height)&&t(),y=b,g=requestAnimationFrame(v)}return t(),()=>{var b;h.forEach(w=>{i&&w.removeEventListener("scroll",t),r&&w.removeEventListener("resize",t)}),u==null||u(),(b=p)==null||b.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const qc=o_,Gc=a_,Yc=i_,Kp=l_,D_=s_,Xc=(s,e,t)=>{const n=new Map,i={platform:k_,...t},r={...i.platform,_c:n};return n_(s,e,{...i,platform:r})};class Zc extends ke{constructor(e){super(e),this._ref=Ce(),this._handleDocClick=t=>{const{state:{open:n},id:i,togglePop:r}=this.props,o=_(t.target);n!=="closing"&&!o.closest(`#pick-${i},#pick-pop-${i}`).length&&o.parent().length&&r(!1)},this._handleClick=this._handleClick.bind(this)}get trigger(){return _(`#pick-${this.props.id}`)[0]}get element(){var e;return(e=this._ref)==null?void 0:e.current}get container(){return this._container}_handleClick(e){const{togglePop:t,onClickItem:n,state:i}=this.props,r=_(e.target),o=r.closest("[data-pick-value]");if(n&&n(e,i.value),o.length)return e.stopPropagation(),t(!1,{value:`${o.dataset("pickValue")}`});if(r.closest('[data-dismiss="pick"]').length)return t(!1)}_getClass(e){const{className:t,state:n,pickerName:i,empty:r}=e,{open:o}=n;return ee("pick-pop",i?`${i}-pick-pop`:"",t,o===!0&&"in",r?"is-empty-value":"")}_getProps(e){const{id:t,style:n,maxHeight:i,maxWidth:r,minHeight:o,minWidth:a}=e,l=_.extend({maxHeight:i,maxWidth:r,minHeight:o,minWidth:a},n);return{id:`pick-pop-${t}`,className:this._getClass(e),style:l,ref:this._ref,onClick:this._handleClick}}_getContainer(e){if(!this._container){const t=_(e.container||"body");let n=t.find(".pick-container");n.length||(n=_("<div>").addClass("pick-container").appendTo(t)),this._container=n[0]}return this._container}_render(e){return A("div",{...this._getProps(e),children:this._renderPop(e)})}_renderPop(e){return e.children}_getStyle(e={},t){var c;const n=(c=this.trigger)==null?void 0:c.getBoundingClientRect();if(!n)return{};const{width:i,minWidth:r,maxWidth:o,maxHeight:a}=this.props,l=n.width;if(typeof i=="function"?e.width=i():i==="100%"?e.width=l:i&&(e.width=nt(i)),r==="100%"&&(e.minWidth=l),o==="100%"&&(e.maxWidth=l),this.props.limitInScreen&&t&&(!a||a==="auto"||typeof a=="number")){let h;if(t.includes("bottom"))h=window.innerHeight-n.bottom-2;else{const u=this.element.getBoundingClientRect().height;h=n.top,u>h&&typeof e.top=="number"&&(e.top+=u-h)}h&&(e.maxHeight=typeof a=="number"?Math.min(h,a):h)}else a&&(e.maxHeight=a);return e}layout(){const{element:e,trigger:t,props:n}=this,{state:i}=n;if(!e||!t||!i.open){this._layoutWatcher&&(this._layoutWatcher(),this._layoutWatcher=void 0);return}this._layoutWatcher||(this._layoutWatcher=Vp(t,e,()=>{const{placement:r,width:o,noFlipAfterShow:a}=n,l=this._lastPlacement;Xc(t,e,{placement:a&&l?l:!r||r==="auto"?"bottom-start":r,middleware:[r==="auto"&&(!a||!l)?Yc():null,Gc(),qc(1)].filter(Boolean)}).then(({x:c,y:h,placement:u})=>{var f,p;if(Jn(t)||!ur(t,{checkZeroSize:!0})){_(e).css({display:"none"});return}_(e).css(this._getStyle({left:c,top:h},u)),(p=(f=this.props).onLayout)==null||p.call(f,e),l||(this._lastPlacement=u)}),o==="100%"&&_(e).css(this._getStyle())}))}componentDidMount(){var e,t;this.layout(),_(document).on("click",this._handleDocClick),(t=(e=this.props).afterRender)==null||t.call(e,{firstRender:!0})}componentDidUpdate(){var e,t;(t=(e=this.props).afterRender)==null||t.call(e,{firstRender:!1})}componentWillUnmount(){var t,n;_(document).off("click",this._handleDocClick);const e=this._layoutWatcher;e&&(e(),this._layoutWatcher=void 0),this._container=void 0,this._ref=void 0,_(`#pick-pop-${this.props.id}`).remove(),(n=(t=this.props).beforeDestroy)==null||n.call(t)}render(e){return _p(this._render(e),this._getContainer(e))}}const bk="";let xt=class extends ke{constructor(e){super(e),this._toggleTimer=0,this._pop=Ce(),this._trigger=Ce(),this.toggle=async(t,n)=>{(this.props.disabled||this.props.readonly)&&(t=!1);const{state:i}=this;if(typeof t=="boolean"&&t===(!!i.open&&i.open!=="closing"))return n&&await this.changeState(n),this.state;this._toggleTimer&&(clearTimeout(this._toggleTimer),this._toggleTimer=0);let r=await this.changeState(a=>(t=t??!a.open,{open:t?"opening":"closing",...n}));const{open:o}=r;return o==="closing"?(await Is(200,a=>{this._toggleTimer=a}),this._toggleTimer=0,r=await this.changeState({open:!1})):o==="opening"&&(await Is(50,a=>{this._toggleTimer=a}),this._toggleTimer=0,r=await this.changeState({open:!0})),r},this._id=e.id??`_pick${Bt()}`,this.changeState=this.changeState.bind(this),this.state=this.getDefaultState(e)}get id(){return this._id}get pop(){return this._pop.current}get trigger(){return this._trigger.current}get value(){return this.state.value}getDefaultState(e){return{value:String((e||this.props).defaultValue??""),open:!1}}resetState(e,t){const n=this.getDefaultState(e);t?this.state=n:this.changeState(n)}changeState(e,t){return new Promise(n=>{this.setState(e,()=>{t==null||t(),n(this.state)})})}open(e){return this.toggle(!0,e)}close(e){return this.toggle(!1,e)}_getTriggerProps(e,t){return{id:this.id,ref:this._trigger,state:t,className:e.className,pickerName:e.pickerName,style:e.style,name:e.name,tagName:e.tagName,attrs:e.attrs,disabled:e.disabled,readonly:e.readonly,clickType:e.clickType,onClick:e.onClick,changeState:this.changeState,togglePop:this.toggle}}_getPopProps(e,t){return{id:this.id,state:t,className:e.popClass,pickerName:e.pickerName,style:e.popStyle,disabled:e.disabled,readonly:e.readonly,changeState:this.changeState,togglePop:this.toggle,placement:e.popPlacement,container:e.popContainer,width:e.popWidth,height:e.popHeight,minHeight:e.popMinHeight,maxHeight:e.popMaxHeight,maxWidth:e.popMaxWidth,minWidth:e.popMinWidth,limitInScreen:e.limitPopInScreen,onClickItem:e.onClickItem}}_renderTrigger(e,t){return null}_renderPop(e,t){return null}_afterRender(e=!1){var t;(t=this.props.afterRender)==null||t.call(this,{firstRender:e})}_getPop(e){return e.Pop||this.constructor.Pop}_getTrigger(e){return e.Trigger||this.constructor.Trigger}_isEmptyValue(){const{value:e}=this.state;return e==null||e===""}_handleChange(e,t){const{onChange:n}=this.props;n&&n.call(this,e,t)}_handlePopToggle(e){const{onPopShown:t,onPopHidden:n}=this.props;e===!0&&t?t.call(this):!e&&n&&n.call(this)}setValue(e,t){if(t){const n=this._trigger.current;n&&(n._skipTriggerChange=e)}return this.changeState({value:e})}componentDidMount(){this._afterRender(!0)}componentWillUpdate(e,t){const{open:n}=this.state,{open:i}=t;if(!n==!i)return;const{onPopShow:r,onPopHide:o}=this.props;i&&r?r.call(this):!i&&o&&o.call(this)}componentDidUpdate(e,t){const{open:n,value:i}=this.state,{open:r,value:o}=t;!!n!=!!r&&this._handlePopToggle(!!n),i!==o&&this._handleChange(i,o),this._afterRender()}componentWillUnmount(){var t;(t=this.props.beforeDestroy)==null||t.call(this),this._toggleTimer&&clearTimeout(this._toggleTimer);const e=this._pop.current;e&&e.componentWillUnmount&&e.componentWillUnmount()}render(e,t){const{open:n}=t,i=this._getTrigger(e);let r;if(n&&(!e.hidePopWhenEmpty||!this._isEmptyValue())){const o=this._getPop(e);r=A(o,{ref:this._pop,...this._getPopProps(e,t),children:this._renderPop(e,t)},"pop")}return A(Mn,{children:[A(i,{...this._getTriggerProps(e,t),children:this._renderTrigger(e,t)},"pick"),r]})}};xt.Trigger=oa,xt.Pop=Zc,xt.defaultProps={popContainer:"body",popClass:"popup",popWidth:"100%",popPlacement:"auto",popMinWidth:50,popMinHeight:32,popMaxHeight:300,limitPopInScreen:!0,clickType:"open"};let qp=class extends xt{getDefaultState(e){const t=super.getDefaultState(e);return t.value===void 0&&(e||this.props).required&&(t.value=this.getColors()[0]),t}getColors(){const{colors:e}=this.props;return typeof e=="string"?e.split(","):e||[]}componentDidMount(){this.syncColor()}syncColor(){const{syncBackground:e,syncBorder:t,syncColor:n,syncValue:i}=this.props,r=this.state.value||"";if(e&&_(e).css("backgroundColor",r),t&&_(t).css("borderColor",r),n&&_(n).css("color",r),i){const o=_(i);o.is("input,textarea,select")?o.val(r):o.text(r)}}_handleChange(e,t){this.props.disabled||(super._handleChange(e,t),this.syncColor())}_renderTrigger(e,t){const{icon:n,hint:i=""}=e,{value:r}=t;return[n?A(Re,{icon:n,title:i},"icon"):A("span",{class:"color-picker-item bg-current ring ring-gray ring-inset",style:{background:r},title:i})]}_getTriggerProps(e,t){const n=super._getTriggerProps(e,t);return n.style=_.extend({color:t.value},n.style),n.className=ee("color-picker",n.className,{disabled:e.disabled}),n}_renderPop(e,t){const{closeBtn:n,heading:i}=e,r=this.getColors(),{value:o}=t;let a;return i&&(a=A("div",{className:"color-picker-heading",children:[i,n?A("button",{className:"btn ghost square rounded size-sm","data-dismiss":"pick",children:A("span",{class:"close"})}):null]},"heading")),[a,A("div",{className:"color-picker-row",children:[r.map(l=>A("button",{className:"btn color-picker-item",style:{backgroundColor:l},"data-pick-value":l,children:o===l?A(Re,{icon:"check"}):null},l)),A("button",{className:"btn color-picker-item","data-pick-value":"",children:A(Re,{className:"text-fore",icon:"trash"})})]},"row")]}};qp.defaultProps={...xt.defaultProps,className:"rounded btn square size-sm ghost",popClass:"color-picker-pop popup",colors:["#ef4444","#f97316","#eab308","#84cc16","#22c55e","#14b8a6","#0ea5e9","#6366f1","#a855f7","#d946ef","#ec4899"],closeBtn:!0,popWidth:"auto",popMinWidth:184};class $i extends Ee{}$i.NAME="ColorPicker",$i.Component=qp,$i.register();const wk="";class Gp extends ke{constructor(){super(...arguments),this._ref=Ce(),this._handleClickItem=(e,t)=>{var n,i;(i=(n=this.props).onChange)==null||i.call(n,e,+t.item.key)}}componentDidMount(){setTimeout(()=>{_(this._ref.current).find(".menu-item>.active").scrollIntoView({container:".menu"})},100)}render(e){const{minuteStep:t=5,hour:n,minute:i}=e,r=[],o=[];for(let l=0;l<24;++l)r.push({key:String(l),text:l<10?`0${l}`:l,active:n===l});for(let l=0;l<60;l+=t)o.push({key:String(l),text:l<10?`0${l}`:l,active:i===l});const a="col w-10 max-h-full overflow-y-auto scrollbar-thin scrollbar-hover";return A("div",{className:"time-picker-menu row",ref:this._ref,children:[A(Lt,{className:a,items:r,onClickItem:this._handleClickItem.bind(this,"hour")}),A(Lt,{className:a,items:o,onClickItem:this._handleClickItem.bind(this,"minute")})]})}}const Ck="",Yp=s=>{if(!s)return;const e=et(`1999-01-01 ${s}`);if(!Number.isNaN(e.getDay()))return e};let pa=class extends xt{constructor(){super(...arguments),this._handleInputFocus=()=>{this.toggle(!0)},this._handleInputChange=e=>{this.setTime(e.target.value)},this._handleSetTime=(e,t)=>{this.setTime({[e]:String(t)})},this._handleClearBtnClick=()=>{this.setTime("")}}getDefaultState(e){const t=super.getDefaultState(e);return t.value==="now"&&(t.value=gt(new Date,(e||this.props).format)),t}setTime(e,t){if(!t&&(this.props.disabled||this.props.readonly))return;let n="";if(typeof e=="string")n=e;else{const[c,h]=(this.state.value||"00:00").split(":"),{hour:u=+c,minute:f=+h}=e;n=`${u}:${f}`}const i=Yp(n),{onInvalid:r,required:o,defaultValue:a,format:l}=this.props;return this.changeState({value:i?gt(i,l):o?a:""},()=>{!i&&r&&r(n)})}setValue(e,t){if(t){const n=this._trigger.current;n&&(n._skipTriggerChange=e)}return this.setTime(e,!0)}getTime(){const e=Yp(this.state.value);return e?[e.getHours(),e.getMinutes()]:null}_renderTrigger(e,t){const{placeholder:n,icon:i,required:r,disabled:o,readonly:a}=e,{value:l="",open:c}=t,h=`time-picker-${this.id}`;let u;return c&&!r&&l.length?u=A("button",{type:"button",className:"btn size-sm square ghost",onClick:this._handleClearBtnClick,children:A("span",{className:"close"})}):i&&(i===!0?u=A("i",{class:"i-time"}):u=A(Re,{icon:i})),[A("input",{id:h,type:"text",className:"form-control",placeholder:n,value:l,disabled:o,readOnly:a,autoComplete:"off",onFocus:this._handleInputFocus,onChange:this._handleInputChange},"input"),u?A("label",{for:h,className:"input-control-suffix",children:u},"icon"):null]}_getTriggerProps(e,t){const n=super._getTriggerProps(e,t);return{...n,className:ee(n.className,"time-picker input-control has-suffix-icon")}}_renderPop(e){const[t,n]=this.getTime()||[];return A(Gp,{hour:t,minute:n,minuteStep:e.minuteStep,onChange:this._handleSetTime})}};pa.defaultProps={...xt.defaultProps,popWidth:"auto",popMaxHeight:320,minuteStep:5,format:"hh:mm",icon:!0};function E_(s,e,t){return e&&s<e?e:t&&s>t?t:s}function Er(s){if(s==null)return null;if(typeof s=="function"&&(s=s()),typeof s=="string"&&s.startsWith("today")){const e=new Date;s.length>6?s=Wf(e,s.substring(5).replace("+","")):s=e}else s=et(s);return dc(s)?s:null}const kk="";Oe.addLang({zh_cn:{today:"今天",yearFormat:"{0}年",weekNames:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},zh_tw:{today:"今天",yearFormat:"{0}年",weekNames:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},en:{today:"Today",yearFormat:"{0}",weekNames:["SUN","MON","TUE","WED","THU","FRI","SAT"],monthNames:["Jan.","Feb.","Mar.","Apr.","May.","Jun.","Jul.","Aug.","Sept.","Oct.","Nov.","Dec."]}});const A_=(s,e,t=0)=>{const n=new Date(s,e-1,1),i=n.getDay(),r=n.getTime()-(7+i-t)%7*gi;return{days:7*5,startTime:r,firstDay:n.getTime()}},Xp=(s,e)=>new Set((Array.isArray(s)?s:[s]).map(t=>gt(t,e)));class T_ extends ke{constructor(){super(...arguments),this._handleClickDate=e=>{const{onClickDate:t}=this.props;if(!t)return;const n=_(e.target).closest(".mini-calendar-day").dataset("date");n&&t(n)}}render(e){var M,F;const t=new Date,{weekStart:n=1,weekNames:i=Oe.getLang("weekNames"),monthNames:r=Oe.getLang("monthNames"),year:o=t.getFullYear(),month:a=t.getMonth()+1,highlights:l=[],selections:c=[],maxDate:h,minDate:u,isAllowDate:f}=e,p=[],g="btn ghost square rounded-full";for(let K=0;K<7;K++){const X=(n+K)%7;p.push(A("div",{className:ee("col mini-calendar-day",{"is-weekend":X===0||X===6}),children:A("div",{children:i?i[X]:X})},K))}const{startTime:y,days:v,firstDay:b}=A_(o,a,n),w=b+v*gi;let S=y;const E=[],$="yyyy-MM-dd",B=Xp(l,$),N=Xp(c,$),L=((M=h?et(h):null)==null?void 0:M.getTime())??Number.MAX_SAFE_INTEGER,V=((F=u?et(u):null)==null?void 0:F.getTime())??0;for(;S<=w;){const K=[];for(let X=0;X<7;X++){const ae=new Date(S);let ue=(f==null?void 0:f(ae))??!0;typeof ue=="boolean"&&(ue={allow:ue});const ye=ae.getDate(),ce=gt(ae,$),ne=ae.getDay(),_e=uc(ae,b),pe=ee("col mini-calendar-day",{active:B.has(ce),selected:N.has(ce),"is-first":ye===1,"is-in-month":_e,"is-out-month":!_e,"is-today":es(ae,t),"is-weekend":ne===0||ne===6,disabled:!ue.allow||(S>L||S<V)&&!es(ae,L)&&!es(ae,V)});K.push(A("div",{className:pe,"data-date":ce,children:A("button",{type:"button",className:g,onClick:this._handleClickDate,title:ue.hint,children:ye===1&&r?r[ae.getMonth()]:ae.getDate()})},ce)),S+=gi}E.push(A("div",{className:"row",children:K},S))}return A("div",{className:"mini-calendar",children:[A("div",{className:"row",children:p}),E]})}}class Zp extends ke{constructor(){super(...arguments);en(this,nl,Ce());en(this,sl,t=>{const{onChange:n}=this.props;if(!n)return;const r=_(t.target).closest("[data-value]").dataset("value");r&&(n(+r),t.stopPropagation())})}render(t){const{className:n,max:i,min:r,value:o}=t,a=[],l=new Date().getFullYear();for(let c=r;c<=i;++c)a.push(A($e,{type:"ghost","data-value":c,active:c===o,className:ee(l===c?"is-current":""),onClick:Wt(this,sl),children:c},c));return A("div",{className:n,ref:Wt(this,nl),children:a})}}nl=new WeakMap,sl=new WeakMap;class $_ extends ke{constructor(t){super(t);en(this,il);en(this,rl);en(this,to,void 0);en(this,no,void 0);en(this,so,void 0);en(this,io,void 0);en(this,ro,void 0);en(this,oo,void 0);an(this,to,Ce()),an(this,no,r=>{const o=_(r.target).closest("[data-set-date]");o.length&&this.changeDate(o.dataset("set-date"))}),an(this,so,()=>{const{year:r,month:o}=this.state;o===1?this.setState({year:r-1,month:12}):this.setState({month:o-1})}),an(this,io,()=>{const{year:r,month:o}=this.state;o===12?this.setState({year:r+1,month:1}):this.setState({month:o+1})}),an(this,ro,r=>{this.setState({year:r,select:"day"})}),an(this,oo,r=>{this.setState({month:r,select:"day"})}),this.changeDate=r=>{var o,a;(a=(o=this.props).onChange)==null||a.call(o,r)};const{date:n}=t,i=Er(n)||new Date;this.state={select:"day",year:i.getFullYear(),month:i.getMonth()+1}}_showSelect(t){this.setState(n=>n.select===t?{select:"day"}:{select:t})}render(t,n){const{date:i,yearText:r=Oe.getLang("yearFormat")||"{0}",weekNames:o=Oe.getLang("weekNames"),monthNames:a=Oe.getLang("monthNames"),minDate:l,maxDate:c,weekStart:h}=t,u=Er(i),{year:f,month:p,select:g}=n,y=g==="day",v=l||et("1970-1-1"),b=c||et("2099-12-31");return A("div",{className:"date-picker-menu row",ref:Wt(this,to),onClick:Wt(this,no),children:[Od(this,il,Ay).call(this,t),A("div",{className:"cell",style:"width: 312px",children:[A("div",{className:"row p-2",children:[A($e,{type:g==="year"?"primary-pale":"ghost",size:"sm",caret:!0,onClick:this._showSelect.bind(this,"year"),children:Te(r,f)}),A($e,{type:g==="month"?"primary-pale":"ghost",size:"sm",caret:!0,onClick:this._showSelect.bind(this,"month"),children:a?a[p-1]:p}),A("div",{className:"flex-auto"}),y?A("div",{children:[A($e,{type:"ghost",size:"sm",square:!0,onClick:Wt(this,so),children:A("i",{className:"chevron-left"})}),A($e,{type:"ghost",size:"sm",square:!0,onClick:Wt(this,io),children:A("i",{className:"chevron-right"})})]}):null]}),y?A(T_,{weekStart:h,weekNames:o,monthNames:a,maxDate:b,minDate:v,year:f,month:p,selections:u||[],onClickDate:this.changeDate,isAllowDate:t.isAllowDate}):null,g==="year"?A(Zp,{className:"date-pick-menu-years overflow-y-auto scrollbar-hover scrollbar-thin",value:f,min:v.getFullYear(),max:b.getFullYear(),onChange:Wt(this,ro)}):g==="month"?A(Zp,{className:"date-pick-menu-month overflow-y-auto scrollbar-hover scrollbar-thin",value:p,min:1,max:12,onChange:Wt(this,oo)}):null,y?Od(this,rl,Ty).call(this,t):null]})]})}}to=new WeakMap,no=new WeakMap,so=new WeakMap,io=new WeakMap,ro=new WeakMap,oo=new WeakMap,il=new WeakSet,Ay=function(t){return Lt.render(t.menu,[],{onClickItem:n=>{const i=n.item.value;typeof i=="string"&&this.changeDate(i)}},this)},rl=new WeakSet,Ty=function(t){let{actions:n}=t;const{todayText:i=Oe.getLang("today"),clearText:r}=t;return n===void 0&&(n=[{text:i,"data-set-date":gt(new Date,"yyyy-MM-dd")}]),Array.isArray(n)&&(n={items:n}),A("div",{className:"date-picker-menu-footer",children:[A(Xe,{btnProps:{className:"ghost text-primary"},...n}),r?A($e,{type:"ghost text-link","data-set-date":"",children:r}):null]})};const Sk="";let Ii=class extends xt{constructor(){super(...arguments),this.setDate=(e,t)=>{const{disabled:n,readonly:i}=this.props;if(!t&&(n||i))return;const r=this._calcValue(e);return this.changeState({value:r},()=>{this._afterSetDate()})},this._handleInputFocus=()=>{this.toggle(!0)},this._handleInputChange=e=>{this.setDate(e.target.value)},this._handleClearBtnClick=()=>{this.setDate("")},this._handleSetDate=e=>{this.setDate(e)}}getDefaultState(e){const t=super.getDefaultState(e);return{...t,value:this._calcValue(t.value)}}getDate(){return this._date}setValue(e,t){if(t){const n=this._trigger.current;n&&(n._skipTriggerChange=e)}return this.setDate(e,!0)}_calcValue(e){const{onInvalid:t,defaultValue:n="",required:i,allowInvalid:r,format:o}=this.props;let a=this._parseDate(e);if(!a&&t){const l=t(e);l&&(a=this._parseDate(l))}return this._date=a,a?gt(a,o):r?e:i?n:""}_getDateRange(e){const{minDate:t,maxDate:n}=this.props;return[Er(typeof t=="function"?t(e):t),Er(typeof n=="function"?n(e):n)]}_parseDate(e){const t=Er(e);return t&&this._isAllowDate(t)?E_(t,...this._getDateRange(e)):null}_afterSetDate(){this.toggle(!1)}_renderTrigger(e,t){const{placeholder:n,icon:i,required:r,disabled:o,readonly:a,display:l}=e,{value:c="",open:h}=t,u=`date-picker-${this.id}`;let f;h&&!r&&c.length?f=A("button",{type:"button",className:"btn size-sm square ghost",onClick:this._handleClearBtnClick,children:A("span",{className:"close"})}):i&&(i===!0?f=A("i",{class:"i-calendar"}):f=A(Re,{icon:i}));const p=h?c:l?l(c,this._date):c;return[A("input",{id:u,type:"text",className:"form-control",placeholder:n,value:p,disabled:o,readOnly:a,autoComplete:"off",onFocus:this._handleInputFocus,onChange:this._handleInputChange},"input"),f?A("label",{for:u,className:"input-control-suffix",children:f},"icon"):null]}_getTriggerProps(e,t){const n=super._getTriggerProps(e,t);return{...n,className:ee(n.className,"date-picker input-control has-suffix-icon")}}_getPopProps(e,t){const n=super._getPopProps(e,t);return{...n,className:ee(n.className,"popup")}}_isAllowDate(e){var n;const t=((n=this.props.isAllowDate)==null?void 0:n.call(this,e))??!0;return t===!0||typeof t=="object"&&t&&t.allow}_renderPop(e,t){const{weekNames:n,monthNames:i,weekStart:r,yearText:o,todayText:a,clearText:l,menu:c,actions:h,required:u,isAllowDate:f}=e,[p,g]=this._getDateRange(t.value);return A($_,{onChange:this._handleSetDate,date:this._date,weekNames:n,monthNames:i,weekStart:r,yearText:o,todayText:a,clearText:u?"":l,menu:c,actions:h,minDate:p,maxDate:g,isAllowDate:f?this._isAllowDate.bind(this):void 0})}};Ii.defaultProps={...xt.defaultProps,popWidth:"auto",popMaxHeight:320,format:"yyyy-MM-dd",icon:!0,limitPopInScreen:!1};let Qc=class extends Ii{constructor(){super(...arguments),this._handleSetDate=e=>{const t=et(e),n=this.getDate()||new Date;t.setHours(n.getHours()),t.setMinutes(n.getMinutes()),this.setDate(gt(t,this.props.format))},this._handleSetTime=(e,t)=>{const n=this.getDate()||new Date;e==="hour"?n.setHours(t):n.setMinutes(t),this.setDate(gt(n,this.props.format))}}getTime(){const e=this.getDate();return e?[e.getHours(),e.getMinutes()]:null}_afterSetDate(){}_renderPop(e,t){const[n,i]=this.getTime()||[];return A("div",{className:"datetime-picker-menu row",children:[super._renderPop(e,t),A("div",{className:"divider"}),A(Gp,{hour:n,minute:i,minuteStep:e.minuteStep,onChange:this._handleSetTime})]})}};Qc.defaultProps={...Ii.defaultProps,popMaxHeight:310,format:"yyyy-MM-dd hh:mm",minuteStep:5};class ma extends Ee{}ma.NAME="TimePicker",ma.Component=pa,ma.register();class ga extends Ee{}ga.NAME="DatePicker",ga.Component=Ii,ga.register();class ya extends Ee{}ya.NAME="DatetimePicker",ya.Component=Qc,ya.register();const Dk="",Qp="show",Jc="in",I_='[data-dismiss="modal"]',va="modal-hide",Bi=class ci extends Je{constructor(){super(...arguments),this._timer=0,this._handleClick=e=>{const t=e.target,n=t.closest(".modal");!n||n!==this.modalElement||(t.closest(I_)||this.options.backdrop===!0&&t===n)&&(e.preventDefault(),this.hide())}}static get SELECTOR(){return".modal"}get modalElement(){return this.element}get shown(){return this._shown}get dialog(){return this.modalElement.querySelector(".modal-dialog")}get rob(){return this._rob}_observeResize(){var e;if(this.options.responsive&&typeof ResizeObserver<"u"){(e=this._rob)==null||e.disconnect();const{dialog:t}=this;if(t){const n=new ResizeObserver(()=>{if(!this._shown)return;const i=t.clientWidth,r=t.clientHeight,[o,a]=this._lastDialogSize||[];(o!==i||a!==r)&&(this._lastDialogSize=[i,r],this.layout())});n.observe(t),this._rob=n}}}_cancelObserver(){var e;(e=this._rob)==null||e.disconnect(),this._rob=void 0}afterInit(){this.on("click",this._handleClick),this.options.show&&(this.show(),this._observeResize()),this.on("hidden",e=>{const{modalElement:t}=this;if(!t.parentNode)return this.destroy();const n=e.target.closest(".modal")===t;n&&this._cancelObserver(),n&&!ci.getAll().some(i=>i.shown)&&_("html").enableScroll()}),this.on("show",e=>{const{modalElement:t}=this;if(!t.parentNode)return this.destroy();e.target.closest(".modal")===t&&(this._observeResize(),_("html").disableScroll())}),this.shown&&_("html").disableScroll()}destroy(){super.destroy(),this._cancelObserver()}show(e){var c;const{modalElement:t}=this,n=_(t);if(this._shown&&n.hasClass(Jc))return n.removeClass(va).css("z-index",`${ci.zIndex++}`),!1;this._shown=!0,this.setOptions(e);const{animation:i,backdrop:r,className:o,style:a}=this.options;n.setClass({"modal-trans":i,"modal-no-backdrop":!r,[va]:!1},Qp,o).css({zIndex:`${ci.zIndex++}`,...a});const l=this.constructor;return l.hideOthers&&this.options.hideOthers!==!1&&l.getAll().forEach(h=>{h!==this&&h.shown&&!n.closest(h.modalElement).length&&h.hideForOther()}),this.options.closeOthers&&l.getAll().forEach(h=>{h!==this&&!n.closest(h.modalElement).length&&h.hide()}),this.layout(),(c=this.options.onShow)==null||c.call(this),this.emit("show"),this._setTimer(()=>{n.addClass(Jc),this._setTimer(()=>{var h,u;(h=n.find("[autofocus]")[0])==null||h.focus(),(u=this.options.onShown)==null||u.call(this),this.emit("shown")})},50),!0}hideForOther(){_(this.modalElement).addClass(va)}hide(){var t;if(!this._shown)return!1;this._shown=!1,_(this.modalElement).removeClass(Jc),(t=this.options.onHide)==null||t.call(this),this.emit("hide"),this._setTimer(()=>{var n;_(this.modalElement).removeClass(Qp),(n=this.options.onHidden)==null||n.call(this),this.emit("hidden")});const e=this.constructor;return e.hideOthers&&this.options.hideOthers!==!1&&e.getAll().forEach(n=>{n.shown&&n!==this&&_(n.modalElement).removeClass(va)}),!0}layout(e,t){if(!this._shown)return;const{dialog:n}=this;if(!n)return;const i=_(n);if(t=t??this.options.size,t){i.removeAttr("data-size");const h={width:"",height:""};typeof t=="object"?(h.width=t.width,h.height=t.height):typeof t=="string"&&["md","sm","lg","full"].includes(t)?i.attr("data-size",t):t&&(h.width=t),i.css(h)}e=e??this.options.position??"fit";const r=n.clientWidth,o=n.clientHeight;this._lastDialogSize=[r,o],typeof e=="function"&&(e=e({width:r,height:o}));const a={left:null,bottom:null,right:null};let l=null,c="center";typeof e=="number"?(c="flex-start",l=e):typeof e=="object"&&e?(Object.assign(a,e),l=a.top??l,c=a.alignSelf??"flex-start"):e==="fit"?(c="flex-start",l=`${Math.max(0,Math.floor((window.innerHeight-o)/3))}px`):e==="bottom"?c="flex-end":e==="top"?c="flex-start":e!=="center"&&typeof e=="string"&&(c="flex-start",l=e),a.top=l,a.alignSelf=c,i.css(a),_(this.modalElement).css("justifyContent",a.left?"flex-start":"center")}_setTimer(e,t){this._timer&&(clearTimeout(this._timer),this._timer=0),e&&(this.options.animation?this._timer=window.setTimeout(e,t??this.options.transTime):e())}static last(e){return ci.query(e,void 0,t=>t.shown)}static hide(e){var t;(t=ci.last(e))==null||t.hide()}static show(e){var t;(t=ci.query(e,void 0,n=>!n.shown))==null||t.show()}};Bi.NAME="Modal",Bi.MULTI_INSTANCE=!0,Bi.DEFAULT={position:"fit",show:!0,keyboard:!0,animation:!0,backdrop:!0,responsive:!0,transTime:300},Bi.hideOthers=!0,Bi.zIndex=1500;let Ni=Bi;_(window).on(`resize.${Ni.NAMESPACE}`,()=>{Ni.getAll().forEach(s=>{const e=s;e.shown&&e.options.responsive&&e.layout()})});class Jp extends ke{constructor(e){super(e),this._ref=Ce(),this.state={showed:!e.waitShowEvent}}componentDidMount(){const{waitShowEvent:e,afterRender:t}=this.props;t==null||t.call(this,{firstRender:!0}),e&&_(this._ref.current).on(e,()=>{this.setState({showed:!0})})}componentDidUpdate(){var e;(e=this.props.afterRender)==null||e.call(this,{firstRender:!1})}componentWillUnmount(){var e;(e=this.props.beforeDestroy)==null||e.call(this)}renderHeader(){const{header:e,headerClass:t,title:n}=this.props;return P.isValidElement(e)?e:e===!1||!n?null:e?A(Se,{className:ee("modal-header",t),content:e}):A("div",{className:ee("modal-header",t),children:A("div",{className:"modal-title",children:n})})}renderActions(){const{actions:e,closeBtn:t}=this.props;return!t&&!e?null:P.isValidElement(e)?e:A("div",{className:"modal-actions",children:[e?A(Xe,{...e}):null,t?A("button",{type:"button",class:"btn square ghost","data-dismiss":"modal",children:A("span",{class:"close"})}):null]})}renderBody(){const{body:e,bodyClass:t}=this.props;return e?P.isValidElement(e)?e:A(Se,{className:ee("modal-body",t),content:e}):null}renderFooter(){const{footer:e,footerClass:t,footerActions:n}=this.props;return P.isValidElement(e)?e:e===!1||!n?null:e?A(Se,{className:ee("modal-footer",t),content:e}):A("div",{className:ee("modal-footer",t),children:n?A(Xe,{...n}):null})}render(){const{className:e,style:t,contentClass:n,children:i,waitShowEvent:r}=this.props,o=r&&!this.state.showed;return A("div",{ref:r?this._ref:void 0,className:ee("modal-dialog",e,o?"loading":""),style:t,children:[A("div",{className:ee("modal-content",n),children:[this.renderHeader(),this.renderActions(),this.renderBody(),i,this.renderFooter()]}),o?A("div",{class:"load-indicator loading"}):null]})}}Jp.defaultProps={closeBtn:!0};class eh extends ke{constructor(){super(...arguments),this._ref=Ce(),this._height=at(),this._timer=0,this._handleError=e=>{e.message.includes("ResizeObserver loop completed with undelivered notifications")&&this.componentWillUnmount()},this._handleIframeLoad=()=>{const e=this.iframeDoc;if(!e)return;const{iframeBodyClass:t,watchHeight:n}=this.props;n&&this._watchIframeHeight(),t&&e.body.classList.add(t),_(this._ref.current).trigger("modal-iframe-loaded")}}get iframeDoc(){var e,t;return(t=(e=this._ref.current)==null?void 0:e.contentWindow)==null?void 0:t.document}componentDidMount(){this.props.watchHeight&&this._watchIframeHeight(),window.addEventListener("error",this._handleError)}componentWillUnmount(){var e;window.removeEventListener("error",this._handleError),(e=this._rob)==null||e.disconnect(),this._timer&&clearTimeout(this._timer)}_watchIframeHeight(){const e=this.iframeDoc;if(!e)return;let t=this._rob;t==null||t.disconnect(),t=new ResizeObserver(()=>{this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout(()=>{const n=e.body,i=e.documentElement,r=Math.ceil(Math.max(n.scrollHeight,n.offsetHeight,i.offsetHeight));r&&r!==this._height.value&&(this._height.value=r),this._timer=0},10)}),t.observe(e.body),this._rob=t}render(){return A("iframe",{className:"modal-iframe",style:this._height.value?`height: ${this._height.value}px;`:void 0,src:this.props.url,ref:this._ref,onLoad:this._handleIframeLoad})}}eh.defaultProps={watchHeight:!0};var th=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)},dn=(s,e,t)=>(th(s,e,"read from private field"),t?t.call(s):e.get(s)),Ar=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},Fi=(s,e,t,n)=>(th(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),xa=(s,e,t)=>(th(s,e,"access private method"),t),On,Tr,Hn,_a,nh,ba,sh;function B_(s,e){const{custom:t,title:n,content:i,closeBtn:r}=e;return{body:i,closeBtn:r,title:n,...typeof t=="function"?t():t}}async function N_(s,e){const{dataType:t="html",url:n,request:i,custom:r,title:o,replace:a=!0,executeScript:l=!0}=e,c=await _.ajax({url:n,headers:{"X-ZUI-Modal":"true"},...i});if(t!=="html")try{const h=JSON.parse(c);return{title:o,...r,...h}}catch{}return a!==!1&&t==="html"?[c]:{title:o,...r,body:t==="html"?A(Rn,{className:"modal-body",html:c,executeScript:l}):c}}async function F_(s,e){const{url:t,custom:n,title:i,size:r}=e,o=typeof r=="object"&&typeof r.height=="number";return{title:i,...n,waitShowEvent:"modal-iframe-loaded",body:A(eh,{url:t,watchHeight:!o})}}const P_={custom:B_,ajax:N_,iframe:F_},e0="loading",t0=class hi extends Ni{constructor(){super(...arguments),Ar(this,_a),Ar(this,ba),Ar(this,On,void 0),Ar(this,Tr,void 0),Ar(this,Hn,void 0),this._builded=!1}get id(){return dn(this,Tr)}get loading(){var e;return(e=dn(this,On))==null?void 0:e.classList.contains(e0)}get shown(){var e;return!!((e=dn(this,On))!=null&&e.classList.contains("show"))}get modalElement(){let e=dn(this,On);if(!e){const{options:t}=this;let n=dn(this,Tr);n||(n=t.id||`modal-${Bt()}`,Fi(this,Tr,n));const{$element:i}=this;if(e=i.find(`#${n}`)[0],e)_(e).data(this.constructor.KEY,this);else{const r=this.key;e=_("<div>").attr({id:n,"data-key":r}).data(this.constructor.KEY,this).css(t.style||{}).setClass("modal modal-async load-indicator",t.className).appendTo(i)[0]}Fi(this,On,e)}return e}get $emitter(){const e=dn(this,On);return e?_(e):this.$element}afterInit(){super.afterInit(),this.options.destroyOnHide&&this.options.type!=="static"&&this.on("hidden",e=>{_(e.target).data("key")===this.key&&this.destroy()})}show(e){return super.show(e)?(this.buildDialog(),!0):!1}destroy(){super.destroy();const e=dn(this,On);e&&(_(e).removeData(this.constructor.KEY).remove(),Fi(this,On,void 0))}render(e){return super.render(e),this.buildDialog()}async buildDialog(){if(this.loading)return!1;dn(this,Hn)&&clearTimeout(dn(this,Hn));const{modalElement:e,options:t}=this,n=_(e),{type:i,loadTimeout:r,loadingClass:o=e0,loadingText:a=null,cache:l}=t;if(!i||i==="static")return!0;if(l&&this._builded)return this.layout(),!0;const c=P_[i];if(!c)return console.warn(`Modal: Cannot build modal with type "${i}"`),!1;n.attr("data-loading",a).addClass(o),r&&Fi(this,Hn,window.setTimeout(()=>{Fi(this,Hn,0),xa(this,ba,sh).call(this,this.options.timeoutTip)},r));const h=await c.call(this,e,t);return this._destroyed?!1:(h===!1?await xa(this,ba,sh).call(this,this.options.failedTip):h&&typeof h=="object"&&await xa(this,_a,nh).call(this,h),dn(this,Hn)&&(clearTimeout(dn(this,Hn)),Fi(this,Hn,0)),this.layout(),this._builded=!0,await Is(100),n.removeClass(o),!0)}static isValid(e){return!_.isDetached(e.modalElement)}static open(e){return new Promise(t=>{const{container:n=document.body,ref:i,...r}=e,o={show:!0,...r};!o.type&&o.url&&(o.type="ajax"),!o.type&&e.id&&(o.type="static"),o.key===void 0&&(o.key=o.id);const a=hi.ensure(n,o);i&&(i.current=a);const l=`${hi.NAMESPACE}.open${Bt()}`;a.on(`hidden${l}`,()=>{a.off(l),t(a)}),a.show()})}static async alert(e){typeof e=="string"&&(e={message:e});const{type:t,message:n,icon:i,iconClass:r="icon-lg muted",actions:o="confirm",onClickAction:a,custom:l,key:c="__alert",...h}=e,u=(typeof l=="function"?l():l)||{};let f=A(Se,{content:n});i?f=A("div",{className:ee("modal-body row gap-4 items-center",u.bodyClass),children:[A("div",{className:`icon ${i} ${r}`}),f]}):f=A("div",{className:ee("modal-body",u.bodyClass),children:f});const p=[];(Array.isArray(o)?o:o?[o]:[]).forEach(v=>{v={...typeof v=="string"?{key:v}:v},typeof v.key=="string"&&(v.text||(v.text=Oe.getLang(v.key,v.key)),v.btnType||(v.btnType=`btn-wide ${v.key==="confirm"?"primary":"btn-default"}`)),v&&p.push(v)},[]);let g;const y=p.length?{gap:4,items:p,onClickItem:({item:v,event:b})=>{const w=hi.query(b.target);if(!w||w.key!==c)return;g=v.key,(a==null?void 0:a(v,w))!==!1&&w&&w.hide()}}:void 0;return await hi.open({key:c,type:"custom",size:400,className:"modal-alert",content:f,modal:!0,backdrop:"static",hideOthers:!1,custom:{footerActions:y,...u},...h}),g}static async confirm(e){typeof e=="string"&&(e={message:e});const{onClickAction:t,onResult:n,...i}=e;return await hi.alert({actions:["confirm","cancel"],onClickAction:(o,a)=>{n==null||n(o.key==="confirm",a),t==null||t(o,a)},...i})==="confirm"}static async prompt(e){typeof e=="string"&&(e={message:e});const{defaultValue:t="",placeholder:n,onResult:i,onShown:r,message:o,content:a,bodyClass:l,custom:c,multiline:h,...u}=e;let f=t,p=!1;const g=w=>{f=w.target.value},y=Ce(),v=w=>{var S,E;w.key==="Enter"?(p=!0,w.preventDefault(),(S=y.current)==null||S.hide()):w.key==="Escape"&&((E=y.current)==null||E.hide())};return await hi.confirm({...u,custom:{closeBtn:!1,...c},message:o,ref:y,content:A("div",{className:ee("modal-body",l),children:[A(Se,{content:o}),h?A("textarea",{className:"modal-prompt-input form-control mt-3",autoFocus:!0,placeholder:n,defaultValue:t,onChange:g,onKeyDown:v,rows:10}):A("input",{type:"text",className:"modal-prompt-input form-control mt-3",autoFocus:!0,placeholder:n,defaultValue:t,onChange:g,onKeyDown:v}),a]})})||p?f:null}};On=new WeakMap,Tr=new WeakMap,Hn=new WeakMap,_a=new WeakSet,nh=function(s){return new Promise(e=>{if(Array.isArray(s))return _(this.modalElement).html(s[0]).zuiInit(),this.layout(),this._observeResize(),e();const{afterRender:t,...n}=s;s={afterRender:i=>{this.layout(),t==null||t(i),this._observeResize(),e()},...n},Ns(A(Jp,{...s}),this.modalElement)})},ba=new WeakSet,sh=function(s){if(s)return xa(this,_a,nh).call(this,{body:A("div",{className:"modal-load-failed",children:s})})},t0.DEFAULT={...Ni.DEFAULT,loadTimeout:1e4,destroyOnHide:!0};let Ke=t0;Ke.register();class Pi extends Je{get modal(){return this._modal}get container(){const{container:e}=this.options;return typeof e=="string"?document.querySelector(e):e instanceof HTMLElement?e:document.body}show(){var e;return(e=this._initModal())==null?void 0:e.show()}hide(){var e;return(e=this._modal)==null?void 0:e.hide()}_getBuilderOptions(){const{container:e,...t}=this.options,n=t,i=this.$element.attr("href")||"";return n.type||(n.target||i[0]==="#"?n.type="static":n.type=n.type||(n.url||i?"ajax":"custom")),!n.url&&(n.type==="iframe"||n.type==="ajax")&&i[0]!=="#"&&(n.url=i),n.key===void 0&&(n.key=`${this._key}`),n}_initModal(){const e=this._getBuilderOptions();let t=this._modal;if(t)return t.setOptions(e),t;if(e.type==="static"){const n=this._getStaticModalElement();if(!n)return;t=Ni.ensure(n,e)}else t=Ke.ensure(this.container,e);return this._modal=t,t.on("destroyed",()=>{this._modal=void 0}),t}_getStaticModalElement(){let e=this.options.target;if(!e){const{$element:t}=this;if(t.is("a")){const n=t.attr("href");n!=null&&n.startsWith("#")&&(e=n)}}return this.container.querySelector(e||".modal")}}Pi.NAME="ModalTrigger",Pi.toggle={name:"modal",skip:"[disabled],.disabled,.open-in-parent",convertHref:!0,onGet(s){return Pi.get(s)},onCreate(s,e,t){return new Pi(s,t)}},Pi.register();const M_={zh_cn:{selectFile:"选择文件",fileSelectTip:"（不超过 {maxFileSize}）",removeFile:"移除文件",renameFile:"重命名",duplicatedTip:"文件 “{name}”（{size}） 已存在。",exceededSizeTip:"文件 “{name}”（{size}） 超过了 {maxFileSize} 的限制。",exceededTotalSizeTip:"文件 “{name}”（{size}） 超过了总大小 {totalFileSize} 的限制。",exceededCountTip:"文件 “{name}”（{size}） 超过了数量 {maxFileCount} 的限制。"},zh_tw:{selectFile:"選擇文件",fileSelectTip:"（不超過 {maxFileSize}）",removeFile:"移除文件",renameFile:"重命名",duplicatedTip:"文件 “{name}”（{size}） 已存在。",exceededSizeTip:"文件 “{name}”（{size}） 超過了 {maxFileSize} 的限制。",exceededTotalSizeTip:"文件 “{name}”（{size}） 超過了總大小 {totalFileSize} 的限制。",exceededCountTip:"文件 “{name}”（{size}） 超過了數量 {maxFileCount} 的限制。"},en:{selectFile:"Select File",fileSelectTip:"(Not exceeding {maxFileSize})",removeFile:"Remove File",renameFile:"Rename",duplicatedTip:"File “{name}” ({size}) already exists.",exceededSizeTip:"File “{name}” ({size}) exceeds the limit of {maxFileSize}.",exceededTotalSizeTip:"File “{name}” ({size}) exceeds the total size limit of {totalFileSize}.",exceededCountTip:"File “{name}” ({size}) exceeds the limit of {maxFileCount}."}};let os=class extends tt{constructor(e){if(e.totalFileSize)if(e.maxFileSize){const{maxFileSize:t,totalFileSize:n}=e,i=typeof t=="number"?t:Fn(t),r=typeof n=="number"?n:Fn(n);e.maxFileSize=i>r?n:t}else e.maxFileSize=e.totalFileSize;e.maxFileSize||(e.maxFileSize="100MB"),super(e),this._input=Ce(),this._file=Ce(),this._id=`file-selector-input-${Bt()}`,this._data=new DataTransfer,this.stopRenameFile=()=>{const{renaming:t,newName:n}=this.state;this.cancelRenameFile(),!(!t||!n)&&this.renameFile(t,n)},this.cancelRenameFile=()=>{this.setState({renaming:""})},this._handleChange=t=>{const n=t.target;n.files&&(this.selectFiles(n.files),this.setState({inputKey:Bt()}))},this._handleDragOver=t=>{t.preventDefault(),this.state.dragging||this.setState({dragging:!0})},this._handleDragLeave=t=>{t.preventDefault(),this.setState({dragging:!1})},this._handleDrop=t=>{var i;this._handleDragLeave(t);const n=this.constructor.filterFiles(((i=t.dataTransfer)==null?void 0:i.files)||[],this.props.accept);n.length&&(this.selectFiles(n),this.setState({inputKey:Bt()}))},this._handleRenameChange=t=>{this.setState({newName:t.target.value})},this._handleClick=t=>{if(this.props.disabled)return;const i=_(t.target).closest("[data-remove-file],[data-rename-file]");if(!i.length)return;const r=i.data();r.renameFile?this.startRenameFile(String(r.renameFile)):r.removeFile&&this.removeFile(String(r.removeFile))},this.state={files:(e.defaultFiles||[]).map(t=>this.constructor.getInfo(t)),inputKey:0}}get size(){return this.state.files.reduce((e,t)=>e+t.size,0)}get count(){return this.state.files.length}get multiple(){const{multiple:e,maxFileCount:t,name:n=""}=this.props;return!!(t!==1&&(e??n.endsWith("[]")))}get info(){const{maxFileSize:e=0,maxFileCount:t=Number.MAX_SAFE_INTEGER}=this.props;return{size:Dt(this.size,1),maxFileSize:Dt(typeof e=="string"?Fn(e):e,1),maxFileCount:t,count:this.count}}get files(){return this._data.files}componentDidMount(){const e=this.state.files.reduce((t,n)=>(n.file&&t.push(n.file),t),[]);e.length&&(e.forEach(t=>this._data.items.add(t)),this._syncFiles())}getFile(e){return this.state.files.find(t=>t.id===e)}getFileByName(e){return this.state.files.find(t=>t.name===e)}select(){var e;(e=this._input.current)==null||e.click()}async selectFiles(e){var t;if(((t=this.props.onSelect)==null?void 0:t.call(this,e))!==!1){this._skipAddMore=!1;for(let n=0;n<e.length&&(await this.addFile(e[n]),!this._skipAddMore);n++);}}async _checkDuplicated(e){const{allowSameName:t,onDuplicated:n,duplicatedTip:i=this.i18n("duplicatedTip")}=this.props,{name:r}=e,o=t?this.getFile(e.id):this.getFileByName(r);return o?((n==null?void 0:n.call(this,r,e,o))===!0||i&&await this._showAlert(i,{name:r,size:Dt(e.size,1)}),!0):!1}async _checkExceededSize(e){const{maxFileSize:t,onExceededSize:n,exceededSizeTip:i=this.i18n("exceededSizeTip")}=this.props;if(!t)return!1;const r=typeof t=="string"?Fn(t):t;return e.size<=r?!1:((n==null?void 0:n.call(this,r,e))===!0||i&&await this._showAlert(i,{name:e.name,size:Dt(e.size,1),maxFileSize:t}),!0)}async _checkTotalSize(e){const{totalFileSize:t,onExceededTotalSize:n,exceededTotalSizeTip:i=this.i18n("exceededTotalSizeTip")}=this.props;if(!t)return!1;const r=typeof t=="string"?Fn(t):t,o=e.size+this.size;return o<=r?!1:((n==null?void 0:n.call(this,r,e))===!0||i&&await this._showAlert(i,{name:e.name,size:Dt(e.size,1),totalSize:Dt(o,1)}),!0)}async _checkExceededCount(e){const{maxFileCount:t=0,onExceededCount:n,exceededCountTip:i=this.i18n("exceededCountTip")}=this.props;if(!t)return!1;const r=this.count+1;return r<=t?!1:((n==null?void 0:n.call(this,t,e))===!0||i&&await this._showAlert(i,{name:e.name,size:Dt(e.size,1),exceededCount:r}),!0)}async addFile(e){const{onAdd:t,disabled:n}=this.props;if(n)return!1;const i=this.constructor.getInfo(e);return await this._checkExceededCount(i)?(this._skipAddMore=!0,!1):await this._checkDuplicated(i)?!1:await this._checkExceededSize(i)?(this._skipAddMore=!0,!1):await this._checkTotalSize(i)?(this._skipAddMore=!0,!1):t&&t.call(this,i)===!1?!1:(this._data.items.add(e),this._syncFiles(!0),await this.changeState(c=>({files:[...c.files,i]})),!0)}startRenameFile(e){this.setState({renaming:e,newName:void 0},()=>{const t=_(this._file.current).closest(".file-selector").find(".file-selector-rename-input")[0];t&&(t.select(),t.focus())})}async renameFile(e,t){const n=this.getFile(e);if(!n||n.name===t)return;const{onRename:i}=this.props;if(i&&await i.call(this,t,n.name,n)===!1)return;const r=n.file,{files:o,renamedFiles:a={}}=this.state;if(r){const c=new File([r],t,{type:r.type,lastModified:r.lastModified}),h=Array.from(this._data.files).indexOf(r);h>=0&&this._data.items.remove(h),this._data.items.add(c),this._syncFiles(!0),n.file=c}else a[n.id]=t;n.name=t,n.ext=this.constructor.getExt(t);const l=o.indexOf(n);l>=0?o.splice(l,1,n):o.push(n),this.setState({files:[...o],renamedFiles:{...a}})}async removeFile(e){const t=this.getFile(e);if(!t)return;const{onRemove:n,removeConfirm:i}=this.props;if(i){let c=i;if(typeof c=="string"&&(c={message:c}),typeof c.message=="string"&&(c.message=Te(c.message,{name:t.name,size:Dt(t.size,1)})),!await Ke.confirm(c))return}if(n&&await n.call(this,t)===!1)return;if(t.file){const c=Array.from(this._data.files).indexOf(t.file);c>=0&&this._data.items.remove(c)}const{files:r,deletedFiles:o=[],renamedFiles:a={}}=this.state,l=r.indexOf(t);l>=0&&(!t.file&&!o.includes(t.id)&&(delete a[t.id],o.push(t.id)),r.splice(l,1),this.setState({files:[...r],deletedFiles:[...o],renamedFiles:{...a}}),this._syncFiles(!0))}_syncFiles(e=!1){const t=this._data.files,n=this._file.current;n.files=t,e&&_(n).trigger("change",{files:t})}_showAlert(e,t){return typeof e=="string"&&(e={message:e}),typeof e.message=="string"&&(e.message=Te(e.message,{...this.info,...t})),Ke.alert(e)}_getTip(e){return typeof e=="string"?Te(e,this.info):e}_renderInput(e){return A("input",{id:this._id,multiple:this.multiple,accept:e.accept,style:"display:none",type:"file",ref:this._input,onChange:this._handleChange},`input${this.state.inputKey}`)}_getDraggableProps(){const e={};return this.props.draggable&&!this.props.disabled&&(e.onDragOver=this._handleDragOver,e.onDragLeave=this._handleDragLeave,e.onDrop=this._handleDrop),e}_renderUpload(e){const{mode:t,disabled:n,tip:i=this.i18n("fileSelectTip"),uploadBtn:r}=e,o=Ie({component:"label",attrs:{for:n?void 0:this._id},disabled:n,text:this.i18n("selectFile")},typeof r=="object"?r:typeof r=="string"?{text:r}:{}),a=A("div",{className:"file-selector-tip",children:A(Se,{content:this._getTip(i),generatorThis:this,generatorArgs:[this.state]})}),l=t==="grid",c=l?{}:this._getDraggableProps();return l||t==="box"?A($e,{...o,...c,className:ee(l?"file-selector-grid-btn":"file-selector-box",o.className),children:a},"upload"):A("div",{className:"file-selector-btn",...c,children:[A($e,{rounded:"full",size:"sm",...o}),a]},"upload")}_renderForForm(e){const{name:t,accept:n,onChange:i,deleteName:r,renameName:o}=e,{deletedFiles:a,renamedFiles:l}=this.state,c=[A("input",{ref:this._file,type:"file",name:t,multiple:this.multiple,accept:n,style:"display:none",onChange:i},"form")];return r&&a&&c.push(...a.map(h=>A("input",{type:"hidden",name:`${r}[${h}]`,value:h},`delete:${h}`))),o&&l&&c.push(...Object.entries(l).map(([h,u])=>A("input",{type:"hidden",name:`${o}[${h}]`,value:u},`rename:${h}`))),c}_getIcon(e){let{fileIcons:t}=this.props;if(t)return typeof t=="string"&&(t={default:t}),t[e.ext]??t.default}_getThumbnail(e){if((e.file||e.url)&&this.props.thumbnail&&this.constructor.isImage(e))return e.url||URL.createObjectURL(e.file)}_getAvatar(e){const t=this._getThumbnail(e);let n;if(t)n={src:t};else{const i=this._getIcon(e);i&&(n={icon:i})}return n&&{size:this.props.mode==="grid"?void 0:"sm",...n}}_getFileActions(e){if(this.props.disabled)return;let{removeBtn:t,renameBtn:n}=this.props;typeof t=="function"&&(t=t.call(this,e)),typeof t=="string"?t={text:t}:t===!0&&(t={hint:this.i18n("removeFile"),icon:"trash"}),typeof n=="function"&&(n=n.call(this,e)),typeof n=="string"?n={text:n}:n===!0&&(n={hint:this.i18n("renameFile"),icon:"edit"});const i=[];return n&&i.push({"data-rename-file":e.id,...n}),t&&i.push({"data-remove-file":e.id,...t}),i}_renderFile(e){let{itemProps:t}=this.props;return t=Ie({className:this.props.mode==="grid"?"file-selector-grid-item":"file-selector-item",multiline:!1,title:e.name,subtitle:Dt(e.size,1),avatar:this._getAvatar(e),actions:this._getFileActions(e),"z-id":e.id},typeof t=="function"?t.call(this,e):t),A(wn,{...t},e.id)}_renderFileRename(e){let{itemProps:t}=this.props;if(typeof t=="function")t=t.call(this,e);else{const{newName:n=e.name}=this.state,i=this.props.mode==="grid",r=A("div",{className:"file-selector-rename-text",children:[A("div",{className:"form-control size-sm",children:n}),A("input",{type:"text",defaultValue:e.name,className:"form-control size-sm select-all file-selector-rename-input",autofocus:!0,onBlur:i?this.stopRenameFile:void 0,onChange:this._handleRenameChange,onInput:this._handleRenameChange})]});t=Ie({className:`${i?"file-selector-grid-item":"file-selector-item"} is-renaming`,multiline:!1,avatar:this._getAvatar(e),"z-id":e.id,contentClass:"file-selector-rename",content:i?r:[r,A($e,{icon:"check",text:this.i18n("confirm"),type:"primary-pale",size:"sm",onClick:this.stopRenameFile}),A($e,{icon:"close",text:this.i18n("cancel"),type:"gray-pale",size:"sm",onClick:this.cancelRenameFile})]},t)}return A(wn,{...t},e.id)}_renderList(e){const{files:t,renaming:n}=this.state;return A("div",{className:`file-selector-list${t.length?"":" is-empty"}`,onClick:this._handleClick,children:t.map(i=>i.id===n?this._renderFileRename(i):this._renderFile(i))},"list")}_renderGrid(e){const t=this._getDraggableProps(),{gridWidth:n=120,gridHeight:i=148,gridGap:r=12}=e,o={"--file-selector-grid-width":nt(n),"--file-selector-grid-height":nt(i),"--file-selector-grid-gap":nt(r)},{files:a,renaming:l}=this.state;return A("div",{className:"file-selector-grid",style:o,onClick:this._handleClick,...t,children:[a.map(c=>c.id===l?this._renderFileRename(c):this._renderFile(c)),this._renderUpload(e)]},"grid")}_getClassName(e){return["file-selector",`is-mode-${e.mode}`,e.className,this.state.dragging?"is-dragging":""]}_getChildren(e){const t=e.mode==="grid";return[t?null:this._renderUpload(e),t?this._renderGrid(e):this._renderList(e),this._renderInput(e),this._renderForForm(e)]}static getExt(e){return(e.split(".").pop()||"").toLowerCase()}static getInfo(e){const{name:t,size:n,type:i}=e;if(e instanceof File)return{name:t,size:n,type:i,file:e,id:[t,n].join(":"),ext:this.getExt(t)};const r=typeof n=="string"?Fn(n):n;return{name:t,size:r,id:e.id?String(e.id):[t,r].join(":"),type:i??"",ext:this.getExt(t),file:e.file,url:e.url}}static isAccept(e,t){return!t||!t.length?!0:(Array.isArray(t)?t:t.split(",")).some(i=>e.type&&i===e.type?!0:i.startsWith(".")?e.name.endsWith(i):i.endsWith("/*")?e.type.startsWith(i.slice(0,-1)):!1)}static isImage(e){return this.isAccept(e,this.imageAccepts)}static filterFiles(e,t){if(!t||!t.length)return e;e instanceof FileList&&(e=Array.from(e));const n=t.split(",");return e.filter(i=>this.isAccept(i,n))}};os.defaultProps={mode:"button",fileIcons:"file",renameBtn:!0,removeBtn:!0,draggable:!0,thumbnail:!0,maxFileCount:0},os.i18n=M_,os.imageAccepts="image/*,.png,.jpg,.jpeg,.gif";let ih=class extends os{};ih.defaultProps={...os.defaultProps,mode:"grid",accept:os.imageAccepts};const R_=Object.freeze(Object.defineProperty({__proto__:null,FileSelector:os,ImageSelector:ih},Symbol.toStringTag,{value:"Module"}));class wa extends Ee{}wa.NAME="FileSelector",wa.Component=os,wa.replace=!0;class Ca extends Ee{}Ca.NAME="ImageSelector",Ca.Component=ih,Ca.replace=!0,ut(R_);const Ek="",rh=class $y extends kt{_getClassName(e){const{type:t,stacked:n}=e;return[super._getClassName(e),t?`nav-${t}`:"",n?"nav-stacked":""]}static render(e,t,n,i){let r=typeof e=="function"?e.call(i??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),n&&(r=Ie(n,r)),k($y,{...r})}};rh.NAME="nav",rh.defaultItemProps={component:"li",innerComponent:"a"};let n0=rh;const L_=Object.freeze(Object.defineProperty({__proto__:null,Nav:n0},Symbol.toStringTag,{value:"Module"}));class oh extends Ee{}oh.NAME="Nav",oh.Component=n0,ut(L_);const Ak="",Tk="",$k="",Ik="",Bk="",Nk="",Fk="",Pk="",Mk="",Rk="",Lk="",zk="",Ok="";function $r(s,e){const t=s.pageTotal||Math.ceil(s.recTotal/s.recPerPage);return typeof e=="string"&&(e==="first"?e=1:e==="last"?e=t:e==="prev"?e=s.page-1:e==="next"?e=s.page+1:e==="current"?e=s.page:e=Number.parseInt(e,10)),e=e!==void 0?Math.max(1,Math.min(e<0?t+e:e,t)):s.page,{...s,pageTotal:t,page:e}}function s0({key:s,type:e,btnType:t,page:n,format:i,pagerInfo:r,linkCreator:o,...a}){const l=$r(r,n);return a.text===void 0&&!a.icon&&i&&(a.text=typeof i=="function"?i(l):Te(i,l)),a.url===void 0&&o&&(a.url=typeof o=="function"?o(l):Te(o,l)),a.disabled===void 0&&(a.disabled=n!==void 0&&l.page===r.page),A($e,{type:t,"z-go-to-page":l.page,...a})}function i0({key:s,type:e,page:t,text:n="",pagerInfo:i,children:r,...o}){const a=$r(i,t);return n=typeof n=="function"?n(a):Te(n,a),A(tt,{...o,children:[r,n]})}function z_({type:s,btnType:e,count:t=12,pagerInfo:n,linkCreator:i,...r}){if(!n.pageTotal)return;const o={...r,square:!0},a=()=>(o.text="",o.icon="icon-ellipsis-h",o.disabled=!0,A($e,{type:e,...o})),l=(h,u)=>{const f=[];for(let p=h;p<=u;p++){o.text=p,delete o.icon,o.disabled=!1;const g=$r(n,p);i&&(o.url=typeof i=="function"?i(g):Te(i,g)),f.push(A($e,{type:e,...o}))}return f};let c=[];return c=[...l(1,1)],n.pageTotal<=1||(n.pageTotal<=t?c=[...c,...l(2,n.pageTotal)]:n.page<t-2?c=[...c,...l(2,t-2),a(),...l(n.pageTotal,n.pageTotal)]:n.page>n.pageTotal-t+3?c=[...c,a(),...l(n.pageTotal-t+3,n.pageTotal)]:c=[...c,a(),...l(n.page-Math.ceil((t-4)/2),n.page+Math.floor((t-4)/2)),a(),...l(n.pageTotal,n.pageTotal)]),c}const Hk="";let O_=class extends ke{render(e){const{id:t,popup:n,title:i,content:r,style:o,className:a,closeBtn:l,arrow:c,headingClass:h,titleClass:u,contentClass:f,arrowStyle:p,onlyInner:g,footer:y,footerClass:v}=e;let b=A(Se,{content:r},"content");(f||i)&&(b=A("div",{className:f,children:b},"content"));let w=A(Se,{content:y},"footer");(v||i)&&(w=A("div",{className:v,children:w},"footer"));const S=[],E=l?A("button",{className:"btn ghost square size-sm btn-close","data-dismiss":"popover",children:A("span",{className:"close"})}):null;return i?S.push(A("div",{className:h,children:[i?A(Se,{className:u,content:i}):null,E]},"heading")):S.push(E),S.push(b,w),c&&S.push(A("div",{className:typeof c=="string"?c:"arrow",style:p},"arrow")),g?S:A("div",{id:t,className:ee("popover",a,{popup:n,"has-heading":i}),style:o,children:S})}};class ka extends Ee{}ka.NAME="PopoverPanel",ka.Component=O_;const r0="show",o0="in",Mi=class Iy extends Je{constructor(){super(...arguments),this._getClickBounding=()=>{const e=this._triggerEvent;return{x:e.clientX,y:e.clientY,left:e.clientX,top:e.clientY,width:0,height:0,bottom:e.clientY,right:e.clientX}}}get shown(){return this._shown}get id(){return this._id}get zIndex(){return this._zIndex}get trigger(){return this._triggerElement}get target(){return this._targetElement}afterInit(){const{trigger:e,id:t,triggerEvent:n}=this.options;this._triggerEvent=n,this._id=t||`popover_${this.gid}`;const i=this.getTriggerElement();if(i instanceof HTMLElement){const o=_(i),{namespace:a}=this;if(e){const l=()=>{let c=o.dataset();const h=o.attr(`zui-toggle-${this.constructor.ZUI}`);h&&(c=_.extend(c,$s(h))),this.setOptions(c)};e==="hover"?o.on(`pointerenter${a}`,c=>{o.is("[disabled],.disabled")||(l(),this.show({delay:!0,event:c}))}).on(`pointerleave${a} pointercancel${a}`,()=>{this.delayHide()}):o.on(`${e}${a}`,c=>{o.is("[disabled],.disabled")||(this.shown||l(),this.toggle({event:c,delay:!0}),c.preventDefault())})}}const{show:r}=this.options;r&&this.show({delay:typeof r=="number"?r:!1})}getTriggerElement(){if(!this._triggerElement){let{element:e=this.element}=this.options;e===document.body&&(e={getBoundingClientRect:this._getClickBounding}),this._triggerElement=e,this._virtual=!(e instanceof HTMLElement)}return this._triggerElement}initTarget(){let e=this.options.target;return this._dynamic=!e,e?(typeof e=="function"&&(e=e()),typeof e=="string"&&(e==="$next"?e=_(this._triggerElement).next():e.startsWith("$target:")&&(e=_(this._triggerElement).closest(e.slice(8)))),_(e)[0]):this._createTarget()}show(e){const{delay:t,event:n,hideOthers:i=this.options.hideOthers}=e||{};if(n&&(this._triggerEvent=n),t)return this._resetTimer(()=>{this.show()},t===!0?this.options.delay:t);if(!this.inited){this.setOptions({show:!0});return}if(this._shown)return;const r=this.initTarget();if(!r)return;this._targetElement=r;const o=_(r),{animation:a,onShow:l,onShown:c,trigger:h,elementShowClass:u}=this.options,{SHOWN_POPOVERS:f}=this.constructor;o.addClass(r0),a&&o.addClass(a===!0?"fade":a),this._zIndex=Iy.Z_INDEX++,this._shown=!0,this.render(),f.set(this.gid,this),l==null||l.call(this),this.emit("show"),i&&f.forEach(g=>{g!==this&&g.hide()});const{namespace:p}=this;h==="hover"&&(this._clearDelayHide(),o.off(p).on(`pointerenter${p}`,()=>{this._clearDelayHide()}).on(`pointerleave${p}`,()=>{this.delayHide()})),this._virtual||(o.attr("zui-commands-proxy","").data("zui.commandProxy",this._triggerElement),u&&_(this._triggerElement).addClass(u)),this._resetTimer(()=>{o.addClass(o0),this._resetTimer(()=>{c==null||c.call(this),this.emit("shown")},200)},50)}hide(e){(!this._shown||!this._targetElement)&&this._resetTimer();const{destroyOnHide:t,animation:n,onHide:i,onHidden:r,trigger:o,hideNewOnHide:a,elementShowClass:l}=this.options,c=_(this._targetElement),{SHOWN_POPOVERS:h}=this.constructor;if(this._shown=!1,h.delete(this.gid),i==null||i.call(this),this.emit("hide"),c.removeClass(o0),o==="hover"&&(this._clearDelayHide(),c.off(this.namespace)),!this._virtual){const u=_(this._triggerElement);u.removeAttr("zui-commands-proxy").removeData("zui.commandProxy"),l&&u.removeClass(l).removeAttr("data-pop-placement")}a&&h.forEach(u=>{u!==this&&u.zIndex>this.zIndex&&u.hide()}),this._resetTimer(()=>{r==null||r.call(this),this.emit("hidden"),c.removeClass(r0),(t||e)&&this._resetTimer(()=>{this.destroy()},!e&&typeof t=="number"?t:0),this._destoryTarget()},n&&!e?200:0)}toggle(e){this._shown?this.hide():this.show(e)}destroy(){if(super.destroy(),!this._virtual){const{namespace:e}=this;_(this._triggerElement).off(e)}this._resetTimer(),this._destoryTarget(),this._clearDelayHide()}layout(){const e=this._triggerElement,t=this._targetElement,n=this._layoutWatcher;if(!t||!e||!this._shown){n&&(n(),this._layoutWatcher=void 0);return}n||(this._layoutWatcher=Vp(e,t,()=>{if(this.destroyed||!this._shown)return;const{animation:i,name:r="popover",minWidth:o,minHeight:a,maxWidth:l,maxHeight:c,limitInScreen:h,onLayout:u}=this.options;if(!this._virtual){const f={minWidth:nt(o),minHeight:nt(a),maxWidth:nt(l),maxHeight:nt(c)},{width:p,height:g}=this.options;p&&(f.width=typeof p=="function"?p():p==="100%"?_(e).outerWidth():p),g&&(f.height=typeof g=="function"?g():g),Object.keys(f).length&&_(t).css(f)}Xc(...this._getLayoutOptions()).then(({x:f,y:p,middlewareData:g,placement:y,strategy:v})=>{if(e instanceof HTMLElement&&Jn(e)){this.hide(!0);return}const b={position:v,left:f,top:p},w=_(t).css(b);h&&w.css({top:Math.max(0,Math.min(window.innerHeight-w.outerHeight(),p)),left:Math.max(0,Math.min(window.innerWidth-w.outerWidth(),f))});const S=y.split("-")[0],E={top:"bottom",right:"left",bottom:"top",left:"right"}[S],$=g.arrow;$&&w.attr("data-pop-placement",S).find(".arrow").css({left:$.x,top:$.y}).attr("class",`arrow ${r}-arrow arrow-${E}`),i===!0&&w.attr("class",`${w.attr("class").split(" ").filter(B=>B!=="fade"&&!B.startsWith("fade-from")).join(" ")} fade-from-${E}`),this._virtual||_(this._triggerElement).attr("data-pop-placement",S),u&&u.call(this,{target:t,trigger:e,popSide:S,arrowSide:E,x:f,y:p,placement:y,strategy:v})})},{ancestorResize:!1}))}render(e){super.render(e);const t=this._targetElement;if(!t)return;const n=this._getRenderOptions(),i=_(t);if(i.z("popover",this.gid).toggleClass("popup",n.popup).css(n.style),n.className&&i.setClass(n.className),this._dynamic){let r=this._panel;r&&r.element!==t&&(r.destroy(),r=void 0),r?r.render(n):(r=new ka(t,n),r.on("inited",()=>this.layout())),this._panel=r}else n.arrow&&(i.find(".arrow").length||i.append(_('<div class="arrow"></div>').css(n.arrowStyle))),this.layout()}handleClickOutside(e){if(this.options.mask){const t=this._triggerElement;t instanceof HTMLElement&&_(e.target).closest(t).length||this.hide()}}handleClickTarget(e){}delayHide(e=100){this._resetTimer(),this._clearDelayHide(),this._hideTimer=window.setTimeout(()=>{this._hideTimer=0,this.hide()},e)}_clearDelayHide(){this._hideTimer&&(clearTimeout(this._hideTimer),this._hideTimer=0)}_getLayoutOptions(){const e=this._triggerElement,t=this._targetElement,{placement:n,flip:i,limitSize:r,shift:o,offset:a,arrow:l,strategy:c}=this.options,h=l?t.querySelector(".arrow"):null,u=h?typeof l=="number"?l:5:0,f=()=>typeof a=="function"?a:typeof a=="object"?{mainAxis:(a.mainAxis||0)+u,...a}:(a||0)+u;return[e,t,{placement:n,strategy:c,middleware:[i?Yc():null,o?Gc(typeof o=="object"?o:void 0):null,a||u?qc(f()):null,l?D_({element:h}):null,r?Kp({apply({availableWidth:p,availableHeight:g,placement:y}){_(t).css({maxHeight:g-(["top","bottom"].includes(y.split("-")[0])?u:0)-2,maxWidth:p-2})}}):null].filter(Boolean)}]}_getRenderOptions(){const{name:e="popover"}=this.options,{popup:t,title:n,content:i,headingClass:r=`${e}-heading`,titleClass:o=`${e}-title`,contentClass:a=`${e}-content`,style:l,className:c=e,closeBtn:h,arrow:u,footer:f,footerClass:p=`${e}-footer`}=this.options;return{popup:t,title:n,titleClass:o,headingClass:r,contentClass:a,content:i,style:{zIndex:this._zIndex,...l},className:c,closeBtn:h,arrow:u?`arrow ${e}-arrow`:!1,arrowStyle:{"--arrow-size":`${typeof u=="number"?u:5}px`},onlyInner:!0,footer:f,footerClass:p}}_destoryTarget(){var e,t,n;(e=this._layoutWatcher)==null||e.call(this),this._layoutWatcher=void 0,this._dynamic&&((t=this._panel)==null||t.destroy(),(n=this._targetElement)==null||n.remove(),this._panel=void 0,this._targetElement=void 0)}_resetTimer(e,t=0){this._timer&&clearTimeout(this._timer),e&&(this._timer=window.setTimeout(()=>{this._timer=0,e()},t))}_createTarget(){const{container:e="body"}=this.options,t=_(e);let n=t.find(`#${this._id}`);return n.length||(n=_("<div />").attr({id:this._id,class:"popover"}).appendTo(t)),n[0]}static show(e){const{element:t,event:n,...i}=e,r=t||(n==null?void 0:n.currentTarget);return this.ensure(r instanceof HTMLElement?r:document.body,{element:r,show:!0,destroyOnHide:!0,triggerEvent:n,...i})}};Mi.NAME="Popover",Mi.Z_INDEX=1700,Mi.MULTI_INSTANCE=!0,Mi.DEFAULT={placement:"top",strategy:"absolute",flip:!0,arrow:!0,offset:1,trigger:"click",mask:!0,delay:0,animation:!0,closeBtn:!0,popup:!0,elementShowClass:"with-popover-show",hideNewOnHide:!0},Mi.SHOWN_POPOVERS=new Map;let Yt=Mi;Yt.toggle={trigger:["click","hover"],convertHref:{selector:"target"},check(s,e){const t=_(s);return t.data(this.KEY)?!1:e==="hover"?(t.dataset("trigger")||this.DEFAULT.trigger)==="hover":!0},getOptions(s,e,t){return{triggerEvent:t,...e}},onToggle(s,e,t){s.toggle({event:t})}},Yt.register(),_(()=>{_(document).on(`click.${Yt.NAMESPACE}`,s=>{const{SHOWN_POPOVERS:e}=Yt;if(!e.size)return;const t=_(s.target),n=t.closest("[z-popover]"),i=n.length?n.z("popover"):0,r=i?e.get(i):null;if(r){const a=r.options.name??r.constructor.ZUI;if(t.closest(`[data-dismiss="popover"],[data-dismiss="${a}"]`).length){r.hide();return}if(r.handleClickTarget(s))return}const o=[...e.values()].sort((a,l)=>l.zIndex-a.zIndex);for(const a of o)if(a!==r&&a.handleClickOutside(s))return})}),Object.assign(window,{Popover:Yt});const jk="";class Dn extends Yt{handleClickTarget(e){const t=_(e.target),{notHideOnClick:n}=this.options;return(!n||!t.closest(n).length)&&this.hide(),!0}_getMenuOptions(){const{items:e,placement:t,menu:n,tree:i,onClickItem:r,relativeTarget:o=this._triggerElement}=this.options;return{items:e,placement:t,tree:i,onClickItem:r,nestedToggle:".item",accordion:!0,relativeTarget:{target:o,event:this.options.triggerEvent,dropdown:this},dropdown:this,popup:!0,...n}}_getRenderOptions(){const e=super._getRenderOptions();return this._dynamic?{...e,contentClass:"",popup:!1,content:k(Sa,this._getMenuOptions())}:e}}Dn.NAME="Dropdown",Dn.DEFAULT={...Yt.DEFAULT,name:"dropdown",placement:"bottom-start",arrow:!1,closeBtn:!1,animation:"fade",limitSize:!0,notHideOnClick:".not-hide-menu,.form-control,input,label,.nested-toggle-icon"},Dn.toggle={...Yt.toggle,getOptions(s,e,t){return e=Yt.toggle.getOptions.call(this,s,e,t),!e.target&&!e.items&&!e.menu&&(e.target=_(s).next(".dropdown-menu")),e}},Dn.register();class as extends $e{constructor(){super(...arguments),this._ref=Ce()}get triggerElement(){return this._ref.current}_updateData(){const{dropdown:e,menu:t,items:n,onClickItem:i,relativeTarget:r=this.triggerElement}=this.props,o=Dn.get(this.triggerElement),a={items:n,onClickItem:i,menu:t,relativeTarget:r,..._(this.triggerElement).dataset(),...e};o?o.setOptions(a):new Dn(this.triggerElement,a)}componentDidMount(){this._updateData()}componentDidUpdate(){this._updateData()}componentWillUnmount(){var e;(e=Dn.get(this.triggerElement))==null||e.destroy()}_getProps(e){const{trigger:t,placement:n}=e;return{...super._getProps(e),"data-toggle":"dropdown","data-trigger":t,"data-placement":n,ref:this._ref}}}as.defaultProps={caret:!0},Object.assign(cn.ItemComponents,{dropdown:as}),Object.assign(Xe.ItemComponents,{dropdown:as});class Sa extends vt{constructor(){super(...arguments),this._handleSearchFocus=()=>{this._searchFocused=!0},this._handleSearchBlur=()=>{this._searchFocused=!1}}get isHoverTrigger(){const{nestedTrigger:e,tree:t}=this.props;return e?e==="hover":!t}get dropdown(){return this.props.dropdown}layout(){var h;if(this.props.tree||this.isRoot)return;const e=(h=this.element)==null?void 0:h.parentElement,t=_(e);e&&this._searchFocused&&this._position&&t.css(this._position);const r=t.parent().children(".dropdown-menu").children(`[z-key-path="${this.props.parentKey}"]`)[0];if(!e||!r)return;let{maxHeight:o}=this.props;const{flip:a,shift:l,offset:c}=this.props;Xc(r,e,{placement:this.props.placement,middleware:[a?Yc():null,l?Gc(typeof l=="object"?l:void 0):null,qc(c),Kp({apply({availableWidth:u,availableHeight:f}){if(o){const[p,g]=Fs(o);o=Math.min(g==="%"?p*window.innerHeight:p,f-2)}else o=f;t.css({maxHeight:o,maxWidth:u-2})}})]}).then(({x:u,y:f})=>{t.css({left:u,top:f}),this._position={left:u,top:f,width:e.offsetWidth,height:e.offsetHeight}})}_getClassName(e){return["dropdown-menu scrollbar-hover scrollbar-thin",super._getClassName(e)]}_afterRender(e){super._afterRender(e),this.layout()}_getNestedProps(e,t,n,i){return Ie(this.isHoverTrigger?{"z-key":n.key,"z-hover":this.props.parentKey??"root",onMouseEnter:this._handleHover,onMouseLeave:this._handleHover}:{},super._getNestedProps(e,t,n,i))}_getItemFromEvent(e){const t=super._getItemFromEvent(e);if(t)return t;const n=_(e.target).closest(".dropdown-menu[z-key]");if(n.length){const i=n.attr("z-key"),r=n.parent().parent().children(".dropdown-menu").children(`[z-key="${i}"]`);if(r.length)return super._getItemFromEvent(e,r[0])}}_renderNestedList(e,t,n,i){const r=super._renderNestedList(e,t,n,i);if(this.props.tree)return r;this._nestedContextMenu.push(r)}_getWrapClass(e){return[super._getWrapClass(e),e.tree?"is-tree":this.isRoot?"is-contextmenu":"is-contextmenu popup"]}_renderWrapperFooter(e){const t=super._renderWrapperFooter(e),n=this._nestedContextMenu;return this.props.tree||!n.length?t:[t,...n]}_renderNestedToggle(e,t){if(this.props.tree)return super._renderNestedToggle(e,t);if(typeof t=="boolean")return A("span",{className:`${this.name}-toggle nested-toggle-icon`,children:A("span",{className:"caret-right"})})}_getSearchBoxProps(e){return{...super._getSearchBoxProps(e),onFocus:this._handleSearchFocus,onBlur:this._handleSearchBlur}}_beforeRender(e){return this._nestedContextMenu=[],super._beforeRender(e)}}Sa.defaultProps={...vt.defaultProps,searchBox:!1,placement:"right-start",defaultNestedShow:!1,expandOnSearch:!1,nestedSearch:!1,flip:!0,shift:!0,offset:1},Sa.inheritNestedProps=[...vt.inheritNestedProps,"container","tree"];const H_=Object.freeze(Object.defineProperty({__proto__:null,DropdownButton:as,DropdownMenu:Sa},Symbol.toStringTag,{value:"Module"}));function j_({type:s,pagerInfo:e,linkCreator:t,items:n=[5,10,15,20,25,30,35,40,45,50,100,200,500,1e3,2e3],dropdown:i={},menu:r,itemProps:o,...a}){var c;i.items=n.map(h=>{const u={...e,recPerPage:h};return{...o,key:h,text:`${h}`,active:h===e.recPerPage,url:t?typeof t=="function"?t(u):Te(t,u):void 0,"z-change-page-size":h}});const{text:l=""}=a;return a.text=typeof l=="function"?l(e):Te(l,e),i.menu={...r,...i.menu,className:ee((c=i.menu)==null?void 0:c.className,"pager-size-menu")},A(as,{dropdown:i,...a})}function a0({key:s,page:e,type:t,btnType:n,pagerInfo:i,size:r,onClick:o,onChange:a,linkCreator:l,...c}){const h={...c};let u;const f=y=>{var v;u=Number((v=y.target)==null?void 0:v.value)||1,u=u>i.pageTotal?i.pageTotal:u},p=y=>{if(!(y!=null&&y.target))return;u=u<=i.pageTotal?u:i.pageTotal;const v=$r(i,u);a&&!a({info:v,event:y})||(y.target.href=h.url=typeof l=="function"?l(v):Te(l,v))},g=$r(i,e||0);return h.url=typeof l=="function"?l(g):Te(l,g),A("div",{className:ee("input-group","pager-goto-group",r?`size-${r}`:""),children:[A("input",{type:"number",class:"form-control",max:i.pageTotal,min:"1",onInput:f}),A($e,{type:n,...h,onClick:p})]})}const Da=class Hd extends Xe{constructor(){super(...arguments),this._pagerChanges=at({}),this._changedPager=Ye(()=>Hd.format({...this.props,...this._pagerChanges.value})),this._changeEffect=ln(()=>{const{onChangePageInfo:e}=this.props,t=this._changedPager.value;e&&this._changeEvent&&(e(t,this._changeEvent),this._changeEvent=void 0)}),this._handleClickLink=e=>{const t=_(e.currentTarget);if(t.is(".disabled"))return;const n=t.z("goToPage");typeof n=="number"&&(this._changeEvent=e,this._pagerChanges.value={...this._pagerChanges.value,page:n})},this._handleClickSizeMenu=e=>{const{item:t}=e,n=t["z-change-page-size"];typeof n=="number"&&!t.disabled&&(this._changeEvent=e.event,this._pagerChanges.value={...this._pagerChanges.value,recPerPage:n})}}_isBtnType(e){const{type:t}=e;return super._isBtnType(e)||["link","nav","size-menu","goto"].includes(t)}componentDidUpdate(e){if(this.props.useState)this.props.recTotal!==e.recTotal&&(this._pagerChanges.value={...this._pagerChanges.value,recTotal:this.props.recTotal});else{const{page:t,recTotal:n,recPerPage:i}=this.props;(t!==e.page||n!==e.recTotal||i!==e.recPerPage)&&(this._pagerChanges.value={})}}componentWillUnmount(){this._changeEffect()}_beforeRender(e){return this._pagerInfo=e.useState?this._changedPager.value:Hd.format(e),super._beforeRender(e)}_getItem(e,t,n){const i=super._getItem(e,t,n);if(!i)return!1;const{type:r="item"}=t,o=this._pagerInfo;return r==="info"?_.extend(i,{pagerInfo:o}):(r==="link"||r==="size-menu"||r==="nav"||r==="goto")&&_.extend(i,{pagerInfo:o,linkCreator:e.linkCreator}),r==="size-menu"&&(i.menu={onClickItem:this._handleClickSizeMenu,...i.menu}),r==="link"&&(i.onClick=this._handleClickLink),i}static format(e){const{page:t=1,recTotal:n=0,recPerPage:i=10}=e,r=Math.max(0,+n),o=Math.max(1,+i),a=o?Math.ceil(r/o):0;return{page:Math.min(Math.max(1,+t),a),recTotal:r,recPerPage:o,pageTotal:a}}};Da.NAME="pager",Da.ItemComponents={...Xe.ItemComponents,info:i0,link:s0,nav:z_,"size-menu":j_,goto:a0},Da.defaultItemProps={btnType:"ghost",size:"sm"};let Ir=Da;class ah extends Ee{}ah.NAME="Pager",ah.Component=Ir,ut(Object.freeze(Object.defineProperty({__proto__:null,Pager:Ir,PagerGoto:a0,PagerInfoItem:i0,PagerLink:s0},Symbol.toStringTag,{value:"Module"})));const Uk="",Vk="";class Ea extends Ee{}Ea.NAME="Pick",Ea.Component=xt,Ea.replace=!0;const Kk="",qk="",Gk="",Yk="";class lh extends ke{constructor(e){super(e),this._searchInput=Ce(),this._measure=Ce(),this._changeTimer=0,this._handleChange=t=>{if(t.isComposing)return;const n=t.target.value;this.setState({search:n},()=>{const{onSearch:i}=this.props;i&&(this._changeTimer&&clearTimeout(this._changeTimer),this._changeTimer=window.setTimeout(()=>{this._changeTimer=0,i(n)},this.props.debounce||300))}),t.stopPropagation()},this._handleClear=t=>{t.stopPropagation(),this.clear()},this.state={search:e.defaultSearch??""}}get $pop(){return _(`#pick-pop-${this.props.id}`)}focus(){var e;(e=this._searchInput.current)==null||e.focus()}setSearch(e,t=!0){var i,r,o,a;if(!e.length&&this.state.search.length&&((r=(i=this.props).onClear)==null||r.call(i)),((o=this._searchInput.current)==null?void 0:o.value)===e){t&&this.focus();return}_((a=this._searchInput)==null?void 0:a.current).val(e).trigger("change"),t&&this.focus()}clear(){this.setSearch("")}componentDidMount(){this.focus();const{hotkeys:e}=this.props;if(e){const t=rc(e,{clear:{keys:"Escape",handler:()=>{this.state.search.trim().length?this.clear():this.$pop.trigger("hidePop")}},enter:{keys:"Enter",handler:n=>{n.preventDefault(),this.$pop.trigger("selectActive"),this.clear()}},activeNext:{keys:"ArrowDown",handler:()=>{this.$pop.trigger("activeNext")}},activePrev:{keys:"ArrowUp",handler:()=>{this.$pop.trigger("activePrev")}},deselectLast:{keys:"Backspace",handler:()=>{this.state.search.trim().length||this.$pop.trigger("deselectLast")}}});t&&(this._hotkeysScope=`PickerSearch_${Bt()}`,_(this._searchInput.current).hotkeys(t,{scope:this._hotkeysScope,event:"keydown"}))}_(this._searchInput.current).on("compositionend",this._handleChange)}componentDidUpdate(){const{inline:e}=this.props;if(e){const{current:t}=this._measure,{current:n}=this._searchInput;if(t&&n){const i=_(n).parent();i.width(Math.ceil(Math.min(t.clientWidth,i.closest(".picker").outerWidth()-32)))}}}componentWillUnmount(){clearTimeout(this._changeTimer),this._hotkeysScope&&_(this._searchInput.current).unbindHotkeys(this._hotkeysScope),_(this._searchInput.current).off("compositionend",this._handleChange)}render(e,t){const{placeholder:n,inline:i}=e,{search:r}=t,o=r.trim().length>0;let a;return i?a=A("div",{className:"picker-search-measure",ref:this._measure,children:r}):o?a=A("button",{type:"button",className:"btn picker-search-clear square size-sm ghost",onClick:this._handleClear,children:A("span",{className:"close"})}):a=A("span",{className:"magnifier"}),A("div",{className:`picker-search${i?" is-inline":""}`,children:[A("input",{className:"form-control picker-search-input",type:"text",placeholder:n,value:r,autoComplete:"off",onChange:this._handleChange,onInput:this._handleChange,ref:this._searchInput}),a]})}}class l0 extends oa{constructor(){super(...arguments),this._search=Ce(),this._handleDeselectClick=e=>{const{onDeselect:t,state:{selections:n}}=this.props,i=_(e.target).closest(".picker-deselect-btn").attr("data-value");t&&n.length&&typeof i=="string"&&t(i),e.stopPropagation()},this._handleSearch=e=>{this.props.changeState({search:e})},this._handleSearchClear=()=>{this.props.togglePop(!0,{search:""})},this._renderSelection=e=>{const{text:t}=e;return A("div",{className:"picker-multi-selection",title:typeof t=="string"?t:void 0,children:[A("span",{className:"text",children:A(Se,{content:t})}),this.props.disabled||this.props.readonly?null:A("div",{className:"picker-deselect-btn btn size-xs ghost",onClick:this._handleDeselectClick,"data-value":e.value,children:A("span",{className:"close"})})]},e.value)}}get searchBox(){return this._search.current}_handleClick(e){var t;super._handleClick(e),(t=this._search.current)==null||t.focus()}_getClass(e){return ee(super._getClass(e),e.search?"":"picker-no-search","picker-select picker-select-multi form-control")}_renderSearch(e){const{state:{search:t},searchHint:n,hotkeys:i}=e;return A(lh,{inline:!0,id:e.id,ref:this._search,defaultSearch:t,onSearch:this._handleSearch,onClear:this._handleSearchClear,placeholder:n,hotkeys:i})}_renderTrigger(e){const{state:{selections:t=[],open:n,value:i},search:r,placeholder:o,display:a,valueList:l,children:c,caretClass:h}=this.props,u=n&&r;let f;const p=!u&&!t.length;return a&&(!p||o===void 0)?(typeof a=="function"?f=a.call(this,l,t):typeof a=="string"&&(f=Te(a,{value:i,values:l,count:l.length})),f=A("div",{className:"picker-multi-selections",children:f},"selections")):p?f=A("span",{className:"picker-select-placeholder",children:o},"selections"):f=A("div",{className:"picker-multi-selections",children:[t.map(this._renderSelection),u?this._renderSearch(e):null]},"selections"),[f,c,A("span",{class:ee("caret",h)},"caret")]}_renderValue(e){const{name:t,state:{value:n=""},disabled:i,readonly:r,id:o,valueList:a,emptyValue:l}=e;if(t)if(this.hasInput)_(`#${o}`).val(n);else{const c=a.length?a:[l];return A("select",{id:o,multiple:!0,className:"pick-value",name:t.endsWith("[]")?t:`${t}[]`,disabled:i,readonly:r,style:{display:"none"},children:c.map(h=>A("option",{value:h,children:h},h))})}return null}componentDidMount(){super.componentDidMount();const{id:e,valueList:t,emptyValue:n}=this.props;_(`#${e}`).val(t.length?t:[n])}componentDidUpdate(e){const{id:t,state:n,name:i,valueList:r,emptyValue:o}=this.props;if(i&&e.state.value!==n.value){const a=_(`#${t}`).val(r.length?r:[o]);this._skipTriggerChange!==n.value&&a.trigger("change",Ip),this._skipTriggerChange=!1}}}class c0 extends oa{constructor(){super(...arguments),this._search=Ce(),this._handleDeselectClick=e=>{this.props.disabled||(this.props.onClear(),e.stopPropagation())},this._handleSearch=e=>{this.props.changeState({search:e})},this._handleSearchClear=()=>{this.props.togglePop(!0,{search:""})}}get searchBox(){return this._search.current}_getSearchPlaceholder(){const{searchHint:e,state:{value:t,selections:n}}=this.props;let i=e;if(i===void 0){const r=n.find(o=>o.value===t);r&&typeof r.text=="string"&&(i=r.text)}return i}_handleClick(e){var t;super._handleClick(e),(t=this._search.current)==null||t.focus()}_getClass(e){return ee(super._getClass(e),e.search?"":"picker-no-search","picker-select picker-select-single form-control")}_renderSearch(e){const{state:{search:t},hotkeys:n}=e;return A(lh,{ref:this._search,id:e.id,defaultSearch:t,onSearch:this._handleSearch,onClear:this._handleSearchClear,placeholder:this._getSearchPlaceholder(),hotkeys:n})}_renderTrigger(e){const{children:t,state:{selections:n=[],value:i,open:r},placeholder:o,search:a,disabled:l,readonly:c,clearable:h,display:u,caretClass:f}=e,[p]=n,g=r&&a;let y;if(g)y=this._renderSearch(e);else if(p||o===void 0&&u){const{text:w}=p||{text:"",value:""};typeof u=="function"?y=u.call(this,i,n):typeof u=="string"?y=Te(u,p):y=A(Se,{content:w}),y=A("span",{className:"picker-single-selection",title:typeof w=="string"?w:void 0,children:y},"main")}else y=A("span",{className:"picker-select-placeholder",children:o},"main");const v=h&&!g?A("button",{type:"button",className:"btn picker-deselect-btn size-xs square ghost",disabled:l,readonly:c,onClick:this._handleDeselectClick,children:A("span",{className:"close"})},"deselect"):null,b=g?null:A("span",{className:ee("caret flex-none",f)},"caret");return[y,t,v,b]}}function h0(s,e){return s.reduce((t,n)=>(Array.isArray(n.items)&&h0(n.items,t),typeof n.value=="string"&&t.set(n.value,n),t),e||new Map)}class u0 extends Zc{constructor(){super(...arguments),this._menu=Ce(),this._disabledSet=new Set,this._getItem=(e,t)=>{var c;if(e.parentKey!==void 0)return e;const n=new Set(this.props.valueList);let i=e.items,r=!1,o=!1;Array.isArray(i)&&this.props.multiple&&(r=!0,i=i.reduce((h,u,f)=>{const p=this._getItem(u,f);return p&&(p.selected?o=!0:r=!1,h.push(p)),h},[]));const a=r||n.has(e.value);e={selected:a,hint:typeof e.text=="string"?e.text:void 0,...e,checked:this._hasCheckbox||typeof e.checked=="boolean"?r?!0:o?"indeterminate":a:void 0,className:ee(e.className,{hover:e.value!==void 0&&e.value===this.props.state.hoverItem}),items:i},e.content&&e.text&&delete e.text;const l=((c=this._getItemCallback)==null?void 0:c.call(this,e,t))??e;return l&&((l.disabled||l.value===void 0)&&(l.hover===void 0&&(l.hover=!1),l.disabled===void 0&&(l.disabled=!0),this._disabledSet.add(l.value)),a&&!l.disabled&&l.value!==void 0&&this._firstSelected===void 0&&(this._firstSelected=l.value),l)},this._beforeRenderItem=(e,t)=>{var n;return(n=this._renderItemCallback)==null?void 0:n.call(this,e,t)},this._handleItemClick=({item:e,event:t})=>{const n=e.value,i=t.target;if(e.disabled||n===void 0||i.closest(".item-icon,.nested-toggle-icon,.disabled")||Array.isArray(e.items)&&e.items.every(a=>this._disabledSet.has(a.value)))return;const{multiple:r,onPick:o}=this.props;if(r)if(e.items){const l=[...h0(e.items).values()].filter(c=>!c.items&&!this._disabledSet.has(c.value)).map(c=>c.value);_(i).closest(".item").children(".item-inner.selected").length?o({diselect:l}):o({select:l})}else o({toggle:n});else o({select:n})}}get menu(){return this._menu.current}get picker(){return this.props.picker}componentDidMount(){var e,t;super.componentDidMount(),this._firstSelected===void 0?(e=this.menu)==null||e.activeNext():(t=this.menu)==null||t.toggleActive(this._firstSelected,!0),_(this.element).on("activeNext.zui.Picker",()=>{var n;(n=this.menu)==null||n.activeNext()}).on("activePrev.zui.Picker",()=>{var n;(n=this.menu)==null||n.activePrev()}).on("selectActive.zui.Picker",()=>{const n=this.menu;if(!n)return;const i=n.getActiveKey();if(i!==void 0){const r=n.getRenderedItem(i);r&&_(this.element).find(`.item[z-key-path="${r._keyPath}"]`).trigger("click")}}).on("hidePop.zui.Picker",()=>{this.props.togglePop(!1)}).on("deselectLast.zui.Picker",()=>{if(this.props.multiple){const{valueList:n}=this.props,i=n[n.length-1];i&&this.props.onDeselect(i)}}),setTimeout(()=>{var n;_((n=this.menu)==null?void 0:n.element).find(".menu-item>.selected").scrollIntoView({block:"center"})},100)}componentWillUnmount(){super.componentWillUnmount(),_(this.element).off(".zui.Picker")}_getClass(e){return ee(super._getClass(e),"picker-menu")}_getMenuProps(e){const{menu:t,tree:n,state:i,checkbox:r,header:o,footer:a,noMatchHint:l,maxItemsCount:c,exceedLimitHint:h}=e,{items:u,search:f}=i;return Ie({ref:this._menu,className:"picker-menu-list",underlineKeys:!0,limit:c,items:u,defaultNestedShow:!0,activeOnHover:!0,search:f,exceedLimitHint:h,onClickItem:this._handleItemClick,nestedToggle:".nested-toggle-icon,.item-icon",checkbox:r,searchProps:["keys","text","title","subtitle","value"],header:o,footer:a,noMatchHint:l,relativeTarget:this},t,n)}_renderPop(e){const{tree:t}=e;this._firstSelected=void 0,this._disabledSet.clear();const n=this._getMenuProps(e);return this._hasCheckbox=!!n.checkbox,this._getItemCallback=n.getItem,this._renderItemCallback=n.beforeRenderItem,n.getItem=this._getItem,n.beforeRenderItem=this._beforeRenderItem,t?A(Rs,{...n}):A(vt,{...n})}}function Os(s,e){return s.reduce((t,n)=>(Array.isArray(n.items)&&Os(n.items,t),t.set(n.value===void 0?"":String(n.value),n),t),e||new Map)}let fn=class extends xt{constructor(e){super(e),this._updateTimer=0,this.toggleValue=(t,n)=>{if(!this.props.multiple)return n||t!==this.value?this.setValue(t):this.setValue();const{valueList:i}=this,r=i.indexOf(t);if(n!==r>=0)return r>-1?i.splice(r,1):i.push(t),this.setValue(i)},this.deselect=(t=[])=>{const{valueList:n}=this,i=new Set(this.formatValueList(t)),r=n.filter(o=>!i.has(o));this.setValue(r)},this.clear=()=>{this.setValue()},this.select=t=>{const n=this.formatValueList(t),i=this.props.multiple?[...this.valueList,...n]:n[0];return this.setValue(i)},this.isSelected=t=>this.valueList.includes(t),this._handlePickValue=t=>{var o,a;const{toggle:n,select:i,diselect:r}=t;n!==void 0?this.toggleValue(n):i!==void 0?this.select(i):r!==void 0&&this.deselect(r),this.props.multiple?this.props.clearSearchOnSelect&&((o=this.state.search)!=null&&o.length)&&this.focusSearch(""):(this.toggle(!1),(a=this.searchBox)==null||a.clear())},this.setValue=this.setValue.bind(this),this.isEmptyValue=this.isEmptyValue.bind(this)}get valueList(){return this.formatValueList(this.state.value)}get firstEmptyValue(){return this._emptyValueSet.values().next().value}get searchBox(){var e;return(e=this.trigger)==null?void 0:e.searchBox}focusSearch(e){const{searchBox:t}=this;t&&(typeof e=="string"?t.setSearch(e):t.focus())}getDefaultState(e){const{items:t,valueSplitter:n=",",emptyValue:i=""}=e||this.props,r={...super.getDefaultState(e),loading:!1,search:"",items:Array.isArray(t)?t:[],selections:[]};if(this._emptyValueSet=new Set(typeof i=="string"?i.split(n):[]),Array.isArray(t)&&t.length){const{limitValueInList:o,required:a,multiple:l}=this.props;if(t.forEach(c=>{typeof c.value=="number"&&(c.value=String(c.value))}),o){const c=Os(t);r.value=this.formatValueList(r.value,n).filter(h=>c.has(h)).join(n),a&&!l&&!this.formatValueList(r.value,n).length&&(r.value=t[0].value??"")}}return r}isEmptyValue(e){return this._emptyValueSet.has(e)}deselectAll(){this.setValue([])}selectAll(){const{items:e}=this.state;if(!Array.isArray(e))return;const n=[...Os(e).values()].reduce((i,r)=>(r.disabled||i.push(r.value),i),[]);return this.select(n)}isSelectedAll(){const{items:e}=this.state;if(!Array.isArray(e))return!1;const t=Os(e),n=new Set(this.valueList);return[...t.values()].every(i=>i.disabled||n.has(i.value))}async load(){let e=this._abort;e&&e.abort();const{items:t=[],searchDelay:n}=this.props,{search:i=""}=this.state;let r=[];if(Array.isArray(t))r=t;else{if(e=new AbortController,this._abort=e,await Is(n||500),this._abort!==e)return r;let o=t;if(typeof o=="string"&&(o={url:o}),typeof o=="object"&&o.url&&(o={...o,url:Te(o.url,{search:encodeURIComponent(i)})}),r=await Et(o,[this,i],{signal:e.signal}),this._abort!==e)return r}return this._abort=void 0,r}changeState(e,t){return super.changeState(n=>{const i=typeof e=="function"?e(n):e;if(i.value!==void 0&&i.value!==n.value||i.items&&i.items!==n.items){const r=i.items||n.items,o=new Map;Array.isArray(n.items)&&n.items!==i.items&&Os(n.items,o),Array.isArray(r)&&(Os(r,o),i.selections=this.formatValueList(i.value??n.value).reduce((a,l)=>(this.isEmptyValue(l)||a.push(o.get(l)||{value:l,text:l}),a),[]))}return i},t)}async update(e){const{state:t,props:n}=this,i=this._itemsCacheInfo||{},r={};if(this._itemsCacheInfo=i,!t.loading&&(e||i.search!==t.search||n.items!==i.items)){await this.changeState({loading:!0});let a=await this.load();const l=c=>c.filter(h=>(h.key=h.key??h.value,typeof h.value=="number"&&(h.value=String(h.value)),this.isEmptyValue(h.value)?!1:(Array.isArray(h.items)&&(h.items=l(h.items)),!0)));a=l(a),r.loading=!1,r.items=a,i.items=n.items,i.search=t.search}else i.items&&!t.open&&n.cache===!1&&!Array.isArray(n.items)&&(i.items=void 0);(e||i.value!==t.value)&&(i.value=t.value);const o=r.items;n.required&&!n.multiple&&this.isEmptyValue(this.state.value)&&Array.isArray(o)&&o.length&&(r.value=o[0].value),Object.keys(r).length&&await this.changeState(r)}async tryUpdate(){this._updateTimer&&clearTimeout(this._updateTimer),this._updateTimer=window.setTimeout(()=>{this._updateTimer=0,this.update()},50)}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.tryUpdate()}componentDidMount(){super.componentDidMount(),this.tryUpdate()}componentWillUnmount(){var e;(e=this._abort)==null||e.abort(),this._abort=void 0,this._itemsCacheInfo=void 0,clearTimeout(this._updateTimer),super.componentWillUnmount()}_handleChange(e,t){if(super._handleChange(e,t),e!==t){const{onDeselect:n,onSelect:i,onClear:r,multiple:o}=this.props,a=this.formatValueList(t),l=this.valueList;if(r&&!l.length&&a.length&&r.call(this),n){const c=a.filter(h=>!l.includes(h));c.length&&n.call(this,o?c:c[0])}if(i){const c=l.filter(h=>!a.includes(h));c.length&&i.call(this,o?c:c[0])}}}_getTriggerProps(e,t){return{...super._getTriggerProps(e,t),multiple:e.multiple,hotkeys:e.hotkeys,placeholder:e.placeholder,search:e.search,display:e.display,searchHint:e.searchHint,caretClass:e.caretClass,clearable:!!this.valueList.length&&!e.required,valueList:this.valueList,emptyValue:this.firstEmptyValue,onDeselect:this.deselect,onSelect:this.select,onClear:this.clear,onToggleValue:this.toggleValue,onSetValue:this.setValue}}_getPopProps(e,t){return{...super._getPopProps(e,t),picker:this,menu:e.menu,tree:e.tree,checkbox:e.checkbox,multiple:e.multiple,search:e.search,maxItemsCount:e.maxItemsCount,footer:this._renderToolbar(),valueList:this.valueList,noFlipAfterShow:!0,noMatchHint:t.loading?Oe.getLang("loadingHint"):e.searchEmptyHint??Oe.getLang("searchEmptyHint"),exceedLimitHint:e.exceedLimitHint??Oe.getLang("exceedLimitHint"),onDeselect:this.deselect,onSelect:this.select,onClear:this.clear,onToggleValue:this.toggleValue,onSetValue:this.setValue,onPick:this._handlePickValue}}_getTrigger(e){return e.Trigger||(e.multiple?l0:c0)}_renderToolbar(){let{toolbar:e}=this.props;return e?(e===!0&&(e=[{key:"selectAll",text:Oe.getLang("selectAll")},{key:"cancelSelect",text:Oe.getLang("cancelSelect")}]),Xe.render(e,[],{size:"sm",relativeTarget:this,getItem:t=>(t.onClick||(t.key==="selectAll"?(t.onClick=this.selectAll.bind(this),t.disabled=this.isSelectedAll()):t.key==="cancelSelect"&&(t.onClick=this.deselectAll.bind(this),t.disabled=!this.valueList.length)),t)},this)):null}formatValueList(e,t){let n;return typeof e=="string"&&e.length?n=e.split(t??this.props.valueSplitter??","):Array.isArray(e)?n=e:n=[e],_.unique(n).reduce((i,r)=>(r==null||(r=typeof r!="string"?String(r):r,this.isEmptyValue(r)||i.push(r)),i),[])}formatValue(e){const t=this.formatValueList(e);return t.length?t.join(this.props.valueSplitter??","):this.firstEmptyValue}setValue(e=[],t){let n=this.formatValueList(e);if(n.length){const{items:r,limitValueInList:o}=this.props;if(o){const a=Os(Array.isArray(r)?r:this.state.items);n=n.filter(l=>a.has(l))}}const i=this.formatValue(n);return super.setValue(i,t)}};fn.defaultProps={...xt.defaultProps,className:"picker",valueSplitter:",",limitValueInList:!0,search:!0,emptyValue:"",cache:!0,hotkeys:!0,clearSearchOnSelect:!0},fn.Pop=u0;const W_=Object.freeze(Object.defineProperty({__proto__:null,Picker:fn,PickerMenu:u0,PickerMultiSelect:l0,PickerSearch:lh,PickerSingleSelect:c0},Symbol.toStringTag,{value:"Module"}));class Aa extends Ee{}Aa.NAME="Picker",Aa.Component=fn,Aa.register(),Oe.addLang({zh_cn:{selectAll:"全选",cancelSelect:"取消选择",searchEmptyHint:"无匹配选项",loadingHint:"正在加载...",exceedLimitHint:"还有 {0} 个选项没有显示，可尝试搜索来查找"},zh_tw:{selectAll:"全選",cancelSelect:"取消選擇",searchEmptyHint:"無匹配選項",loadingHint:"正在載入...",exceedLimitHint:"還有 {0} 個選項沒有顯示，可嘗試搜索來查找"},en:{selectAll:"Select All",cancelSelect:"Cancel Select",searchEmptyHint:"No matching options",loadingHint:"Loading...",exceedLimitHint:"There are {0} items not displayed, try searching to find"}}),ut(W_);class Ta extends Ee{}Ta.NAME="SearchBox",Ta.Component=Ms,Ta.register(),ut(Ax);const Xk="";function ch(s,e){const[t,n]=Fs(s);return n==="%"?e*t/100:t}const d0="is-sidebar-resizing",f0="has-sidebar-animation",hh="is-animating",$a=".sidebar-gutter";class Ia extends Je{get side(){return this._side}get width(){return this._width}get $parent(){const{parent:e}=this.options;return e?_(e):this.$element.parent()}afterInit(){const{$element:e}=this,t=e.parent(),n=t[0],i=t.width();this._container=n;const{preserve:r,side:o=e.hasClass("sidebar-right")?"right":"left",animation:a,dragToResize:l,width:c,minWidth:h=0,maxWidth:u=Number.MAX_SAFE_INTEGER,toggleBtn:f,dbclick:p}=this.options;this._storeID=r?`SIDEBAR:${r}:width`:"",this._side=o,this._minWidth=ch(h,i),this._maxWidth=ch(u,i),this._defaultWidth=Math.max(this._minWidth,Math.min(this._maxWidth,ch(c||e.width(),i))),this._width=(r?rt.get(this._storeID):null)??this._defaultWidth,this.render(),f&&e.on(`click${this.namespace}`,".gutter-toggle",()=>this.toggle()),p&&e.on(`dblclick${this.namespace}`,$a,()=>{p==="reset"?this.update(this._defaultWidth):this.toggle()}).on("mousedown",$a,g=>{g.preventDefault()}),l&&(this._moveable=new wr(e,{selector:$a,move:!1,onMoveStart:()=>{this._startWidth=this._width,this.$parent.addClass(d0).removeClass(f0)},onMove:(g,y)=>{const{deltaX:v}=y;Math.abs(v)<10||this.update(this._startWidth+v*(o==="left"?1:-1))},onMoveEnd:()=>{a&&this.$parent.addClass(f0),this.$parent.removeClass(d0)}})),a&&this.on("transitionend",g=>{g.target===e[0]&&g.propertyName==="width"&&e.removeClass(hh)})}destroy(){var e;super.destroy(),this._raf&&cancelAnimationFrame(this._raf),(e=this._moveable)==null||e.destroy()}toggle(e){e=e??!!this._width,e&&(this._widthBack=this._width),this.update(e?0:this._widthBack||this._defaultWidth)}update(e,t){if(!t){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0,this.update(e,!0)});return}const{preserve:n,toggleBtn:i,onResize:r,onToggle:o,animation:a}=this.options;if(e=e<this._minWidth?i?0:this._minWidth:Math.min(this._maxWidth,e,this._container.clientWidth),e===this._width)return;const l=!this._width,c=!e;this._width=e,n&&rt.set(this._storeID,e),this.render(),r==null||r(e),l!==c&&(l&&a&&this.$element.addClass(hh),o==null||o(c)),this.emit("sidebarResize",e)}render(){var h;const{side:e,width:t,$element:n,$parent:i}=this,r=!t,{toggleBtn:o,gutterWidth:a=Fs(n.parent().css("gap"))[0]||1,animation:l}=this.options;n.addClass(`sidebar-${e}`).toggleClass("is-collapsed",r).toggleClass("is-expanded",!r).css({"--gutter-width":`${a}px`,width:`var(--sidebar-${e}-width)`,"--sidebar-duration":typeof l=="number"?`${l}ms`:null});let c=n.find($a);c.length||(c=_('<div class="sidebar-gutter gutter gutter-horz"></div>').appendTo(n)),o?c.children(".gutter-toggle").length||c.append(`<button class="gutter-toggle" type="button"><span class="chevron-${e}"></span></button>`):c.children(".gutter-resize-handler").length||c.append('<div class="gutter-resize-handler"></div>'),i.addClass(`has-sidebar-${e}`).css(`--sidebar-${e}-width`,`${t}px`).toggleClass(`is-sidebar-${e}-collapsed`,r),(h=this._moveable)!=null&&h.state&&n.removeClass(hh)}}Ia.NAME="Sidebar",Ia.DEFAULT={minWidth:40,toggleBtn:!0,animation:!0,dragToResize:!0,dbclick:"reset"};const Zk="",Qk="",Jk="";class uh extends Ee{}uh.NAME="Toolbar",uh.Component=Xe,ut(wx);const eS="";class Ri extends Yt{_getRenderOptions(){const{type:e,className:t,title:n,content:i}=this.options;let r=n,o=i;return o===void 0&&(o=r,r=void 0),{...super._getRenderOptions(),title:r,content:o,className:ee("tooltip",e,t,r?"tooltip-has-title":""),contentClass:r?"tooltip-content":""}}}Ri.NAME="Tooltip",Ri.DEFAULT={...Yt.DEFAULT,trigger:"hover",delay:500,closeBtn:!1,popup:!1,name:"tooltip",animation:"fade",destroyOnHide:5e3,hideOthers:!0,hideNewOnHide:!1},Ri.register();const tS="",nS="",sS="";class Ba extends Ee{}Ba.NAME="Tree",Ba.Component=Ft,Ba.replace=Ft.TAG;class dh extends Ee{}dh.NAME="SearchTree",dh.Component=Rs,ut(Fx);const iS="",rS="",oS="",aS="";class Na extends Je{init(){const{multiple:e,defaultFileList:t,limitSize:n}=this.options;this.fileMap=new Map,this.renameMap=new Map,this.itemMap=new Map,this.dataTransfer=new DataTransfer,this.limitBytes=n?Fn(n):Number.MAX_VALUE,this.currentBytes=0,e||(this.options.limitCount=1),this.$element.addClass("upload"),this.initFileInputCash(),this.initUploadCash(),t&&this.addFileItem(t)}initUploadCash(){const{name:e,uploadText:t,uploadIcon:n,listPosition:i,btnClass:r,tip:o,draggable:a}=this.options;this.$list=_('<ul class="file-list py-1"></ul>');const l=_(`<span class="upload-tip">${o}</span>`);if(!a){if(this.$label=_(`<label class="btn ${r}" for="${e}">${t}</label>`),n){const f=_(`<i class="icon icon-${n}"></i>`);this.$label.prepend(f)}const u=i==="bottom"?[this.$label,l,this.$list]:[this.$list,this.$label,l];this.$element.append(this.$input,...u);return}const c=_(`<span class="text-primary">${t}</span>`);if(n){const u=_(`<i class="icon icon-${n} mr-1"></i>`);c.prepend(u)}this.$label=_(`<label class="draggable-area col justify-center items-center cursor-pointer block w-full h-16" for="${e}"></label>`).append(c).append(l),this.bindDragEvent();const h=i==="bottom"?[this.$label,this.$list]:[this.$list,this.$label];this.$element.append(this.$input,...h)}bindDragEvent(){this.$label.on("dragover",e=>{e.preventDefault(),this.$label.hasClass("border-primary")||(this.$label.removeClass("border-gray"),this.$label.addClass("border-primary")),this.$label.hasClass("dragover")||this.$label.addClass("dragover")}).on("dragleave",e=>{e.preventDefault(),this.$label.removeClass("border-primary"),this.$label.addClass("border-gray"),this.$label.removeClass("dragover")}).on("drop",e=>{var n;e.preventDefault(),this.$label.removeClass("border-primary"),this.$label.addClass("border-gray"),this.$label.removeClass("dragover");const t=Array.from(((n=e.dataTransfer)==null?void 0:n.files)??[]);console.log(e.dataTransfer.files),this.addFileItem(t)})}initFileInputCash(){const{name:e,multiple:t,accept:n}=this.options;this.$input=_("<input />").addClass("hidden").prop("type","file").prop("name",e).prop("id",e).prop("multiple",t).on("change",i=>{const r=i.target.files;if(!r)return;const o=[...r];this.addFileItem(o)}),n&&this.$input.prop("accept",n)}addFile(e){const{multiple:t,onSizeChange:n}=this.options;t||(this.renameMap.clear(),this.fileMap.clear(),this.dataTransfer.items.clear(),this.currentBytes=e.size),this.renameMap.set(e.name,e.name),this.fileMap.set(e.name,e),this.dataTransfer.items.add(e),this.$input.prop("files",this.dataTransfer.files),this.currentBytes+=e.size,n==null||n(this.currentBytes)}renameDuplicatedFile(e){if(!this.fileMap.has(e.name))return e;const t=e.name.lastIndexOf(".");if(t===-1)return this.renameDuplicatedFile(new File([e],`${e.name}(1)`));const n=e.name.substring(0,t),i=e.name.substring(t);return this.renameDuplicatedFile(new File([e],`${n}(1)${i}`))}filterFiles(e){const{accept:t}=this.options;if(!t)return e;const n=t.replace(/\s/g,"").split(","),i=[],r=[],o=[];return n.forEach(a=>{a.endsWith("/*")?r.push(a.substring(0,a.length-1)):a.includes("/")?i.push(a):a.startsWith(".")&&o.push(a)}),e.filter(a=>i.includes(a.type)||r.some(l=>a.type.startsWith(l))||o.some(l=>a.name.endsWith(l)))}addFileItem(e){e=this.filterFiles(e);const{multiple:t,limitCount:n,exceededSizeHint:i,onExceededSize:r,exceededCountHint:o,onExceededCount:a,onAdd:l}=this.options;if(t){for(let f of e){if(n&&this.fileMap.size>=n){a==null||a(n),o&&alert(o);return}if(this.currentBytes+f.size>this.limitBytes){r==null||r(this.limitBytes),i&&alert(i);return}f=this.renameDuplicatedFile(f);const p=l==null?void 0:l(f);if(!p)continue;f=p;const g=this.createFileItem(f);this.itemMap.set(f.name,g),this.$list.append(g)}return}if(e.length===0||e[0].size>this.limitBytes)return;let c=this.renameDuplicatedFile(e[0]);const h=l==null?void 0:l(c);if(!h)return;c=h;const u=this.createFileItem(c);this.itemMap.clear(),this.itemMap.set(c.name,u),this.$list.empty().append(u)}deleteFileItem(e){var l,c;const t=this.renameMap.get(e)??e;this.renameMap.delete(e);const n=this.fileMap.get(t);if(!n)return;const{onDelete:i,onSizeChange:r}=this.options,o=this.itemMap.get(n.name);this.itemMap.delete(n.name),o==null||o.addClass("hidden");const a=(l=o==null?void 0:o.find(".file-delete"))==null?void 0:l.data("tooltip");a&&(a.destroy(),(c=a.tooltip)==null||c.remove()),setTimeout(()=>o==null?void 0:o.remove(),3e3),i==null||i(n),this.fileMap.delete(n.name),this.currentBytes-=n.size,r==null||r(this.currentBytes),this.dataTransfer=new DataTransfer,this.fileMap.forEach(h=>this.dataTransfer.items.add(h)),this.$input.prop("files",this.dataTransfer.files)}renameFileItem(e,t){var r,o;const n=this.renameMap.get(e.name);this.renameMap.set(e.name,t),n&&(e=this.fileMap.get(n)??e);const i=this.itemMap.get(e.name);i&&(this.itemMap.set(t,i).delete(e.name),(o=(r=this.options).onRename)==null||o.call(r,t,e.name),this.fileMap.delete(e.name),this.dataTransfer=new DataTransfer,e=new File([e],t),this.fileMap.set(t,e).forEach(a=>this.dataTransfer.items.add(a)),this.$input.prop("files",this.dataTransfer.files))}createFileItem(e){const{showIcon:t}=this.options;return this.addFile(e),_('<li class="file-item my-1 flex items-center gap-2"></li>').append(t?this.fileIcon():null).append(this.createFileInfo(e)).append(this.createRenameContainer(e))}fileIcon(){const{icon:e}=this.options;return _(`<i class="icon icon-${e}"></i>`)}fileRenameBtn(){const{useIconBtn:e,renameText:t,renameIcon:n,renameClass:i}=this.options;if(e){const r=_(`<button class="btn btn-link h-5 w-5 p-0 ${i}"><i class="icon icon-${n}"></i></button>`).prop("type","button").addClass("file-action file-rename");return new Ri(r,{title:t}),r}return _("<button />").prop("type","button").addClass(`btn size-sm rounded-sm text-primary canvas file-action file-rename ${i}`).html(t)}fileDeleteBtn(){const{useIconBtn:e,deleteText:t,deleteIcon:n,deleteClass:i}=this.options;if(e){const r=_(`<button class="btn btn-link h-5 w-5 p-0 ${i}"><i class="icon icon-${n}"></i></button>`).prop("type","button").addClass("file-action file-delete");return r.data("tooltip",new Ri(r,{title:t})),r}return _("<button />").html(t).prop("type","button").addClass(`btn size-sm rounded-sm text-primary canvas file-action file-delete ${i}`)}fileName(e){return _(`<span class="file-name">${e}</span>`)}fileSize(e){return _(`<span class="file-size text-gray">${Dt(e)}</span>`)}createFileInfo(e){const{renameBtn:t,deleteBtn:n,showSize:i}=this.options,r=_('<div class="file-info flex items-center gap-2"></div>');return r.append(this.fileName(e.name)),i&&r.append(this.fileSize(e.size)),t&&r.append(this.fileRenameBtn().on("click",o=>{r.addClass("hidden").closest(".file-item").find(".input-rename-container.hidden").removeClass("hidden");const a=_(o.target).closest("li").find("input")[0];a.focus(),a.value.lastIndexOf(".")!==-1&&a.setSelectionRange(0,a.value.lastIndexOf("."))})),n&&r.append(this.fileDeleteBtn().on("click",()=>this.deleteFileItem(e.name))),r}createRenameContainer(e){const{confirmText:t,cancelText:n,duplicatedHint:i,onDuplicated:r}=this.options,o=_('<div class="input-group input-rename-container hidden"></div>'),a=_("<input />").addClass("form-control").prop("type","text").prop("autofocus",!0).prop("defaultValue",e.name).on("keydown",u=>{if(u.key==="Enter"){const f=o.closest(".file-item"),p=f.find(".file-name");if(p.html()===a.val()){o.addClass("hidden"),f.find(".file-info.hidden").removeClass("hidden");return}if(this.fileMap.has(a.val())){r==null||r(a.val()),i&&alert(i);return}this.renameFileItem(e,a.val()),o.addClass("hidden"),f.find(".file-info.hidden").removeClass("hidden"),p.html(a.val())}else u.key==="Escape"&&(a.val(e.name),o.addClass("hidden").closest(".file-item").find(".file-info.hidden").removeClass("hidden"))}),l=_("<button />").addClass("btn primary rename-confirm-btn").prop("type","button").html(t).on("click",()=>{const u=o.closest(".file-item"),f=u.find(".file-name");if(f.html()===a.val()){o.addClass("hidden"),u.find(".file-info.hidden").removeClass("hidden");return}if(this.fileMap.has(a.val())){r==null||r(a.val()),i&&alert(i);return}this.renameFileItem(e,a.val()),o.addClass("hidden"),u.find(".file-info.hidden").removeClass("hidden"),f.html(a.val())}),c=_("<button />").prop("type","button").addClass("btn rename-cancel-btn").html(n).on("click",()=>{a.val(e.name),o.addClass("hidden").closest(".file-item").find(".file-info.hidden").removeClass("hidden")}),h=_('<div class="btn-group"></div').append(l).append(c);return o.append(a).append(h)}}Na.NAME="Upload",Na.DEFAULT={uploadText:"上传文件",confirmText:"确定",cancelText:"取消",useIconBtn:!0,renameBtn:!0,renameText:"重命名",renameIcon:"edit",renameClass:"",deleteBtn:!0,deleteText:"删除",deleteIcon:"trash",deleteClass:"",showIcon:!0,multiple:!0,listPosition:"bottom",limitSize:!1,icon:"file-o",btnClass:"",tip:"",draggable:!1,showSize:!0,onAdd:s=>s};const lS="";class fh extends Na{init(){this.initUploadButtonItemCash(),this.options.onSizeChange=()=>{this.$uploadInfo.html(this.options.totalCountText.replace("%s",this.fileMap.size.toString()).replace("%s",this.fileMap.size.toString())),this.fileMap.size>0?(this.$tip.remove(),this.$list.append(this.$uploadButtonItem)):(this.$uploadButtonItem.remove(),this.$label.append(this.$tip))},super.init(),this.$list.addClass("flex")}initUploadButtonItemCash(){this.$uploadButtonItem=_(`<label class="upload-button-item order-last" for="${this.options.name}" />`).addClass("flex justify-center items-center cursor-pointer").css({width:120,height:120,background:"var(--color-slate-100)"}).append(_('<i class="icon icon-plus" />'))}initUploadCash(){const{name:e,tip:t,uploadText:n,uploadIcon:i,totalCountText:r}=this.options;this.$list=_('<ul class="file-list py-1 flex-wrap gap-x-4 gap-y-4"></ul>'),this.$label=_('<div class="draggable-area relative block w-full border border-dashed border-gray"></div>').css({minHeight:64});const o=_(`<label for="${e}" class="text-primary cursor-pointer">${n}</label>`);if(i){const a=_(`<i class="icon icon-${i} mr-1"></i>`);o.prepend(a)}this.$tip=_('<div class="absolute inset-0 col justify-center items-center"></div>').append(o),t&&this.$tip.append(_(`<span class="upload-tip">${t}</span>`)),this.$label.append(this.$tip),this.$label.append(this.$input,this.$list),this.bindDragEvent(),this.$element.append(this.$label),this.$uploadInfo=_('<div class="py-1" />').css({color:"var(--color-slate-500)"}).html(r.replace("%s",this.fileMap.size.toString()).replace("%s",this.fileMap.size.toString())),this.$element.append(this.$uploadInfo)}filterFiles(e){const{accept:t}=this.options;if(t==="image/*")return e.filter(i=>i.type.includes("image"));const n=t.replace(/\s/g,"").replace(/\./g,"image/").split(",");return e.filter(i=>n.includes(i.type))}createFileItem(e){const t=super.createFileItem(e).addClass("relative").removeClass("flex items-center gap-2 my-1");this.setImageUrl(e,t);const{deleteBtn:n,showSize:i}=this.options;return n&&t.append(this.fileDeleteBtn().addClass("absolute right-0 top-0 text-white").css({background:"var(--color-slate-500)"}).on("click",()=>this.deleteFileItem(e.name))),i&&t.append(this.fileSize(e.size).addClass("file-size label text-white circle darker absolute px-1 hidden").removeClass("text-gray").css({top:96,left:4})),t}setImageUrl(e,t){const n=new FileReader;n.onload=()=>{_('<div class="img flex-none" />').addClass("rounded").css({backgroundImage:`url(${n.result})`,backgroundSize:"cover"}).prependTo(t)},n.readAsDataURL(e)}createFileInfo(e){const t=this.fileRenameBtn().addClass("flex-none").on("click",i=>{const r=_(i.target).closest(".file-item");r.find(".file-info").addClass("hidden"),r.find(".input-rename-container").removeClass("hidden");const o=r.find("input")[0];o.focus(),o.value.lastIndexOf(".")!==-1&&o.setSelectionRange(0,o.value.lastIndexOf("."))});return _('<div class="file-info flex justify-between items-center"></div>').css({width:120}).append(_(`<div class="file-name py-1 ellipsis">${e.name}</div>`)).append(t)}createRenameContainer(e){const{duplicatedHint:t,onDuplicated:n}=this.options,i=_("<input />").addClass("input-rename-container border-primary border hidden").prop("type","text").prop("autofocus",!0).prop("defaultValue",e.name).css({width:120}).on("keydown",r=>{if(r.key==="Enter"){const o=i.closest(".file-item").find(".file-name");if(o.html()===i.val()){i.addClass("hidden"),o.closest(".file-info").removeClass("hidden");return}if(this.fileMap.has(i.val())){n==null||n(i.val()),t&&alert(t);return}this.renameFileItem(e,i.val()),i.addClass("hidden"),o.html(i.val()).closest(".file-info").removeClass("hidden")}else r.key==="Escape"&&i.val(e.name).addClass("hidden").closest(".file-item").find(".file-name").removeClass("hidden")}).on("blur",()=>{const r=i.closest(".file-item").find(".file-name");if(r.html()===i.val()){i.addClass("hidden"),r.closest(".file-info").removeClass("hidden");return}if(this.fileMap.has(i.val())){n==null||n(i.val()),t&&alert(t);return}this.renameFileItem(e,i.val()),i.addClass("hidden"),r.html(i.val()).closest(".file-info").removeClass("hidden")});return i}}fh.NAME="UploadImgs",fh.DEFAULT={uploadText:"添加文件",renameBtn:!0,renameText:"重命名",renameIcon:"edit",renameClass:"",deleteBtn:!0,deleteText:"删除",deleteIcon:"trash",deleteClass:"",showIcon:!1,multiple:!0,limitSize:!1,btnClass:"",draggable:!0,accept:"image/jpg, image/jpeg, image/gif, image/png",showSize:!0,useIconBtn:!0,totalCountText:'共 <span class="font-bold text-black">%s</span> 个文件 <span class="font-bold text-black">%s</span> 个文件等待上传。'};const ph=Symbol("batch-form"),mh=class jd extends Je{constructor(){super(...arguments),this._actions=null,this._cols=[],this._idSeed=0,this._rows=[]}afterInit(){var i;const e=_(this.element),t=e.find(".form-batch-table").addClass("borderless");let n=t.find("tbody");n.length||(n=_("<tbody/>").appendTo(t)),this.$tbody=n,this._template=(i=e.find(".form-batch-template").get(0))==null?void 0:i.innerHTML,this._cols=[],t.find("thead>tr>.form-batch-head").each((r,o)=>{const a=_(o),l=a.data();l&&(l.hidden=a.hasClass("hidden"),this._cols.push(l)),a.data("name")==="ACTIONS"&&a.addClass("form-batch-col-actions")}),this.options.fixedActions&&(e.addClass("has-fixed-actions"),this._sticky=new Lo(e,{side:"right",offset:0,scrollContainer:".form-batch-container",targets:'td[data-name="ACTIONS"],th[data-name="ACTIONS"]'})),e.on("click",r=>{var h;const o=_(r.target).closest(".form-batch-btn");if(!o.length)return;const a=o.dataset("type"),l=o.closest("tr"),c=l.dataset("index");a==="add"?this.addRow(c):a==="delete"?this.deleteRow(c):a==="ditto"&&this.toggleDitto(o),(h=this.options.onClickAction)==null||h.call(this,a,l,c)}).on("change",".form-batch-input,.pick-value",r=>{const o=_(r.target);r.___td===ph||o.hasClass("pick-value")&&!r.___td||this.syncDitto(o)}).on("change",'[type="radio"],[type="checkbox"]',r=>{jd.updateCheckValues(_(r.target))}),this.options.sortable&&(this._sortable=new na(n,{draggable:"tr",handle:'.form-batch-btn[data-type="sort"]',dataIdAttr:"data-gid",ghostClass:"bg-primary-50",onSort:()=>{this._rows=this._sortable.toArray().map(Number),this.render()},dragShadow:!1,...typeof this.options.sortable=="object"?this.options.sortable:{}})),this.render()}destroy(){var e;_(this.element).off("click change"),this.$tbody=void 0,this._template=void 0,this._cols.length=0,this._rows.length=0,(e=this._sticky)==null||e.destroy()}render(e,t){super.render(e,t),!t&&this._rows.length?this._renderRows():(this._actions=null,this._initRows())}addRow(e,t){return t=t??this._idSeed++,typeof e=="number"&&e>=0&&e<=this._rows.length?this._rows.splice(e+1,0,t):(e=this._rows.length,this._rows.push(t)),this._renderRows(void 0,e),t}deleteRow(e){var n;if(this._rows.length<=1||typeof e!="number"||e<0||e>=this._rows.length)return!1;const t=this._rows[e];this._rows.splice(e,1),(n=this.$tbody)==null||n.children(`[data-gid="${t}"]`).remove(),this._renderRows(void 0,e)}deleteRowByGid(e){return this.deleteRow(this._rows.indexOf(e))}toggleDitto(e,t){const n=e.closest("td");t=t??n.attr("data-ditto")!=="on",n.attr("data-ditto",t?"on":"off"),t&&n.closest("tr").prev("tr").find(`td[data-name="${n.data("name")}"]`).find(".form-batch-input,.pick-value").each((o,a)=>{this.syncDitto(_(a),!1)})}syncDitto(e,t=!0,n=!1){const i=e.closest("td");t&&i.attr("data-ditto","off");const r=i.data("name"),a=(e.hasClass("pick-value")?e.closest(".form-group-wrapper"):e).attr("data-name"),l=`td[data-name="${r}"][data-ditto="on"]`,c=e.val();let h=e.closest("tr").next("tr"),u=h.find(l);for(;u.length;){const f=u.find(`.form-batch-input[data-name="${a}"]`);if(f.length&&f.val()!==c)f.val(c).trigger("change",ph);else{const p=u.find(".pick").parent().zui();p&&p.$&&p.$element.attr("data-name")===a&&p.$.value!==c&&p.$.setValue(c,!0).then(()=>{p.$element.find(".pick-value").trigger("change",ph)})}if(n)break;h=h.next("tr"),u=h.find(l)}}toggleCols(e,t){const n=this.$element.find(".form-batch-table").find("th.form-batch-head,td.form-batch-control");n.length&&(typeof e=="string"&&(e=[e]),e.forEach(i=>{const r=this._cols.find(o=>o.name===i);r&&(r.hidden=!t,n.filter(`[data-name="${i}"]`).toggleClass("hidden",!t),t&&requestAnimationFrame(()=>{n.filter(".form-batch-ditto-control").each((o,a)=>{const l=_(a),c=l.find(".form-batch-ditto-btn");l.css("--form-batch-ditto-width",`${c.outerWidth()}px`)})}))}))}_initRows(){const e=this.$tbody;if(!this._template||!(e!=null&&e.length))return;const{data:t=[],minRows:n,maxRows:i,mode:r,rowsCount:o=r==="add"?Math.min(Math.max(1,i??100),Math.max(1,n??(r==="add"?10:1),t.length)):t.length}=this.options;this._rows=Array(o).fill(0).map((a,l)=>l),this._idSeed=this._rows.length,this._renderRows(t)}_renderRows(e=[],t=0){var i;const n=this._rows.length;for(let r=t;r<n;r++)this._renderRow(r,e[r]);(i=this.$tbody)==null||i.attr("data-count",`${n}`)}_renderActions(e){var n;let t=this._actions;if(!t){const{addRowIcon:i="icon-plus",deleteRowIcon:r="icon-trash",sortRowIcon:o="icon-move",sortable:a}=this.options;t=new DocumentFragment;const l='<button type="button" data-type="{type}" class="form-batch-btn btn square ghost size-sm" title="{text}"><i class="icon {icon}"></i></button>';let{actions:c}=this.options;c===void 0&&(c=[],o!==!1&&a&&c.push("sort"),i!==!1&&c.push("add"),r!==!1&&c.push("delete"));const h={sort:{type:"sort",icon:o||"",text:this.i18n("sort"),className:"cursor-move"},add:{type:"add",icon:i||"",text:this.i18n("add")},delete:{type:"delete",icon:r||"",text:this.i18n("delete")}};c.forEach(u=>{typeof u=="string"&&(u={type:u});const f=_.extend({},h[u.type],u),p=_(Te(l,f));f.className&&p.addClass(f.className),t.append(p[0])}),(n=this.options.onRenderActions)==null||n.call(this,t),this._actions=t,this.$element.find('.form-batch-head[data-name="ACTIONS"]').attr("data-action-count",t.children.length+"")}e.empty().append(t.cloneNode(!0))}_renderRow(e,t){const n=this.$tbody,i=String(this._rows[e]),{idKey:r="id",mode:o,onRenderRowCol:a,onRenderRow:l}=this.options,c=o==="add",h=String(t&&t[r]!==void 0?t[r]:e+1);let u=n.children(`[data-gid="${i}"]`),f=!1;if(u.length){if(!t&&u.dataset("index")===e)return}else{f=!0;let v=this._template;if((v.includes(" zui-create ")||v.includes(" zui-create="))&&(v=v.replace(/(id|for)="([\\$a-z_]+)"/g,`$1="$2_${i}"`)),v.includes("<script>")&&v.includes('zui.create("')){const b=[];v=v.replace(/(zui\.create\("[a-zA-Z]+","#)(\w+)(",)/g,(w,S,E,$)=>(b.push(E),`${S}${E}_${i}${$}`)),b.forEach(w=>{const S=`${w}_${i}`;v=v.replace(`id="${w}"`,`id="${S}"`)})}v=v.replaceAll("{GID}",i),u=_(v.trim()).attr("data-gid",i),u.find('[type="radio"],[type="checkbox"]').each((b,w)=>{const S=_(w),E=S.attr("id"),$=`${E}_${i}`;S.attr("id",$),u.find(`label[for="${E}"]`).attr("for",$)}),u.zuiInit({onCreate:(b,w)=>(typeof w.name=="string"&&(w.name=`${w.name}[${h}]`),w)})}const p=this._rows[e-1],g=n.children(`[data-gid="${p}"]`);u.attr("data-index",`${e}`),u.find("textarea").autoHeight(),u.on("inited",(v,[b])=>{let w=b.options.name;if(w){const S=w.split("[");S.length>1&&S.pop(),w=S.join("[");const E=b.$element.closest("td");if(b.$element.attr("data-name",w),g.length&&E.data("ditto")==="on"){const $=g.find(`td[data-name="${E.data("name")}"]`);this.syncDitto($.find(`[data-name="${w}"] .pick-value`),!1,!0)}else t&&t[w]!==void 0&&b.$.setValue(t[w],!0)}}),t&&u.data("data",t),e?g.length?g.after(u):u.appendTo(n):u.prependTo(n),f&&u.find("script").remove();const y=t||u.data("data");this._cols.forEach(v=>{let b=u.find(`td[data-name="${v.name}"]`);if(b.length||(b=_(`<td data-name="${v.name}"></td>`).appendTo(u)),v.index){b.find(".form-control-static").text(h).attr("id",`${v.name}_${i}`),a==null||a.call(this,b,v,y,e);return}if(b.toggleClass("hidden",!!v.hidden),!b.data("init")||t){if(v.name==="ACTIONS"){if(b.addClass("form-batch-col-actions"),!c)return;this._renderActions(b);return}b.data("init",1).find("[name],.form-control-static").each((S,E)=>{const $=_(E);if($.hasClass("form-control-static")){const B=$.attr("data-name");t&&$.text(String(t[B]??""))}else{const B=$.attr("name"),N=`${B}[${h}]`;if($.attr({name:N,"data-name":B}).addClass("form-batch-input"),t&&t[B]!==void 0){const L=String(t[B]??"");if($.is('[type="radio"]'))$.prop("checked",L===$.val());else if($.is('[type="checkbox"]')){const V=new Set(L.split(","));$.prop("checked",V.has($.val()))}else $.val(L)}}}),b.find('[type="radio"],[type="checkbox"]').each((S,E)=>{const $=_(E);typeof $.attr("data-name")!="string"||$.attr("data-val")!==void 0||jd.updateCheckValues($,b,h)})}else b.find("[name]").each((S,E)=>{const $=_(E),B=$.attr("data-name");if(($.attr("name")??"").startsWith(`${B}[`)){if($.attr("name",`${B}[${h}]`),$.is('[type="radio"]'))$.prop("checked",$.val()===$.attr("data-val"));else if($.is('[type="checkbox"]')){const N=new Set($.attr("data-val").split(","));N.size>1&&$.attr("name",`${B}[${h}][]`),$.prop("checked",N.has($.val()))}}}),b.find(".pick").each((S,E)=>{var B;const $=_(E).parent();(B=$.zui())==null||B.render({name:`${$.data("name")}[${h}]`})});if(v.ditto){b.addClass("form-batch-ditto");let S=b.find(".form-batch-ditto-btn");if(e){const{defaultDitto:E="on"}=v;if(b.attr("data-ditto",E),!S.length){S=_(`<button type="button" class="btn ghost form-batch-btn form-batch-ditto-btn" data-type="ditto">${this.i18n("ditto")}</button>`);let $=b.children(".form-batch-ditto-wrapper");$.length||($=_('<div class="form-batch-ditto-wrapper"></div>').append(b.children()).appendTo(b)),$.append(S)}requestAnimationFrame(()=>b.css("--form-batch-ditto-width",`${S.outerWidth()}px`)),E==="on"&&g.find(`td[data-name="${v.name}"]`).find(".form-batch-input").each((B,N)=>{this.syncDitto(_(N),!1,!0)})}else b.attr("data-ditto",""),S.remove()}const w=!!(v.ditto&&e);b.toggleClass("form-batch-ditto-control",w),b.find(".form-batch-ditto-btn").toggle(w),a==null||a.call(this,b,v,y,e)}),l==null||l.call(this,u,e,y)}static updateCheckValues(e,t,n){const i=e.attr("data-name");if(typeof i!="string")return;const r=e.attr("type");t=t||e.closest("td");const o=t.find(`[type="${r}"][data-name="${i}"]`);n!==void 0&&r==="checkbox"&&o.length>1&&o.attr("name",`${i}[${n}][]`);const a=[];o.filter(":checked").each((c,h)=>{a.push(_(h).val())});const l=r==="radio"?a[0]:a.join(",");o.attr("data-val",l)}};mh.NAME="BatchForm",mh.DEFAULT={mode:"add",idKey:"id",i18n:{zh_cn:{ditto:"同上",delete:"删除",add:"添加",sort:"排序"},zh_tw:{ditto:"同上",delete:"刪除",add:"添加",sort:"排序"},en:{ditto:"Ditto",delete:"Delete",add:"Add",sort:"Sort"}}};let U_=mh;const cS="";function V_(s){return typeof s=="string"?s.split(",").map(e=>{const t=parseFloat(e);return Number.isNaN(t)?null:t}):s}let gh=class extends ke{constructor(){super(...arguments),this._canvas=Ce(),this._timer=0,this._needDraw=!1}componentDidMount(){var t;this.tryDraw=this.tryDraw.bind(this),this.tryDraw();const e=(t=this._canvas.current)==null?void 0:t.parentElement;if(this.props.responsive!==!1){if(e&&typeof ResizeObserver<"u"){const n=new ResizeObserver(this.tryDraw);n.observe(e),this._rob=n}this._rob||window.addEventListener("resize",this.tryDraw)}if(e&&typeof IntersectionObserver<"u"){const n=new IntersectionObserver(i=>{this._needDraw&&i.some(r=>r.isIntersecting)&&this.tryDraw()});n.observe(e),this._iob=n}}componentDidUpdate(){this.tryDraw()}componentWillUnmount(){var e;(e=this._rob)==null||e.disconnect(),window.removeEventListener("resize",this.tryDraw)}tryDraw(){this._timer&&cancelAnimationFrame(this._timer),this._timer=requestAnimationFrame(()=>{this.draw(),this._timer=0})}draw(){const e=this._canvas.current;if(!e)return;const t=e.parentElement,{width:n,height:i,responsive:r=!0}=this.props;let o=n||t.clientWidth,a=i||t.clientHeight;if(n&&i&&r&&(o=t.clientWidth,a=Math.floor(i*o/n)),e.style.width=`${o}px`,e.style.height=`${a}px`,o=o*(window.devicePixelRatio||1),a=a*(window.devicePixelRatio||1),e.width=o,e.height=a,!_(t).isVisible()&&this._iob){this._needDraw=!0;return}const{lineSize:l=1,scaleLine:c=!1,scaleLineSize:h,scaleLineGap:u=1,scaleLineDash:f,referenceLine:p,referenceLineSize:g,referenceLineDash:y,color:v="#2c78f1",fillColor:b=["rgba(46, 127, 255, 0.3)","rgba(46, 127, 255, 0.05)"],lineDash:w=[],bezier:S}=this.props,E=V_(this.props.data);if(!E.length)return;const $=Math.floor(o/(E.length-1)),B=Math.max(...E.filter(M=>M!==null)),N=E.map((M,F)=>{const K=typeof M!="number";return{x:F*$,y:K?a:Math.round((1-M/B)*(a-l)),empty:K}});let L=N[0];const V=e.getContext("2d");if(c){const M=typeof c=="string"?c:"rgba(100,100,100,.1)";V.strokeStyle=M,V.lineWidth=h||l,f&&V.setLineDash(f);for(let F=0;F<N.length;++F){if(F%u!==0)continue;const K=N[F];V.moveTo(K.x,0),V.lineTo(K.x,a)}V.stroke()}if(p&&N.length>1){const M=typeof p=="string"?p:"rgba(100,100,100,.2)",F=N[N.length-1];V.moveTo(F.x,a),V.strokeStyle=M,V.lineWidth=g||l,V.lineTo(L.x,L.y),y&&V.setLineDash(y),V.stroke()}for(V.setLineDash(w);N.length&&N[N.length-1].empty;)N.pop();if(b){const M=N[N.length-1];if(V.beginPath(),V.moveTo(0,a),V.lineTo(L.x,L.y),S){const F=Math.round($/2);for(let K=1;K<N.length;++K){const X=N[K],ae=Math.round((X.y-L.y)/5);V.bezierCurveTo(L.x+F,L.y+ae,X.x-F,X.y-ae,X.x,X.y),L=X}}else for(let F=1;F<N.length;++F)L=N[F],V.lineTo(L.x,L.y);if(V.lineTo(M.x,a),Array.isArray(b)){const F=V.createLinearGradient(0,0,0,a);for(let K=0;K<b.length;++K)F.addColorStop(K/(b.length-1),b[K]);V.fillStyle=F}else V.fillStyle=b;V.fill()}if(L=N[0],V.beginPath(),V.moveTo(L.x,L.y),S){const M=Math.round($/2);for(let F=1;F<N.length;++F){const K=N[F],X=Math.round((K.y-L.y)/5);V.bezierCurveTo(L.x+M,L.y+X,K.x-M,K.y-X,K.x,K.y),L=K}}else for(let M=1;M<N.length;++M)L=N[M],V.lineTo(L.x,L.y);V.strokeStyle=v,V.lineWidth=l,V.stroke()}render(){const{style:e,className:t,canvasClass:n}=this.props;return k("div",{class:"center burn-chart",className:t,style:e},k("canvas",{className:n,ref:this._canvas}))}};gh.defaultProps={responsive:!0,lineSize:1,scaleLine:!1,scaleLineSize:1,bezier:!0};class yh extends Ee{}yh.NAME="Burn",yh.Component=gh;class p0 extends tt{_getClassName(e){return["datalist",e.className]}_getProps(e){return Ie(super._getProps(e),e.labelWidth?{style:{"--datalist-label-width":nt(e.labelWidth)}}:null)}_getChildren(){const{items:e=[]}=this.props;return e.map((t,n)=>{const{key:i=n,className:r,label:o,labelStyle:a,labelClass:l,labelAttrs:c,content:h,contentStyle:u,contentClass:f,contentAttrs:p,...g}=t;return k("div",{key:i,className:ee("datalist-item",r),...g},k("div",{className:ee("datalist-item-label",l),style:a,...c},k(Se,{content:o})),k("div",{className:ee("datalist-item-content",f),style:u,...p},k(Se,{content:h})))})}}ut(Object.freeze(Object.defineProperty({__proto__:null,Datalist:p0},Symbol.toStringTag,{value:"Module"})));const uS="",K_="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Hs=(s=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(s));for(;s--;)e+=K_[t[s]&63];return e};const dS="";class m0 extends ke{constructor(t){super(t);en(this,fs,void 0);en(this,ps,void 0);an(this,fs,0),an(this,ps,null),this._handleWheel=n=>{const{wheelContainer:i}=this.props,r=n.target;if(!(!r||!i)&&(typeof i=="string"&&r.closest(i)||typeof i=="object")){const o=(this.props.type==="horz"?n.deltaX:n.deltaY)*(this.props.wheelSpeed??1);this.scrollOffset(o)&&n.preventDefault()}},this._handleMouseMove=n=>{const{dragStart:i}=this.state;i&&(Wt(this,fs)&&cancelAnimationFrame(Wt(this,fs)),an(this,fs,requestAnimationFrame(()=>{const r=this.props.type==="horz"?n.clientX-i.x:n.clientY-i.y;this.scroll(i.offset+r*this.props.scrollSize/this.props.clientSize),an(this,fs,0)})),n.preventDefault())},this._handleMouseUp=()=>{this.state.dragStart&&this.setState({dragStart:!1})},this._handleMouseDown=n=>{this.state.dragStart||this.setState({dragStart:{x:n.clientX,y:n.clientY,offset:this.scrollPos}}),n.preventDefault(),n.stopPropagation()},this._handleClick=n=>{const i=n.currentTarget;if(!i)return;const r=i.getBoundingClientRect(),{type:o,clientSize:a,scrollSize:l}=this.props,c=(o==="horz"?n.clientX-r.left:n.clientY-r.top)-this.barSize/2;this.scroll(c*l/a),n.preventDefault()},this.state={scrollPos:this.props.defaultScrollPos??0,dragStart:!1}}get scrollPos(){return this.props.scrollPos??this.state.scrollPos}get controlled(){return this.props.scrollPos!==void 0}get maxScrollPos(){const{scrollSize:t,clientSize:n}=this.props;return Math.max(0,t-n)}get barSize(){const{clientSize:t,scrollSize:n,size:i=12,minBarSize:r=3*i}=this.props;return Math.max(Math.round(t*t/n),r)}componentDidMount(){document.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp);const{wheelContainer:t}=this.props;t&&(an(this,ps,typeof t=="string"?document:t.current),Wt(this,ps).addEventListener("wheel",this._handleWheel,{passive:!1}))}componentWillUnmount(){document.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),Wt(this,ps)&&Wt(this,ps).removeEventListener("wheel",this._handleWheel)}scroll(t){return t=Math.max(0,Math.min(Math.round(t),this.maxScrollPos)),t===this.scrollPos?!1:(this.controlled?this._afterScroll(t):this.setState({scrollPos:t},this._afterScroll.bind(this,t)),!0)}scrollOffset(t){return this.scroll(this.scrollPos+t)}_afterScroll(t){const{onScroll:n}=this.props;n&&n(t,this.props.type??"vert")}render(){const{clientSize:t,type:n,size:i=12,className:r,style:o,left:a,top:l,bottom:c,right:h}=this.props,{maxScrollPos:u,scrollPos:f}=this,{dragStart:p}=this.state,g={left:a,top:l,bottom:c,right:h,...o},y={};return n==="horz"?(g.height=i,g.width=t,y.width=this.barSize,y.left=Math.round(Math.min(u,f)*(t-y.width)/u)):(g.width=i,g.height=t,y.height=this.barSize,y.top=Math.round(Math.min(u,f)*(t-y.height)/u)),A("div",{className:ee("scrollbar",r,{"is-vert":n==="vert","is-horz":n==="horz","is-dragging":p}),style:g,onMouseDown:this._handleClick,children:A("div",{className:"scrollbar-bar",style:y,onMouseDown:this._handleMouseDown})})}}fs=new WeakMap,ps=new WeakMap;const Fa=new Map,Pa=[];function g0(s,e){const{name:t}=s;if(!(e!=null&&e.override)&&Fa.has(t))throw new Error(`DTable: Plugin with name ${t} already exists`);Fa.set(t,s),e!=null&&e.buildIn&&!Pa.includes(t)&&Pa.push(t)}function Ze(s,e){g0(s,e);const t=n=>{if(!n)return s;const{defaultOptions:i,...r}=s;return{...r,defaultOptions:{...i,...n}}};return t.plugin=s,t}function y0(s){return Fa.delete(s)}function v0(s){if(typeof s=="string"){const e=Fa.get(s);return e||console.warn(`DTable: Cannot found plugin "${s}"`),e}if(typeof s=="function"&&"plugin"in s)return s.plugin;if(typeof s=="object")return s;console.warn("DTable: Invalid plugin",s)}function x0(s,e,t){return e.forEach(n=>{var r;if(!n)return;const i=v0(n);i&&(t.has(i.name)||((r=i.plugins)!=null&&r.length&&x0(s,i.plugins,t),s.push(i),t.add(i.name)))}),s}function q_(s=[],e=!0){if(e&&Pa.length&&s.unshift(...Pa),!(s!=null&&s.length))return[];const t=x0([],s,new Set),n=[],i=t.reduce((r,o,a)=>{var l;return r.set(o.name,a*1e3),(l=o.requireAfter)!=null&&l.length&&n.push(o),r},new Map);return n.length&&(n.forEach(r=>{const o=r.requireAfter.reduce((a,l)=>(i.has(l)&&a.push(i.get(l)),a),[]);o.length&&i.set(r.name,Math.max(...o)+1)}),t.sort((r,o)=>i.get(r.name)-i.get(o.name))),t}function _0(){return{cols:[],data:[],rowKey:"id",width:"100%",height:"auto",rowHeight:35,defaultColWidth:80,minColWidth:24,maxColWidth:9999,header:!0,footer:void 0,headerHeight:0,footerHeight:0,rowHover:!0,colHover:!1,cellHover:!1,bordered:!1,striped:!0,responsive:!1,scrollbarHover:!0,horzScrollbarPos:"outside"}}function b0(s,e,t){return s&&(e&&(s=Math.max(e,s)),t&&(s=Math.min(t,s))),s}function w0(s,e){return typeof s=="string"&&(s=s.endsWith("%")?parseFloat(s)/100:parseFloat(s)),typeof e=="number"&&(typeof s!="number"||isNaN(s))&&(s=e),s}function vh(s,e=!1,t=0){if(!s.list.length)return;if(e&&s.widthSetting&&(s.widthSetting=Math.min(s.widthSetting,s.width)),t&&(!s.widthSetting||s.widthSetting>t)&&s.width>t&&(s.widthSetting=t),s.widthSetting&&s.width!==s.widthSetting){s.width=s.widthSetting;const i=s.width-s.totalWidth;if(!e&&i>0||e&&i!==0){const r=s.flexList.length?s.flexList:s.list,o=r.reduce((a,l)=>a+(l.flex||1),0);r.forEach(a=>{const l=Math[i<0?"max":"min"](i,Math.ceil(i*((a.flex||1)/o)));a.realWidth=a.width+l})}}let n=0;s.list.forEach((i,r)=>{i.realWidth||(i.realWidth=i.width),i.left=n,i.sideIndex=r,n+=i.realWidth})}function C0(s){return s?s==="left"?"left":"right":"center"}function G_(s,e,t,n){const{defaultColWidth:i,minColWidth:r,maxColWidth:o,fixedLeftWidth:a=0,fixedRightWidth:l=0}=e,c=E=>(typeof E=="function"&&(E=E.call(s)),E=w0(E,0),E<1&&(E=Math.round(E*n)),E),h={width:0,list:[],flexList:[],widthSetting:0,totalWidth:0},u={...h,list:[],flexList:[],widthSetting:c(a)},f={...h,list:[],flexList:[],widthSetting:c(l)},p={left:u,center:h,right:f},g=[],y={};let v=!1;const b=[],w={};if(t.forEach(E=>{const{colTypes:$,onAddCol:B}=E;$&&Object.entries($).forEach(([N,L])=>{w[N]||(w[N]=[]),w[N].push(L)}),B&&b.push(B)}),e.cols.forEach((E,$)=>{if(E.hidden)return;const{type:B="",name:N}=E,L={fixed:!1,flex:!1,width:i,minWidth:r,maxWidth:o,...E,type:B},V={name:N,type:B,setting:L,flex:0,left:0,width:0,realWidth:0,visible:!0,index:$,side:C0(L.fixed),sideIndex:0,order:L.order,border:L.border},M=w[B];M&&M.forEach(ye=>{const ce=typeof ye=="function"?ye.call(s,L):ye;ce&&Object.assign(L,ce,E)});const{flex:F,minWidth:K=r,maxWidth:X=o}=L,ae=w0(L.width||i,i);V.flex=F===!0?1:typeof F=="number"?F:0,V.width=b0(ae<1?Math.round(ae*n):ae,K,X),V.side=C0(L.fixed),b.forEach(ye=>ye.call(s,V)),g.push(V),y[V.name]=V;const ue=p[V.side];ue.list.push(V),ue.totalWidth+=V.width,ue.width=ue.totalWidth,V.flex&&ue.flexList.push(V),typeof V.order=="number"&&(v=!0)}),v){const E=($,B)=>($.order??$.index)-(B.order??B.index);g.sort(E),u.list.sort(E),h.list.sort(E),f.list.sort(E)}vh(f,!0);const S=n-f.width-Math.max(40,r);return vh(u,!0,S),h.widthSetting=n-u.width-f.width,vh(h),{list:g,map:y,...p}}function Y_(s){var ce;const{col:e,className:t,height:n,row:i,onRenderCell:r,style:o,outerStyle:a,children:l,outerClass:c,width:h,left:u,top:f,...p}=s,g={left:u??e.left,top:f??i.top,width:h??e.realWidth,height:n,...a},{align:y,cellStyle:v,cellClass:b,className:w}=e.setting,S={justifyContent:y?y==="left"?"start":y==="right"?"end":y:void 0,...v,...o},{name:E,border:$}=e,B=["dtable-cell",c,t,w,{"has-border-left":$===!0||$==="left","has-border-right":$===!0||$==="right"}],N=["dtable-cell-content",b],L=(ce=i.data)==null?void 0:ce[E],V=[l??L??""],M=r?r(V,{row:i,col:e,value:L},s,k):V,F=[],K=[],X={},ae={};let ue="div";M==null||M.forEach(ne=>{if(typeof ne=="object"&&ne&&!P.isValidElement(ne)&&("html"in ne||"className"in ne||"style"in ne||"attrs"in ne||"children"in ne||"tagName"in ne)){const _e=ne.outer?F:K;ne.html?_e.push(A("div",{className:ee("dtable-cell-html",ne.className),style:ne.style,dangerouslySetInnerHTML:{__html:ne.html},...ne.attrs??{}})):(ne.style&&Object.assign(ne.outer?g:S,ne.style),ne.className&&(ne.outer?B:N).push(ne.className),ne.children&&_e.push(ne.children),ne.attrs&&Object.assign(ne.outer?X:ae,ne.attrs)),ne.tagName&&!ne.outer&&(ue=ne.tagName)}else(typeof ne!="object"||P.isValidElement(ne))&&K.push(ne)});const ye=ue;return A("div",{className:ee(B),style:g,"data-col":E,"data-row":i.id,"data-type":e.type||null,...p,...X,children:[K.length>0&&A(ye,{className:ee(N),style:S,...ae,children:K}),F]})}function xh({rows:s=[],cols:e,rowHeight:t,scrollLeft:n=0,scrollTop:i=0,left:r=0,top:o=0,width:a,height:l="100%",className:c,CellComponent:h=Y_,cellClass:u,onRenderCell:f}){var v;const p=Array.isArray(s)?s:[s],g=((v=p[0])==null?void 0:v.top)??0,y=p.length;return A("div",{className:ee("dtable-cells",c),style:{top:o,left:r,width:a,height:l},children:A("div",{className:"dtable-cells-container",style:{left:-n,top:-i+g},children:p.reduce((b,w,S)=>{const E=e.length;return e.forEach(($,B)=>{b.push(A(h,{className:ee(`is-${w.index%2?"odd":"even"}-row`,B?"":"is-first-in-row",B===E-1?"is-last-in-row":"",S?"":"is-first-row",S===y-1?"is-last-row":"",u),col:$,row:w,top:w.top-g,height:t,onRenderCell:f},`${w.index}:${$.name}`))}),b},[])})})}function k0({top:s,height:e,rowHeight:t,rows:n,cols:{left:i,center:r,right:o},scrollLeft:a,scrollTop:l,className:c,cellClass:h,style:u,onRenderCell:f,children:p}){let g=null;i.list.length&&(g=A(xh,{className:"dtable-fixed-left",rows:n,scrollTop:l,cols:i.list,width:i.width,rowHeight:t,cellClass:h,onRenderCell:f},"left"));let y=null;r.list.length&&(y=A(xh,{rows:n,className:"dtable-scroll-center",scrollLeft:a,scrollTop:l,cols:r.list,left:i.width,width:r.width,rowHeight:t,cellClass:h,onRenderCell:f},"center"));let v=null;return o.list.length&&(v=A(xh,{className:"dtable-fixed-right",rows:n,scrollTop:l,cols:o.list,left:i.width+r.width,width:o.width,rowHeight:t,cellClass:h,onRenderCell:f},"right")),A("div",{className:ee("dtable-block",c),style:{...u,top:s,height:e},children:[g,y,v,p]})}var S0=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)},dt=(s,e,t)=>(S0(s,e,"read from private field"),t?t.call(s):e.get(s)),_t=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},Xt=(s,e,t)=>(S0(s,e,"access private method"),t),ls,Br,Nr,_h,D0,bh,E0,wh,A0,Ch,T0,Ma,kh,Ra,La,Sh,Dh,Eh,Ah,Fr,za,Oa,Th,$h,$0,Ih,I0;let Li=class extends ke{constructor(e){super(e),_t(this,_h),_t(this,bh),_t(this,wh),_t(this,Ch),_t(this,Ma),_t(this,Fr),_t(this,Oa),_t(this,$h),_t(this,Ih),this.ref=Ce(),this._rafId=0,this._needRender=!1,this._plugins=[],this._lastUsedPlugins=new Map,this._events=new Map,this._data={},this._i18nMaps=[],this._hover={in:!1},this.updateLayout=()=>{this._rafId&&cancelAnimationFrame(this._rafId),this._rafId=requestAnimationFrame(()=>{const{element:t}=this;t&&!Jn(t)&&this.update({dirtyType:"layout"}),this._rafId=0})},_t(this,ls,(t,n)=>{n=n||t.type;const i=this._events.get(n);if(i!=null&&i.length){for(const r of i)if(r.call(this,t)===!1){t.stopPropagation(),t.preventDefault();break}}}),_t(this,Br,t=>{dt(this,ls).call(this,t,`window_${t.type}`)}),_t(this,Nr,t=>{dt(this,ls).call(this,t,`document_${t.type}`)}),_t(this,Ra,(t,n,i,r)=>{const{row:o,col:a}=n;n.value=this.getCellValue(o,a),t[0]=n.value;const l=o.id==="HEADER"?"onRenderHeaderCell":"onRenderCell",c=(h,u)=>{try{t=h.call(this,t,n,i,r)}catch(f){console.error(`[ZUI] DTable render cell(${o.id}:${a.name}) by ${u} error:`,f)}};return a.setting[l]&&c(a.setting[l],"col"),this._plugins.forEach(h=>{h[l]&&c(h[l],`plugin (${h.name})`)}),this.options[l]&&c(this.options[l],"options"),t}),_t(this,La,(t,n)=>{n==="horz"?this.scroll({scrollLeft:t}):this.scroll({scrollTop:t})}),_t(this,Sh,t=>{var a,l,c;const n=this.getPointerInfo(t);if(!n)return;const{rowID:i,colName:r,cellElement:o}=n;if(i==="HEADER")o&&((a=this.options.onHeaderCellClick)==null||a.call(this,t,{colName:r,element:o}),this._plugins.forEach(h=>{var u;(u=h.onHeaderCellClick)==null||u.call(this,t,{colName:r,element:o})}));else{const h=this.layout.visibleRows.find(u=>u.id===i);if(o){if(((l=this.options.onCellClick)==null?void 0:l.call(this,t,{colName:r,rowID:i,rowInfo:h,element:o}))===!0)return;for(const u of this._plugins)if(((c=u.onCellClick)==null?void 0:c.call(this,t,{colName:r,rowID:i,rowInfo:h,element:o}))===!0)return}}}),_t(this,Dh,t=>{const n=t.key.toLowerCase();if(["pageup","pagedown","home","end"].includes(n))return!this.scroll({to:n.replace("page","")})}),_t(this,Eh,t=>{const n=_(t.target).closest(".dtable-cell");if(!n.length)return Xt(this,Fr,za).call(this,!1);Xt(this,Fr,za).call(this,[n.attr("data-row"),n.attr("data-col")])}),_t(this,Ah,()=>{Xt(this,Fr,za).call(this,!1)}),this._id=e.id??`dtable-${Bt()}`,this.state={scrollTop:0,scrollLeft:0,renderCount:0},this._allPlugins=Object.freeze(q_(e.plugins)),this._allPlugins.forEach(t=>{const{methods:n,data:i,state:r}=t;n&&Object.entries(n).forEach(([o,a])=>{typeof a=="function"&&Object.assign(this,{[o]:a.bind(this)})}),i&&Object.assign(this._data,i.call(this)),r&&Object.assign(this.state,r.call(this))}),Xt(this,Oa,Th).call(this),this._plugins.forEach(t=>{var n;(n=t.onCreate)==null||n.call(this,t)})}get options(){var e;return((e=this._layout)==null?void 0:e.options)||this._options||_0()}get plugins(){return this._plugins}get layout(){return this._layout}get id(){return this._id}get data(){return this._data}get element(){return this.ref.current}get parent(){var e;return this.props.parent??((e=this.element)==null?void 0:e.parentElement)}get hoverInfo(){return this._hover}componentWillReceiveProps(){this._options=void 0}shouldComponentUpdate(){return!0}componentDidMount(){this._needRender?this.forceUpdate():Xt(this,Ma,kh).call(this),this.on("click",dt(this,Sh)),this.on("keydown",dt(this,Dh));const{options:e}=this;(e.rowHover||e.colHover)&&(this.on("mouseover",dt(this,Eh)),this.on("mouseleave",dt(this,Ah)));let{responsive:t}=e;if(t){t===!0&&(t="window,parent");const n=t.split(",");if(typeof ResizeObserver<"u"){const i=[],r=new ResizeObserver(this.updateLayout);this._rob=r;const{parent:o}=this;n.forEach(a=>{a!=="window"&&(a==="parent"?o&&r.observe(o):a[0]==="~"?i.push(a.slice(1)):_(a).each((l,c)=>r.observe(c)))}),i.length&&this.on(i.join(" "),this.updateLayout)}n.includes("window")&&this.on("window_resize",this.updateLayout)}this._checkPluginsState()}componentDidUpdate(){Xt(this,Ma,kh).call(this),this._checkPluginsState(),this._plugins.forEach(e=>{var t;(t=e.onUpdated)==null||t.call(this)})}componentWillUnmount(){var t;(t=this._rob)==null||t.disconnect();const{element:e}=this;if(e)for(const n of this._events.keys())n.startsWith("window_")?window.removeEventListener(n.replace("window_",""),dt(this,Br)):n.startsWith("document_")?document.removeEventListener(n.replace("document_",""),dt(this,Nr)):e.removeEventListener(n,dt(this,ls));this._plugins.forEach(n=>{var i;(i=n.onUnmounted)==null||i.call(this)}),this._allPlugins.forEach(n=>{var i;(i=n.onDestory)==null||i.call(this)}),this._data={},this._events.clear(),this._noAnimation&&clearTimeout(this._noAnimation),this._rafId&&cancelAnimationFrame(this._rafId)}resetState(e,t){this._options=void 0,this._layout=void 0,e=e||this.props;const n={};this._plugins.forEach(i=>{const{resetState:r,state:o}=i;r&&(typeof r=="function"?Object.assign(n,r.call(this,e)):o&&Object.assign(n,o.call(this)))}),Object.keys(n).length&&this.setState(n)}on(e,t,n){var r;n&&(e=`${n}_${e}`);const i=this._events.get(e);i?i.push(t):(this._events.set(e,[t]),e.startsWith("window_")?window.addEventListener(e.replace("window_",""),dt(this,Br)):e.startsWith("document_")?document.addEventListener(e.replace("document_",""),dt(this,Nr)):(r=this.element)==null||r.addEventListener(e,dt(this,ls)))}off(e,t,n){var o;n&&(e=`${n}_${e}`);const i=this._events.get(e);if(!i)return;const r=i.indexOf(t);r>=0&&i.splice(r,1),i.length||(this._events.delete(e),e.startsWith("window_")?window.removeEventListener(e.replace("window_",""),dt(this,Br)):e.startsWith("document_")?document.removeEventListener(e.replace("document_",""),dt(this,Nr)):(o=this.element)==null||o.removeEventListener(e,dt(this,ls)))}emitCustomEvent(e,t){dt(this,ls).call(this,t instanceof Event?t:new CustomEvent(e,{detail:t}),e)}disableAnimation(e=200){var t;this._noAnimation&&clearTimeout(this._noAnimation),(t=this.element)==null||t.classList.add("no-animation"),this._noAnimation=window.setTimeout(()=>{var n;this._noAnimation=void 0,(n=this.element)==null||n.classList.remove("no-animation")},e)}scroll(e,t){const{scrollLeft:n,scrollTop:i,rowsHeightTotal:r,rowsHeight:o,rowHeight:a,cols:{center:{totalWidth:l,width:c}}}=this.layout,{to:h}=e;let{scrollLeft:u,scrollTop:f}=e;if(h==="up"||h==="down")f=i+(h==="down"?1:-1)*Math.floor(o/a)*a;else if(h==="left"||h==="right")u=n+(h==="right"?1:-1)*c;else if(h==="top")f=0;else if(h==="bottom")f=r-o;else if(h==="begin")u=0;else if(h==="end")u=l-c;else{const{offsetLeft:g,offsetTop:y}=e;typeof g=="number"&&(u=n+g),typeof y=="number"&&(f=i+y)}const p={};return typeof u=="number"&&(u=Math.max(0,Math.min(u,l-c)),u!==n&&(p.scrollLeft=u)),typeof f=="number"&&(f=Math.max(0,Math.min(f,r-o)),f!==i&&(p.scrollTop=f)),Object.keys(p).length?(this.setState(p,()=>{var g;(g=this.options.onScroll)==null||g.call(this,p),t==null||t.call(this,!0)}),!0):(t==null||t.call(this,!1),!1)}getColInfo(e){if(e===void 0)return;if(typeof e=="object")return e;const{cols:t}=this.layout;return typeof e=="number"?t.list[e]:t.map[e]}getRowInfo(e){if(e===void 0)return;if(typeof e=="object")return e;if(e===-1||e==="HEADER")return{id:"HEADER",index:-1,top:0};const{rows:t,rowsMap:n,allRows:i}=this.layout;return typeof e=="number"?t[e]:n[e]||i.find(r=>r.id===e)}getCellValue(e,t){var a;const n=typeof e=="object"?e:this.getRowInfo(e);if(!n)return;const i=typeof t=="object"?t:this.getColInfo(t);if(!i)return;let r=n.id==="HEADER"?i.setting.title:(a=n.data)==null?void 0:a[i.name];const{cellValueGetter:o}=this.options;return o&&(r=o.call(this,n,i,r)),r}getRowInfoByIndex(e){return this.layout.rows[e]}update(e={},t){if(!this._options)return;typeof e=="function"&&(t=e,e={});const{dirtyType:n,state:i}=e;if(n==="layout")this._layout=void 0;else if(n==="options"){if(this._options=void 0,!this._layout)return;this._layout=void 0}this.setState(i||(r=>({renderCount:r.renderCount+1})),t)}getPointerInfo(e){const t=e.target;if(!t||t.closest(".no-cell-event"))return;const n=_(t).closest(".dtable-cell");if(!n.length)return;const i=n.attr("data-row"),r=n.attr("data-col");if(!(typeof r!="string"||typeof i!="string"))return{cellElement:n[0],colName:r,rowID:i,target:t}}componentDidCatch(e,t){console.error(`[ZUI] DTable ${this.id} Error:`,e,t)}i18n(e,t,n){return Oe(this._i18nMaps,e,t,n,this.options.lang)??`{i18n:${e}}`}getPlugin(e){return this.plugins.find(t=>t.name===e)}_checkPluginsState(){const e=new Set(this._lastUsedPlugins.keys());this._plugins.forEach(t=>{var i;if(e.has(t.name)){e.delete(t.name);return}let{events:n}=t;n&&(typeof n=="function"&&(n=n.call(this)),Object.entries(n).forEach(([r,o])=>{o&&this.on(r,o)})),(i=t.onMounted)==null||i.call(this),this._lastUsedPlugins.set(t.name,t)}),e.size&&e.forEach(t=>{var i;const n=this._lastUsedPlugins.get(t);(i=n==null?void 0:n.onUnmounted)==null||i.call(this),this._lastUsedPlugins.delete(t)})}render(){let e=Xt(this,Ih,I0).call(this);const{className:t,rowHover:n,colHover:i,cellHover:r,bordered:o,striped:a,scrollbarHover:l,beforeRender:c,emptyTip:h,style:u}=this.options,f={...u},p=["dtable",t,{"dtable-hover-row":n,"dtable-hover-col":i,"dtable-hover-cell":r,"dtable-bordered":o,"dtable-striped":a,"scrollbar-hover":l,"no-animation":this._noAnimation}],g=[];if(e){const y=!e.rows.length;if(c){const v=c.call(this,e);v&&(e=v)}this._plugins.forEach(v=>{var w;const b=(w=v.beforeRender)==null?void 0:w.call(this,e);b&&(e=b)}),f.width=e.width,f.height=e.height,f["--dtable-row-height"]=`${e.rowHeight}px`,f["--dtable-header-height"]=`${e.headerHeight}px`,p.push(e.className,y?"dtable-is-empty":"",{"dtable-has-scroll-y":e.rowsHeightTotal>e.rowsHeight,"dtable-scrolled-down":e.scrollTop>0,"dtable-scrolled-bottom":e.scrollTop>=e.rowsHeightTotal-e.rowsHeight,"dtable-scrolled-right":e.scrollLeft>0,"dtable-scrolled-end":e.scrollLeft>=e.cols.center.totalWidth-e.cols.center.width}),e.children&&g.push(...e.children),y&&h?(delete f.height,g.push(A("div",{className:"dtable-empty-tip",children:A(Se,{content:h,generatorThis:this,generatorArgs:[e]})},"empty-tip"))):(g.push(Xt(this,_h,D0).call(this,e),Xt(this,bh,E0).call(this,e),Xt(this,wh,A0).call(this,e)),e.scrollable&&g.push(Xt(this,Ch,T0).call(this,e))),this._plugins.forEach(v=>{var w;const b=(w=v.onRender)==null?void 0:w.call(this,e);b&&(b.style&&Object.assign(f,b.style),b.className&&p.push(b.className),b.children&&g.push(b.children))})}return A("div",{id:this._id,className:ee(p),style:f,ref:this.ref,tabIndex:-1,children:g})}};ls=new WeakMap,Br=new WeakMap,Nr=new WeakMap,_h=new WeakSet,D0=function(s){const{header:e,cols:t,headerHeight:n,scrollLeft:i,headerChildren:r}=s;if(!e)return null;if(e===!0)return A(k0,{className:"dtable-header",cols:t,height:n,scrollLeft:i,rowHeight:n,scrollTop:0,cellClass:"dtable-header-cell",rows:{id:"HEADER",index:-1,top:0},top:0,onRenderCell:dt(this,Ra),children:r},"header");const o=Array.isArray(e)?e:[e];return A(kc,{className:"dtable-header",style:{height:n},renders:o,generateArgs:[s],generatorThis:this,children:r},"header")},bh=new WeakSet,E0=function(s){const{headerHeight:e,rowsHeight:t,visibleRows:n,rowHeight:i,cols:r,scrollLeft:o,scrollTop:a,bodyChildren:l}=s;return A(k0,{className:"dtable-body",top:e,height:t,rows:n,rowHeight:i,scrollLeft:o,scrollTop:a,cols:r,onRenderCell:dt(this,Ra),children:l},"body")},wh=new WeakSet,A0=function(s){let{footer:e}=s;if(typeof e=="function"&&(e=e.call(this,s)),!e)return null;const t=Array.isArray(e)?e:[e];return A(kc,{className:"dtable-footer",style:{height:s.footerHeight,top:s.rowsHeight+s.headerHeight},renders:t,generateArgs:[s],generatorThis:this,generators:s.footerGenerators,children:s.footerChildren},"footer")},Ch=new WeakSet,T0=function(s){const e=[],{scrollLeft:t,cols:{left:{width:n},center:{width:i,totalWidth:r}},scrollTop:o,rowsHeight:a,rowsHeightTotal:l,footerHeight:c,headerHeight:h}=s,{scrollbarSize:u=12,horzScrollbarPos:f,vertScrollbarPos:p}=this.options;return r>i&&e.push(A(m0,{type:"horz",scrollPos:t,scrollSize:r,clientSize:i,onScroll:dt(this,La),left:n,bottom:(f==="inside"?0:-u)+c,size:u,wheelContainer:this.ref},"horz"),A("div",{className:"dtable-scroll-shadow is-left",style:{left:n,height:h+a}}),A("div",{className:"dtable-scroll-shadow is-right",style:{left:n+i,height:h+a}})),l>a&&e.push(A(m0,{type:"vert",scrollPos:o,scrollSize:l,clientSize:a,onScroll:dt(this,La),right:p==="outside"?-u:0,size:u,top:h,wheelContainer:this.ref},"vert")),e.length?e:null},Ma=new WeakSet,kh=function(){var s;this._needRender=!1,this._plugins.forEach(e=>{var t;return(t=e.afterRender)==null?void 0:t.call(this)}),(s=this.options.afterRender)==null||s.call(this)},Ra=new WeakMap,La=new WeakMap,Sh=new WeakMap,Dh=new WeakMap,Eh=new WeakMap,Ah=new WeakMap,Fr=new WeakSet,za=function(s){const{element:e,options:t}=this;if(!e)return;const n=_(e),i=s?{in:!0,row:s[0],col:s[1]}:{in:!1};t.colHover==="header"&&i.row!=="HEADER"&&(i.col=void 0);const r=this._hover;i.in!==r.in&&n.toggleClass("dtable-hover",i.in),i.row!==r.row&&(n.find(".is-hover-row").removeClass("is-hover-row"),i.row&&n.find(`.dtable-cell[data-row="${i.row}"]`).addClass("is-hover-row")),i.col!==r.col&&(n.find(".is-hover-col").removeClass("is-hover-col"),i.col&&n.find(`.dtable-cell[data-col="${i.col}"]`).addClass("is-hover-col")),this._hover=i},Oa=new WeakSet,Th=function(){if(this._options)return!1;const e={..._0(),...this._allPlugins.reduce((t,n)=>{const{defaultOptions:i}=n;return i&&Object.assign(t,i),t},{}),...this.props};return this._options=e,this._plugins=this._allPlugins.reduce((t,n)=>{const{options:i}=n;let r=e;return i&&(r=Object.assign({...r},typeof i=="function"?i.call(this,e):i)),r!==e&&Object.assign(e,r),t.push(n),t},[]).filter(t=>{const{when:n}=t;return!n||n.call(this,e)}),this._i18nMaps=[this.options.i18n,...this.plugins.map(t=>t.i18n)].filter(Boolean),!0},$h=new WeakSet,$0=function(){var V,M;const{plugins:s}=this;let e=this._options;const t={flex:A("div",{style:"flex:auto"}),divider:A("div",{style:"width:1px;margin:var(--space);background:var(--color-border);height:50%"})};s.forEach(F=>{var X;const K=(X=F.beforeLayout)==null?void 0:X.call(this,e);K&&(e={...e,...K}),Object.assign(t,F.footer)});let n=e.width,i=0;if(typeof n=="function"&&(n=n.call(this)),n==="100%"){const{parent:F}=this;if(F)i=F.clientWidth;else{this._needRender=!0;return}}const r=G_(this,e,s,i),{data:o,rowKey:a="id",rowHeight:l=35,rowConverter:c}=e,h=[],u=(F,K,X)=>{var ye,ce;const ae=X??{[a]:F},ue={data:c?c.call(this,ae,K):ae,id:F,index:h.length,top:0};if(X||(ue.lazy=!0),h.push(ue),((ye=e.onAddRow)==null?void 0:ye.call(this,ue,K))!==!1){for(const ne of s)if(((ce=ne.onAddRow)==null?void 0:ce.call(this,ue,K))===!1)return}};if(typeof o=="number")for(let F=0;F<o;F++)u(`${F}`,F);else Array.isArray(o)&&o.forEach((F,K)=>{typeof F=="object"?u(`${F[a]??""}`,K,F):u(`${F??""}`,K)});let f=h;const p={};if(e.onAddRows){const F=e.onAddRows.call(this,f,r);F&&(f=F)}for(const F of s){const K=(V=F.onAddRows)==null?void 0:V.call(this,f,r);K&&(f=K)}f.forEach((F,K)=>{p[F.id]=F,F.index=K,F.top=F.index*l});const{header:g,footer:y}=e,v=g?e.headerHeight||l:0,b=y?e.footerHeight||l:0;let w=e.height,S=0;const E=f.length*l,$=v+b+E;if(typeof w=="function"&&(w=w.call(this,$)),w==="auto")S=$;else if(typeof w=="object")S=Math.min(w.max,Math.max(w.min,$));else if(w==="100%"){const{parent:F}=this;if(F)S=F.clientHeight;else{S=0,this._needRender=!0;return}}else S=w;const B=S-v-b,N={options:e,allRows:h,width:i,height:S,rows:f,rowsMap:p,rowHeight:l,rowsHeight:B,rowsHeightTotal:E,header:g,footer:y,footerGenerators:t,headerHeight:v,footerHeight:b,cols:r},L=(M=e.onLayout)==null?void 0:M.call(this,N);L&&Object.assign(N,L),s.forEach(F=>{if(F.onLayout){const K=F.onLayout.call(this,N);K&&Object.assign(N,K)}}),this._layout=N},Ih=new WeakSet,I0=function(){(Xt(this,Oa,Th).call(this)||!this._layout)&&Xt(this,$h,$0).call(this);const{layout:s}=this;if(!s)return;const{cols:{center:e}}=s;let{scrollLeft:t}=this.state;t=Math.min(Math.max(0,e.totalWidth-e.width),t);let n=0;e.list.forEach(g=>{g.left=n,n+=g.realWidth,g.visible=g.left+g.realWidth>=t&&g.left<=t+e.width});const{rowsHeightTotal:i,rowsHeight:r,rows:o,rowHeight:a}=s,l=Math.min(Math.max(0,i-r),this.state.scrollTop),c=Math.floor(l/a),h=l+r,u=Math.min(o.length,Math.ceil(h/a)),f=[],{rowDataGetter:p}=this.options;for(let g=c;g<u;g++){const y=o[g];y.lazy&&p&&(y.data=p([y.id])[0],y.lazy=!1),f.push(y)}return Object.assign(s,{visibleRows:f,scrollTop:l,scrollLeft:t,headerChildren:[],bodyChildren:[],footerChildren:[],children:[],className:"",scrollable:!0}),s},Li.addPlugin=g0,Li.removePlugin=y0;class X_ extends ke{constructor(){super(...arguments),this._dtablePlugins=["sort","zentao","resize","pager"],this._dtable=Ce(),this._createActionItem=(e,t)=>{var n,i;return e.command=e.command.replace("{id}",String(t.row.data.id)),e.key==="move"&&((i=(n=this.props).canMoveDoc)==null?void 0:i.call(n,t.row.data))===!1&&(e.disabled=!0),e},this._getToolbar=e=>{const{getActions:t}=this.props,n=t==null?void 0:t("doc-table",{ui:"table-foot-toolbar",dtable:e});if(n)return{btnProps:{size:"sm",btnType:"secondary"},items:n}}}_getCols(){const e={edit:{hint:"编辑",icon:"edit",command:"startEditDoc/{id}",key:"edit"},move:{hint:"移动",icon:"folder-move",command:"moveDoc/{id}",key:"move"},delete:{hint:"删除",icon:"trash",command:"deleteDoc/{id}",key:"trash"}},{searchKeys:t=[]}=this.props;return[{name:"rawID",title:"ID",type:"checkID",sort:"number"},{name:"title",title:"标题",type:"title",onRenderCell:(r,o)=>{const a=o.row.data,l=a.title;return r[0]=k("div",{className:"row items-center gap-1 cursor-pointer","zui-command":`selectDoc/${a.id}`},k(Re,{icon:a.icon??this.props.docIcon,className:a.icon?"":"text-special"})," ",k("a",{title:l,className:"doc-list-item-title text-primary"},t.length?vt.underlineKeys(t,[l]):l)),a.status==="draft"&&r.push(k("div",{className:"label special-pale size-sm rounded-full ml-1 flex-none"},"草稿")),r},sort:!0},{name:"collects",title:"收藏数",onRenderCell:(r,o)=>{const a=o.row.data;return a.api?[]:[k($e,{type:"ghost",size:"sm",text:a.collects||0,icon:a.isCollector?"star text-warning":"star-empty text-gray","zui-command":`collectDoc/${o.row.id}`})]},sort:"number",cellClass:"px-2",fixed:"left"},{name:"views",title:"浏览数",sort:"number",align:"center"},{name:"addedBy",title:"创建者",type:"user",sort:!0},{name:"addedDate",title:"创建日期",type:"date",sort:!0},{name:"editedBy",title:"修改者",type:"user",sort:!0},{name:"editedDate",title:"修改日期",type:"date",sort:!0},{name:"actions",title:"操作",type:"actions",width:96,minWidth:96,actionsMap:e,actions:["edit","move","delete"],actionItemCreator:this._createActionItem}]}_getTableOptions(e){const{docs:t,userMap:n,getTableOptions:i,app:r,orderBy:o}=e;let a="",l="";typeof o=="string"&&o&&([a,l]=o.split("_"));const c=t.map(u=>u.data);["order","id"].includes(a)&&l&&(l==="asc"?c.sort((u,f)=>u.order-f.order):c.sort((u,f)=>f.order-u.order));const h={width:"100%",height(u){var p;const f=(p=this.element)==null?void 0:p.parentElement;return f?Math.min(u,f.clientHeight):u},cols:this._getCols(),checkable:!0,sort:!0,plugins:this._dtablePlugins,data:c,userMap:n,colResize:!0,footToolbar:this._getToolbar,footer:["checkbox","toolbar","checkedInfo","flex","pager"],localPager:!0,loadPartial:!0,canRowCheckable:u=>+String(u)==+u?!0:"disabled",emptyTip:k("div",{className:"center gap-4"},k("div",{className:"text-gray"},r.getLang("noDocs","没有文档")),Xe.render({items:r.getActions("doc-list",{ui:"doc-list-empty"})},[])),footPager:{items:r.getPagerItems()}};return(i==null?void 0:i(h,{type:"doc-list"}))??h}render(e){return k("div",{class:ee("doc-list h-full col",e.className)},k(Li,{ref:this._dtable,...this._getTableOptions(e)}))}}const zi=class extends kt{_getFileIcon(e,t){if(!t)return null;const n=typeof t;return n==="string"?t:(t=t||this.props.fileIcon,n==="function"?t.call(this,e):t[e.extension]||"file")}_getItems(e){const t=super._getItems(e),{fileIcon:n,fileSizeFormat:i,itemProps:r,heading:o,fileUrl:a,fileActions:l}=e,c=t.map(h=>{let u=null;return typeof h.size=="number"&&(u=Dt(h.size),i&&(u=Te(i,{size:u}))),{key:`${h.id}`,icon:this.constructor.getFileIcon(h,n),iconClass:"text-gray",title:h.title,subtitle:u,multiline:!1,url:typeof a=="function"?a.call(this,h):a?Te(a,h):void 0,actions:l?l.call(this,h):void 0,...r}});return o&&c.unshift({key:"heading",titleClass:"font-bold",type:"heading",...o}),c}_getRenderedItem(e,t){return t}static getFileIcon(e,t){if(!t)return null;const n=typeof t;return n==="string"?t:n==="function"?t.call(this,e):t[e.extension]||"file"}static getDefaultIconMap(){return[["file-image",["png","jpg","jpeg","gif","bmp","webp","tiff","ico","svg"]],["file-audio",["mp3","wav","flac","ogg","m4a","wma","aac","aiff","alac"]],["file-video",["mp4","avi","mkv","mov","flv","wmv","webm"]],["file-archive",["zip","rar","7z","tar","gz","bz2","xz"]],["file-code",["js","ts","jsx","tsx","html","css","scss","less","json","xml","yml","yaml","toml","ini","markdown"]],["file-pdf",["pdf"]],["file-log",["log"]],["markdown",["md"]],["file-word",["doc","docx"]],["file-excel",["xls","xlsx"]],["file-powerpoint",["ppt","pptx"]],["file-text",["txt","csv"]]].reduce((t,[n,i])=>(i.forEach(r=>{t[r]=n}),t),{})}};zi.NAME="file-list",zi.defaultProps={...kt.defaultProps,fileSizeFormat:"({size})",fileIcon:zi.getDefaultIconMap()},zi.TAG="div",zi.defaultItemProps={component:"div"};let Pr=zi;function B0(s){s=s||location.search,s[0]==="?"&&(s=s.substring(1));try{const e=new URLSearchParams(s),t={};for(const n of e.keys())t[n]=e.getAll(n).join(",");return t}catch{return{}}}function N0(s){if(!s)return{url:s};const{config:e}=window;if(/^https?:\/\//.test(s)){const l=window.location.origin;if(!s.includes(l))return{external:!0,url:s};s=(e.webRoot.endsWith("/")?"/":"")+s.substring((l+e.webRoot).length)}const t=s.split("#"),n=t[0].split("?"),i=n[1],r=i?B0(i):{};let o=n[0];const a={url:s,isOnlyBody:r.onlybody==="yes",vars:[],hash:t[1]||"",params:r,tid:r.tid||""};if(e.requestType==="GET"){a.moduleName=r[e.moduleVar]||"index",a.methodName=r[e.methodVar]||"index",a.viewType=r[e.viewVar]||e.defaultView;for(const l in r)l!==e.moduleVar&&l!==e.methodVar&&l!==e.viewVar&&l!=="onlybody"&&l!=="tid"&&a.vars.push([l,r[l]])}else{let l=o.lastIndexOf("/");l===o.length-1&&(o=o.substring(0,l),l=o.lastIndexOf("/")),l>=0&&(o=o.substring(l+1));const c=o.lastIndexOf(".");c>=0?(a.viewType=o.substring(c+1),o=o.substring(0,c)):a.viewType=e.defaultView;const h=o.split(e.requestFix);if(a.moduleName=h[0]||"index",a.methodName=h[1]||"index",h.length>2)for(let u=2;u<h.length;u++)a.vars.push(["",h[u]]),r["$"+(u-1)]=h[u]}return a}function zt(s,e,t,n,i,r){if(typeof s=="object")return zt(s.moduleName,s.methodName,s.vars,s.viewType,s.hash,s.params);const o=window.config||{};if(t){typeof t=="string"&&(t=t.split("&"));for(let c=0;c<t.length;c++){const h=t[c];if(typeof h=="string"){const u=h.split("=");t[c]=[u.shift(),u.join("=")]}}}const a=[],l=o.requestType==="GET";if(l){if(a.push(o.router,"?",o.moduleVar,"=",s,"&",o.methodVar,"=",e),t)for(let c=0;c<t.length;c++)a.push("&",t[c][0],"=",t[c][1]);n&&n!==o.defaultView&&a.push("&",o.viewVar,"=",n)}else{if(o.requestType=="PATH_INFO"&&a.push(o.webRoot,s,o.requestFix,e),o.requestType=="PATH_INFO2"&&a.push(o.webRoot,"index.php/",s,o.requestFix,e),t)for(let c=0;c<t.length;c++)a.push(o.requestFix+t[c][1]);n=n||o.defaultView,n&&a.push(".",n)}return r&&Object.keys(r).forEach(c=>{const h=r[c];c[0]!=="$"&&a.push(!l&&!a.includes("?")?"?":"&",c,"=",h)}),typeof i=="string"&&a.push(i.startsWith("#")?"":"#",i),a.join("")}const Bh=class nr extends ke{constructor(){super(...arguments),this._files=at(),this._loadID="",this._timer=0,this._handleChangePager=e=>{this.props.app.resetPager("files",{...e})}}_filterFiles(e){if(!(e!=null&&e.length))return e;const{currentUser:t,onGetUser:n,searchKeys:i=[],filterType:r}=this.props,o=r&&r!=="all";if(!o&&!i.length)return e;const a=["title","id","addedBy","addedDate","extension","objectType","sourceName",l=>`.${l.extension}`,n?l=>n(l.addedBy).realname:null].filter(Boolean);return e.filter(l=>!(o&&!nr.isFileMatchFilter(l,r,t)||i.length&&!vt.isItemMatch(l,i,a)))}_getCols(){const{searchKeys:e=[],fileUrl:t,app:n}=this.props,i=l=>typeof t=="function"?t.call(this,l):t?Te(t,l):void 0;return[{name:"id",title:"ID",type:"id",sort:"number"},{name:"title",title:"附件名称",type:"title",width:300,onRenderCell:(l,c)=>{var g;const h=c.row.data,u=nr.getFilterTypeFromExt(h.extension),f=u?(g=nr.filterTypeConfig[u])==null?void 0:g.iconClass:void 0,p=h.title;return l[0]=k("a",{title:p,href:i(h),target:"_blank",className:"doc-list-item-title text-primary"},e.length?vt.underlineKeys(e,[p]):p),l.unshift(k(Re,{icon:Pr.getFileIcon(h,Pr.getDefaultIconMap())||"file",className:f})),l},sort:!0},{name:"objectName",title:"来源",type:"text",sort:!0,width:400,flex:1,cellClass:"px-2",onRenderCell:(l,c)=>{const h=c.row.data,{objectType:u,objectID:f,sourceName:p}=h;if(!u||!f)return l;const g=zt(u,"view",`${u}ID=${f}`),y=`#${f} ${p}`,v=u==="doc";return l.push(k("a",{"data-toggle":v?void 0:"modal","data-size":v?void 0:"lg",href:g,title:`${h.objectName??""}${y}`},y)),l}},{name:"extension",title:"类型",sort:!0,align:"center"},{name:"size",title:"大小",format:Dt,sort:"number"},{name:"addedBy",title:"由谁添加",type:"user",sort:!0},{name:"addedDate",title:"创建日期",type:"date",sort:!0},{name:"actions",title:"操作",fixed:"right",width:64,minWidth:64,onRenderCell:(l,c)=>{const h=c.row.data;return l[0]=k($e,{type:"ghost",className:"text-primary",size:"sm",icon:"download",hint:n.getLang("downloadFile","下载文件"),target:"_blank",url:i(h)}),l}}]}async loadFiles(){const{filesFetcher:e,objectID:t,objectType:n}=this.props;this._files.value=void 0,this._loadID=[n,t].join();const i=await Et(e,[{objectID:+t,objectType:n}]);[this.props.objectType,this.props.objectID].join()===this._loadID&&(this._files.value=i||[])}tryLoadFiles(){this._loadID!==[this.props.objectType,this.props.objectID].join()&&(this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout(()=>{this._timer=0,this._loadID!==[this.props.objectType,this.props.objectID].join()&&this.loadFiles()},100))}componentDidMount(){this.tryLoadFiles()}componentDidUpdate(){this.tryLoadFiles()}componentWillUnmount(){this._timer&&clearTimeout(this._timer)}_getTableOptions(e,t){const{app:n}=e,i={width:"100%",height(r){var a;const o=(a=this.element)==null?void 0:a.parentElement;return o?Math.min(r,o.clientHeight):r},cols:this._getCols(),checkable:!1,className:"h-full",sort:!0,sortBy:{name:"id",order:"asc"},plugins:["sort","zentao","resize","pager"],data:t||[],userMap:e.userMap,colResize:!0,localPager:!0,loadPartial:!0,emptyTip:t?k("div",{className:"center gap-4 text-gray"},n.getLang("noFiles","没有文件")):null,footPager:{items:n.getPagerItems(),onChangePageInfo:this._handleChangePager}};return n.getTableOptions(i,{type:"file-list"})??i}render(e){const t=this._filterFiles(this._files.value),n=this._getTableOptions(e,t);return k("div",{className:`doc-lib-files h-full col load-indicator${t?"":" loading"}`,"data-loading":e.app.getLang("loadingFilesTip","正在加载文件...")},k(Li,{...n}))}static getFilterTypeFromExt(e){const[t]=Object.entries(nr.filterExtensions).find(([,n])=>n.has(e))||[];return t}static isFileMatchFilter(e,t,n){if(t==="addedByMe")return e.addedBy===n;if(t==="bug"||t==="story"||t==="task")return e.objectType===t;const{filterExtensions:i}=nr,{extension:r}=e;if(t==="other")return Object.values(i).every(a=>!a.has(r));const o=i[t];return o==null?void 0:o.has(r)}};Bh.filterTypeConfig={all:{text:"全部",icon:"file-alt",iconClass:"text-gray"},story:{text:"需求",icon:"lightbulb",iconClass:"text-primary"},bug:{text:"Bug",icon:"bug",iconClass:"text-danger"},task:{text:"任务",icon:"checkbox",iconClass:"text-secondary"},office:{text:"Office",icon:"file-word",iconClass:"text-primary"},doc:{text:"文档",icon:"file-text",iconClass:"text-secondary"},image:{text:"图片",icon:"file-image",iconClass:"text-warning"},av:{text:"音视频",icon:"file-video",iconClass:"text-danger"},archive:{text:"压缩包",icon:"file-archive",iconClass:"text-important"},code:{text:"代码",icon:"file-code",iconClass:"text-success"},other:{text:"其他",icon:"file",iconClass:"text-gray"},addedByMe:{text:"由我添加",icon:"person",iconClass:"text-primary"}},Bh.filterExtensions={av:new Set(["mp3","wav","flac","ogg","m4a","wma","aac","aiff","alac","mp4","avi","mkv","mov","flv","wmv","webm"]),image:new Set(["png","jpg","jpeg","gif","bmp","webp","tiff","ico","svg"]),code:new Set(["js","ts","jsx","tsx","html","css","scss","less","json","xml","yml","yaml","toml","ini","markdown","log"]),doc:new Set(["pdf","txt","md"]),office:new Set(["doc","docx","xls","xlsx","ppt","pptx"]),archive:new Set(["zip","rar","7z","tar","gz","bz2","xz","exe","dmg"])};let Nh=Bh;class Z_ extends ke{constructor(){super(...arguments),this.state={},this._menu=Ce(),this._ref=Ce(),this._getTreeItem=e=>{var y;const t=e.data,n=t.id;if(e.type==="doc")return{className:"item tree-item",type:"item",key:e.key,icon:t.icon??(t.type==="chapter"?this.props.chapterIcon:this.props.docIcon),selected:n===this.props.docID,text:t.title,hint:t.title,items:(y=e.docs)!=null&&y.length?[...e.docs]:void 0,innerClass:"group",innerComponent:"div",actions:this.props.app.getItemActions("doc",t,"sidebar"),_data:e};const{moduleIcon:i,moduleID:r,lib:o,docID:a,app:l}=this.props,c=l.props.libColors,{modules:h=[],docs:u=[]}=e,f=e.type==="lib";let p=t.icon;if(p===void 0)if(f){const v=t.type==="api"?this.props.apiLibIcon:this.props.libIcon;p=typeof v=="string"&&c?{icon:v,style:{color:c[n%c.length]}}:v}else p=i;const g={className:"item tree-item",type:"item",key:e.key,text:t.name,icon:p,items:f?void 0:[...h,...u],iconClass:f?"gray-pale w-5 h-5 center rounded-lg":"",selected:!1,innerClass:"group",innerComponent:"div",actions:this.props.app.getItemActions(e.type,t,"sidebar"),hint:t.name,_data:e};if(!a){const v=o==null?void 0:o.data.id;f&&!r?g.selected=n===v:!f&&r&&(g.selected=n===r)}return g},this._toggleSearchBox=()=>{this.setState({search:!this.state.search})},this._handleToggleTree=()=>{const{nestedShow:e,defaultShow:t}=this._menu.current.state,n=(!e||!Object.keys(e))&&!t;this.setState({isExpandAll:n})},this._toggleTree=()=>{var t;const{isExpandAll:e}=this.state;(t=this._menu.current)==null||t.toggleAll(!this.state.isExpandAll),this.setState({isExpandAll:!e})},this._handleClickItem=e=>{var n,i,r,o,a,l,c,h;if(e.event.target.closest(".item-icon,.nested-toggle-icon"))return;const t=e.renderedItem._data;t&&(t.type==="doc"?(i=(n=this.props).onSelectDoc)==null||i.call(n,t.data):t.type==="lib"?(o=(r=this.props).onSelectLib)==null||o.call(r,t.data.id):t.type==="files"?(l=(a=this.props).onShowFiles)==null||l.call(a):(h=(c=this.props).onSelectLib)==null||h.call(c,t.data.lib,t.data.id))},this._handleClickFileFilter=e=>{this.props.app.setFilterType(e.item.key,"files")}}_renderFooterToolbar(e){var n,i;const t=(i=(n=this.props).getActions)==null?void 0:i.call(n,e,"current","sidebar-toolbar");if(t!=null&&t.length)return Xe.render({items:t},[],{type:"ghost",size:"sm"})}_renderFooterHint(e){const t=this.props.app.renderCustom("sidebar-footer-hint",e);if(t!==void 0&&typeof t!="string")return t;let n="";if(typeof t=="string")n=t;else{const{space:i,spaceType:r,lib:o,showFiles:a,app:l}=this.props;if(i){const c=l.getLang("colon",": ");n=`${l.getLang(["spaceTypeNames",r],[],{custom:"空间",mine:"空间",product:"产品",project:"项目"}[r]||r)}${c}${i.name}`,o?n+=` ${l.getLang("libNamePrefix","库")}${c}${o.data.name}`:a&&(n+=` ${l.getLang("libNamePrefix","库")}${c}${l.getLang("filesLib","附件库")}`)}}return k("div",{className:"flex-auto text-gray text-clip overflow-hidden whitespace-nowrap",title:n},n)}_renderFooter(e){const t=this.props.app.renderCustom("sidebar-footer",e);return t!==void 0?t:k("div",{key:"actions",className:"doc-tree-actions row items-center flex-none surface-light h-9 border-t pl-2 pr-1"},this._renderFooterHint(e),this._renderFooterToolbar(e))}_getLibs(e){const{libs:t,app:n,onShowFiles:i,libTypes:r=[],libFilesIcon:o="annex-lib"}=e,a=[],l=i?{key:"project-files",text:n.getLang("filesLib","附件库"),icon:o,iconClass:"success-pale w-5 h-5 center rounded-lg",actions:!1,selected:e.showFiles,_data:{type:"files"}}:null;if(!(r!=null&&r.length))return a.push(...t.map(f=>this._getTreeItem(f))),l&&a.push(l),[a,!1];const[c,h]=Q_(t,r,n.spaceType),u=!!h.size;return r.forEach((f,p)=>{const g=c.get(f.type)||[];if(g.length)if(a.push({key:`lib-type-${f.type}`,type:"heading",text:f.name,content:k("span",{className:"label size-sm rounded-full gray-pale"},g.length+(l&&!p?1:0)),icon:f.icon,actions:!1,className:p&&a.length>1?"mt-1.5 pt-1 border-t":""}),u){const y=new Set,v=g.reduce((b,w)=>{const S=w.data.execution,E=S?h.get(S):null;if(E&&E.length>1){if(y.has(S))return b;y.add(S),b.push({className:"item tree-item",type:"item",key:`e${S}`,text:w.data.executionName??w.data.name,innerComponent:"div",icon:"run",iconClass:"text-gray",items:E.map($=>({...this._getTreeItem($),text:$.data.originName}))})}else b.push(this._getTreeItem(w));return b},[]);a.push(...v)}else a.push(...g.map(y=>this._getTreeItem(y)));!p&&l&&a.push(l)}),[a,u]}_renderLibList(e){const{libs:t,app:n,space:i}=e;if(!(t!=null&&t.length))return k("div",{key:"empty",className:"center gap-4 h-full"},k("div",{className:"text-gray"},n.getLang("noLibs","没有文档库")),Xe.render({items:n.getActions("space",{ui:"sidebar-no-lib",data:i})},[]));const[r,o]=this._getLibs(e),a=e.app.getSortableOptions("lib");return k("div",{key:"list",className:"doc-tree flex-auto min-w-0 overflow-y-auto scrollbar-hover"},o?k(a?ki:Ft,{ref:this._menu,wrapClass:"doc-lib-list doc-lib-tree px-1",className:"p-2",items:r,activeOnHover:!1,defaultNestedShow:!0,hoverItemActions:!0,itemKey:"key",lines:!0,nestedToggle:".item-icon,.nested-toggle-icon",onToggle:this._handleToggleTree,onClickItem:this._handleClickItem,...a}):k(a?Cr:kt,{className:"doc-lib-list p-2",itemKey:"key",items:r,activeOnHover:!1,hoverItemActions:!0,onClickItem:this._handleClickItem,itemProps:{titleClass:"text-clip"},...a}))}_renderModuleTree(e){const{lib:t,app:n}=e,i=t?[...t.modules,...t.docs].filter(a=>!a.data.deleted):[];if(!i.length)return k("div",{key:"empty",className:"center gap-4 h-full"},k("div",{className:"text-gray"},n.getLang("noModules","没有目录")),Xe.render({items:n.getActions("lib",{ui:"sidebar-no-module",data:t})},[]));const r=e.app.getSortableOptions("doc-module");return k("div",{key:"list",className:"doc-tree flex-auto min-w-0 overflow-y-auto scrollbar-hover"},k(r?ki:Ft,{ref:this._menu,wrapClass:"doc-lib-list doc-lib-tree px-1",className:ee("p-2",t?"":"pl-3"),items:i,activeOnHover:!1,defaultNestedShow:!0,hoverItemActions:!0,itemKey:"key",lines:!0,nestedToggle:".item-icon,.nested-toggle-icon",getItem:this._getTreeItem,onToggle:this._handleToggleTree,onClickItem:this._handleClickItem,...r}))}_renderFileFilterList(e){const t=["all","story","bug","task","office","doc","image","av","archive","code","other"].map(i=>({key:i,...Nh.filterTypeConfig[i]}));e.currentUser&&t.push({key:"addedByMe",...Nh.filterTypeConfig.addedByMe});const n=e.app.filterType;return k(kt,{className:"doc-file-filter-list py-2 px-3",itemKey:"key",items:t.map(i=>({...i,selected:i.key===n})),activeOnHover:!1,onClickItem:this._handleClickFileFilter})}_scrollToSelected(){const e=this._ref.current.querySelector(".item>.selected");e&&_(e).scrollIntoView({behavior:"smooth"})}componentDidMount(){this._sidebar=new Ia(this._ref.current,{width:240,minWidth:64,maxWidth:400,parent:".doc-app",side:"left",preserve:this.props.preserve}),this._scrollToSelected()}componentDidUpdate(e){(e.moduleID!==this.props.moduleID||e.docID!==this.props.docID)&&this._scrollToSelected()}componentWillUnmount(){var e;(e=this._sidebar)==null||e.destroy()}render(e){const{className:t,lib:n,showFiles:i,app:r}=e,o=!n||i;return k("div",{className:ee("doc-sidebar sidebar border-r flex-none z-50 col",t),ref:this._ref},r.renderCustom("sidebar-before",this),o?this._renderLibList(e):this._renderModuleTree(e),r.renderCustom("sidebar-after",this),this._renderFooter(o?"space":"lib"))}}function Q_(s,e,t){const n=new Map,i=new Map;for(const{type:o}of e)i.set(o,[]);const r=i.get(t);for(const o of s){const{type:a=""}=o.data;if(i.has(a)?i.get(a).push(o):r&&r.push(o),a!=="execution")continue;const l=o.data.execution;n.has(l)?n.get(l).push(o):n.set(l,[o])}return[i,n]}function js(s){return typeof s=="string"&&String(+s)===s?+s:s}function F0(s){return typeof s=="string"?+s.replace("api.",""):s}function J_(s,e,t){const n=new Map,i=new Map,r=new Map,o=[];if(e){const{libs:a=[],docs:l=[],modules:c=[]}=e;for(const u of a){if(u.deleted||u.space!==s&&!t)continue;const p={type:"lib",key:`l${u.id}`,docs:[],modules:[],data:u};n.set(u.id,p),o.push(p)}const h=[];for(const u of c){if(u.deleted)continue;const f=`m${u.id}`,p=n.get(u.lib);if(!p||p.data.type==="api"&&u.type!=="api")continue;const g={type:"module",key:f,docs:[],modules:[],data:u,parent:p};i.set(u.id,g),u.parent?h.push(g):p.modules.push(g)}if(h.length)for(const u of h){const f=i.get(u.data.parent);f&&(f.modules.push(u),u.parent=f)}for(const u of l){const f=`${u.id}`,p=n.get(u.lib);if(!p&&u.lib!==s)continue;const g={type:"doc",key:f,data:u,parent:p,docs:[]};r.set(u.id,g)}for(const u of r.values()){if(u.data.parent){const g=r.get(u.data.parent);if(g){g.docs.push(u),u.parent=g;continue}}const f=i.get(u.data.module),p=n.get(u.data.lib);f?(f.docs.push(u),u.parent=f):p&&p.docs.push(u)}}return{libs:n,modules:i,docs:r,libList:o}}function Mr(s,e=[],t){if(e.push(...t?s.docs.map(n=>n.data):s.docs),s.modules)for(const n of s.modules)Mr(n,e,t);for(const n of s.docs)Mr(n,e,t);return e}const P0=1e9;let eb=P0;function tb(){return eb++}function M0(s){return s>=P0}function nb(s){const{link:e,itemProps:t={},typeIconMap:n={},labelMap:i={},searchKeys:r,active:o,itemType:a="",checkIcon:l,hideDirIcon:c}=this,{id:h,keys:u,text:f,className:p,type:g,url:y,items:v,icon:b,label:w,...S}=s;let{type:E}=s;E=E==="item"?a:E||a;let $=v?w??(i[E]||E):null,B;typeof $=="string"&&$.length&&(B=$,$=k("span",{class:"label rounded-full gray-pale size-sm ml-1"},$));let N=y;N===void 0&&e&&(typeof e=="function"?N=e(s):typeof e=="object"?(N=e[E],N&&(N=Te(N,s))):v||(N=Te(e,s)));let L=b;L===void 0&&(!c||N)&&(L=n[E]),typeof L=="string"&&(L={icon:L},B&&_.extend(L,{"data-toggle":"tooltip","data-title":B}));let V=f??(i[E]||E);r!=null&&r.length&&(V=Rs.underlineKeys(r,[V]));const M=String(o)===String(h);return{type:"item",key:h,content:$,icon:L,trailingIcon:l&&M?{icon:"check",className:"mx-1 text-primary"}:void 0,items:v,"data-url":N,"data-type":E,title:V,selected:M,hint:f,...t,...S,className:ee("dropmenu-item tree-item",p,t.className,v?"is-dir":"is-item"),innerClass:N?"is-link open-url":"is-toggle",active:!1}}function R0(s){const{className:e,items:t,tree:n,onClickItem:i,defaultNestedShow:r}=s;return k(Ft,{items:t,getItem:nb.bind(s),className:ee(e,"dropmenu-tree"),defaultNestedShow:r,onClickItem:i,...n})}const sb=(s,e)=>{const{keys:t="",text:n}=s;return!e.length||e.every(i=>t.toLowerCase().includes(i)||typeof n=="string"&&n.toLowerCase().includes(i))},L0=(s,e,t=0)=>(s=s.reduce((n,i)=>{const{items:r}=i;if(r){if(r.length){const[o,a]=L0(r,e);o.length&&(n.push({...i,items:o}),t+=a)}}else sb(i,e)&&(n.push(i),t++);return n},[]),[s,t]);class ib extends Zc{constructor(e){super(e),this._searchbox=Ce(),this._list=Ce(),this._handleSearch=t=>{this.setState({search:t})},this._handleExpandBtnClick=()=>{this.expand()},this._handleItemClick=({item:t,event:n})=>{const i=_(n.target);!i.closest(".tree-toggle").length&&i.closest(".is-link").length&&(this.props.togglePop(!1,{text:t.text??`${t.type}:${t.id}`}),this.props.changeState({text:t.text??`${t.type||""}:${t.id}`,value:t.id}))},this._scrollToActive=()=>{requestAnimationFrame(()=>{const t=this._list.current;t&&_(t).find(".tree-item-inner.active").scrollIntoView()})},this.activeTab=t=>{this.setState({active:t})},this.expand=t=>{this.setState({expanded:t??!this.state.expanded})},this.state={search:"",data:e.data,expanded:!1,loading:!!e.fetcher&&!e.data}}async load(){var n,i;let{fetcher:e}=this.props;if(!e)return this._scrollToActive();if(typeof e=="string"&&(e={url:e}),typeof e=="object"){const{url:r,...o}=e;e=()=>_.ajax({url:r,dataType:"json",jsonParser:Gl,...o})}this.setState({loading:!0});let t=await e();t.result&&(t=t.data),t={...this.props.data,...t},this.setState({data:t,loading:!1},this._scrollToActive),(i=(n=this.props).onCacheData)==null||i.call(n,t)}componentDidMount(){var e;super.componentDidMount(),this.props.data||this.load(),(e=this._searchbox.current)==null||e.focus(),this._scrollToActive()}_getTreeProps(e){const{data:{labelMap:t,link:n,typeIconMap:i,typeLabelMap:r,itemProps:o,tree:a,itemType:l,checkIcon:c,hideDirIcon:h=!0}={},search:u}=this.state,f=_.unique(u.toLowerCase().split(" ").filter(p=>p.length));return{items:f.length&&e.items.length>100?e.items.slice(0,100):e.items,labelMap:t,typeIconMap:{execution:"run",project:"project",product:"product",program:"cards-view",...i},hideDirIcon:h,typeLabelMap:r,itemProps:o,itemType:l,checkIcon:c,onClickItem:this._handleItemClick,tree:a,link:n,active:this.props.state.value,defaultNestedShow:!!((e.count||e.items.length)<100||f.length||e.index===0&&!e.expand),searchKeys:f}}_getData(){const{data:e={},search:t,active:n}=this.state,{tabs:i=[{name:"other"}],expandName:r}=e;let{data:o=[]}=e;Array.isArray(o)&&(o={other:o});const a={},l=_.unique(t.toLowerCase().split(" ").filter(f=>f.length));let c,h;Object.keys(o).forEach(f=>{const p=r===f,g=i.find(E=>E.name===f)||{name:f},y=o[f]||[],v=(n===f||g.active&&n===void 0)&&!p,[b,w]=L0(y,l),S={name:f,items:b,text:g.text,active:v,count:w,index:0,expand:p};p?c=S:(a[f]=S,v&&(h=S))});const u=i.reduce((f,{name:p})=>{if(p!==r){const g=a[p]||{name:p,items:[]};g.index=f.length,f.push(g)}return f},[]);return!h&&u.length&&(h=u[0]),{tabs:u,expandData:c,activeTab:h}}_renderList(e,t,n){const i=t.name,{expanded:r,data:o={},search:a}=this.state;let{hideSingleTab:l=!0}=o;return l=e.length===1&&l,k(Mn,null,l?null:k("div",{className:"dropmenu-nav"},k("ul",{key:"nav",className:"nav nav-secondary"},e.map(({name:c,text:h,count:u})=>k("li",{className:"nav-item"},k("a",{className:`${i===c?" active":""}`,onClick:this.activeTab.bind(this,c)},h||c,u?k("span",{className:"label gray-pale rounded-full size-sm font-normal"},u):null))))),k("div",{key:"tab",className:"flex-auto dropmenu-list scrollbar-hover"},k(R0,{key:`${i}${a!=null&&a.length?"-search":""}`,...this._getTreeProps(t)})),n?k("div",{key:"foot",className:"dropmenu-foot flex-none toolbar justify-between border-t"},o.footToolbar?Xe.render(o.footToolbar,[]):k("div",{className:"flex-auto"}),k($e,{type:"ghost text-dark rounded gap-0.5 px-1.5",trailingIcon:`angle-${this.state.expanded?"left":"right"} opacity-60`,onClick:this._handleExpandBtnClick},n.text||n.name," ",n.count&&r?k("span",{className:"ml-1 label gray-pale rounded-full size-sm font-normal"},n.count):null)):null)}_renderExpand(e){const{search:t}=this.state;return k("div",{className:"col w-1/2 dropmenu-list scrollbar-hover"},k(R0,{key:`${e.name}${t!=null&&t.length?"-search":""}`,...this._getTreeProps(e)}))}_renderPop(){const{expanded:e,data:t={}}=this.state,{searchHint:n,search:i=!0,title:r}=t,{expandData:o,tabs:a,activeTab:l}=this._getData(),c=e&&o;return k(Mn,null,i?k("div",{key:"search",className:"p-3 flex-none"},k(Ms,{ref:this._searchbox,className:"size-md",placeholder:n,onChange:this._handleSearch})):null,r?k("div",{className:"dropmenu-title"},r):null,k("div",{class:"row flex-auto min-h-0",ref:this._list},k("div",{class:`col w-${c?"1/2":"full"}`},this._renderList(a,l,o)),c?k("div",{class:"w-px bg-gray opacity-10"}):null,e&&o&&this._renderExpand(o)))}_getClass(e){const{expanded:t,loading:n,data:i={}}=this.state;return ee("dropmenu load-indicator col",super._getClass(e),t&&"is-expanded",n&&"loading",i.search!==!1&&"has-search",i.title?"has-title":"")}_getStyle(e={},t){e=super._getStyle(e,t);const{width:n=248}=this.props;return typeof n=="number"&&(e.width=n*(this.state.expanded?2:1)),e}_getProps(e){const{style:t,...n}=super._getProps(e),i=this.trigger,r=i==null?void 0:i.getBoundingClientRect();return{...n,style:{...t,...this._getStyle(),maxHeight:r?Math.max(r.top-8,window.innerHeight-r.bottom-8):t.maxHeight}}}}class rb extends oa{_getProps(e){const t=super._getProps(e);return{type:"button","data-value":e.state.value,...t}}_renderTrigger(e){const{text:t,state:n,children:i,caret:r,leadingAngle:o,display:a}=e;let l=n.text??t??"";return a&&(l=typeof a=="function"?a.call(this,l,n):a),[o&&k(Re,{icon:"angle-right",className:"is-leading"}),k("span",{key:"text",className:"text",title:typeof l=="string"?l:void 0},l??i),r&&k("div",{key:"caret",class:"is-caret"},k("span",{className:"caret"}))]}}let Rr=class extends xt{constructor(){super(...arguments),this._setCacheData=e=>{const{cache:t}=this.props;t&&(this._cacheData=e,typeof t=="number"&&(this._cacheTimer&&clearTimeout(this._cacheTimer),this._cacheTimer=window.setTimeout(()=>{this._cacheData=void 0,this._cacheTimer=0},t)))}}getDefaultState(e){return{...super.getDefaultState(e),text:void 0}}componentWillUnmount(){super.componentWillUnmount(),this._cacheTimer&&clearTimeout(this._cacheTimer)}componentWillReceiveProps(e){(this.props.data!==e.data||this.props.fetcher!==e.fetcher)&&(this._cacheData=void 0)}_getTriggerProps(e,t){const{className:n,...i}=super._getTriggerProps(e,t),{value:r=""}=t;return{...i,className:ee(n,{"has-value":r.length}),text:e.text,caret:e.caret,maxWidth:e.maxWidth,leadingAngle:e.leadingAngle,display:e.display}}_getPopProps(e,t){return{...super._getPopProps(e,t),data:this._cacheData||e.data,fetcher:e.fetcher,cache:!!e.cache,onCacheData:this._setCacheData,onClickItem:e.onClickItem}}};Rr.defaultProps={...xt.defaultProps,popWidth:248,popMaxHeight:800,maxWidth:160,className:"dropmenu-btn btn ghost",tagName:"button",clickType:"toggle",leadingAngle:!0,caret:!0,cache:60*1e3*4},Rr.Pop=ib,Rr.Trigger=rb;class ob extends ke{constructor(){super(...arguments),this._handleClickItem=(e,t)=>{var n,i;e.target.closest(".dropmenu-nav")||e.target.closest(".dropmenu-foot")||(i=(n=this.props).onSelect)==null||i.call(n,+t,!0)}}render(e){const{space:t,fetcher:n,menuOptions:i}=e;return k(Rr,{text:t==null?void 0:t.name,defaultValue:t==null?void 0:t.id.toString(),onClickItem:this._handleClickItem,fetcher:n,leadingAngle:!1,...i})}}class z0 extends ke{constructor(){super(...arguments),this._picker=Ce(),this._getItems=()=>{const{spaces:e=[],spaceIcon:t}=this.props;return e.map(n=>({id:n.id,icon:t,text:n.name,value:n.id,className:"group"}))},this._renderCurrent=()=>{const{space:e}=this.props;return k("div",{class:"row items-center"},k("div",{className:"text-md flex-none"},e==null?void 0:e.name),k("span",{className:"caret"}))},this._handleClick=e=>{var t,n,i;!this.props.noClickTrigger&&!e.target.closest(".doc-space-picker-toggle")&&((i=(n=this.props).onSelect)==null||i.call(n,((t=this.props.space)==null?void 0:t.id)||0,!0),e.preventDefault())},this._handleItemClick=e=>{var i,r;const t=this._picker.current;if(!t)return;const n=e.item.value;(r=(i=this.props).onSelect)==null||r.call(i,n,!0),t.select(n),t.close()}}render(e){const{getSpaceFetcher:t,spaceID:n,space:i,spaceType:r,onSelect:o,menuOptions:a}=e;if(t){const f=t(r,n);if(f)return k(ob,{fetcher:f,space:i,onSelect:o,menuOptions:a})}const{spaces:l=[],searchBox:c=!0}=e,h=i||l[0],u={searchBox:c,search:void 0,onClickItem:this._handleItemClick};return k(fn,{ref:this._picker,className:"doc-space-picker ring-transparent cursor-pointer state bg-transparent w-auto",popClass:"popup doc-space-picker-menu",style:{maxWidth:200},items:this._getItems,defaultValue:h?String(h.id):"",required:!0,search:!1,cache:!1,caretClass:"hidden",menu:u,popMinWidth:200,display:this._renderCurrent,onClick:this._handleClick})}}z0.defaultProps={noClickTrigger:!0};class Lr extends ke{constructor(){super(...arguments),this._picker=Ce(),this._getItems=()=>{const{items:e=[],icon:t,apiIcon:n,chapterIcon:i,current:r,getItems:o}=this.props,a=e.filter(l=>!l.data.deleted).map(l=>({id:l.data.id,icon:l.type==="lib"&&l.data.type==="api"?n:l.type==="doc"&&l.data.type==="chapter"?i:t,text:this._getItemText(l),value:l.data.id,selected:(r==null?void 0:r.key)===l.key}));return o?o(a):a},this._renderCurrent=()=>{const{current:e,placeholder:t,type:n,suffixIcon:i,children:r}=this.props,o=n==="lib";return k("div",{class:ee("row items-center",o?"gap-2":"gap-1")},k("div",{className:ee("row items-center",o?"text-md":"",e?"":"text-gray")},e?this._getItemText(e):t,k("span",{className:"caret"})),r,i?k(Re,{icon:i}):null)},this._handleClick=e=>{var t,n,i;!this.props.noClickTrigger&&!e.target.closest(".doc-path-picker-toggle")&&((i=(n=this.props).onSelect)==null||i.call(n,((t=this.props.current)==null?void 0:t.data.id)||0,this.props.type),e.preventDefault())},this._handleItemClick=e=>{var i,r;const t=this._picker.current;if(!t)return;const n=e.item.value;(r=(i=this.props).onSelect)==null||r.call(i,js(n),e.item.dataType),t.select(n),t.close()}}_getItemText(e){return e?e.type==="doc"?e.data.title:e.data.name:""}render(e){const{current:t,type:n,maxWidth:i,display:r,searchBox:o=!0}=e,a={searchBox:o,search:void 0,onClickItem:this._handleItemClick};return k(fn,{ref:this._picker,className:"doc-path-picker ring-transparent cursor-pointer state bg-transparent w-auto",popClass:"popup doc-path-picker-menu",style:{maxWidth:i},items:this._getItems,defaultValue:t?String(t.data.id):"",search:!1,cache:!1,caretClass:"hidden",menu:a,popMinWidth:200,required:n!=="lib",display:r??this._renderCurrent,onClick:this._handleClick})}}Lr.defaultProps={type:"module",maxWidth:160,noClickTrigger:!0};class ab extends ke{constructor(){super(...arguments),this._handleSelectModule=e=>{var t,n;(n=(t=this.props).onSelectModule)==null||n.call(t,+e,!0)},this._handleSelectLib=(e,t)=>{var n,i;t==="files"?this.props.app.showFiles():(i=(n=this.props).onSelectLib)==null||i.call(n,+e,0)},this._unselectLib=()=>{var e,t;(t=(e=this.props).onSelectLib)==null||t.call(e,0,0)},this._handleSelectVersion=e=>{var t,n;(n=(t=this.props).onSelectDocVersion)==null||n.call(t,e.item.version)},this._handleRestoreDocVersion=async()=>{const{app:e,doc:t}=this.props,{version:n=1,id:i}=t==null?void 0:t.data,r=this.props.docVersion||n;await Ke.confirm({title:e.getLang("restoreVersionHint","恢复到版本")+` #${r}`,message:e.getLang("restoreVersionConfirm",[{version:r}],"这将使用文档版本 #{version} 的内容创建一个新的版本，确定要继续吗？")})&&e.restoreDoc(i,r)},this._getLibItems=e=>{const{app:t,libIcon:n,showFiles:i}=this.props;return t.canShowLibFiles?[...e,{text:t.getLang("filesLib","附件库"),icon:n,key:"files",dataType:"files",selected:!!i,disabled:!1}]:e}}_renderAngle(e){return k("div",{key:e,class:"doc-path-picker-angle chevron-right scale-75 opacity-75 flex-none"})}_renderModulePickers(e){const{module:t}=e;if(!t)return[];let n=t;const i=[];for(;n;){const{parent:o}=n;if(i.push(n),o.type!=="module")break;n=o}const r=[];return i.reverse().forEach((o,a)=>{if(i.length>=3&&a>0&&a<i.length-1){a===1&&r.push(["module-ellipsis",k("div",{key:"module-ellipsis",class:"doc-path-picker-angle mx-1 opacity-50"},k("div",{className:"more"}))]);return}const{key:l}=o;r.push([`${l}-angle`,k(Lr,{key:l,icon:e.moduleIcon,current:o,items:o.parent.modules,searchBox:{placeholder:this.props.app.getLang("searchModulePlaceholder","searchModulePlaceholder")},onSelect:this._handleSelectModule})])}),r}_renderParents(e){var c,h;const{doc:t,app:n,docIcon:i,onSelectDoc:r}=e;if(!t||((c=t.parent)==null?void 0:c.type)!=="doc")return[];let o=t.parent;const a=[];for(;o&&(a.push(o),((h=o.parent)==null?void 0:h.type)==="doc");)o=o.parent;const l=[];return a.reverse().forEach((u,f)=>{var g;if(a.length>=3&&f>0&&f<a.length-1){f===1&&l.push(["parent-ellipsis",k("div",{key:"parent-ellipsis",class:"doc-path-picker-angle mx-1 opacity-50"},k("div",{className:"more"}))]);return}const{key:p}=u;l.push([`${p}-angle`,k(Lr,{key:p,type:"doc",icon:i,chapterIcon:n.props.chapterIcon,current:u,items:(g=u.parent)==null?void 0:g.docs,searchBox:{placeholder:n.getLang("searchPlaceholder","搜索")},onSelect:r,maxWidth:300})])}),l}_renderCurrent(e){var l,c;const{doc:t,creatingDoc:n,editingDoc:i,docIcon:r,onSelectDoc:o,app:a}=e;if(n)return k($e,{key:"doc",type:"ghost",icon:r,className:"mr-4 min-w-0 justify-start"},k("span",{className:"text-gray min-w-0 overflow-hidden"},n.title),k("span",{className:"label size-sm rounded-full primary-pale flex-none"},a.getLang("newDocLabel","新文档")));if(i)return k($e,{key:"doc",type:"ghost",icon:r,className:"mr-4 min-w-0 justify-start"},k("span",{className:"text-gray min-w-0 overflow-hidden"},i.title),k("span",{className:"label size-sm rounded-full primary-pale flex-none"},a.getLang("editingDocLabel","编辑中")));if(t){const{version:h=1,privs:u={},id:f}=t.data,p=e.docVersion||h,g=!t.data.deleted&&!t.data.api&&h>1&&p!==h&&(((l=a.props.privs)==null?void 0:l.restoreDoc)??u.edit!==!1),y=a.isLoadingDoc(f);return[k(Lr,{key:"doc",type:"doc",icon:r,chapterIcon:a.props.chapterIcon,current:t,items:(c=t.parent)==null?void 0:c.docs,onSelect:o,searchBox:{placeholder:a.getLang("searchPlaceholder","搜索")},maxWidth:300,suffixIcon:i?"draft-edit":void 0}),h>1?k("div",{key:"version",className:"hint mx-1","data-hint":a.getLang("currentDocVersionHint","当前版本，点击切换")},k(as,{text:`#${p}`,size:"xs",type:"gray-pale",rounded:"full",className:"h-4",items:Array(h).fill(0).map((v,b)=>({text:`#${h-b}`,version:h-b,selected:p===h-b})),menu:{onClickItem:this._handleSelectVersion}})):null,g?k("div",{key:"restoreVersion","data-hint":`${a.getLang("restoreVersionHint","恢复到版本")} #${p}`,className:"hint ml-1"},k($e,{disabled:y,text:a.getLang("restoreVersion","恢复"),type:"ghost text-primary",size:"sm",rounded:"full",onClick:this._handleRestoreDocVersion})):null,t.data.status==="draft"?k("div",{key:"status",className:"label special-pale size-sm rounded-full ml-1"},a.getLang("draft","草稿")):null]}return null}_renderLibPicker(e){const{lib:t,libs:n,libIcon:i,apiLibIcon:r,libPlaceholder:o,showFiles:a,app:l}=e;return!t&&!a?null:k(Lr,{key:"lib",type:"lib",icon:i,apiIcon:r,current:t,items:n,getItems:this._getLibItems,display:a?()=>k("div",{class:"row items-center gap-2"},k("div",{class:"text-md"},l.getLang("filesLib","附件库")),k("span",{className:"caret"})):void 0,placeholder:o,searchBox:{placeholder:l.getLang("searchLibPlaceholder","搜索库")},onSelect:this._handleSelectLib})}render(e){const{spaceIcon:t,space:n,spaces:i,onSelectSpace:r,children:o,homeName:a,noSpace:l,getSpaceFetcher:c,spaceID:h,spaceType:u,app:f}=e;let p;if(l)p=l==="hidden"?null:k($e,{icon:n?t:"home",type:"ghost",iconClass:"w-4 h-4 center rounded-md primary flex-none",textClass:"text-md",text:n==null?void 0:n.name,onClick:this._unselectLib});else if(n){let E=f.props.spaceMenuOptions;typeof E=="function"&&(E=E.call(f,u,h)),p=k(z0,{key:"space",spaceIcon:t,space:n,spaces:i,searchBox:{placeholder:f.getLang("searchSpacePlaceholder","搜索空间")},onSelect:r,getSpaceFetcher:c,spaceType:u,spaceID:h,menuOptions:E})}const g=this._renderLibPicker(e),y=this._renderModulePickers(e),v=this._renderParents(e),b=this._renderCurrent(e);let w=[];a!==!1&&w.push(["home",k($e,{key:"home-btn",icon:"home",size:"md",type:"ghost text-primary",hint:typeof a=="string"?a:void 0,command:"goHome",...typeof a=="object"?a:{}})]),w.push(["space",p]),g&&w.push(["lib",g]),y&&w.push(...y),v&&w.push(...v),b&&w.push(["current",b]);const S=f.getCustomRender("app-nav");return S&&(w=S.call(f,w,this)||w),k("div",{className:"doc-app-nav row items-center flex-auto min-w-0"},w.reduce((E,[$,B],N)=>(B==null||(Array.isArray(B)?E.push(...B):E.push(B),N<w.length-1&&E.push(this._renderAngle($+"-angle"))),E),[]),o)}}function Fh(){var s;return(s=window.frameElement)==null?void 0:s.closest("affine-zui-iframe")}function Ph(){const s=Fh();if(!s)return;const e=s.getAttribute("data-block-id"),t=s.closest("editor-host");if(!(!t||!e))return t.std.doc.getBlock(e)}function lb(){const s=Ph();s&&s.doc.deleteBlock(s.model)}function cb(s){const e=Ph();e&&e.doc.updateBlock(e.model,s)}function hb(){var s;return(s=Fh())==null?void 0:s.adjustHeight()}const ub={getElement:Fh,get:Ph,delete:lb,update:cb,adjustHeight:hb};function Mh(s,e){var n;if(Array.isArray(s))return s.map(i=>Mh(i,e));let t=s;return(n=t.children)!=null&&n.length&&(t={...s,children:Mh(s.children,e)}),e(t)}const pn=class Ve extends Je{constructor(){super(...arguments),this._lastChangeContent="",this._assetsMap=new Map,this._isEmpty=!0,this._hocuspocusProvider=null}get collection(){if(!this._collection)throw new Error("Editor._collection must be initialized!");return this._collection}get schema(){if(!this._schema)throw new Error("Editor._schema must be initialized!");return this._schema}get doc(){if(!this._doc)throw new Error("Editor._doc must be initialized!");return this._doc}get editor(){if(!this._editor)throw new Error("Editor._editor must be initialized!");return this._editor}get host(){return this.editor.host}get title(){var e;return((e=this.doc.meta)==null?void 0:e.title)??this.options.title??"Untitled"}get context(){var r,o;const e=(r=this.doc.root)==null?void 0:r.id;if(!e||!this.host)return;const t=this.host.view.getBlock(e);if(!t)return;const n=this.host.selection.find("text");if(!n)return;const i=(o=this.host.doc.getBlock(n.blockId))==null?void 0:o.model;if(i)return{rootComponent:t,model:i}}get isEmpty(){return Ve.Module.utils.isEmptyDoc(this.doc)}get rootService(){try{return this.editor.std.getService("affine:page")}catch{return null}}async readyToUseHocuspocus(e,t=!0){try{if(!e)return null;const n=typeof e=="string"?JSON.parse(e):e,{Y:i,utils:r}=Ve.Module,o=n.meta.id,{hocuspocusUrls:a,token:l}=this.options,c=a==null?void 0:a[0];if(!c||!l)return null;if(t&&(await(await fetch(`${c}/doc/${this.options.docID}@${o}/exists`)).json()).data)return o;const h=await r.convertSnapshotToYDoc(n,this.getBlockSources());if(!h)return null;const u=i.encodeStateAsUpdate(h);return(await(await fetch(`${c}/doc/${this.options.docID}@${o}/init`,{method:"POST",body:u,headers:{"Content-Type":"application/octet-stream",token:l}})).json()).result==="success"?o:null}catch(n){return console.error("Ready to use hocuspocus error:",n),null}}async afterInit(){const{schema:e,collection:t,content:n,mode:i,contentType:r,title:o,uid:a,onLoadingLibChange:l,useHocuspocus:c}=this.options,{store:h}=await Ve.loadModule(l);if(this.destroyed)return;const{DocCollection:u}=h;if(this._uid=a||Hs(13),c){const{checkExists:f=!0}=typeof c=="object"?c:{},p=await this.readyToUseHocuspocus(n,f);if(p){this.initHocuspocusDoc({docId:p,mode:i});return}}this._schema=e||Ve.createSchema(),this._collection=t||new u({schema:this.schema,blobSources:this.getBlockSources()}),this._collection.meta.initialize(),this._editor=Ve.createEditor(i),await this.updateDoc(n,r,o),this.doc.history.clear(),await this.syncData(!0),this.element.appendChild(this.editor),this.$element.addClass("affine-theme").on("syncData",()=>this.syncData())}async initHocuspocusDoc({docId:e,mode:t}){const{store:n}=Ve.Module,{DocCollection:i}=n;this._schema=this.options.schema||Ve.createSchema(),this._collection=new i({schema:this.schema,blobSources:this.getBlockSources()}),this.collection.start(),this.collection.meta.initialize(),this._doc=this.collection.createDoc({id:e}),this.createHocuspocusProvider(),this.doc.load(),this._editor=Ve.createEditor(t),this.editor.doc=this.doc,this.element.appendChild(this.editor)}destroyHocuspocusProvider(){var e;(e=this._hocuspocusProvider)==null||e.destroy()}setDocReadonly(){this.options.readonly&&this.collection.awarenessStore.setReadonly(this.collection.getBlockCollection(this.doc.id),!0)}getBlockSources(){const{onDownload:e,downloadUrl:t,onUpload:n}=this.options;if(!e&&!n&&!t)return;const i=this._assetsMap;return{main:{name:this._uid,readonly:!1,get:async r=>{const o=i.get(r);if(o)return o;if(e)try{const a=await e({key:r,editorID:this._uid}),l=a==null?void 0:a.blob;if(l)return i.set(r,l),l}catch(a){console.error("[ZUI] download file failed",a)}else if(t){let a=t;if(r.startsWith("data:"))a=r;else if(/https?:\/\//.test(r)){const h=window.EDITOR_IMAGE_PROXY_ENDPOINT;a=h?`${h}?url=${encodeURIComponent(r)}`:r}else a=Te(t,{objectType:"doc",objectID:this.options.docID,gid:btoa(`g-${r}`),title:"",extra:"editor"});const c=await(await fetch(a)).blob();return i.set(r,c),c}return null},set:async(r,o)=>{if(i.set(r,o),n)try{await n({key:r,blob:o,editorID:this._uid})}catch(a){console.error("[ZUI] update file failed",a)}return r},delete:async r=>{i.delete(r)},list:async()=>Array.from(i.keys())}}}render(e,t){super.render(e,t),t&&this.updateDoc(this.options.content,void 0,this.options.title)}async getHtml(e){const{store:t}=Ve.Module,n=this.doc,i=n.collection;return e||(e=new t.Job({collection:i}).docToSnapshot(n)),e?await Ve.convertToHtml(e,i,this.options.downloadUrl):""}async export(e="pdf",t){const{blocks:n}=Ve.Module,i=this.editor.std.get(n.ExportManager);return i?(_("body").addClass("editor-is-exporting"),e==="png"?await i.exportPng():e==="markdown"?await this.exportMarkdown():e==="json"?await this.exportSnapshot(t):e==="html"?await this.exportHtml():await i.exportPdf(),_("body").removeClass("editor-is-exporting"),!0):!1}exportMarkdown(){var t;const e=(t=this.rootService)==null?void 0:t.transformers.markdown;return e==null?void 0:e.exportDoc(this.doc)}exportHtml(){var t;const e=(t=this.rootService)==null?void 0:t.transformers.html;return e==null?void 0:e.exportDoc(this.doc)}async exportSnapshot(e){const t=await this.toSnapshot(),n=new Blob([JSON.stringify(t)],{type:"application/json"});mi(n,`${e??(t==null?void 0:t.meta.title)??this.title}.json`)}exportPDF(){return this.export("pdf")}exportPNG(){return this.export("png")}getBlock(e){var t;if(e instanceof HTMLElement&&(e=((t=e.closest("[data-block-id]"))==null?void 0:t.getAttribute("data-block-id"))||""),typeof e=="string")return this.doc.getBlock(e)}deleteBlock(e){const t=this.getBlock(e);if(t)return this.doc.deleteBlock(t.model),!0}updateBlock(e,t){const n=this.getBlock(e);n&&this.doc.updateBlock(n.model,t)}_createEmptyDoc(){const e=Ve.createEmptyDoc(this.collection);return this._isEmpty=!0,e}async _importSnapshot(e){const{store:t}=Ve.Module,n=e,i=this.collection,r=new t.Job({collection:i});let o;try{o=await r.snapshotToDoc(n),o&&i.setDocMeta(o.id,{createDate:n.meta.createDate})}catch(a){console.error("[ZUI] parse doc content error:",a)}return o||this._createEmptyDoc()}async importHTML(e){return await Ve.importHtml(e,this.collection)||this._createEmptyDoc()}async importConfluence(e){return await Ve.importConfluence(e,this.collection)||this._createEmptyDoc()}async importMarkdown(e){const{blocks:t}=Ve.Module,n=this.collection,i=await t.MarkdownTransformer.importMarkdownToDoc({collection:n,markdown:e});return i?n.getDoc(i)||this._createEmptyDoc():this._createEmptyDoc()}_migrateFrom(e){return e.$migrate==="html"?this.importHTML(e.$data):e.$migrate==="markdown"?this.importMarkdown(e.$data):e.$migrate==="confluence"?this.importConfluence(e.$data):this._createEmptyDoc()}async updateDoc(e="",t="snapshot",n){if(this._doc&&this._doc.dispose(),e==="")this._doc=this._createEmptyDoc();else if(t==="doc"||t==="snapshot"||typeof e=="object")try{for(;typeof e=="string";)e=JSON.parse(e);e.$migrate?this._doc=await this._migrateFrom(e):this._doc=await this._importSnapshot(e),this._lastChangeContent=typeof e=="string"?e:JSON.stringify(e)}catch(c){this._doc=this._createEmptyDoc(),console.error("[ZUI] parse doc content error:",c)}else t==="html"?this._doc=await this.importHTML(e):t==="markdown"?this._doc=await this.importMarkdown(e):t==="confluence"?this._doc=await this.importConfluence(e):this._doc=this._createEmptyDoc();const{readonly:i,name:r,htmlName:o}=this.options;this.setDocReadonly();const a=(c,h)=>{const u=document.createElement("input");return u.type="hidden",u.name=c,u.value=h||"",this.element.appendChild(u),u};r&&(this._input||(this._input=a(r)),this._uidInput||(this._uidInput=a("uid",this._uid)),this._input.value=JSON.stringify(e)),o&&(this._htmlInput||(this._htmlInput=a(o)),this._htmlInput.value=await this.getHtml()),this.editor.doc=this._doc;const l=()=>{this._isEmpty=this.isEmpty,this.$element.toggleClass("is-editor-empty",!!this._isEmpty)};return this._doc.slots.blockUpdated.on(()=>{l(),this.trySyncData()}),l(),this.$element.toggleClass("is-readonly",!!i).toggleClass("is-editing",!i),n!==void 0&&this.updateTitle(n),this._doc}async updateTitle(e){var i;const t=this.doc,n=t.root.title;n&&(n.clear(),n.insert(e,0)),t.collection.setDocMeta(this.doc.id,{title:(i=t.root)==null?void 0:i.title.toString()})}trySyncData(){this._updateTimer=window.setTimeout(()=>{this.syncData()},200)}async syncData(e){var i,r;const t=await this.toSnapshot();if(!t)return this._lastChangeContent="",!1;const n=JSON.stringify(t);if(this._lastChangeContent===n)return!1;if(this._lastChangeContent=n,this._input&&(this._input.value=n),!e){const o={uid:this._uid,content:n,title:t.meta.title,contentType:"doc",isEmpty:this._isEmpty};(r=(i=this.options).onChange)==null||r.call(i,o,t)}}async getData(e){return e===void 0&&(e=await this.toSnapshot()),e?{content:JSON.stringify(e),title:e.meta.title,uid:this._uid}:{content:"",title:"",uid:this._uid}}async toSnapshot(){return Ve.toSnapshot(this.doc)}insertText(e,t){if(t=t||this.context,!t)return;const{rootComponent:n,model:i}=t;if(!i.text){console.error("Can't insert text! Text not found");return}Ve.Module.components.insertContent(n.host,i,e)}insertBlock(e,t,n){if(n=n||this.context,!n)return;const{rootComponent:i,model:r}=n,o=i.doc.getParent(r);if(!o)return;const a=o.children.indexOf(r),l=e.includes(":")?e:`affine:${e}`;return i.doc.addBlock(l,t,i.doc.getParent(r),a)}insertComponent(e,t,n){const i=typeof e=="string"?{name:e}:e;return this.insertBlock("affine:embed-zui-component",{options:t,...i},n)}insertIframe(e,t){const n=typeof e=="string"?{name:e}:e;return this.insertBlock("affine:embed-zui-iframe",n,t)}insertHtmlBlock(e,t){const n=typeof e=="string"?{html:e}:e;return this.insertBlock("affine:embed-zui-html",n,t)}insertLazyBlock(e,t,n){const{content:i,...r}=t||{};return this.insertCustom({...i,fetcher:e},r,n)}insertCustom(e,t,n){return this.insertBlock("affine:embed-zui-custom",{content:e,...t},n)}async createHocuspocusProvider(){console.log("> connect to hocuspocus");const e=this._doc;if(!e)throw new Error("Hocuspocus provider needs a doc.");const{awarenessUser:t,hocuspocusUrls:n,token:i}=this.options;if(!t)throw new Error("Hocuspocus provider needs awarenessUser");if(!n||!n[1])throw new Error("Hocuspocus provider needs hocuspocusUrls");const r=e.awarenessStore.awareness,{hocuspocusProvider:o}=await Ve.loadModule(),a=new o.HocuspocusProvider({url:n[1],name:`${this.options.docID}@${e.id}`,document:e.spaceDoc,awareness:r,token:i,onAuthenticationFailed:l=>{var c,h,u;console.log("> onAuthenticationFailed",l),(h=(c=this.options).onAuthenticationFailed)==null||h.call(c,l),(u=this._hocuspocusProvider)==null||u.destroy()},onAwarenessUpdate:l=>{var c,h;console.log("> Hocuspocus awareness update",l),(h=(c=this.options).onAwarenessUpdate)==null||h.call(c,l)},onConnect:()=>{var l,c;console.log("> Hocuspocus connect"),(c=(l=this.options).onConnect)==null||c.call(l)},onDisconnect:({event:l})=>{var c,h;console.log("> Hocuspocus disconnect",l),(h=(c=this.options).onDisconnect)==null||h.call(c,l)},onClose:({event:l})=>{var c,h,u;console.log(">>> Hocuspocus close",l),l.code===4205&&l.reason==="Reset Connection"&&((c=this._hocuspocusProvider)==null||c.destroy(),(u=(h=this.options).onClose)==null||u.call(h,l))},onMessage:l=>{console.log("> Hocuspocus message",l)},onOutgoingMessage:l=>{console.log("> Hocuspocus outgoing message",l)},onStateless:l=>{console.log("> Hocuspocus stateless",l)},onSynced:l=>{console.log(">>> Hocuspocus synced!",l),this._hocuspocusProvider=a,this.setDocReadonly()},onStatus:l=>{console.log("> Hocuspocus status",l)},onDestroy:()=>{console.log(">>> Hocuspocus destroy"),this._hocuspocusProvider=null}});a.setAwarenessField("user",t)}destroy(){var e,t,n,i,r;super.destroy(),(e=this._doc)==null||e.dispose(),(t=this._editor)==null||t.remove(),(n=this._input)==null||n.remove(),(i=this._uidInput)==null||i.remove(),(r=this._hocuspocusProvider)==null||r.destroy(),this._updateTimer&&clearTimeout(this._updateTimer)}static async loadModule(e){var t,n;if(!this.Module){if(e==null||e(!0),!this.Module){const i=await _.getLib("blocksuite");this.Module=i,(n=(t=i.zui).use)==null||n.call(t,{init:hc,create:Mo,runJS:hr}),this.slashMenuSettings.forEach(([r,o])=>{i.utils.setSlashMenu(this.formatSlashMenuItems(r),o)}),this.slashMenuSettings=[]}e==null||e(!1)}return this.Module}static formatSlashMenuItems(e){const t=this.Module,n=i=>r=>i.call(this.query(r.rootComponent),r);return e.map(i=>{if(typeof i=="object"&&i){if(typeof i.icon=="string"){let r=i.icon,o=t.icons[r];o===void 0&&(r.startsWith("icon-")||(r=`icon-${r}`),r.split(" ").includes("icon")||(r=`icon ${r}`),o=t.lit.html`<i class=${r}></i>`),i={...i,icon:o}}i.divider&&(i={groupName:"",...i}),i.action?i={...i,action:n(i.action)}:i.subMenu&&(i={...i,subMenu:this.formatSlashMenuItems(i.subMenu)})}return i})}static setSlashMenu(e,t){this.Module?this.Module.utils.setSlashMenu(this.formatSlashMenuItems(e),t):this.slashMenuSettings.push([e,t])}static forEachBlock(e,t){t(e);for(const n of e.children)t(n),this.forEachBlock(n,t)}static createEditor(e){const{presets:t,blocks:n,utils:i}=Ve.Module;let r;const o=()=>i!=null&&i.patchPageRootSpec?i.patchPageRootSpec(n.PageEditorBlockSpecs):n.PageEditorBlockSpecs;return e==="full"?(r=new t.AffineEditorContainer,r.pageSpecs=o()):e==="edgeless"?r=new t.EdgelessEditor:(r=new t.PageEditor,r.specs=o()),r}static async convertToHtml(e,t,n){const{store:i,blocks:r}=Ve.Module;let o;if(typeof e=="string")try{o=JSON.parse(e)}catch(g){console.error("[ZUI] parse doc content error:",g)}else o=e;if(!o)return"";t=t||new i.DocCollection({schema:new i.Schema().register(r.AffineSchemas)});const a=new i.Job({collection:t}),l=new r.HtmlAdapter(a),c=Mh(o.blocks,g=>g.flavour==="affine:bookmark"?{...g,flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:[{insert:g.props.title??g.props.url,attributes:{link:g.props.url}},g.props.description?{insert:` (${g.props.description})`}:null].filter(Boolean)}}}:g),h=await l.fromBlockSnapshot({snapshot:c,assets:a.assetsManager}),u=document.createElement("template");u.innerHTML=h.file.replace("<!--BlockSuiteDocTitlePlaceholder-->","");const f=u.content;if(n&&h.assetsIds.length){const g=new Set(h.assetsIds),y=new Map;a.assets.entries().forEach(([v,b])=>{b.name&&y.set(b.name,{file:b,id:v})}),f.querySelectorAll("img").forEach(v=>{const b=v.getAttribute("alt")??"";let w=b.split(".").shift(),S;if(w&&g.has(w))S=a.assets.get(w);else{const E=y.get(b);E&&(w=E.id,S=E.file)}if(S){const E=Te(n,{gid:btoa(`g-${w}`),title:btoa(w),extra:"editor"});v.src=E.replaceAll("&","{{AMP}}")+"#g="+btoa(w)}})}return f.querySelectorAll("pre.shiki>code").forEach(g=>{g.textContent=g.textContent}),f.querySelectorAll(".affine-block-children-container").forEach(g=>{g.childNodes.length||g.remove()}),f.children[f.childElementCount-1].innerHTML.replaceAll("{{AMP}}","&")}static createEmptyDoc(e){const{store:t}=Ve.Module;e||(e=new t.DocCollection({schema:Ve.createSchema()}),e.start(),e.meta.initialize());const n=e.createDoc();n.load();const i=n.addBlock("affine:page",void 0);n.addBlock("affine:surface",void 0,i);const r=n.addBlock("affine:note",void 0,i);return n.addBlock("affine:paragraph",void 0,r),n}static toSnapshot(e){const{collection:t}=e;return new Ve.Module.store.Job({collection:t}).docToSnapshot(e)}static cleanHtml(e){const t=document.createElement("template");return t.innerHTML=e,t.content.querySelectorAll("img").forEach(i=>{const r=i.getAttribute("src");r!=null&&r.startsWith("/")&&i.setAttribute("src",`${location.origin}${r}`)}),t.innerHTML}static async importConfluence(e,t){const n=await Ve.loadModule(),{store:i}=n;try{t=t||new i.DocCollection({schema:Ve.createSchema()});const r=await n.blocks.ConfluenceTransformer.importConfluenceToDoc({collection:t,confluence:e});if(r)return t.getDoc(r)}catch(r){console.error("[ZUI] import confluence error:",r)}}static async importHtml(e,t){const{store:n,blocks:i}=await Ve.loadModule();try{t=t||new n.DocCollection({schema:Ve.createSchema()});const r=await i.HtmlTransformer.importHTMLToDoc({collection:t,html:this.cleanHtml(e)});if(r)return t.getDoc(r)}catch(r){console.error("[ZUI] import html error:",r)}}static async htmlToSnap(e,t){try{const{store:n,blocks:i}=await Ve.loadModule();t=t||new n.DocCollection({schema:Ve.createSchema()});const r=new n.Job({collection:t});return await new i.HtmlAdapter(r).toBlockSnapshot({file:this.cleanHtml(e)})}catch(n){console.error("[ZUI] html to snap error:",n)}}static setGlobalConfig(e){window.EDITOR_CONFIG||(window.EDITOR_CONFIG={}),Object.assign(window.EDITOR_CONFIG,e)}static createSchema(){const{store:e,blocks:t}=Ve.Module,{AffineSchemas:n}=t,i=new e.Schema().register(n);return["affine:embed-linked-doc","affine:embed-youtube","affine:embed-figma","affine:embed-github","affine:embed-loom"].forEach(r=>i.flavourSchemaMap.delete(r)),i}static nanoid(){return Hs()}};pn.NAME="Editor",pn.DEFAULT={mode:"page",contentType:"snapshot"},pn.slashMenuSettings=[],pn.iframe=ub,pn.confluenceBlockMatcherMap={},pn.registerConfluenceBlockMatcher=(s,e)=>{if(pn.Module)pn.Module.blocks.ConfluenceAdapter.registerBlockMatcher(s,e);else if(typeof s=="object")for(const t in s)pn.confluenceBlockMatcherMap[t]=s[t];else pn.confluenceBlockMatcherMap[s]=e};let mn=pn;const O0=Oe.getCode();_.registerLib("blocksuite",{src:[`editor/blocksuite/editor${O0!=="zh_cn"?`.${O0}`:""}.umd.cjs`,"editor/blocksuite/editor.css"],check:"BlockSuite"}),mn.register();let{maxUploadSize:Ws}=window.config||{};Ws&&(Ws=typeof Ws=="string"?Fn(Ws):Ws,mn.setGlobalConfig({maxFileSize:Ws,maxImageSize:Ws}));const db=zt("file","read","fileID={fileID}","{viewType}");mn.setGlobalConfig({imageSrcGetter:s=>{if(s.startsWith("{")&&s.endsWith("}")){const e=s.slice(1,-1),[t,n]=e.split(".");return db.replace("{fileID}",t).replace("{viewType}",n)}return s}});class Ha extends mn{}Ha.NAME="PageEditor",Ha.DEFAULT={mode:"page"},Ha.register(),Object.assign(window,{Editor:mn});class Oi extends ke{constructor(){super(...arguments),this._ref=Ce()}get element(){return this._ref.current}get $(){return this._editor}init(e){var u;const{className:t,style:n,rootProps:i,ref:r,children:o,jsx:a,key:l,autoInit:c,...h}=this.props;return e={...h,...e},(u=this._editor)==null||u.destroy(),_(this.element).empty(),this._editor=new mn(this.element,e),this._editor}destroyHocuspocusProvider(){var e;(e=this._editor)==null||e.destroyHocuspocusProvider()}update(e){var t;(t=this._editor)==null||t.render(e)}getData(){var e;return(e=this._editor)==null?void 0:e.getData()}getHtml(){var e;return(e=this._editor)==null?void 0:e.getHtml()}componentDidMount(){this.props.autoInit&&this.init()}componentWillUnmount(){var e;(e=this._editor)==null||e.destroy()}render(e){const{className:t,style:n,rootProps:i,children:r}=e;return k("div",{ref:this._ref,className:ee("editor",t),style:n,...i},r)}}Oi.defaultProps={autoInit:!0};const H0=class By extends ke{constructor(e){super(e),this._editorRoot=Ce(),this._titleEle=Ce(),this._handleChange=()=>{var t,n;(n=(t=this.props).onChange)==null||n.call(t,this.data)},this._uid=e.uid??Hs(13).replaceAll("-","_")}get data(){var t,n,i;const e=((n=(t=this._editorRoot.current)==null?void 0:t.querySelector("zen-editor"))==null?void 0:n.value)??"";return{title:((i=this._titleEle.current)==null?void 0:i.value)??"",content:e,html:e,uid:this._uid,contentType:this.props.contentType}}_loadLib(){return _.getLib("zeneditor",{type:"module"})}async init(e){var l,c,h,u;customElements.get("zen-editor")||((c=(l=this.props).onLoadingLibChange)==null||c.call(l,!0),await this._loadLib(),(u=(h=this.props).onLoadingLibChange)==null||u.call(h,!1));const{readonly:t,content:n,contentType:i,placeholder:r,uploadUrl:o=""}={...this.props,...e},a=[];a.push(`<zen-editor class="p-0 w-full h-full" upload-url="${Te(o,{uid:encodeURIComponent(this._uid),extra:"",field:"imgFile",gid:""})}"${t?" readonly hide-ui":""} fullscreenable expose-editor${i==="markdown"?" markdown":""}${r?` placeholder="${r}"`:""} size="auto" menubar-mode="compact" css="${By.injectCSS()}">`,`  <article slot="content">${n}</article>`,"</zen-editor>",`<textarea rows="1" style="display: none">${n}</textarea>`,`<input type="hidden" name="uid" value="${this._uid}" />`),_(this._editorRoot.current).html(a.join(`
`))}async getData(){return Promise.resolve(this.data)}update(e){this.init(e)}componentDidMount(){this.props.autoInit&&this.init()}componentWillUnmount(){const e=this._editorRoot.current;e&&(e.innerHTML="")}_renderTitle(e){const{readonly:t,title:n,mode:i}=e;return i!=="full"?null:t?k("h1",{class:"zen-editor-title",style:"font-size: 40px"},n):k("input",{ref:this._titleEle,class:"zen-editor-title w-full font-bold",style:"font-size: 40px",defaultValue:n,onChange:this._handleChange})}render(e){const{className:t,readonly:n,children:i}=e;return k("div",{className:ee("zen-editor-container relative",t)},this._renderTitle(e),k("div",{ref:this._editorRoot,className:ee("zen-editor p-px mt-px rounded relative",n?"is-readonly":""),onChange:this._handleChange}),i)}static injectCSS(){return[".editor {border: unset; border-radius: unset; color: var(--color-fore)}",".editor.size-auto {min-height: 0;}","zen-editor-menu-item > .menu-item {color: #9ea3b0!important;}","zen-editor-menu-item > .menu-item:hover {color: var(--color-primary-400)!important; background-color: var(--color-gray-200)!important;}","zen-editor-menu-item > .menu-item.is-active {color: var(--color-primary-400)!important; background-color: transparent!important; box-shadow: inset 0 0 0 1px var(--color-primary-300);}","zen-editor-menu-item > .menu-item.is-active:hover {background-color: var(--color-gray-200)!important;}","zen-editor-menu-item > .menu-item.is-active:not(:hover) {background-color: transparent!important;}","zen-editor-menu-item > .menu-item:has(.color):hover, zen-editor-menu-item > .menu-item:has(.color).is-active {background-color: transparent!important; box-shadow: inset 0 0 0 1px var(--color-primary-300)!important;}",".menubar {border-bottom: 1px solid #d8dbde!important; padding: 0.125rem;}",".editor__content {padding: 0!important}",".tippy-content > div {border: 1px solid #d8dbde!important;}",".tippy-content zen-editor-menu-item {line-height: normal;}",".tippy-content zen-editor-menu-item .label {all: unset;}",".tiptap.ProseMirror {padding-top: 0.5rem;}",".tiptap.ProseMirror p {margin: 0;}"].join(`
`)}};H0.defaultProps={autoInit:!0};let fb=H0;_.registerLib("zeneditor",{src:"zen-editor/zen-editor.esm.js",type:"module"});let zr=class extends ke{render(e){const{avatar:t,account:n,realname:i,user:r,...o}=e,a={code:r?r.account:n,text:r?r.realname??r.account:i??n,src:r?r.avatar:t,...o};return k(bi,{...a})}};zr.defaultProps={size:24,circle:!0};function j0(s,e="yyyy年M月d日 hh:mm",t="M月d日 hh:mm"){const n=et(s);return cr(n,new Date)?gt(n,t):gt(n,e)}const pb=(s,e)=>{if(!e)return;const t=[];for(const n of e)t.includes(n.account)||t.push(n.account);return t.map(n=>s.getUserInfo(n))},mb=s=>s.map(t=>({account:t.account,realname:t.name,avatar:t.avatar})),gb=(s,e=!0)=>s?s.length<=3?s:e?[s[0],"more",s[s.length-1]]:[s[0],s[1],"more"]:null;function W0(s){const{createDate:e,app:t,editors:n,creator:i}=s,r=t.getUserInfo(i),o=Ye(()=>{var h;const{editingUsers:c}=t.signals;return(h=c.value)!=null&&h.length?mb(c.value):null}),a=o.value||pb(t,n),l=gb(a,!o.value);return k("div",{className:"doc-users-bar flex flex-nowrap gap-2"},k("div",{className:"flex flex-nowrap gap-1"},k("div",{title:e?t.getLang("createdByUserAt",[{name:r.realname,time:j0(e)}],"由 {name} 创建于 {time}"):r.realname},k(zr,{size:"xs",user:r})),k("span",null,r.realname),k("span",null,t.getLang("created"))),l!=null&&l.length?k("div",{className:"flex flex-nowrap gap-1"},k("div",{className:"avatar-group",title:a==null?void 0:a.map(c=>c.realname).join("、")},l.map(c=>typeof c=="string"?k(zr,{size:"xs",className:"rotate-90",icon:"ellipsis-v"}):k(zr,{size:"xs",user:c}))),k("span",null,t.getLang(o.value?"editing":"edited"))):null)}function ja(){return k("span",{className:"inline-block w-px h-3 bg-gray-400"})}const yb=()=>document.documentElement.lang.includes("zh"),Rh=s=>{const e=et(s);if(yb())return j0(e,"yyyy年MM月dd日","MM月dd日");const[,t,n,i]=e.toDateString().split(" "),r=new Date().getFullYear();return e.getFullYear()===r?`${t} ${n} `:`${t} ${n} ${i} `};function vb(s){var i;const{doc:e,app:t}=s;if(!e.status)return k("div",{className:"doc-editor-info flex text-gray gap-2 items-center py-2.5"},k(W0,{app:t,createDate:e.addedDate,editors:e.editors,creator:e.addedBy}),k(ja,null),k("span",null,t.getLang("notSaved")));const n=!!t.editingUsers.length;return k("div",{className:"doc-editor-info flex text-gray gap-2 items-center py-2.5"},k(W0,{app:t,createDate:e.addedDate,editors:e.editors,creator:e.addedBy}),k(ja,null),k("span",null,e.status==="draft"?t.getLang("draft"):t.getLang("released")),k(ja,null),k("span",{className:"hint","data-hint":et(e.addedDate).toLocaleString()},Rh(e.addedDate),t.getLang("created")),n?k("span",{className:"-px-2"},t.getLang("autoSaveHint","所有编辑内容都会自动保存")):null,n?k("span",null,Rh(new Date),t.getLang("edited")):e.editedDate?k("span",{className:"hint","data-hint":et(e.editedDate).toLocaleString()},Rh(e.editedDate),t.getLang("edited")):null,k(ja,null),k("div",{key:"views",className:"text-sm hint flex items-center gap-1","data-hint":t.getLang("viewsCount","阅读次数")},k(Re,{icon:"eye"}),e.views||0),e.api||((i=t.props.privs)==null?void 0:i.collect)==="no"?null:k("div",{key:"star",className:`text-sm hint cursor-pointer ${e.isCollector?"text-warning":"text-gray"} flex items-center gap-1`,"data-hint":t.getLang(e.isCollector?"cancelCollection":"collect"),"zui-command":`collectDoc/${e.id}`},k($e,{size:"xs",type:"ghost",icon:e.isCollector?"star":"star-empty",text:e.collects||0})))}var U0={exports:{}};function xb(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Lh={exports:{}};const _b=Mx(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var V0;function ze(){return V0||(V0=1,function(s,e){(function(t,n){s.exports=n()})(Ne,function(){var t=t||function(n,i){var r;if(typeof window<"u"&&window.crypto&&(r=window.crypto),typeof self<"u"&&self.crypto&&(r=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(r=globalThis.crypto),!r&&typeof window<"u"&&window.msCrypto&&(r=window.msCrypto),!r&&typeof Ne<"u"&&Ne.crypto&&(r=Ne.crypto),!r&&typeof xb=="function")try{r=_b}catch{}var o=function(){if(r){if(typeof r.getRandomValues=="function")try{return r.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof r.randomBytes=="function")try{return r.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function w(){}return function(S){var E;return w.prototype=S,E=new w,w.prototype=null,E}}(),l={},c=l.lib={},h=c.Base=function(){return{extend:function(w){var S=a(this);return w&&S.mixIn(w),(!S.hasOwnProperty("init")||this.init===S.init)&&(S.init=function(){S.$super.init.apply(this,arguments)}),S.init.prototype=S,S.$super=this,S},create:function(){var w=this.extend();return w.init.apply(w,arguments),w},init:function(){},mixIn:function(w){for(var S in w)w.hasOwnProperty(S)&&(this[S]=w[S]);w.hasOwnProperty("toString")&&(this.toString=w.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),u=c.WordArray=h.extend({init:function(w,S){w=this.words=w||[],S!=i?this.sigBytes=S:this.sigBytes=w.length*4},toString:function(w){return(w||p).stringify(this)},concat:function(w){var S=this.words,E=w.words,$=this.sigBytes,B=w.sigBytes;if(this.clamp(),$%4)for(var N=0;N<B;N++){var L=E[N>>>2]>>>24-N%4*8&255;S[$+N>>>2]|=L<<24-($+N)%4*8}else for(var V=0;V<B;V+=4)S[$+V>>>2]=E[V>>>2];return this.sigBytes+=B,this},clamp:function(){var w=this.words,S=this.sigBytes;w[S>>>2]&=4294967295<<32-S%4*8,w.length=n.ceil(S/4)},clone:function(){var w=h.clone.call(this);return w.words=this.words.slice(0),w},random:function(w){for(var S=[],E=0;E<w;E+=4)S.push(o());return new u.init(S,w)}}),f=l.enc={},p=f.Hex={stringify:function(w){for(var S=w.words,E=w.sigBytes,$=[],B=0;B<E;B++){var N=S[B>>>2]>>>24-B%4*8&255;$.push((N>>>4).toString(16)),$.push((N&15).toString(16))}return $.join("")},parse:function(w){for(var S=w.length,E=[],$=0;$<S;$+=2)E[$>>>3]|=parseInt(w.substr($,2),16)<<24-$%8*4;return new u.init(E,S/2)}},g=f.Latin1={stringify:function(w){for(var S=w.words,E=w.sigBytes,$=[],B=0;B<E;B++){var N=S[B>>>2]>>>24-B%4*8&255;$.push(String.fromCharCode(N))}return $.join("")},parse:function(w){for(var S=w.length,E=[],$=0;$<S;$++)E[$>>>2]|=(w.charCodeAt($)&255)<<24-$%4*8;return new u.init(E,S)}},y=f.Utf8={stringify:function(w){try{return decodeURIComponent(escape(g.stringify(w)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(w){return g.parse(unescape(encodeURIComponent(w)))}},v=c.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(w){typeof w=="string"&&(w=y.parse(w)),this._data.concat(w),this._nDataBytes+=w.sigBytes},_process:function(w){var S,E=this._data,$=E.words,B=E.sigBytes,N=this.blockSize,L=N*4,V=B/L;w?V=n.ceil(V):V=n.max((V|0)-this._minBufferSize,0);var M=V*N,F=n.min(M*4,B);if(M){for(var K=0;K<M;K+=N)this._doProcessBlock($,K);S=$.splice(0,M),E.sigBytes-=F}return new u.init(S,F)},clone:function(){var w=h.clone.call(this);return w._data=this._data.clone(),w},_minBufferSize:0});c.Hasher=v.extend({cfg:h.extend(),init:function(w){this.cfg=this.cfg.extend(w),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(w){return this._append(w),this._process(),this},finalize:function(w){w&&this._append(w);var S=this._doFinalize();return S},blockSize:16,_createHelper:function(w){return function(S,E){return new w.init(E).finalize(S)}},_createHmacHelper:function(w){return function(S,E){return new b.HMAC.init(w,E).finalize(S)}}});var b=l.algo={};return l}(Math);return t})}(Lh)),Lh.exports}var zh={exports:{}},K0;function Wa(){return K0||(K0=1,function(s,e){(function(t,n){s.exports=n(ze())})(Ne,function(t){return function(n){var i=t,r=i.lib,o=r.Base,a=r.WordArray,l=i.x64={};l.Word=o.extend({init:function(c,h){this.high=c,this.low=h}}),l.WordArray=o.extend({init:function(c,h){c=this.words=c||[],h!=n?this.sigBytes=h:this.sigBytes=c.length*8},toX32:function(){for(var c=this.words,h=c.length,u=[],f=0;f<h;f++){var p=c[f];u.push(p.high),u.push(p.low)}return a.create(u,this.sigBytes)},clone:function(){for(var c=o.clone.call(this),h=c.words=this.words.slice(0),u=h.length,f=0;f<u;f++)h[f]=h[f].clone();return c}})}(),t})}(zh)),zh.exports}var Oh={exports:{}},q0;function bb(){return q0||(q0=1,function(s,e){(function(t,n){s.exports=n(ze())})(Ne,function(t){return function(){if(typeof ArrayBuffer=="function"){var n=t,i=n.lib,r=i.WordArray,o=r.init,a=r.init=function(l){if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),(l instanceof Int8Array||typeof Uint8ClampedArray<"u"&&l instanceof Uint8ClampedArray||l instanceof Int16Array||l instanceof Uint16Array||l instanceof Int32Array||l instanceof Uint32Array||l instanceof Float32Array||l instanceof Float64Array)&&(l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength)),l instanceof Uint8Array){for(var c=l.byteLength,h=[],u=0;u<c;u++)h[u>>>2]|=l[u]<<24-u%4*8;o.call(this,h,c)}else o.apply(this,arguments)};a.prototype=r}}(),t.lib.WordArray})}(Oh)),Oh.exports}var Hh={exports:{}},G0;function wb(){return G0||(G0=1,function(s,e){(function(t,n){s.exports=n(ze())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.WordArray,o=n.enc;o.Utf16=o.Utf16BE={stringify:function(l){for(var c=l.words,h=l.sigBytes,u=[],f=0;f<h;f+=2){var p=c[f>>>2]>>>16-f%4*8&65535;u.push(String.fromCharCode(p))}return u.join("")},parse:function(l){for(var c=l.length,h=[],u=0;u<c;u++)h[u>>>1]|=l.charCodeAt(u)<<16-u%2*16;return r.create(h,c*2)}},o.Utf16LE={stringify:function(l){for(var c=l.words,h=l.sigBytes,u=[],f=0;f<h;f+=2){var p=a(c[f>>>2]>>>16-f%4*8&65535);u.push(String.fromCharCode(p))}return u.join("")},parse:function(l){for(var c=l.length,h=[],u=0;u<c;u++)h[u>>>1]|=a(l.charCodeAt(u)<<16-u%2*16);return r.create(h,c*2)}};function a(l){return l<<8&4278255360|l>>>8&16711935}}(),t.enc.Utf16})}(Hh)),Hh.exports}var jh={exports:{}},Y0;function Us(){return Y0||(Y0=1,function(s,e){(function(t,n){s.exports=n(ze())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.WordArray,o=n.enc;o.Base64={stringify:function(l){var c=l.words,h=l.sigBytes,u=this._map;l.clamp();for(var f=[],p=0;p<h;p+=3)for(var g=c[p>>>2]>>>24-p%4*8&255,y=c[p+1>>>2]>>>24-(p+1)%4*8&255,v=c[p+2>>>2]>>>24-(p+2)%4*8&255,b=g<<16|y<<8|v,w=0;w<4&&p+w*.75<h;w++)f.push(u.charAt(b>>>6*(3-w)&63));var S=u.charAt(64);if(S)for(;f.length%4;)f.push(S);return f.join("")},parse:function(l){var c=l.length,h=this._map,u=this._reverseMap;if(!u){u=this._reverseMap=[];for(var f=0;f<h.length;f++)u[h.charCodeAt(f)]=f}var p=h.charAt(64);if(p){var g=l.indexOf(p);g!==-1&&(c=g)}return a(l,c,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function a(l,c,h){for(var u=[],f=0,p=0;p<c;p++)if(p%4){var g=h[l.charCodeAt(p-1)]<<p%4*2,y=h[l.charCodeAt(p)]>>>6-p%4*2,v=g|y;u[f>>>2]|=v<<24-f%4*8,f++}return r.create(u,f)}}(),t.enc.Base64})}(jh)),jh.exports}var Wh={exports:{}},X0;function Cb(){return X0||(X0=1,function(s,e){(function(t,n){s.exports=n(ze())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.WordArray,o=n.enc;o.Base64url={stringify:function(l,c){c===void 0&&(c=!0);var h=l.words,u=l.sigBytes,f=c?this._safe_map:this._map;l.clamp();for(var p=[],g=0;g<u;g+=3)for(var y=h[g>>>2]>>>24-g%4*8&255,v=h[g+1>>>2]>>>24-(g+1)%4*8&255,b=h[g+2>>>2]>>>24-(g+2)%4*8&255,w=y<<16|v<<8|b,S=0;S<4&&g+S*.75<u;S++)p.push(f.charAt(w>>>6*(3-S)&63));var E=f.charAt(64);if(E)for(;p.length%4;)p.push(E);return p.join("")},parse:function(l,c){c===void 0&&(c=!0);var h=l.length,u=c?this._safe_map:this._map,f=this._reverseMap;if(!f){f=this._reverseMap=[];for(var p=0;p<u.length;p++)f[u.charCodeAt(p)]=p}var g=u.charAt(64);if(g){var y=l.indexOf(g);y!==-1&&(h=y)}return a(l,h,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function a(l,c,h){for(var u=[],f=0,p=0;p<c;p++)if(p%4){var g=h[l.charCodeAt(p-1)]<<p%4*2,y=h[l.charCodeAt(p)]>>>6-p%4*2,v=g|y;u[f>>>2]|=v<<24-f%4*8,f++}return r.create(u,f)}}(),t.enc.Base64url})}(Wh)),Wh.exports}var Uh={exports:{}},Z0;function Vs(){return Z0||(Z0=1,function(s,e){(function(t,n){s.exports=n(ze())})(Ne,function(t){return function(n){var i=t,r=i.lib,o=r.WordArray,a=r.Hasher,l=i.algo,c=[];(function(){for(var y=0;y<64;y++)c[y]=n.abs(n.sin(y+1))*4294967296|0})();var h=l.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(y,v){for(var b=0;b<16;b++){var w=v+b,S=y[w];y[w]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}var E=this._hash.words,$=y[v+0],B=y[v+1],N=y[v+2],L=y[v+3],V=y[v+4],M=y[v+5],F=y[v+6],K=y[v+7],X=y[v+8],ae=y[v+9],ue=y[v+10],ye=y[v+11],ce=y[v+12],ne=y[v+13],_e=y[v+14],pe=y[v+15],J=E[0],le=E[1],re=E[2],oe=E[3];J=u(J,le,re,oe,$,7,c[0]),oe=u(oe,J,le,re,B,12,c[1]),re=u(re,oe,J,le,N,17,c[2]),le=u(le,re,oe,J,L,22,c[3]),J=u(J,le,re,oe,V,7,c[4]),oe=u(oe,J,le,re,M,12,c[5]),re=u(re,oe,J,le,F,17,c[6]),le=u(le,re,oe,J,K,22,c[7]),J=u(J,le,re,oe,X,7,c[8]),oe=u(oe,J,le,re,ae,12,c[9]),re=u(re,oe,J,le,ue,17,c[10]),le=u(le,re,oe,J,ye,22,c[11]),J=u(J,le,re,oe,ce,7,c[12]),oe=u(oe,J,le,re,ne,12,c[13]),re=u(re,oe,J,le,_e,17,c[14]),le=u(le,re,oe,J,pe,22,c[15]),J=f(J,le,re,oe,B,5,c[16]),oe=f(oe,J,le,re,F,9,c[17]),re=f(re,oe,J,le,ye,14,c[18]),le=f(le,re,oe,J,$,20,c[19]),J=f(J,le,re,oe,M,5,c[20]),oe=f(oe,J,le,re,ue,9,c[21]),re=f(re,oe,J,le,pe,14,c[22]),le=f(le,re,oe,J,V,20,c[23]),J=f(J,le,re,oe,ae,5,c[24]),oe=f(oe,J,le,re,_e,9,c[25]),re=f(re,oe,J,le,L,14,c[26]),le=f(le,re,oe,J,X,20,c[27]),J=f(J,le,re,oe,ne,5,c[28]),oe=f(oe,J,le,re,N,9,c[29]),re=f(re,oe,J,le,K,14,c[30]),le=f(le,re,oe,J,ce,20,c[31]),J=p(J,le,re,oe,M,4,c[32]),oe=p(oe,J,le,re,X,11,c[33]),re=p(re,oe,J,le,ye,16,c[34]),le=p(le,re,oe,J,_e,23,c[35]),J=p(J,le,re,oe,B,4,c[36]),oe=p(oe,J,le,re,V,11,c[37]),re=p(re,oe,J,le,K,16,c[38]),le=p(le,re,oe,J,ue,23,c[39]),J=p(J,le,re,oe,ne,4,c[40]),oe=p(oe,J,le,re,$,11,c[41]),re=p(re,oe,J,le,L,16,c[42]),le=p(le,re,oe,J,F,23,c[43]),J=p(J,le,re,oe,ae,4,c[44]),oe=p(oe,J,le,re,ce,11,c[45]),re=p(re,oe,J,le,pe,16,c[46]),le=p(le,re,oe,J,N,23,c[47]),J=g(J,le,re,oe,$,6,c[48]),oe=g(oe,J,le,re,K,10,c[49]),re=g(re,oe,J,le,_e,15,c[50]),le=g(le,re,oe,J,M,21,c[51]),J=g(J,le,re,oe,ce,6,c[52]),oe=g(oe,J,le,re,L,10,c[53]),re=g(re,oe,J,le,ue,15,c[54]),le=g(le,re,oe,J,B,21,c[55]),J=g(J,le,re,oe,X,6,c[56]),oe=g(oe,J,le,re,pe,10,c[57]),re=g(re,oe,J,le,F,15,c[58]),le=g(le,re,oe,J,ne,21,c[59]),J=g(J,le,re,oe,V,6,c[60]),oe=g(oe,J,le,re,ye,10,c[61]),re=g(re,oe,J,le,N,15,c[62]),le=g(le,re,oe,J,ae,21,c[63]),E[0]=E[0]+J|0,E[1]=E[1]+le|0,E[2]=E[2]+re|0,E[3]=E[3]+oe|0},_doFinalize:function(){var y=this._data,v=y.words,b=this._nDataBytes*8,w=y.sigBytes*8;v[w>>>5]|=128<<24-w%32;var S=n.floor(b/4294967296),E=b;v[(w+64>>>9<<4)+15]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,v[(w+64>>>9<<4)+14]=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,y.sigBytes=(v.length+1)*4,this._process();for(var $=this._hash,B=$.words,N=0;N<4;N++){var L=B[N];B[N]=(L<<8|L>>>24)&16711935|(L<<24|L>>>8)&4278255360}return $},clone:function(){var y=a.clone.call(this);return y._hash=this._hash.clone(),y}});function u(y,v,b,w,S,E,$){var B=y+(v&b|~v&w)+S+$;return(B<<E|B>>>32-E)+v}function f(y,v,b,w,S,E,$){var B=y+(v&w|b&~w)+S+$;return(B<<E|B>>>32-E)+v}function p(y,v,b,w,S,E,$){var B=y+(v^b^w)+S+$;return(B<<E|B>>>32-E)+v}function g(y,v,b,w,S,E,$){var B=y+(b^(v|~w))+S+$;return(B<<E|B>>>32-E)+v}i.MD5=a._createHelper(h),i.HmacMD5=a._createHmacHelper(h)}(Math),t.MD5})}(Uh)),Uh.exports}var Vh={exports:{}},Q0;function J0(){return Q0||(Q0=1,function(s,e){(function(t,n){s.exports=n(ze())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.WordArray,o=i.Hasher,a=n.algo,l=[],c=a.SHA1=o.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(h,u){for(var f=this._hash.words,p=f[0],g=f[1],y=f[2],v=f[3],b=f[4],w=0;w<80;w++){if(w<16)l[w]=h[u+w]|0;else{var S=l[w-3]^l[w-8]^l[w-14]^l[w-16];l[w]=S<<1|S>>>31}var E=(p<<5|p>>>27)+b+l[w];w<20?E+=(g&y|~g&v)+1518500249:w<40?E+=(g^y^v)+1859775393:w<60?E+=(g&y|g&v|y&v)-1894007588:E+=(g^y^v)-899497514,b=v,v=y,y=g<<30|g>>>2,g=p,p=E}f[0]=f[0]+p|0,f[1]=f[1]+g|0,f[2]=f[2]+y|0,f[3]=f[3]+v|0,f[4]=f[4]+b|0},_doFinalize:function(){var h=this._data,u=h.words,f=this._nDataBytes*8,p=h.sigBytes*8;return u[p>>>5]|=128<<24-p%32,u[(p+64>>>9<<4)+14]=Math.floor(f/4294967296),u[(p+64>>>9<<4)+15]=f,h.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var h=o.clone.call(this);return h._hash=this._hash.clone(),h}});n.SHA1=o._createHelper(c),n.HmacSHA1=o._createHmacHelper(c)}(),t.SHA1})}(Vh)),Vh.exports}var Kh={exports:{}},em;function qh(){return em||(em=1,function(s,e){(function(t,n){s.exports=n(ze())})(Ne,function(t){return function(n){var i=t,r=i.lib,o=r.WordArray,a=r.Hasher,l=i.algo,c=[],h=[];(function(){function p(b){for(var w=n.sqrt(b),S=2;S<=w;S++)if(!(b%S))return!1;return!0}function g(b){return(b-(b|0))*4294967296|0}for(var y=2,v=0;v<64;)p(y)&&(v<8&&(c[v]=g(n.pow(y,1/2))),h[v]=g(n.pow(y,1/3)),v++),y++})();var u=[],f=l.SHA256=a.extend({_doReset:function(){this._hash=new o.init(c.slice(0))},_doProcessBlock:function(p,g){for(var y=this._hash.words,v=y[0],b=y[1],w=y[2],S=y[3],E=y[4],$=y[5],B=y[6],N=y[7],L=0;L<64;L++){if(L<16)u[L]=p[g+L]|0;else{var V=u[L-15],M=(V<<25|V>>>7)^(V<<14|V>>>18)^V>>>3,F=u[L-2],K=(F<<15|F>>>17)^(F<<13|F>>>19)^F>>>10;u[L]=M+u[L-7]+K+u[L-16]}var X=E&$^~E&B,ae=v&b^v&w^b&w,ue=(v<<30|v>>>2)^(v<<19|v>>>13)^(v<<10|v>>>22),ye=(E<<26|E>>>6)^(E<<21|E>>>11)^(E<<7|E>>>25),ce=N+ye+X+h[L]+u[L],ne=ue+ae;N=B,B=$,$=E,E=S+ce|0,S=w,w=b,b=v,v=ce+ne|0}y[0]=y[0]+v|0,y[1]=y[1]+b|0,y[2]=y[2]+w|0,y[3]=y[3]+S|0,y[4]=y[4]+E|0,y[5]=y[5]+$|0,y[6]=y[6]+B|0,y[7]=y[7]+N|0},_doFinalize:function(){var p=this._data,g=p.words,y=this._nDataBytes*8,v=p.sigBytes*8;return g[v>>>5]|=128<<24-v%32,g[(v+64>>>9<<4)+14]=n.floor(y/4294967296),g[(v+64>>>9<<4)+15]=y,p.sigBytes=g.length*4,this._process(),this._hash},clone:function(){var p=a.clone.call(this);return p._hash=this._hash.clone(),p}});i.SHA256=a._createHelper(f),i.HmacSHA256=a._createHmacHelper(f)}(Math),t.SHA256})}(Kh)),Kh.exports}var Gh={exports:{}},tm;function kb(){return tm||(tm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),qh())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.WordArray,o=n.algo,a=o.SHA256,l=o.SHA224=a.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var c=a._doFinalize.call(this);return c.sigBytes-=4,c}});n.SHA224=a._createHelper(l),n.HmacSHA224=a._createHmacHelper(l)}(),t.SHA224})}(Gh)),Gh.exports}var Yh={exports:{}},nm;function sm(){return nm||(nm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),Wa())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.Hasher,o=n.x64,a=o.Word,l=o.WordArray,c=n.algo;function h(){return a.create.apply(a,arguments)}var u=[h(1116352408,3609767458),h(1899447441,602891725),h(3049323471,3964484399),h(3921009573,2173295548),h(961987163,4081628472),h(1508970993,3053834265),h(2453635748,2937671579),h(2870763221,3664609560),h(3624381080,2734883394),h(310598401,1164996542),h(607225278,1323610764),h(1426881987,3590304994),h(1925078388,4068182383),h(2162078206,991336113),h(2614888103,633803317),h(3248222580,3479774868),h(3835390401,2666613458),h(4022224774,944711139),h(264347078,2341262773),h(604807628,2007800933),h(770255983,1495990901),h(1249150122,1856431235),h(1555081692,3175218132),h(1996064986,2198950837),h(2554220882,3999719339),h(2821834349,766784016),h(2952996808,2566594879),h(3210313671,3203337956),h(3336571891,1034457026),h(3584528711,2466948901),h(113926993,3758326383),h(338241895,168717936),h(666307205,1188179964),h(773529912,1546045734),h(1294757372,1522805485),h(1396182291,2643833823),h(1695183700,2343527390),h(1986661051,1014477480),h(2177026350,1206759142),h(2456956037,344077627),h(2730485921,1290863460),h(2820302411,3158454273),h(3259730800,3505952657),h(3345764771,106217008),h(3516065817,3606008344),h(3600352804,1432725776),h(4094571909,1467031594),h(275423344,851169720),h(430227734,3100823752),h(506948616,1363258195),h(659060556,3750685593),h(883997877,3785050280),h(958139571,3318307427),h(1322822218,3812723403),h(1537002063,2003034995),h(1747873779,3602036899),h(1955562222,1575990012),h(2024104815,1125592928),h(2227730452,2716904306),h(2361852424,442776044),h(2428436474,593698344),h(2756734187,3733110249),h(3204031479,2999351573),h(3329325298,3815920427),h(3391569614,3928383900),h(3515267271,566280711),h(3940187606,3454069534),h(4118630271,4000239992),h(116418474,1914138554),h(174292421,2731055270),h(289380356,3203993006),h(460393269,320620315),h(685471733,587496836),h(852142971,1086792851),h(1017036298,365543100),h(1126000580,2618297676),h(1288033470,3409855158),h(1501505948,4234509866),h(1607167915,987167468),h(1816402316,1246189591)],f=[];(function(){for(var g=0;g<80;g++)f[g]=h()})();var p=c.SHA512=r.extend({_doReset:function(){this._hash=new l.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(g,y){for(var v=this._hash.words,b=v[0],w=v[1],S=v[2],E=v[3],$=v[4],B=v[5],N=v[6],L=v[7],V=b.high,M=b.low,F=w.high,K=w.low,X=S.high,ae=S.low,ue=E.high,ye=E.low,ce=$.high,ne=$.low,_e=B.high,pe=B.low,J=N.high,le=N.low,re=L.high,oe=L.low,He=V,Be=M,ot=F,De=K,be=X,nn=ae,ms=ue,je=ye,St=ce,Pt=ne,sn=_e,Ys=pe,Ui=J,Xs=le,ao=re,Wn=oe,lt=0;lt<80;lt++){var Mt,Ht,Zs=f[lt];if(lt<16)Ht=Zs.high=g[y+lt*2]|0,Mt=Zs.low=g[y+lt*2+1]|0;else{var gs=f[lt-15],rn=gs.high,Un=gs.low,Qs=(rn>>>1|Un<<31)^(rn>>>8|Un<<24)^rn>>>7,Vi=(Un>>>1|rn<<31)^(Un>>>8|rn<<24)^(Un>>>7|rn<<25),Js=f[lt-2],jt=Js.high,En=Js.low,lo=(jt>>>19|En<<13)^(jt<<3|En>>>29)^jt>>>6,yn=(En>>>19|jt<<13)^(En<<3|jt>>>29)^(En>>>6|jt<<26),we=f[lt-7],ei=we.high,Vn=we.low,ti=f[lt-16],ve=ti.high,Ki=ti.low;Mt=Vi+Vn,Ht=Qs+ei+(Mt>>>0<Vi>>>0?1:0),Mt=Mt+yn,Ht=Ht+lo+(Mt>>>0<yn>>>0?1:0),Mt=Mt+Ki,Ht=Ht+ve+(Mt>>>0<Ki>>>0?1:0),Zs.high=Ht,Zs.low=Mt}var ol=St&sn^~St&Ui,qi=Pt&Ys^~Pt&Xs,al=He&ot^He&be^ot&be,co=Be&De^Be&nn^De&nn,ld=(He>>>28|Be<<4)^(He<<30|Be>>>2)^(He<<25|Be>>>7),ll=(Be>>>28|He<<4)^(Be<<30|He>>>2)^(Be<<25|He>>>7),ys=(St>>>14|Pt<<18)^(St>>>18|Pt<<14)^(St<<23|Pt>>>9),vs=(Pt>>>14|St<<18)^(Pt>>>18|St<<14)^(Pt<<23|St>>>9),Gi=u[lt],Yi=Gi.high,st=Gi.low,We=Wn+vs,An=ao+ys+(We>>>0<Wn>>>0?1:0),We=We+qi,An=An+ol+(We>>>0<qi>>>0?1:0),We=We+st,An=An+Yi+(We>>>0<st>>>0?1:0),We=We+Mt,An=An+Ht+(We>>>0<Mt>>>0?1:0),ni=ll+co,Xi=ld+al+(ni>>>0<ll>>>0?1:0);ao=Ui,Wn=Xs,Ui=sn,Xs=Ys,sn=St,Ys=Pt,Pt=je+We|0,St=ms+An+(Pt>>>0<je>>>0?1:0)|0,ms=be,je=nn,be=ot,nn=De,ot=He,De=Be,Be=We+ni|0,He=An+Xi+(Be>>>0<We>>>0?1:0)|0}M=b.low=M+Be,b.high=V+He+(M>>>0<Be>>>0?1:0),K=w.low=K+De,w.high=F+ot+(K>>>0<De>>>0?1:0),ae=S.low=ae+nn,S.high=X+be+(ae>>>0<nn>>>0?1:0),ye=E.low=ye+je,E.high=ue+ms+(ye>>>0<je>>>0?1:0),ne=$.low=ne+Pt,$.high=ce+St+(ne>>>0<Pt>>>0?1:0),pe=B.low=pe+Ys,B.high=_e+sn+(pe>>>0<Ys>>>0?1:0),le=N.low=le+Xs,N.high=J+Ui+(le>>>0<Xs>>>0?1:0),oe=L.low=oe+Wn,L.high=re+ao+(oe>>>0<Wn>>>0?1:0)},_doFinalize:function(){var g=this._data,y=g.words,v=this._nDataBytes*8,b=g.sigBytes*8;y[b>>>5]|=128<<24-b%32,y[(b+128>>>10<<5)+30]=Math.floor(v/4294967296),y[(b+128>>>10<<5)+31]=v,g.sigBytes=y.length*4,this._process();var w=this._hash.toX32();return w},clone:function(){var g=r.clone.call(this);return g._hash=this._hash.clone(),g},blockSize:1024/32});n.SHA512=r._createHelper(p),n.HmacSHA512=r._createHmacHelper(p)}(),t.SHA512})}(Yh)),Yh.exports}var Xh={exports:{}},im;function Sb(){return im||(im=1,function(s,e){(function(t,n,i){s.exports=n(ze(),Wa(),sm())})(Ne,function(t){return function(){var n=t,i=n.x64,r=i.Word,o=i.WordArray,a=n.algo,l=a.SHA512,c=a.SHA384=l.extend({_doReset:function(){this._hash=new o.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var h=l._doFinalize.call(this);return h.sigBytes-=16,h}});n.SHA384=l._createHelper(c),n.HmacSHA384=l._createHmacHelper(c)}(),t.SHA384})}(Xh)),Xh.exports}var Zh={exports:{}},rm;function Db(){return rm||(rm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),Wa())})(Ne,function(t){return function(n){var i=t,r=i.lib,o=r.WordArray,a=r.Hasher,l=i.x64,c=l.Word,h=i.algo,u=[],f=[],p=[];(function(){for(var v=1,b=0,w=0;w<24;w++){u[v+5*b]=(w+1)*(w+2)/2%64;var S=b%5,E=(2*v+3*b)%5;v=S,b=E}for(var v=0;v<5;v++)for(var b=0;b<5;b++)f[v+5*b]=b+(2*v+3*b)%5*5;for(var $=1,B=0;B<24;B++){for(var N=0,L=0,V=0;V<7;V++){if($&1){var M=(1<<V)-1;M<32?L^=1<<M:N^=1<<M-32}$&128?$=$<<1^113:$<<=1}p[B]=c.create(N,L)}})();var g=[];(function(){for(var v=0;v<25;v++)g[v]=c.create()})();var y=h.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var v=this._state=[],b=0;b<25;b++)v[b]=new c.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(v,b){for(var w=this._state,S=this.blockSize/2,E=0;E<S;E++){var $=v[b+2*E],B=v[b+2*E+1];$=($<<8|$>>>24)&16711935|($<<24|$>>>8)&4278255360,B=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360;var N=w[E];N.high^=B,N.low^=$}for(var L=0;L<24;L++){for(var V=0;V<5;V++){for(var M=0,F=0,K=0;K<5;K++){var N=w[V+5*K];M^=N.high,F^=N.low}var X=g[V];X.high=M,X.low=F}for(var V=0;V<5;V++)for(var ae=g[(V+4)%5],ue=g[(V+1)%5],ye=ue.high,ce=ue.low,M=ae.high^(ye<<1|ce>>>31),F=ae.low^(ce<<1|ye>>>31),K=0;K<5;K++){var N=w[V+5*K];N.high^=M,N.low^=F}for(var ne=1;ne<25;ne++){var M,F,N=w[ne],_e=N.high,pe=N.low,J=u[ne];J<32?(M=_e<<J|pe>>>32-J,F=pe<<J|_e>>>32-J):(M=pe<<J-32|_e>>>64-J,F=_e<<J-32|pe>>>64-J);var le=g[f[ne]];le.high=M,le.low=F}var re=g[0],oe=w[0];re.high=oe.high,re.low=oe.low;for(var V=0;V<5;V++)for(var K=0;K<5;K++){var ne=V+5*K,N=w[ne],He=g[ne],Be=g[(V+1)%5+5*K],ot=g[(V+2)%5+5*K];N.high=He.high^~Be.high&ot.high,N.low=He.low^~Be.low&ot.low}var N=w[0],De=p[L];N.high^=De.high,N.low^=De.low}},_doFinalize:function(){var v=this._data,b=v.words;this._nDataBytes*8;var w=v.sigBytes*8,S=this.blockSize*32;b[w>>>5]|=1<<24-w%32,b[(n.ceil((w+1)/S)*S>>>5)-1]|=128,v.sigBytes=b.length*4,this._process();for(var E=this._state,$=this.cfg.outputLength/8,B=$/8,N=[],L=0;L<B;L++){var V=E[L],M=V.high,F=V.low;M=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360,F=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360,N.push(F),N.push(M)}return new o.init(N,$)},clone:function(){for(var v=a.clone.call(this),b=v._state=this._state.slice(0),w=0;w<25;w++)b[w]=b[w].clone();return v}});i.SHA3=a._createHelper(y),i.HmacSHA3=a._createHmacHelper(y)}(Math),t.SHA3})}(Zh)),Zh.exports}var Qh={exports:{}},om;function Eb(){return om||(om=1,function(s,e){(function(t,n){s.exports=n(ze())})(Ne,function(t){/** @preserve
(c) 2012 by Cédric Mesnil. All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/return function(n){var i=t,r=i.lib,o=r.WordArray,a=r.Hasher,l=i.algo,c=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),h=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),f=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),p=o.create([0,1518500249,1859775393,2400959708,2840853838]),g=o.create([1352829926,1548603684,1836072691,2053994217,0]),y=l.RIPEMD160=a.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(B,N){for(var L=0;L<16;L++){var V=N+L,M=B[V];B[V]=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360}var F=this._hash.words,K=p.words,X=g.words,ae=c.words,ue=h.words,ye=u.words,ce=f.words,ne,_e,pe,J,le,re,oe,He,Be,ot;re=ne=F[0],oe=_e=F[1],He=pe=F[2],Be=J=F[3],ot=le=F[4];for(var De,L=0;L<80;L+=1)De=ne+B[N+ae[L]]|0,L<16?De+=v(_e,pe,J)+K[0]:L<32?De+=b(_e,pe,J)+K[1]:L<48?De+=w(_e,pe,J)+K[2]:L<64?De+=S(_e,pe,J)+K[3]:De+=E(_e,pe,J)+K[4],De=De|0,De=$(De,ye[L]),De=De+le|0,ne=le,le=J,J=$(pe,10),pe=_e,_e=De,De=re+B[N+ue[L]]|0,L<16?De+=E(oe,He,Be)+X[0]:L<32?De+=S(oe,He,Be)+X[1]:L<48?De+=w(oe,He,Be)+X[2]:L<64?De+=b(oe,He,Be)+X[3]:De+=v(oe,He,Be)+X[4],De=De|0,De=$(De,ce[L]),De=De+ot|0,re=ot,ot=Be,Be=$(He,10),He=oe,oe=De;De=F[1]+pe+Be|0,F[1]=F[2]+J+ot|0,F[2]=F[3]+le+re|0,F[3]=F[4]+ne+oe|0,F[4]=F[0]+_e+He|0,F[0]=De},_doFinalize:function(){var B=this._data,N=B.words,L=this._nDataBytes*8,V=B.sigBytes*8;N[V>>>5]|=128<<24-V%32,N[(V+64>>>9<<4)+14]=(L<<8|L>>>24)&16711935|(L<<24|L>>>8)&4278255360,B.sigBytes=(N.length+1)*4,this._process();for(var M=this._hash,F=M.words,K=0;K<5;K++){var X=F[K];F[K]=(X<<8|X>>>24)&16711935|(X<<24|X>>>8)&4278255360}return M},clone:function(){var B=a.clone.call(this);return B._hash=this._hash.clone(),B}});function v(B,N,L){return B^N^L}function b(B,N,L){return B&N|~B&L}function w(B,N,L){return(B|~N)^L}function S(B,N,L){return B&L|N&~L}function E(B,N,L){return B^(N|~L)}function $(B,N){return B<<N|B>>>32-N}i.RIPEMD160=a._createHelper(y),i.HmacRIPEMD160=a._createHmacHelper(y)}(),t.RIPEMD160})}(Qh)),Qh.exports}var Jh={exports:{}},am;function eu(){return am||(am=1,function(s,e){(function(t,n){s.exports=n(ze())})(Ne,function(t){(function(){var n=t,i=n.lib,r=i.Base,o=n.enc,a=o.Utf8,l=n.algo;l.HMAC=r.extend({init:function(c,h){c=this._hasher=new c.init,typeof h=="string"&&(h=a.parse(h));var u=c.blockSize,f=u*4;h.sigBytes>f&&(h=c.finalize(h)),h.clamp();for(var p=this._oKey=h.clone(),g=this._iKey=h.clone(),y=p.words,v=g.words,b=0;b<u;b++)y[b]^=1549556828,v[b]^=909522486;p.sigBytes=g.sigBytes=f,this.reset()},reset:function(){var c=this._hasher;c.reset(),c.update(this._iKey)},update:function(c){return this._hasher.update(c),this},finalize:function(c){var h=this._hasher,u=h.finalize(c);h.reset();var f=h.finalize(this._oKey.clone().concat(u));return f}})})()})}(Jh)),Jh.exports}var tu={exports:{}},lm;function Ab(){return lm||(lm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),qh(),eu())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.Base,o=i.WordArray,a=n.algo,l=a.SHA256,c=a.HMAC,h=a.PBKDF2=r.extend({cfg:r.extend({keySize:128/32,hasher:l,iterations:25e4}),init:function(u){this.cfg=this.cfg.extend(u)},compute:function(u,f){for(var p=this.cfg,g=c.create(p.hasher,u),y=o.create(),v=o.create([1]),b=y.words,w=v.words,S=p.keySize,E=p.iterations;b.length<S;){var $=g.update(f).finalize(v);g.reset();for(var B=$.words,N=B.length,L=$,V=1;V<E;V++){L=g.finalize(L),g.reset();for(var M=L.words,F=0;F<N;F++)B[F]^=M[F]}y.concat($),w[0]++}return y.sigBytes=S*4,y}});n.PBKDF2=function(u,f,p){return h.create(p).compute(u,f)}}(),t.PBKDF2})}(tu)),tu.exports}var nu={exports:{}},cm;function cs(){return cm||(cm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),J0(),eu())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.Base,o=i.WordArray,a=n.algo,l=a.MD5,c=a.EvpKDF=r.extend({cfg:r.extend({keySize:128/32,hasher:l,iterations:1}),init:function(h){this.cfg=this.cfg.extend(h)},compute:function(h,u){for(var f,p=this.cfg,g=p.hasher.create(),y=o.create(),v=y.words,b=p.keySize,w=p.iterations;v.length<b;){f&&g.update(f),f=g.update(h).finalize(u),g.reset();for(var S=1;S<w;S++)f=g.finalize(f),g.reset();y.concat(f)}return y.sigBytes=b*4,y}});n.EvpKDF=function(h,u,f){return c.create(f).compute(h,u)}}(),t.EvpKDF})}(nu)),nu.exports}var su={exports:{}},hm;function bt(){return hm||(hm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),cs())})(Ne,function(t){t.lib.Cipher||function(n){var i=t,r=i.lib,o=r.Base,a=r.WordArray,l=r.BufferedBlockAlgorithm,c=i.enc;c.Utf8;var h=c.Base64,u=i.algo,f=u.EvpKDF,p=r.Cipher=l.extend({cfg:o.extend(),createEncryptor:function(M,F){return this.create(this._ENC_XFORM_MODE,M,F)},createDecryptor:function(M,F){return this.create(this._DEC_XFORM_MODE,M,F)},init:function(M,F,K){this.cfg=this.cfg.extend(K),this._xformMode=M,this._key=F,this.reset()},reset:function(){l.reset.call(this),this._doReset()},process:function(M){return this._append(M),this._process()},finalize:function(M){M&&this._append(M);var F=this._doFinalize();return F},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function M(F){return typeof F=="string"?V:B}return function(F){return{encrypt:function(K,X,ae){return M(X).encrypt(F,K,X,ae)},decrypt:function(K,X,ae){return M(X).decrypt(F,K,X,ae)}}}}()});r.StreamCipher=p.extend({_doFinalize:function(){var M=this._process(!0);return M},blockSize:1});var g=i.mode={},y=r.BlockCipherMode=o.extend({createEncryptor:function(M,F){return this.Encryptor.create(M,F)},createDecryptor:function(M,F){return this.Decryptor.create(M,F)},init:function(M,F){this._cipher=M,this._iv=F}}),v=g.CBC=function(){var M=y.extend();M.Encryptor=M.extend({processBlock:function(K,X){var ae=this._cipher,ue=ae.blockSize;F.call(this,K,X,ue),ae.encryptBlock(K,X),this._prevBlock=K.slice(X,X+ue)}}),M.Decryptor=M.extend({processBlock:function(K,X){var ae=this._cipher,ue=ae.blockSize,ye=K.slice(X,X+ue);ae.decryptBlock(K,X),F.call(this,K,X,ue),this._prevBlock=ye}});function F(K,X,ae){var ue,ye=this._iv;ye?(ue=ye,this._iv=n):ue=this._prevBlock;for(var ce=0;ce<ae;ce++)K[X+ce]^=ue[ce]}return M}(),b=i.pad={},w=b.Pkcs7={pad:function(M,F){for(var K=F*4,X=K-M.sigBytes%K,ae=X<<24|X<<16|X<<8|X,ue=[],ye=0;ye<X;ye+=4)ue.push(ae);var ce=a.create(ue,X);M.concat(ce)},unpad:function(M){var F=M.words[M.sigBytes-1>>>2]&255;M.sigBytes-=F}};r.BlockCipher=p.extend({cfg:p.cfg.extend({mode:v,padding:w}),reset:function(){var M;p.reset.call(this);var F=this.cfg,K=F.iv,X=F.mode;this._xformMode==this._ENC_XFORM_MODE?M=X.createEncryptor:(M=X.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==M?this._mode.init(this,K&&K.words):(this._mode=M.call(X,this,K&&K.words),this._mode.__creator=M)},_doProcessBlock:function(M,F){this._mode.processBlock(M,F)},_doFinalize:function(){var M,F=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(F.pad(this._data,this.blockSize),M=this._process(!0)):(M=this._process(!0),F.unpad(M)),M},blockSize:128/32});var S=r.CipherParams=o.extend({init:function(M){this.mixIn(M)},toString:function(M){return(M||this.formatter).stringify(this)}}),E=i.format={},$=E.OpenSSL={stringify:function(M){var F,K=M.ciphertext,X=M.salt;return X?F=a.create([1398893684,1701076831]).concat(X).concat(K):F=K,F.toString(h)},parse:function(M){var F,K=h.parse(M),X=K.words;return X[0]==1398893684&&X[1]==1701076831&&(F=a.create(X.slice(2,4)),X.splice(0,4),K.sigBytes-=16),S.create({ciphertext:K,salt:F})}},B=r.SerializableCipher=o.extend({cfg:o.extend({format:$}),encrypt:function(M,F,K,X){X=this.cfg.extend(X);var ae=M.createEncryptor(K,X),ue=ae.finalize(F),ye=ae.cfg;return S.create({ciphertext:ue,key:K,iv:ye.iv,algorithm:M,mode:ye.mode,padding:ye.padding,blockSize:M.blockSize,formatter:X.format})},decrypt:function(M,F,K,X){X=this.cfg.extend(X),F=this._parse(F,X.format);var ae=M.createDecryptor(K,X).finalize(F.ciphertext);return ae},_parse:function(M,F){return typeof M=="string"?F.parse(M,this):M}}),N=i.kdf={},L=N.OpenSSL={execute:function(M,F,K,X,ae){if(X||(X=a.random(64/8)),ae)var ue=f.create({keySize:F+K,hasher:ae}).compute(M,X);else var ue=f.create({keySize:F+K}).compute(M,X);var ye=a.create(ue.words.slice(F),K*4);return ue.sigBytes=F*4,S.create({key:ue,iv:ye,salt:X})}},V=r.PasswordBasedCipher=B.extend({cfg:B.cfg.extend({kdf:L}),encrypt:function(M,F,K,X){X=this.cfg.extend(X);var ae=X.kdf.execute(K,M.keySize,M.ivSize,X.salt,X.hasher);X.iv=ae.iv;var ue=B.encrypt.call(this,M,F,ae.key,X);return ue.mixIn(ae),ue},decrypt:function(M,F,K,X){X=this.cfg.extend(X),F=this._parse(F,X.format);var ae=X.kdf.execute(K,M.keySize,M.ivSize,F.salt,X.hasher);X.iv=ae.iv;var ue=B.decrypt.call(this,M,F,ae.key,X);return ue}})}()})}(su)),su.exports}var iu={exports:{}},um;function Tb(){return um||(um=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){return t.mode.CFB=function(){var n=t.lib.BlockCipherMode.extend();n.Encryptor=n.extend({processBlock:function(r,o){var a=this._cipher,l=a.blockSize;i.call(this,r,o,l,a),this._prevBlock=r.slice(o,o+l)}}),n.Decryptor=n.extend({processBlock:function(r,o){var a=this._cipher,l=a.blockSize,c=r.slice(o,o+l);i.call(this,r,o,l,a),this._prevBlock=c}});function i(r,o,a,l){var c,h=this._iv;h?(c=h.slice(0),this._iv=void 0):c=this._prevBlock,l.encryptBlock(c,0);for(var u=0;u<a;u++)r[o+u]^=c[u]}return n}(),t.mode.CFB})}(iu)),iu.exports}var ru={exports:{}},dm;function $b(){return dm||(dm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){return t.mode.CTR=function(){var n=t.lib.BlockCipherMode.extend(),i=n.Encryptor=n.extend({processBlock:function(r,o){var a=this._cipher,l=a.blockSize,c=this._iv,h=this._counter;c&&(h=this._counter=c.slice(0),this._iv=void 0);var u=h.slice(0);a.encryptBlock(u,0),h[l-1]=h[l-1]+1|0;for(var f=0;f<l;f++)r[o+f]^=u[f]}});return n.Decryptor=i,n}(),t.mode.CTR})}(ru)),ru.exports}var ou={exports:{}},fm;function Ib(){return fm||(fm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var n=t.lib.BlockCipherMode.extend();function i(a){if((a>>24&255)===255){var l=a>>16&255,c=a>>8&255,h=a&255;l===255?(l=0,c===255?(c=0,h===255?h=0:++h):++c):++l,a=0,a+=l<<16,a+=c<<8,a+=h}else a+=1<<24;return a}function r(a){return(a[0]=i(a[0]))===0&&(a[1]=i(a[1])),a}var o=n.Encryptor=n.extend({processBlock:function(a,l){var c=this._cipher,h=c.blockSize,u=this._iv,f=this._counter;u&&(f=this._counter=u.slice(0),this._iv=void 0),r(f);var p=f.slice(0);c.encryptBlock(p,0);for(var g=0;g<h;g++)a[l+g]^=p[g]}});return n.Decryptor=o,n}(),t.mode.CTRGladman})}(ou)),ou.exports}var au={exports:{}},pm;function Bb(){return pm||(pm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){return t.mode.OFB=function(){var n=t.lib.BlockCipherMode.extend(),i=n.Encryptor=n.extend({processBlock:function(r,o){var a=this._cipher,l=a.blockSize,c=this._iv,h=this._keystream;c&&(h=this._keystream=c.slice(0),this._iv=void 0),a.encryptBlock(h,0);for(var u=0;u<l;u++)r[o+u]^=h[u]}});return n.Decryptor=i,n}(),t.mode.OFB})}(au)),au.exports}var lu={exports:{}},mm;function Nb(){return mm||(mm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){return t.mode.ECB=function(){var n=t.lib.BlockCipherMode.extend();return n.Encryptor=n.extend({processBlock:function(i,r){this._cipher.encryptBlock(i,r)}}),n.Decryptor=n.extend({processBlock:function(i,r){this._cipher.decryptBlock(i,r)}}),n}(),t.mode.ECB})}(lu)),lu.exports}var cu={exports:{}},gm;function Fb(){return gm||(gm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){return t.pad.AnsiX923={pad:function(n,i){var r=n.sigBytes,o=i*4,a=o-r%o,l=r+a-1;n.clamp(),n.words[l>>>2]|=a<<24-l%4*8,n.sigBytes+=a},unpad:function(n){var i=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=i}},t.pad.Ansix923})}(cu)),cu.exports}var hu={exports:{}},ym;function Pb(){return ym||(ym=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){return t.pad.Iso10126={pad:function(n,i){var r=i*4,o=r-n.sigBytes%r;n.concat(t.lib.WordArray.random(o-1)).concat(t.lib.WordArray.create([o<<24],1))},unpad:function(n){var i=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=i}},t.pad.Iso10126})}(hu)),hu.exports}var uu={exports:{}},vm;function Mb(){return vm||(vm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){return t.pad.Iso97971={pad:function(n,i){n.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(n,i)},unpad:function(n){t.pad.ZeroPadding.unpad(n),n.sigBytes--}},t.pad.Iso97971})}(uu)),uu.exports}var du={exports:{}},xm;function Rb(){return xm||(xm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){return t.pad.ZeroPadding={pad:function(n,i){var r=i*4;n.clamp(),n.sigBytes+=r-(n.sigBytes%r||r)},unpad:function(n){for(var i=n.words,r=n.sigBytes-1,r=n.sigBytes-1;r>=0;r--)if(i[r>>>2]>>>24-r%4*8&255){n.sigBytes=r+1;break}}},t.pad.ZeroPadding})}(du)),du.exports}var fu={exports:{}},_m;function Lb(){return _m||(_m=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(fu)),fu.exports}var pu={exports:{}},bm;function zb(){return bm||(bm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),bt())})(Ne,function(t){return function(n){var i=t,r=i.lib,o=r.CipherParams,a=i.enc,l=a.Hex,c=i.format;c.Hex={stringify:function(h){return h.ciphertext.toString(l)},parse:function(h){var u=l.parse(h);return o.create({ciphertext:u})}}}(),t.format.Hex})}(pu)),pu.exports}var mu={exports:{}},wm;function Ob(){return wm||(wm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),Us(),Vs(),cs(),bt())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.BlockCipher,o=n.algo,a=[],l=[],c=[],h=[],u=[],f=[],p=[],g=[],y=[],v=[];(function(){for(var S=[],E=0;E<256;E++)E<128?S[E]=E<<1:S[E]=E<<1^283;for(var $=0,B=0,E=0;E<256;E++){var N=B^B<<1^B<<2^B<<3^B<<4;N=N>>>8^N&255^99,a[$]=N,l[N]=$;var L=S[$],V=S[L],M=S[V],F=S[N]*257^N*16843008;c[$]=F<<24|F>>>8,h[$]=F<<16|F>>>16,u[$]=F<<8|F>>>24,f[$]=F;var F=M*16843009^V*65537^L*257^$*16843008;p[N]=F<<24|F>>>8,g[N]=F<<16|F>>>16,y[N]=F<<8|F>>>24,v[N]=F,$?($=L^S[S[S[M^L]]],B^=S[S[B]]):$=B=1}})();var b=[0,1,2,4,8,16,32,64,128,27,54],w=o.AES=r.extend({_doReset:function(){var S;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var E=this._keyPriorReset=this._key,$=E.words,B=E.sigBytes/4,N=this._nRounds=B+6,L=(N+1)*4,V=this._keySchedule=[],M=0;M<L;M++)M<B?V[M]=$[M]:(S=V[M-1],M%B?B>6&&M%B==4&&(S=a[S>>>24]<<24|a[S>>>16&255]<<16|a[S>>>8&255]<<8|a[S&255]):(S=S<<8|S>>>24,S=a[S>>>24]<<24|a[S>>>16&255]<<16|a[S>>>8&255]<<8|a[S&255],S^=b[M/B|0]<<24),V[M]=V[M-B]^S);for(var F=this._invKeySchedule=[],K=0;K<L;K++){var M=L-K;if(K%4)var S=V[M];else var S=V[M-4];K<4||M<=4?F[K]=S:F[K]=p[a[S>>>24]]^g[a[S>>>16&255]]^y[a[S>>>8&255]]^v[a[S&255]]}}},encryptBlock:function(S,E){this._doCryptBlock(S,E,this._keySchedule,c,h,u,f,a)},decryptBlock:function(S,E){var $=S[E+1];S[E+1]=S[E+3],S[E+3]=$,this._doCryptBlock(S,E,this._invKeySchedule,p,g,y,v,l);var $=S[E+1];S[E+1]=S[E+3],S[E+3]=$},_doCryptBlock:function(S,E,$,B,N,L,V,M){for(var F=this._nRounds,K=S[E]^$[0],X=S[E+1]^$[1],ae=S[E+2]^$[2],ue=S[E+3]^$[3],ye=4,ce=1;ce<F;ce++){var ne=B[K>>>24]^N[X>>>16&255]^L[ae>>>8&255]^V[ue&255]^$[ye++],_e=B[X>>>24]^N[ae>>>16&255]^L[ue>>>8&255]^V[K&255]^$[ye++],pe=B[ae>>>24]^N[ue>>>16&255]^L[K>>>8&255]^V[X&255]^$[ye++],J=B[ue>>>24]^N[K>>>16&255]^L[X>>>8&255]^V[ae&255]^$[ye++];K=ne,X=_e,ae=pe,ue=J}var ne=(M[K>>>24]<<24|M[X>>>16&255]<<16|M[ae>>>8&255]<<8|M[ue&255])^$[ye++],_e=(M[X>>>24]<<24|M[ae>>>16&255]<<16|M[ue>>>8&255]<<8|M[K&255])^$[ye++],pe=(M[ae>>>24]<<24|M[ue>>>16&255]<<16|M[K>>>8&255]<<8|M[X&255])^$[ye++],J=(M[ue>>>24]<<24|M[K>>>16&255]<<16|M[X>>>8&255]<<8|M[ae&255])^$[ye++];S[E]=ne,S[E+1]=_e,S[E+2]=pe,S[E+3]=J},keySize:256/32});n.AES=r._createHelper(w)}(),t.AES})}(mu)),mu.exports}var gu={exports:{}},Cm;function Hb(){return Cm||(Cm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),Us(),Vs(),cs(),bt())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.WordArray,o=i.BlockCipher,a=n.algo,l=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],c=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],h=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],f=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],p=a.DES=o.extend({_doReset:function(){for(var b=this._key,w=b.words,S=[],E=0;E<56;E++){var $=l[E]-1;S[E]=w[$>>>5]>>>31-$%32&1}for(var B=this._subKeys=[],N=0;N<16;N++){for(var L=B[N]=[],V=h[N],E=0;E<24;E++)L[E/6|0]|=S[(c[E]-1+V)%28]<<31-E%6,L[4+(E/6|0)]|=S[28+(c[E+24]-1+V)%28]<<31-E%6;L[0]=L[0]<<1|L[0]>>>31;for(var E=1;E<7;E++)L[E]=L[E]>>>(E-1)*4+3;L[7]=L[7]<<5|L[7]>>>27}for(var M=this._invSubKeys=[],E=0;E<16;E++)M[E]=B[15-E]},encryptBlock:function(b,w){this._doCryptBlock(b,w,this._subKeys)},decryptBlock:function(b,w){this._doCryptBlock(b,w,this._invSubKeys)},_doCryptBlock:function(b,w,S){this._lBlock=b[w],this._rBlock=b[w+1],g.call(this,4,252645135),g.call(this,16,65535),y.call(this,2,858993459),y.call(this,8,16711935),g.call(this,1,1431655765);for(var E=0;E<16;E++){for(var $=S[E],B=this._lBlock,N=this._rBlock,L=0,V=0;V<8;V++)L|=u[V][((N^$[V])&f[V])>>>0];this._lBlock=N,this._rBlock=B^L}var M=this._lBlock;this._lBlock=this._rBlock,this._rBlock=M,g.call(this,1,1431655765),y.call(this,8,16711935),y.call(this,2,858993459),g.call(this,16,65535),g.call(this,4,252645135),b[w]=this._lBlock,b[w+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function g(b,w){var S=(this._lBlock>>>b^this._rBlock)&w;this._rBlock^=S,this._lBlock^=S<<b}function y(b,w){var S=(this._rBlock>>>b^this._lBlock)&w;this._lBlock^=S,this._rBlock^=S<<b}n.DES=o._createHelper(p);var v=a.TripleDES=o.extend({_doReset:function(){var b=this._key,w=b.words;if(w.length!==2&&w.length!==4&&w.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var S=w.slice(0,2),E=w.length<4?w.slice(0,2):w.slice(2,4),$=w.length<6?w.slice(0,2):w.slice(4,6);this._des1=p.createEncryptor(r.create(S)),this._des2=p.createEncryptor(r.create(E)),this._des3=p.createEncryptor(r.create($))},encryptBlock:function(b,w){this._des1.encryptBlock(b,w),this._des2.decryptBlock(b,w),this._des3.encryptBlock(b,w)},decryptBlock:function(b,w){this._des3.decryptBlock(b,w),this._des2.encryptBlock(b,w),this._des1.decryptBlock(b,w)},keySize:192/32,ivSize:64/32,blockSize:64/32});n.TripleDES=o._createHelper(v)}(),t.TripleDES})}(gu)),gu.exports}var yu={exports:{}},km;function jb(){return km||(km=1,function(s,e){(function(t,n,i){s.exports=n(ze(),Us(),Vs(),cs(),bt())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.StreamCipher,o=n.algo,a=o.RC4=r.extend({_doReset:function(){for(var h=this._key,u=h.words,f=h.sigBytes,p=this._S=[],g=0;g<256;g++)p[g]=g;for(var g=0,y=0;g<256;g++){var v=g%f,b=u[v>>>2]>>>24-v%4*8&255;y=(y+p[g]+b)%256;var w=p[g];p[g]=p[y],p[y]=w}this._i=this._j=0},_doProcessBlock:function(h,u){h[u]^=l.call(this)},keySize:256/32,ivSize:0});function l(){for(var h=this._S,u=this._i,f=this._j,p=0,g=0;g<4;g++){u=(u+1)%256,f=(f+h[u])%256;var y=h[u];h[u]=h[f],h[f]=y,p|=h[(h[u]+h[f])%256]<<24-g*8}return this._i=u,this._j=f,p}n.RC4=r._createHelper(a);var c=o.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var h=this.cfg.drop;h>0;h--)l.call(this)}});n.RC4Drop=r._createHelper(c)}(),t.RC4})}(yu)),yu.exports}var vu={exports:{}},Sm;function Wb(){return Sm||(Sm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),Us(),Vs(),cs(),bt())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.StreamCipher,o=n.algo,a=[],l=[],c=[],h=o.Rabbit=r.extend({_doReset:function(){for(var f=this._key.words,p=this.cfg.iv,g=0;g<4;g++)f[g]=(f[g]<<8|f[g]>>>24)&16711935|(f[g]<<24|f[g]>>>8)&4278255360;var y=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],v=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var g=0;g<4;g++)u.call(this);for(var g=0;g<8;g++)v[g]^=y[g+4&7];if(p){var b=p.words,w=b[0],S=b[1],E=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,$=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,B=E>>>16|$&4294901760,N=$<<16|E&65535;v[0]^=E,v[1]^=B,v[2]^=$,v[3]^=N,v[4]^=E,v[5]^=B,v[6]^=$,v[7]^=N;for(var g=0;g<4;g++)u.call(this)}},_doProcessBlock:function(f,p){var g=this._X;u.call(this),a[0]=g[0]^g[5]>>>16^g[3]<<16,a[1]=g[2]^g[7]>>>16^g[5]<<16,a[2]=g[4]^g[1]>>>16^g[7]<<16,a[3]=g[6]^g[3]>>>16^g[1]<<16;for(var y=0;y<4;y++)a[y]=(a[y]<<8|a[y]>>>24)&16711935|(a[y]<<24|a[y]>>>8)&4278255360,f[p+y]^=a[y]},blockSize:128/32,ivSize:64/32});function u(){for(var f=this._X,p=this._C,g=0;g<8;g++)l[g]=p[g];p[0]=p[0]+1295307597+this._b|0,p[1]=p[1]+3545052371+(p[0]>>>0<l[0]>>>0?1:0)|0,p[2]=p[2]+886263092+(p[1]>>>0<l[1]>>>0?1:0)|0,p[3]=p[3]+1295307597+(p[2]>>>0<l[2]>>>0?1:0)|0,p[4]=p[4]+3545052371+(p[3]>>>0<l[3]>>>0?1:0)|0,p[5]=p[5]+886263092+(p[4]>>>0<l[4]>>>0?1:0)|0,p[6]=p[6]+1295307597+(p[5]>>>0<l[5]>>>0?1:0)|0,p[7]=p[7]+3545052371+(p[6]>>>0<l[6]>>>0?1:0)|0,this._b=p[7]>>>0<l[7]>>>0?1:0;for(var g=0;g<8;g++){var y=f[g]+p[g],v=y&65535,b=y>>>16,w=((v*v>>>17)+v*b>>>15)+b*b,S=((y&4294901760)*y|0)+((y&65535)*y|0);c[g]=w^S}f[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,f[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,f[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,f[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,f[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,f[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,f[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,f[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}n.Rabbit=r._createHelper(h)}(),t.Rabbit})}(vu)),vu.exports}var xu={exports:{}},Dm;function Ub(){return Dm||(Dm=1,function(s,e){(function(t,n,i){s.exports=n(ze(),Us(),Vs(),cs(),bt())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.StreamCipher,o=n.algo,a=[],l=[],c=[],h=o.RabbitLegacy=r.extend({_doReset:function(){var f=this._key.words,p=this.cfg.iv,g=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],y=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var v=0;v<4;v++)u.call(this);for(var v=0;v<8;v++)y[v]^=g[v+4&7];if(p){var b=p.words,w=b[0],S=b[1],E=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,$=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,B=E>>>16|$&4294901760,N=$<<16|E&65535;y[0]^=E,y[1]^=B,y[2]^=$,y[3]^=N,y[4]^=E,y[5]^=B,y[6]^=$,y[7]^=N;for(var v=0;v<4;v++)u.call(this)}},_doProcessBlock:function(f,p){var g=this._X;u.call(this),a[0]=g[0]^g[5]>>>16^g[3]<<16,a[1]=g[2]^g[7]>>>16^g[5]<<16,a[2]=g[4]^g[1]>>>16^g[7]<<16,a[3]=g[6]^g[3]>>>16^g[1]<<16;for(var y=0;y<4;y++)a[y]=(a[y]<<8|a[y]>>>24)&16711935|(a[y]<<24|a[y]>>>8)&4278255360,f[p+y]^=a[y]},blockSize:128/32,ivSize:64/32});function u(){for(var f=this._X,p=this._C,g=0;g<8;g++)l[g]=p[g];p[0]=p[0]+1295307597+this._b|0,p[1]=p[1]+3545052371+(p[0]>>>0<l[0]>>>0?1:0)|0,p[2]=p[2]+886263092+(p[1]>>>0<l[1]>>>0?1:0)|0,p[3]=p[3]+1295307597+(p[2]>>>0<l[2]>>>0?1:0)|0,p[4]=p[4]+3545052371+(p[3]>>>0<l[3]>>>0?1:0)|0,p[5]=p[5]+886263092+(p[4]>>>0<l[4]>>>0?1:0)|0,p[6]=p[6]+1295307597+(p[5]>>>0<l[5]>>>0?1:0)|0,p[7]=p[7]+3545052371+(p[6]>>>0<l[6]>>>0?1:0)|0,this._b=p[7]>>>0<l[7]>>>0?1:0;for(var g=0;g<8;g++){var y=f[g]+p[g],v=y&65535,b=y>>>16,w=((v*v>>>17)+v*b>>>15)+b*b,S=((y&4294901760)*y|0)+((y&65535)*y|0);c[g]=w^S}f[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,f[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,f[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,f[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,f[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,f[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,f[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,f[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}n.RabbitLegacy=r._createHelper(h)}(),t.RabbitLegacy})}(xu)),xu.exports}var _u={exports:{}},Em;function Vb(){return Em||(Em=1,function(s,e){(function(t,n,i){s.exports=n(ze(),Us(),Vs(),cs(),bt())})(Ne,function(t){return function(){var n=t,i=n.lib,r=i.BlockCipher,o=n.algo;const a=16,l=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],c=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var h={pbox:[],sbox:[]};function u(v,b){let w=b>>24&255,S=b>>16&255,E=b>>8&255,$=b&255,B=v.sbox[0][w]+v.sbox[1][S];return B=B^v.sbox[2][E],B=B+v.sbox[3][$],B}function f(v,b,w){let S=b,E=w,$;for(let B=0;B<a;++B)S=S^v.pbox[B],E=u(v,S)^E,$=S,S=E,E=$;return $=S,S=E,E=$,E=E^v.pbox[a],S=S^v.pbox[a+1],{left:S,right:E}}function p(v,b,w){let S=b,E=w,$;for(let B=a+1;B>1;--B)S=S^v.pbox[B],E=u(v,S)^E,$=S,S=E,E=$;return $=S,S=E,E=$,E=E^v.pbox[1],S=S^v.pbox[0],{left:S,right:E}}function g(v,b,w){for(let N=0;N<4;N++){v.sbox[N]=[];for(let L=0;L<256;L++)v.sbox[N][L]=c[N][L]}let S=0;for(let N=0;N<a+2;N++)v.pbox[N]=l[N]^b[S],S++,S>=w&&(S=0);let E=0,$=0,B=0;for(let N=0;N<a+2;N+=2)B=f(v,E,$),E=B.left,$=B.right,v.pbox[N]=E,v.pbox[N+1]=$;for(let N=0;N<4;N++)for(let L=0;L<256;L+=2)B=f(v,E,$),E=B.left,$=B.right,v.sbox[N][L]=E,v.sbox[N][L+1]=$;return!0}var y=o.Blowfish=r.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var v=this._keyPriorReset=this._key,b=v.words,w=v.sigBytes/4;g(h,b,w)}},encryptBlock:function(v,b){var w=f(h,v[b],v[b+1]);v[b]=w.left,v[b+1]=w.right},decryptBlock:function(v,b){var w=p(h,v[b],v[b+1]);v[b]=w.left,v[b+1]=w.right},blockSize:64/32,keySize:128/32,ivSize:64/32});n.Blowfish=r._createHelper(y)}(),t.Blowfish})}(_u)),_u.exports}(function(s,e){(function(t,n,i){s.exports=n(ze(),Wa(),bb(),wb(),Us(),Cb(),Vs(),J0(),qh(),kb(),sm(),Sb(),Db(),Eb(),eu(),Ab(),cs(),bt(),Tb(),$b(),Ib(),Bb(),Nb(),Fb(),Pb(),Mb(),Rb(),Lb(),zb(),Ob(),Hb(),jb(),Wb(),Ub(),Vb())})(Ne,function(t){return t})})(U0);var Kb=U0.exports;const bu=Dp(Kb);class Am extends ke{constructor(){super(...arguments),this._toolbarState={bold:!1,italic:!1,underline:!1,strikethrough:!1,bulleted:!1,numbered:!1,fontSize:"text",color:"",background:"",hasSelection:!1},this.colorPickerRef=null,this.colorPicker=null,this.bgColorPickerRef=null,this.bgColorPicker=null,this.formatButtons=[{key:"bold",icon:"format-bold",command:"toggleBold",hint:"加粗"},{key:"italic",icon:"format-italic",command:"toggleItalic",hint:"斜体"},{key:"underline",icon:"underline",command:"toggleUnderline",hint:"下划线"},{key:"strikethrough",icon:"strikethrough",command:"toggleStrike",hint:"删除线"}],this.listButtons=[{key:"bulleted",icon:"format-list-bulleted",listType:"bulleted",hint:"无序列表"},{key:"numbered",icon:"format-list-numbers",listType:"numbered",hint:"有序列表",iconClass:"text-lg"}],this.otherButtons=[{key:"todo",icon:"check-sign",listType:"todo",hint:"待办事项"},{key:"link",icon:"text-link",command:"toggleLink",hint:"链接",iconClass:"text-lg"},{key:"image",icon:"file-image",command:"insertImages",hint:"插入图片"},{key:"file",icon:"file",isUpload:!0,hint:"上传附件"}],this.colorList=[{key:"default",value:"#30394A"},{key:"red",value:"#C62222"},{key:"orange",value:"#D34F0B"},{key:"yellow",value:"#B67C04"},{key:"green",value:"#149343"},{key:"teal",value:"#0782A0"},{key:"blue",value:"#2159D3"},{key:"purple",value:"#842ED3"},{key:"grey",value:"#7A7A7A"}],this.fontSizeItems=[{text:"文本",value:"text"},{text:"标题 1",value:"h1"},{text:"标题 2",value:"h2"},{text:"标题 3",value:"h3"},{text:"标题 4",value:"h4"},{text:"标题 5",value:"h5"},{text:"标题 6",value:"h6"}],this.moreItems=[{text:"基础",type:"heading",className:"text-gray-400"},{text:"代码块",value:"code",command:"toggleCode",flavour:"affine:code"},{text:"引用",value:"quote",flavour:"affine:paragraph"},{text:"分割线",value:"divider",flavour:"affine:divider"},{text:"内嵌公式",value:"inLineEquation",command:"insertInlineLatex",flavour:"affine:latex"},{text:"公式",value:"equation",command:"insertLatexBlock",flavour:"affine:latex"},{text:"数据库",type:"heading",className:"text-gray-400"},{text:"表格视图",value:"table",command:"table"},{text:"看板视图",value:"kanban",command:"kanban"}],this.syncSelectionRange=()=>{var t;const e=this.checkEditor(!0);e&&e.selection.std.range.syncTextSelectionToRange((t=e.selection.value)==null?void 0:t[0])},this.checkEditor=e=>{var r;const{editor:t}=this.props;if(!t)return;const n=t.editor;if(!n)return;const i=n.host;if(i&&!(e&&!((r=i.selection.value)!=null&&r.length)))return i},this.handleColorChange=e=>{const t=this.checkEditor(!0);if(!t)return;const n=this.colorList.find(i=>i.value===e);t.selection.std.command.exec("formatText",{textSelection:t.selection.value[0],styles:{color:`var(--affine-text-highlight-foreground-${n==null?void 0:n.key})`}}),this.updateToolbarState()},this.handleBackgroundChange=e=>{const t=this.checkEditor(!0);if(!t)return;const n=this.colorList.find(i=>i.value===e);t.selection.std.command.exec("formatText",{textSelection:t.selection.value[0],styles:{background:`var(--affine-text-highlight-${n==null?void 0:n.key})`}}),this.updateToolbarState()},this.handleFormat=e=>{var n,i,r,o;const t=this.checkEditor(e!="toggleLink");if(t){if(e=="toggleLink")if(!((i=(n=t.selection.value[0])==null?void 0:n.from)!=null&&i.length))t.selection.std.command.exec("insertLinkByQuickSearch");else{t.selection.std.command.exec(e);return}if(e=="toggleCode")if((o=(r=t.selection.value[0])==null?void 0:r.from)!=null&&o.length){t.selection.std.command.exec(e);return}else{t.selection.std.command.exec("updateBlockType",{flavour:"affine:code"});return}if(e=="table"||e=="kanban"){const{selectedModels:a}=t.selection.std.command.exec("getSelectedModels");t.selection.std.command.exec("insertDatabaseBlock",{selectedModels:a,viewType:e,place:"after"});return}if(e=="insertLatexBlock"||e=="insertImages"){const{selectedModels:a}=t.selection.std.command.exec("getSelectedModels");t.selection.std.command.exec(e,{selectedModels:a,place:"after"});return}if(e=="insertInlineLatex"){t.selection.std.command.exec("insertInlineLatex",{textSelection:t.selection.value[0]});return}t.selection.std.command.exec(e),this.updateToolbarState()}},this.handleList=e=>{this.updateBlockType("affine:list",{type:e}),this.updateToolbarState()},this.handleFontSize=e=>{this.updateBlockType("affine:paragraph",{type:e}),this.updateToolbarState()},this.updateBlockType=(e,t)=>{const n=this.checkEditor(!0);n&&n.selection.std.command.exec("updateBlockType",{flavour:e,props:t})},this.handleUpload=async e=>{const t=this.checkEditor(!0);if(!t)return;const n=new FileReader;n.onload=async i=>{var o;const r=(o=i.target)==null?void 0:o.result;r&&t.selection.std.command.exec("updateBlockType",{flavour:"affine:attachment",props:{name:e.name,size:e.size,type:e.type,sourceId:this.sha(r)}})},n.readAsArrayBuffer(e)},this.sha=e=>{const t=bu.lib.WordArray.create(new Uint8Array(e));return bu.SHA256(t).toString(bu.enc.Base64).replace(/\+/g,"-").replace(/\//g,"_")},this.handleFileUpload=e=>{var i;const t=e.target,n=(i=t.files)==null?void 0:i[0];n&&this.handleUpload(n),t.value=""},this.renderButton=e=>{const{key:t,icon:n,command:i,listType:r,hint:o,isUpload:a,iconClass:l}=e,c=this._toolbarState[t];return a?k("div",{key:t,className:"relative file-container"},k("input",{type:"file",className:"hidden",accept:"*/*",onChange:this.handleFileUpload}),k($e,{className:ee("ghost"),icon:n,hint:o,onClick:h=>{const u=_(h.target).closest(".file-container").find('input[type="file"]')[0];u==null||u.click()}})):k($e,{key:n,className:ee("ghost",c?"text-primary":""),icon:n,iconClass:l,hint:o,disabled:t=="link"&&!this._toolbarState.hasSelection,onClick:()=>{i?this.handleFormat(i):r&&this.handleList(r)}})}}componentDidMount(){this.initColorPicker(),setTimeout(()=>{this.initSelectionListener()},1e3)}componentWillUnmount(){this.colorPicker&&this.colorPicker.destroy(),this.bgColorPicker&&this.bgColorPicker.destroy(),this.removeSelectionListener()}initColorPicker(){this.colorPickerRef&&(this.colorPicker=new $i(this.colorPickerRef,{className:"btn ghost px-2",icon:"icon-pencil",hint:"文字颜色",colors:["#30394A","#C62222","#D34F0B","#B67C04","#149343","#0782A0","#2159D3","#842ED3","#7A7A7A"],onChange:e=>this.handleColorChange(e),onClick:()=>this.syncSelectionRange()})),this.bgColorPickerRef&&(this.bgColorPicker=new $i(this.bgColorPickerRef,{className:"btn ghost px-2",icon:"icon-pencil-alt",hint:"文字背景颜色",colors:["#C62222","#D34F0B","#B67C04","#149343","#0782A0","#2159D3","#842ED3","#7A7A7A"],onChange:e=>this.handleBackgroundChange(e),onClick:()=>this.syncSelectionRange()}))}initSelectionListener(){const e=this.checkEditor();e==null||e.selection.slots.changed.on(()=>{this.updateToolbarState()})}getColor(e){const t=this._toolbarState[e],n=e=="color"?/var\(--affine-text-highlight-foreground-(.*?)\)/:/var\(--affine-text-highlight-(.*?)\)/,i=t.match(n),r=i?i[1]:"";return this.colorList.find(o=>o.key===r)}updataColorPicker(){if(this.colorPicker){const e=this.getColor("color");this.colorPicker.$.setValue((e==null?void 0:e.value)||"")}if(this.bgColorPicker){const e=this.getColor("background");this.bgColorPicker.$.setValue((e==null?void 0:e.value)||"")}}removeSelectionListener(){const e=this.checkEditor();e==null||e.selection.slots.changed.dispose()}updateToolbarState(){var h,u,f;const e=this.checkEditor();if(!e){this._toolbarState={bold:!1,italic:!1,underline:!1,strikethrough:!1,bulleted:!1,numbered:!1,fontSize:"text",color:"",background:"",hasSelection:!1};return}const n=e.selection.std.command.exec("getTextStyle").textStyle,{selectedModels:i}=e.selection.std.command.exec("getSelectedModels"),r=i==null?void 0:i[0],o=(r==null?void 0:r.flavour)==="affine:list",a=o?r==null?void 0:r.type:null,c=(r==null?void 0:r.flavour)==="affine:paragraph"&&["h1","h2","h3","h4","h5","h6"].includes(r==null?void 0:r.type)?r==null?void 0:r.type:"text";this._toolbarState={bold:n.bold||!1,italic:n.italic||!1,underline:n.underline||!1,strikethrough:n.strike||!1,bulleted:o&&a==="bulleted",numbered:o&&a==="numbered",fontSize:c,color:(n==null?void 0:n.color)||"",background:(n==null?void 0:n.background)||"",hasSelection:((f=(u=(h=e.selection.value)==null?void 0:h[0])==null?void 0:u.from)==null?void 0:f.length)>0},this.forceUpdate(),this.updataColorPicker()}render(){this.fontSizeItems.forEach(n=>{n.onClick=this.handleFontSize.bind(this,n.value)});const e=this._toolbarState.fontSize,t=this.fontSizeItems.filter(n=>n.value==e);return this.moreItems.forEach(n=>{n.value=="quote"||n.value=="divider"?n.onClick=this.updateBlockType.bind(this,n.flavour,{type:n.value}):n.type||(n.onClick=this.handleFormat.bind(this,n.command))}),k("div",{className:"doc-toolbar flex items-center flex-wrap gap-1 absolute top-0 left-0 w-full bg-white border-b z-10",style:"min-height: 40px;"},k(as,{type:"ghost",text:t[0].text,trigger:"hover",items:this.fontSizeItems}),k("div",{className:"divider",style:"height: unset; margin-left: -4px;"}),this.formatButtons.map(this.renderButton),k("div",{className:"divider",style:"height: unset;"}),k("div",{ref:n=>this.colorPickerRef=n}),k("div",{ref:n=>this.bgColorPickerRef=n}),k("div",{className:"divider",style:"height: unset;"}),this.listButtons.map(this.renderButton),k("div",{className:"divider",style:"height: unset;"}),this.otherButtons.map(this.renderButton),k(as,{type:"ghost",icon:"plus",trigger:"hover",items:this.moreItems}))}}Am.defaultProps={className:""};class qb extends ke{constructor(e){super(e),this._editor=Ce(),this._titleEle=Ce(),this._isLoadingLib=at(!1),this._convertedToNewDoc=at(0),this._gid=Hs(),this._saveTimer=0,this._dataTime=0,this._cacheDataTime=0,this._isLoadingFile=at(!1),this._loadFileTimer=0,this._handleChange=t=>{const n=t.content;(n!==this._data.content||t.html!==this._data.html)&&(this._data.content=n,this._data.contentType=t.contentType,this._data.html=t.html,this._dataTime=Date.now(),this._callChange()),this.trySaveCache()},this._handleKeywordsChange=t=>{const i=t.target.value.split(/,|，/).map(r=>r.trim()).filter(Boolean).join(", ");i!==this._data.keywords&&(this._data.keywords=i,this._callChange())},this._handleTitleChange=t=>{var i;const n=t.target.value;if(n!==this._data.title){this._data.title=n;const{editor:r}=this;r instanceof Oi&&((i=r.$)==null||i.updateTitle(n)),this._callChange()}},this._handleConvertDoc=async()=>{const{app:t}=this.props;await Ke.confirm({title:t.getLang("convertToNewDoc","转换文档"),content:t.getLang("convertToNewDocConfirm","确定要将此文档转换为新文档格式吗？")})&&await this._switchDoc(!0)},this._switchDoc=async t=>{const{doc:n}=this.props,i=n.$html;i&&this.triggerChange({content:i,contentType:"html",html:i}),await Is(100),this._convertedToNewDoc.value=t?n.id:0},this._switchToOldDoc=()=>{this._switchDoc(!1)},this._handleLoadingLibChange=t=>{this._isLoadingLib.value=t},this._toggleFileLoading=t=>{this._loadFileTimer&&clearTimeout(this._loadFileTimer),t?(this._isLoadingFile.value=!0,this._loadFileTimer=0):this._loadFileTimer=window.setTimeout(()=>{this._isLoadingFile.value=!1,this._loadFileTimer=0},1500)},this._handleAwarenessUpdate=t=>{const{states:n}=t,{app:i}=this.props,r=Array.from(new Map(n.map(o=>o.user).map(o=>[o.id,o])).values());i.changeState({editingUsers:r})},this._handleDownload=async t=>{const{downloadUrl:n}=this.props,i=this.props.app.getDownloadUrl(t.key,n);this._toggleFileLoading(!0);let r=null;try{r=await(await fetch(i)).blob()}catch(o){console.error("[ZUI - DocEditor] download file failed",o)}return this._toggleFileLoading(!1),{blob:r}},this._handleUpload=async t=>{const{uploadUrl:n}=this.props,{key:i,blob:r,editorID:o}=t;await _.post(Te(n,{uid:encodeURIComponent(o),extra:"editor",field:"imgFile",gid:btoa(i)}),{imgFile:r,"labels[]":[r.name]},"json")},this._data={title:e.doc.title,content:e.doc.content??""}}get gid(){return this._gid}get editor(){return this._editor.current}get cacheID(){return`doc-${this.props.mode==="edit"?this.props.doc.id:"new"}-${this._gid}`}async getData(e){const t=this._editor.current;if(t instanceof Oi){const r={...await t.getData(),contentType:"doc"};return e!=null&&e.getHtml&&(r.html=await t.getHtml()),r}return await(t==null?void 0:t.getData())}focusTitle(){var e;(e=this._titleEle.current)==null||e.focus()}setTitle(e){this._data.title=e;const t=this._titleEle.current;t&&(t.value=e,this.triggerChange())}async triggerChange(e,t){var i;const n=await this.getData(t);!n&&!e||((i=this._handleChange)==null||i.call(this,{...n,...e}),this.saveCache())}saveCache(){this._cacheDataTime!==this._dataTime&&(_.db.setCacheData(this.cacheID,this._data,0,"docAppCache"),this._cacheDataTime=this._dataTime)}trySaveCache(){this._saveTimer&&clearTimeout(this._saveTimer),this._saveTimer=window.setTimeout(()=>{this.saveCache(),this._saveTimer=0},1e3)}removeCache(){_.db.deleteCacheData(this.cacheID,"docAppCache")}_callChange(){var t,n;const{doc:e}=this.props;(n=(t=this.props).onChange)==null||n.call(t,{id:e.id,...this._data})}_renderTitle(e){const{doc:{title:t,deleted:n},mode:i,app:r}=e;return i==="view"?n?k("div",{class:"flex gap-2 items-center"},k("h1",{key:"title",class:"doc-editor-title",style:"font-size: 40px"},t),k("span",{class:"label danger"},r.getLang("deleted","已删除"))):k("h1",{key:"title",class:"doc-editor-title",style:"font-size: 40px"},t):k("input",{key:"title",ref:this._titleEle,type:"text",class:"doc-editor-title w-full font-bold",style:"font-size: 40px",defaultValue:t,onChange:this._handleTitleChange,placeholder:r.getLang("docTitlePlaceholder","请输入文档标题")})}_renderInfo(e){return k(vb,{...e})}_renderKeywords(e){const{doc:{keywords:t},mode:n,app:i}=e,r=(t==null?void 0:t.split(/,|，/).map(a=>a.trim()).filter(Boolean))??[];if(n==="view")return k("div",{key:"kw",title:i.getLang("keywords","关键字"),class:`doc-editor-keywords row gap-2 px-1 my-2${r.length?"":" hidden"}`},r.map(a=>k("span",{className:"label label-sm secondary-outline"},a.trim())));const o=`doc-app-kw-${this._gid}`;return k("div",{key:"kw",className:"input-control has-prefix-icon my-2 doc-editor-keywords"},k("input",{key:"kw",type:"text",id:o,class:"form-control ring-0 shadow-none",defaultValue:r.join(", "),onChange:this._handleKeywordsChange,placeholder:i.getLang("keywordsPlaceholder","关键字，使用逗号分隔")}),k("label",{for:o,class:"input-control-prefix"},k("i",{className:"icon icon-tag"})))}componentDidMount(){this.props.mode==="edit"&&this.focusTitle()}render(e){var K,X,ae,ue,ye;const{className:t,doc:n,belowTitle:i,mode:r,uploadUrl:o,downloadUrl:a,app:l}=e,c=n.contentType==="doc"?"doc":n.contentType==="markdown"?"markdown":"html",h=c==="doc"&&!n.$convert,u=c==="markdown",f=r==="view",p=r==="edit",g=l.props.autoConvertDoc||n.status==="draft",y=this._convertedToNewDoc.value,v=p&&(n.contentType==="html"||n.contentType==="attachment"||n.$convert),b=!(n.content??"").trim().length,w=b&&r==="view",S=p&&v&&y===n.id,E=u||h||S||b,$=E?Oi:fb,B=n.content===void 0||n.content===null,N=this._isLoadingLib.value,L=this._isLoadingFile.value,V=B||N;let{useHocuspocus:M}=l.props;M=typeof M=="function"?M(l):M;const F=l.mode==="edit"&&M?{checkExists:!!n.draft}:!1;return k("div",{class:ee("doc-editor load-indicator col",t,V||L?"loading":"",f?"is-readonly":"is-editing",w?"is-empty":"flex-auto"),"data-loading":B?l.getLang("loadingDocTip","正在加载文档内容..."):N?l.getLang("loadingEditorTip","正在加载编辑器..."):l.getLang("loadingFile","正在下载文档附件...")},l.mode=="edit"?k(Am,{editor:(K=this._editor.current)==null?void 0:K.$}):null,this._renderTitle(e),this._renderInfo(e),this._renderKeywords(e),g&&S&&E&&p?k("div",{className:"center mb-3"},k("div",{class:"row gap-2 items-center primary-pale pl-2 rounded-full"},k("p",{className:"text-gray"},l.getLang("oldDocEditingTip","此文档为旧版本编辑器创建，已启用新版编辑器编辑，保存后将转换为新版文档")),k($e,{text:l.getLang("switchToOldEditor","切换回旧编辑器"),size:"sm",type:"ghost",rounded:"full",className:"underline",onClick:this._switchToOldDoc}))):null,i,!V&&!w&&k($,{ref:this._editor,key:`editor-${n.id}-${r}-${n.currentVersion||n.version}`,className:"doc-editor-control flex-auto",mode:h?"full":"page",autoInit:!0,readonly:f,downloadUrl:a,uploadUrl:o,onDownload:a?this._handleDownload:void 0,onUpload:this._handleUpload,uid:n.uid??`doc${n.id}`,content:n.content??"",title:n.title,contentType:c,placeholder:o?l.getLang("pasteImageTip","可以在编辑器直接贴图。"):"",onChange:this._handleChange,onLoadingLibChange:this._handleLoadingLibChange,token:l.props.token,docID:Gb(l.docID),useHocuspocus:F,hocuspocusUrls:l.props.hocuspocusUrls,awarenessUser:l.props.awarenessUser,onAwarenessUpdate:this._handleAwarenessUpdate,onAuthenticationFailed:(X=l.props.onAuthenticationFailed)==null?void 0:X.bind(null,l),onConnect:(ae=l.props.onHocuspocusConnect)==null?void 0:ae.bind(null,l),onDisconnect:(ue=l.props.onHocuspocusDisconnect)==null?void 0:ue.bind(null,l),onClose:(ye=l.props.onHocuspocusClose)==null?void 0:ye.bind(null,l)},g&&v&&!S?k("div",{className:"absolute right-0 top-1"},k($e,{type:"primary-pale",size:"md",onClick:this._handleConvertDoc},l.getLang("convertToNewDoc","转换为新文档格式"))):null))}}function Gb(s){if(typeof s=="number")return s;const e=s.match(/\d+/);return e?+e:0}let wu=class extends tt{get actions(){return this.state.actions||this.props.actions||[]}getDefaultState(e){e=e||this.props;let{preserve:t,defaultReversed:n}=e;return t===!0&&(t=""),n===void 0&&typeof t=="string"&&(this._preserveID=`HistoryPanel.reversed${t.length?`:${t}`:""}`,n=rt.get(this._preserveID)),e.actions&&(this._currentLoadID=[e.objectType,e.objectID].join()),{actions:e.actions,expandMap:{},reversed:n}}resetState(e,t){const n=this.getDefaultState(e);t?this.state=n:this.changeState(n)}componentDidMount(){_.on(`load.HistoryPanel.${this.gid}.zt`,(e,{objectType:t,objectID:n})=>{t===this.props.objectType&&String(n)===String(this.props.objectID)&&this.load()}),this.state.actions||this.load()}componentWillUnmount(){_.off(`.HistoryPanel.${this.gid}.zt`)}componentDidUpdate(){(!this.state.actions||this._currentLoadID!==[this.props.objectType,this.props.objectID].join())&&!this.state.loading&&this.load()}async load(){const{objectType:e,objectID:t}=this.props;let n=this.props.fetcher;n||(n=zt("action","ajaxGetList",`objectType=${e}&objectID=${t}`));const i=[e,t].join();if(this.state.loading)return;await this.changeState({loading:!0});const o={actions:await Et(n,[{objectType:e,objectID:t}])||[],loading:!1},a=[this.props.objectType,this.props.objectID].join();a!==i?delete o.actions:this._currentLoadID=a,await this.changeState(o)}reverse(e){return e===void 0&&(e=!this.state.reversed),this.changeState({reversed:e},()=>{typeof this._preserveID=="string"&&rt.set(this._preserveID,e)})}toggle(e,t){return this.changeState(n=>{const{expandMap:i}=n;return t===void 0&&(t=!i[e]),{expandMap:{...i,[e]:t}}})}isAllExpanded(){const{expandMap:e}=this.state;return this.actions.every(t=>{const{history:n,historyChanges:i}=t;return!(n&&n.length||typeof i=="string"&&i.length)||e[t.id]})}toggleAll(e){return e===void 0&&(e=!this.isAllExpanded()),this.changeState({expandMap:e?this.actions.reduce((t,n)=>({...t,[n.id]:e}),{}):{}})}_getClassName(e){return[super._getClassName(e),"history-panel",e.panel?"panel":""]}_getChildren(e){const t=this._buildHeader(e),n=this._buildBody(e);return e.panel?[t?k("div",{key:"heading",className:"panel-heading"},t):null,k("div",{key:"body",className:"panel-body"},n)]:[t,n]}_buildFiles(e){let t=e.files;return Array.isArray(t)&&(t={items:t}),!t||!t.items?null:k(Pr,{key:"files",className:"bg-primary-50 py-1 px-1.5",...this.props.fileListProps,...t})}_buildAction(e,t,n,i){const{history:r,historyChanges:o}=e,a=r&&r.length||typeof o=="string"&&o.length,l=typeof e.comment=="string"&&e.comment.length,c=`${t+1}`,h={component:"li",key:String(e.id),"data-id":e.id,"data-action":e.action,className:["history-panel-action list-item item",a?n?"is-expanded":"is-collapsed":""],innerClass:"item-inner list-item-inner",avatar:{className:"text-gray ring canvas",background:"",size:16,circle:!0,...e.action==="finished"?{icon:{icon:"check",className:"text-success"}}:{children:k("span",{style:c.length>1?{transform:`scale(${1-c.length*.1})`}:void 0},c)}},title:{html:e.content},text:a?k($e,{icon:n?"minus":"plus",type:"ghost",size:"xs",className:"history-panel-action-toggle ring text-gray scale-75",onClick:this.toggle.bind(this,e.id,void 0)}):null,children:a&&n||l?k("div",{className:"history-panel-action-content pl-6 col gap-1 mb-1"},a&&n?typeof o=="string"&&o.length?k("div",{key:"history",className:"history-panel-action-history pl-1",dangerouslySetInnerHTML:{__html:o}}):k("ul",{key:"history",className:"history-panel-action-history col pl-1"},r.map(u=>k("li",{key:u.id,className:"history-panel-history-item",dangerouslySetInnerHTML:{__html:u.content}}))):null,e.comment?k("div",{key:"comment",className:`history-panel-action-comment py-2 surface relative ${e.commentEditable?"pl-3 pr-6":"px-3"}`},e.commentEditable?k($e,{key:"btn",type:"ghost",icon:"pencil",size:"sm",className:"comment-btn hover:text-primary absolute top-1 right-1","data-toggle":"comment","data-action-ID":e.id,url:i.editCommentUrl?i.editCommentUrl.replace("{actionID}",String(e.id)):void 0}):null,k("div",{className:"article",key:"comment",dangerouslySetInnerHTML:{__html:e.comment}})):null,this._buildFiles(e)):null};return k(wn,{...h})}_buildBody(e){const{actions:t}=this,{loading:n,expandMap:i,reversed:r}=this.state;return k("ul",{key:"actions",className:ee("list history-panel-body load-indicator",{loading:n},r?"col-reverse":"col",e.bodyClass)},t.map((o,a)=>this._buildAction(o,a,i[o.id],e)))}_buildHeader(e){let{header:t}=e;if(!t)return null;const{title:n="History",toolbar:i=!0,commentBtn:r=!0}=e,o=[];if(i){const{reversed:a}=this.state,l=this.isAllExpanded(),{actions:c}=this,h={key:"toolbar",className:"history-panel-toolbar",gap:1,items:[c.length>1?{icon:a?"arrow-down":"arrow-up",type:"ghost",size:"xs",className:"ring text-gray scale-75",onClick:this.reverse.bind(this,void 0)}:null,c.some(u=>{const{history:f,historyChanges:p}=u;return f&&f.length||typeof p=="string"&&p.length})?{icon:l?"minus":"plus",type:"ghost",size:"xs",className:"ring text-gray scale-75",onClick:this.toggleAll.bind(this,void 0)}:null].filter(Boolean)};typeof i=="object"&&Object.assign(h,i),h.items&&(!Array.isArray(h.items)||h.items.length)&&o.push(k(Xe,{...h}))}if(r){const a={key:"commentBtn",type:"ghost",className:"comment-btn text-gray",size:"sm",url:e.commentUrl,icon:{icon:"message",className:"icon-sm text-primary"},"data-toggle":"comment","data-object-ID":e.objectID,"data-object-type":e.objectType};typeof r=="object"?Object.assign(a,r):typeof r=="string"&&(a.text=r),o.push(k($e,{...a}))}return t={key:"header",className:"history-panel-header",title:n,titleClass:"font-bold mr-1",content:o,contentClass:"flex items-center flex-auto gap-2",...typeof t=="object"?t:{}},k(wn,{...t})}};wu.defaultProps={header:!0,panel:!0,preserve:!0};class Or extends ke{constructor(){super(...arguments),this._ref=Ce(),this._timer=0,this._editorSelector="page-editor,affine-page-root,zen-editor,.doc-editor-content",this.state={},this._getItem=e=>{var t;return e.innerClass=(t=e.text)!=null&&t.length?"":"hidden",e},this._handleClickItem=e=>{var t;(t=e.event.target)!=null&&t.closest(".tree-toggle")||this.scrollIntoDoc(e.item)}}update(){var l,c;const e=this.props.container||((l=this._ref.current)==null?void 0:l.closest(".doc-view"));if(!e)return;this._container!==e&&(this._container&&_(this._container).off(".doc-outline"),this._container=e,_(e).on("docChange.doc-outline",()=>{this.tryUpdate()}));const n=_(e).find(this._editorSelector)[0];if(!n)return;const i=n.tagName.toLowerCase(),r=i==="zen-editor"?"zen":i==="page-editor"||i==="affine-page-root"?"blocksuite":"html";this._editorType=r;const o=r==="blocksuite"?Or.getBlocksuiteHeadings(n):Or.getEditorHeadings(n),a=Or.formHeadings(o);this._lastDocID=(c=this.props.doc)==null?void 0:c.id,this.setState({items:a})}tryUpdate(){var e;this._timer&&clearTimeout(this._timer),this._lastDocID!==((e=this.props.doc)==null?void 0:e.id)&&this.setState({items:void 0}),this._timer=window.setTimeout(()=>{this.update(),this._timer=0},1e3)}scrollIntoDoc(e){var i,r,o,a;const t=this._container;if(!t)return;const n=_(t).find(this._editorSelector)[0];if(n)if(this._editorType==="blocksuite")(i=n.querySelector(`affine-paragraph[data-block-id="${e.id}"]`))==null||i.scrollIntoView({behavior:"smooth",block:"start"});else{const c=(((a=(o=(r=n.shadowRoot)==null?void 0:r.querySelector("zen-editor-core"))==null?void 0:o.shadowRoot)==null?void 0:a.querySelector("zen-editor-content"))||n).querySelectorAll("h1,h2,h3,h4,h5,h6");if(!c)return;const{text:h,level:u}=e;let f=e.index!==void 0?c[e.index]:void 0;(!f||f.textContent!==h||f.tagName!==`H${u}`)&&(f=Array.from(c).find(p=>p.textContent===h&&p.tagName===`H${u}`)),f&&f.scrollIntoView({behavior:"smooth",block:"start"})}}componentDidMount(){this.tryUpdate()}componentDidUpdate(e){this.props.doc!==e.doc&&this.tryUpdate()}componentWillUnmount(){this._container&&_(this._container).off(".doc-outline"),this._timer&&clearTimeout(this._timer)}render(e,t){const{items:n}=t;return k("div",{className:"doc-outline",ref:this._ref},n?n.length?k(Ft,{items:n,defaultNestedShow:!0,getItem:this._getItem,nestedToggle:".tree-toggle",onClickItem:this._handleClickItem}):k("div",{className:"text-gray p-2"},e.app.getLang("noOutline","没有大纲")):k("div",{className:"text-gray p-1"},e.app.getLang("loading","加载中...")))}static formHeadings(e){let t,n=e.reduce((i,r)=>{r.text=r.text.trim();const{level:o}=r;if(!r.text.length&&(o===1||t&&t.level===o))return i;if(o>1){t||(t={level:1,text:"",id:""},i.push(t));let a;if(t.level===o-1)a=t;else if(t.level>=o){for(;t.level>=o;)t.parent&&(t=t.parent);a=t}else{for(;t.level<o-1;){const l={level:t.level+1,text:"",id:"",parent:t};t.items||(t.items=[]),t.items.push(l),t=l}a=t}r.parent=a,a.items||(a.items=[]),a.items.push(r)}else i.push(r);return t=r,i},[]);return n.length===1&&n[0].text===""&&(n=n[0].items||[]),n}static getBlocksuiteHeadings(e){const t=[],n=(i,r)=>{var a;const o=((a=i.querySelector("v-text"))==null?void 0:a.textContent)??"";t.push({id:i.closest("affine-paragraph").dataset.blockId??`${r}_${o}`,text:o,level:r})};return e.querySelectorAll(".affine-paragraph-rich-text-wrapper").forEach(i=>{const r=i.classList;let o=0;r.contains("h1")?o=1:r.contains("h2")?o=2:r.contains("h3")?o=3:r.contains("h4")?o=4:r.contains("h5")?o=5:r.contains("h6")&&(o=6),o&&n(i,o)}),t}static getEditorHeadings(e){var i,r,o;const t=[],n=((o=(r=(i=e.shadowRoot)==null?void 0:i.querySelector("zen-editor-core"))==null?void 0:r.shadowRoot)==null?void 0:o.querySelector("zen-editor-content"))||e;return n&&n.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(a=>{const l=a.textContent||"",c=a.id,h=parseInt(a.tagName[1]);l.length&&h<7&&t.push({index:t.length,level:h,text:l,id:c})}),t}}const Tm=class Wd extends ke{constructor(e){super(e),this._ref=Ce();const{defaultStatus:t=Wd.defaultProps.defaultStatus}=e;this._status=e.status||at(t)}toggleTab(e){e===void 0?this._status.value=this._status.value?!1:Wd.defaultProps.defaultStatus:this._status.value=e===!1||this._status.value===e?!1:e}_renderContent(e,t,n){var o;if(!e||!n)return null;const{doc:i,app:r}=t;if(n.render)return k(Se,{content:n.render(i)});if(e==="info"){const{creator:a,modifier:l}=t,c=[{label:r.getLang("docStatus","状态"),content:i.status==="draft"?k("div",{key:"status",className:"label special-pale size-sm rounded-full ml-1"},r.getLang("draft","草稿")):r.getLang("released","已发布")},{label:r.getLang("creator","创建者"),content:a.realname},{label:r.getLang("createDate","创建时间"),content:gt(i.addedDate)},{label:r.getLang("modifier","修改者"),content:l==null?void 0:l.realname},i.editedDate?{label:r.getLang("editDate","修改时间"),content:gt(i.editedDate)}:null,{label:r.getLang("viewsCount","阅读次数"),content:i.views},{label:r.getLang("collectCount","收藏次数"),content:[i.collects,i.isCollector?k("span",{className:"label side-sm rounded-full warning-pale"},r.getLang("collected","已收藏")):null]}].filter(Boolean);return k("div",{className:"col gap-2"},k("div",{className:"font-bold px-1"},r.getLang("docInfo","文档信息")),k(p0,{items:c}))}if(e==="outline")return k("div",{className:"col gap-2"},k("div",{className:"font-bold px-1"},n.title??r.getLang("docOutline","文档大纲")),k(Or,{app:r,container:(o=this._ref.current)==null?void 0:o.closest(".doc-view"),doc:i}));if(e==="history")return M0(i.rawID)?null:k("div",{style:"margin-top: -6px"},k(wu,{panel:!1,title:n.title??r.getLang("history","历史记录"),objectType:i.api?"api":"doc",objectID:i.rawID,fetcher:t.historyFetcher,...t.historyPanel}))}_renderNav(e,t,n){const{app:i}=t;return k("menu",{key:"nav",className:"doc-view-sidebar-nav nav nav-stacked gap-1 p-1 flex-none rounded-lg"},n.map(({icon:r,title:o,key:a})=>k("li",{class:"nav-item item hint-left","data-hint":o,key:a},k("a",{className:`rounded-lg${e===a?" active":""}`,"zui-command":`toggleViewSideTab/${a}`},k(Re,{icon:r})))),n.length?k("li",{key:"divider",class:"nav-divider divider"}):null,k("li",{class:"nav-item item hint-left","data-hint":i.fullscreen?i.getLang("exitFullscreen","退出全屏"):i.getLang("enterFullscreen","进入全屏")},k("a",{className:"rounded-lg","zui-command":"toggleFullscreen"},k(Re,{icon:i.fullscreen?"fullscreen-exit":"fullscreen"}))),e?k("li",{class:"nav-item item hint-left","data-hint":i.getLang("collapse","收起")},k("a",{className:"rounded-lg","zui-command":"toggleViewSideTab/false"},k(Re,{icon:"icon-menu-arrow-right"}))):null)}render(e){var h;const{className:t,app:n,doc:i,showTabsNav:r}=e;let o=this._status.value;const a=M0(+i.id);o&&a&&(o="outline");const l=((h=n.props.getDocViewSidebarTabs)==null?void 0:h.call(n,i,{isNewDoc:a,mode:n.mode}))||[{icon:"list-box",title:n.getLang("docOutline","文档大纲"),key:"outline"}],c=l==null?void 0:l.find(u=>u.key===o);return c||(o=""),!r&&!o?null:k("div",{className:ee("doc-view-sidebar flex-none z-50 sticky top-3 right-1 self-start",t,`is-${o?"opened":"closed"}`,`is-${o}`,r?`has-tabs-nav-${r}`:""),ref:this._ref},k("div",{className:"doc-view-sidebar-container border shadow rounded-lg row items-stretch mb-3"},k("div",{key:"content",className:"doc-view-sidebar-content p-2 border-r flex-auto overflow-y-auto scrollbar-hover"},this._renderContent(o,e,c)),r?this._renderNav(o,e,l):k($e,{type:"ghost",size:"sm",icon:"close text-gray",className:"absolute top-1.5 right-1.5 z-10",command:"toggleViewSideTab/false"})))}};Tm.defaultProps={defaultStatus:"outline",showTabsNav:"right"};let Yb=Tm;class Xb extends ke{constructor(e){super(e),this._editorRef=Ce(),this._ref=Ce(),this._sidebarRef=Ce(),this._currentDocID=at(""),this._modeChangeEffect=ln(()=>{this.props.app.mode!=="view"&&(this._currentDocID.value="")}),this._docChangeEffect=ln(()=>{const{docID:i,docVersion:r}=this.props.app.signals,o=[i,r].join();o!==this._currentDocID.value&&(this._currentDocID.value=o,this.tryLoadDoc())}),this._handleChange=i=>{const{doc:r,mode:o="view",onChange:a}=this.props;a==null||a(i,o,r),_(this.element).trigger("docChange",[i,o,r])};const{preserve:t}=e,n=t?`${t}-expanded`:null;this._status=at(n?rt.get(n,!1):!1),n&&this._status.subscribe(i=>{rt.set(n,i)})}get editor(){return this._editorRef.current}get element(){return this._ref.current}get sidebar(){return this._sidebarRef.current}tryLoadDoc(){const e=this._currentDocID.value;if(e){const[t,n]=e.split(",").map(js);this.props.app.loadDoc(t,n)}}componentWillUnmount(){this._modeChangeEffect(),this._docChangeEffect()}_renderEditor(e){const{doc:t,mode:n="view",uploadUrl:i,downloadUrl:r,app:o}=e,a=o.renderCustom("editor");return a!==void 0?a:k(qb,{app:o,ref:this._editorRef,mode:n,doc:t,uploadUrl:i?Te(i,{objectID:n==="create"?0:t.id,objectType:"doc",api:t.contentType==="doc"?"true":"",extra:t.contentType==="doc"?"editor":""}):void 0,downloadUrl:r?Te(r,{id:t.id,objectID:t.id,objectType:"doc"}):void 0,onChange:this._handleChange})}render(e){var g;const{doc:t,fileActions:n,fileIcon:i,fileUrl:r,creator:o,modifier:a,onGetUser:l,historyFetcher:c,highlight:h,app:u}=e,f=this._status.value,p=u.mode=="edit"?"pt-8":"";return k("div",{className:ee("doc-view absolute inset-0 canvas z-10 row",p,`is-sidebar-${f?"opened":"closed"}`,h?"highlight":""),ref:this._ref},k("div",{class:"doc-view-content col gap-4 flex-auto overflow-auto scrollbar-hover"},this._renderEditor(e),(g=t.files)!=null&&g.length?k(Pr,{className:"doc-files my-4 px-3 py-2 surface rounded-lg",heading:{icon:"paper-clip",title:u.getLang("attachment","附件")},items:t.files,fileActions:n,fileIcon:i,fileUrl:r,itemProps:{target:"_blank"},hoverItemActions:!0}):null),k(Yb,{ref:this._sidebarRef,app:u,doc:t,creator:o,modifier:a,status:this._status,historyFetcher:c,historyPanel:u.props.historyPanel,onGetUser:l,showTabsNav:!1}))}}function $m(s,e){const{page:t,recPerPage:n}={page:1,recTotal:s.length,pageTotal:Math.ceil(s.length/20),recPerPage:20,...e},i=(t-1)*n,r=t*n;return s.slice(i,r)}class Zb extends ke{constructor(e){var n;super(e),this._libsMap=at({}),this._filterType=at(),this._loading=at(!1),this._currentFilterType=Ye(()=>{const{app:i}=this.props,r=this._filterType.value,o=i.spaceType;return r||(o==="product"||o==="project"?"mine":"all")}),this._spaceList=Ye(()=>{const{app:i}=this.props;let r=i.signals.spaces.value;const o=this._currentFilterType.value,a=i.spaceType,l=i.props.isMatchFilter;return o&&l&&(r=r.filter(c=>l.call(i,a,o,c))),r.sort((c,h)=>c.order-h.order)}),this._pagedSpaceList=Ye(()=>{const i=this._spaceList.value;return $m(i,this.props.app.signals.pager.value)}),this._autoLoadLibs=ln(()=>{const i=this._spaceList.value;this.loadLibs(i.map(r=>r.id))}),this._handleFilterTypeClick=i=>{const o=i.target.getAttribute("data-type");o&&(this._filterType.value=o)},this._handleLibClick=i=>{const r=_(i.target);if(r.closest(".toolbar").length)return;const o=r.closest("[z-lib]").z("lib"),a=r.closest("[z-space]").z("space");!o||!a||this.props.app.selectSpace(a,+o)},this._handleChangePager=i=>{this.props.app.resetPager("home",{...i})};const t=e.app.getFilterTypes("home")||[];this._filterType.value=(n=t[0])==null?void 0:n[0]}get app(){return this.props.app}async loadLibs(e){e=e||this._spaceList.value.map(r=>r.id);const{libSummariesFetcher:t}=this.app.props;if(!t)return;const n=typeof t=="object"&&(t.method||"").toLowerCase()==="post"?{data:JSON.stringify(e.join(",")),processData:!1}:void 0;this._loading.value=!0;const i=await Et(t,[{spaceList:e,spaceType:this.app.spaceType}],n);dr(()=>{this._libsMap.value={...this._libsMap.value,...e.reduce((r,o)=>(r[o]=[],r),{}),...i},this._loading.value=!1})}_getToolbarActions(e){return e.app.getActions("home",{ui:"toolbar"})}_renderHeader(e){const{app:t}=e,i=this._spaceList.value.length,r=t.getFilterTypes("home")||[],o=this._currentFilterType.value;return k("div",{key:"header",class:"doc-app-header flex-none surface-light row items-center border-b py-2 pl-1 pr-2 flex-none"},k("menu",{className:"nav nav-compact ml-2",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},r.map(([a,l])=>k("li",{key:a,className:"nav-item item"},k("a",{className:a===o?"active rounded":"rounded","data-type":a},l,a===o&&i?k("span",{className:"label size-sm canvas ring-0 rounded-md"},i):null)))),k("div",{className:"flex-auto"}),k(Xe,{className:"doc-app-toolbar",gap:2,size:"md",items:this._getToolbarActions(e)}))}_getSpaceLibs(e){const{app:t}=this.props,i=this._libsMap.value[e];if(i)return i;const r=[],o=t.signals.docs.value,a=t.signals.libs.value,{maxHomeLibsOfSpace:l=5}=t.props,c=new Map;for(const h of o){const u=h.lib,f=c.get(u)||0;c.set(u,f+1)}for(let h=0;h<a.length;h++){const u=a[h];if(!(u.deleted||u.space!==e)&&(r.push({id:u.id,name:u.name,docs:c.get(u.id)||0}),l&&r.length>=l))break}return r}_renderSpace(e,t){var c;const{app:n}=t,i=n.getItemActions("space",e,"space-card"),r=[{text:n.getLang("enterSpace","进入空间"),textClass:"text-primary",command:`selectSpace/${e.id}/true`},...i];let o=this._getSpaceLibs(e.id);const a=n.props.libColors;let l;return o?o.length?(o.length>5&&(o=o.slice(0,5)),l=k("div",{class:"row flex-wrap"},o.map(h=>{const u=n.getItemActions("lib",h,"space-card");return k("div",{className:"doc-space-card-lib p-1.5 w-1/5 group"},k("div",{class:"canvas border rounded py-2 px-3 col gap-1 hover:shadow-lg hover:border-primary relative cursor-pointer",onClick:this._handleLibClick,"z-lib":h.id,"z-space":e.id},k(Re,{icon:"doclib text-2xl",style:a?{color:a[h.id%a.length]}:null}),k("div",{class:"font-bold text-clip",title:h.name},h.name),k("div",{class:"text-gray text-sm"},h.docs?n.getLang("docsTotalInfo",[h.docs],"共 {0} 个文档"):n.getLang("noDocs","没有文档")),u!=null&&u.length?Xe.render({items:u},[],{size:"sm",type:"ghost",className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100"}):null))}))):l=k("div",{className:"center gap-4 py-3"},k("div",{className:"text-gray"},n.getLang("noLibs","没有文档库")),(c=n.props.privs)!=null&&c.createLib?k($e,{type:"primary-pale",icon:"plus",command:`createLib/${e.id}`},n.getLang("createLib","创建文档库")):null):l=k("div",{className:"relative load-indicator loading center gap-4 h-4 py-3"}),k("div",{class:"doc-space-card ring rounded surface-light",key:e.id},k("header",{class:"row items-center justify-between gap-2 px-2.5 py-1 border-b"},k("div",{class:"row items-center gap-2 flex-none cursor-pointer hover:text-primary","zui-command":`selectSpace/${e.id}/true`},k(Re,{icon:"docspace",className:"w-4 h-4 center rounded-md text-gray-600 flex-none"}),k("div",{className:"min-w-0 flex-auto"},k("strong",null,e.name))),k(Xe,{size:"md",items:r})),k("div",{class:"doc-space-card-libs p-1.5",style:"min-height: 118px"},l))}_renderBody(e){const t=this._pagedSpaceList.value;return k("div",{key:"body",class:"doc-app-body flex-auto min-h-0 col gap-4 p-4 items-stretch overflow-auto scrollbar-hover"},t.map(n=>this._renderSpace(n,e)),t.length===0?k("div",{className:"center text-gray h-full"},e.app.getLang("noDataYet","暂无数据")):null)}_renderFooter(e){const t=e.app.getPagerOptions({className:"flex-none",...e.app.signals.pager.value,recTotal:this._spaceList.value.length,onChangePageInfo:this._handleChangePager},{type:"home"});return k("div",{key:"footer",class:"doc-app-footer surface-light row items-center border-t py-1.5 px-2"},k("div",{class:"flex-auto"}),k(Ir,{...t}))}componentDidMount(){this.props.app.resetPager("home",{recTotal:this._spaceList.value.length})}componentWillUnmount(){this._autoLoadLibs()}render(e){return this._loading.value?k("div",{key:"loading",class:"doc-loading relative center h-full load-indicator loading tex-gray","data-loading":e.app.getLang("loadingDocsData","正在加载文档数据...")}):[this._renderHeader(e),this._renderBody(e),this._renderFooter(e)]}}const Qb=s=>{var t,n;s=JSON.parse(JSON.stringify(s));const e=new Map;for(const i of s){const r=String(i.id);e.has(r)?i.items&&((n=(t=e.get(r))==null?void 0:t.items)==null||n.push(...i.items)):e.set(r,i)}return Array.from(e.values())};class Jb extends ke{constructor(e){super(e),this._libsMap=at({}),this._filterType=at(),this._programData=at(),this._hasDocsOnly=at(!1),this._showClosed=at(!1),this._otherPrograms=Ye(()=>{var n;if(!this._programData.value)return[];const t=[];if(t.push(...this._programData.value.data.other),this._showClosed.value){const i=this._programData.value.data.closed;for(const r of i){const o={...r,items:(n=r.items)==null?void 0:n.filter(a=>!a.isPO&&!a.involved)};t.push(o)}}return t}),this._myPrograms=Ye(()=>{var n;if(!this._programData.value)return[];const t=[];if(t.push(...this._programData.value.data.my),this._showClosed.value){const i=this._programData.value.data.closed;for(const r of i){const o={...r,items:(n=r.items)==null?void 0:n.filter(a=>a.isPO||a.involved)};t.push(o)}}return t}),this._currentFilterType=Ye(()=>{const t=this._filterType.value;return t||"mine"}),this._programList=Ye(()=>{const n=this._currentFilterType.value==="mine"?this._myPrograms.value:this._otherPrograms.value;return Qb(n)}),this._pagedProgramList=Ye(()=>{const t=this._programList.value;return $m(t,this.app.signals.pager.value)}),this._spaceList=Ye(()=>{const{app:t}=this.props;let n=t.signals.spaces.value;const i=this._currentFilterType.value,r=t.spaceType,o=t.props.isMatchFilter;return i&&o&&(n=n.filter(a=>o.call(t,r,i,a))),n.sort((a,l)=>a.order-l.order)}),this._autoLoadLibs=ln(()=>{const t=this._spaceList.value;this.loadLibs(t.map(n=>n.id))}),this._handleFilterTypeClick=t=>{const i=t.target.getAttribute("data-type");i&&(this._filterType.value=i)},this._handleSpaceClick=t=>{const n=_(t.target);if(n.closest(".toolbar").length)return;const i=n.closest("[z-space]").z("space");i!=null&&this.props.app.selectSpace(i,!0)},this._handleChangePager=t=>{this.props.app.resetPager("home",{...t})},this._filterType.value="mine"}get app(){return this.props.app}async loadLibs(e){e=e||this._spaceList.value.map(r=>r.id);const{libSummariesFetcher:t}=this.app.props;if(!t)return;const n=typeof t=="object"&&(t.method||"").toLowerCase()==="post"?{data:JSON.stringify(e.join(",")),processData:!1}:void 0,i=await Et(t,[{spaceList:e,spaceType:this.app.spaceType}],n);this._libsMap.value={...this._libsMap.value,...e.reduce((r,o)=>(r[o]=[],r),{}),...i}}_getToolbarActions(e){return e.app.getActions("home",{ui:"toolbar"})}_renderHeader(e){const{app:t}=e,n=this._programList.value.length,i=t.spaceType==="product"?[["mine",t.getLang("productMine")],["other",t.getLang("productOther")]]:[["mine",t.getLang("projectMine")],["other",t.getLang("projectOther")]],r=this._currentFilterType.value;return k("div",{key:"header",class:"doc-app-header flex-none surface-light row gap-2 items-center border-b py-2 pl-1 pr-2 flex-none"},k("menu",{className:"nav nav-compact ml-2",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},i.map(([o,a])=>k("li",{key:o,className:"nav-item item"},k("a",{className:o===r?"active rounded":"rounded","data-type":o},a,o===r&&n?k("span",{className:"label size-sm canvas ring-0 rounded-md"},n):null)))),k(wi,{id:"show-no-doc",name:"show-no-doc",defaultChecked:this._hasDocsOnly.value,label:t.getLang(t.spaceType==="product"?"showHasDocsOnlyProduct":"showHasDocsOnlyProject"),onChange:(o,a)=>{typeof a=="boolean"&&(this._hasDocsOnly.value=a)}}),k(wi,{id:"show-closed",name:"show-closed",defaultChecked:this._showClosed.value,label:t.getLang(t.spaceType==="product"?"showClosedProduct":"showClosedProject"),onChange:(o,a)=>{typeof a=="boolean"&&(this._showClosed.value=a)}}),k("div",{className:"flex-auto"}),k(Xe,{className:"doc-app-toolbar",gap:2,size:"md",items:this._getToolbarActions(e)}))}_getSpaceLibs(e){const{app:t}=this.props,i=this._libsMap.value[e];if(i)return i;const r=[],o=t.signals.docs.value,a=t.signals.libs.value,{maxHomeLibsOfSpace:l=5}=t.props,c=new Map;for(const h of o){const u=h.lib,f=c.get(u)||0;c.set(u,f+1)}for(let h=0;h<a.length;h++){const u=a[h];if(!(u.deleted||u.space!==e)&&(r.push({id:u.id,name:u.name,docs:c.get(u.id)||0}),l&&r.length>=l))break}return r}_getSpaceDocSum(e){var t;return((t=this._getSpaceLibs(e))==null?void 0:t.map(n=>n.docs).reduce((n,i)=>n+i,0))||0}_renderProgram(e,t){var a;const{app:n}=t,i=this._hasDocsOnly.value?(a=e.items)==null?void 0:a.filter(l=>this._getSpaceDocSum(Number(l.id))>0):e.items,r=n.props.libColors;let o;return e?i!=null&&i.length?o=k("div",{class:"row flex-wrap"},i.map(l=>{const c=this._getSpaceDocSum(l.id);return k("div",{className:"doc-space-card-lib p-1.5 w-1/5 group",key:l.id},k("div",{class:"canvas border rounded py-2 px-3 col gap-1 hover:shadow-lg hover:border-primary relative cursor-pointer",onClick:this._handleSpaceClick,"z-space":l.id},k(Re,{icon:"doclib text-2xl",style:r?{color:r[Number(l.id)%r.length]}:null}),k("div",{class:"font-bold text-clip",title:l.text},l.text),k("div",{class:"text-gray text-sm"},c?n.getLang("docsTotalInfo",[c],"共 {0} 个文档"):n.getLang("noDocs","没有文档"))))})):o=k("div",{className:"center gap-4 py-3"},k("div",{className:"text-gray"},n.getLang(n.spaceType==="product"?"noProducts":"noProjects"))):o=k("div",{className:"relative load-indicator loading center gap-4 h-4 py-3"}),k("div",{class:"doc-space-card ring rounded surface-light",key:e.id},k("header",{class:"row items-center justify-between gap-2 px-2.5 py-1 border-b"},k("div",{class:"row items-center gap-2 flex-none cursor-pointer hover:text-primary","zui-command":`selectSpace/${e.id}/true`},k(Re,{icon:"docspace",className:"w-4 h-4 center rounded-md text-gray-600 flex-none"}),k("div",{className:"min-w-0 flex-auto"},k("strong",null,e.text)))),k("div",{class:"doc-space-card-libs p-1.5",style:"min-height: 118px"},o))}_renderBody(e){const t=this._pagedProgramList.value;return k("div",{key:"body",class:"doc-app-body flex-auto min-h-0 col gap-4 p-4 items-stretch overflow-auto scrollbar-hover"},t.map(n=>this._renderProgram(n,e)),t.length===0?k("div",{className:"center text-gray h-full"},e.app.getLang("noDataYet","暂无数据")):null)}_renderFooter(e){const t=e.app.getPagerOptions({className:"flex-none",...e.app.signals.pager.value,recTotal:this._programList.value.length,onChangePageInfo:this._handleChangePager},{type:"home"});return k("div",{key:"footer",class:"doc-app-footer surface-light row items-center border-t py-1.5 px-2"},k("div",{class:"flex-auto"}),k(Ir,{...t}))}componentDidMount(){var t,n;this.props.app.resetPager("home",{recTotal:this._programList.value.length,recPerPage:5});const e=(n=(t=this.props.app.props).getSpaceFetcher)==null?void 0:n.call(t,this.props.app.spaceType);e&&Et(e).then(i=>void(this._programData.value=i))}componentWillUnmount(){this._autoLoadLibs()}render(e){return[this._renderHeader(e),this._renderBody(e),this._renderFooter(e)]}}class ew extends ke{constructor(){super(...arguments),this._dtable=Ce(),this._handleCellClick=(e,t)=>{var i;const n=(i=t.rowInfo)==null?void 0:i.data;this.props.app.selectDoc(n)}}_getCols(){return[{name:"title",onRenderCell:function(e,t){const n=t.row.data;return[{className:`api-list-item row items-center my-0.5 mx-1 gap-2 flex-auto is-${n.method} cursor-pointer rounded`,html:[`<div class="font-mono w-14 text-center api-method py-1 rounded rounded-r-none">${n.method}</div>`,`<div class="font-mono api-path">${n.path}</div>`,`<div class="flex-auto text-right api-title pr-2">${n.originTitle}</div>`].join("")}]}}]}_getTableOptions(e){var h;const{app:t,docs:n}=e,i=t.lib,r=i==null?void 0:i.data.orderBy;let o="",a="";typeof r=="string"&&r&&([o,a]=r.split("_"));const l=n.map(u=>u.data);["order","id"].includes(o)&&a&&(a==="asc"?l.sort((u,f)=>u.order-f.order):l.sort((u,f)=>f.order-u.order));const c={width:"100%",height(u){var p;const f=(p=this.element)==null?void 0:p.parentElement;return f?Math.min(u,f.clientHeight):u},cols:this._getCols(),data:l,header:!1,checkable:!1,footer:["flex","pager"],localPager:!0,emptyTip:k("div",{className:"center gap-4"},k("div",{className:"text-gray"},t.getLang("noApi","没有 API")),Xe.render({items:t.getActions("doc-list",{ui:"doc-list-empty"})},[])),footPager:{items:t.getPagerItems()},onCellClick:this._handleCellClick};return((h=t.getTableOptions)==null?void 0:h.call(t,c,{type:"api-list"}))??c}render(e){return k("div",{class:ee("doc-list doc-api-list h-full col",e.className)},k(Li,{ref:this._dtable,...this._getTableOptions(e)}))}}const mS="";let Cu=class extends Cc{constructor(e){super(e),this._loadingDocs=new Map,this._viewRef=Ce(),this._homeRef=Ce(),this._treeMap=Ye(()=>{const{spaceID:t,libs:n,modules:i,docs:r}=this.signals;return J_(t.value,{libs:n.value,modules:i.value,docs:r.value},!!this.props.noSpace)}),this._space=Ye(()=>{const{spaces:t,spaceID:n}=this.signals,i=n.value;return t.value.find(r=>r.id===i)}),this._spaceList=Ye(()=>{const{spaces:t,spaceType:n}=this.signals,i=n.value;return t.value.filter(r=>!r.deleted&&r.type===i)}),this._libList=Ye(()=>this._treeMap.value.libList),this._docList=Ye(()=>{const{lib:t,module:n,doc:i}=this;return(i==null?void 0:i.data.type)==="chapter"?this._filterDocs(Mr(i,[],!0),{api:(t==null?void 0:t.data.type)==="api"}):n||t?this._filterDocs(Mr(n||t,[],!0),{api:(t==null?void 0:t.data.type)==="api"}):this._filterDocs(void 0,{api:!1})}),this._doc=Ye(()=>this._treeMap.value.docs.get(this.signals.docID.value)),this._viewingDoc=Ye(()=>{const t=this._doc.value,n=this.signals.docVersion.value;return!t||!n||n===t.data.version||!t.data.versions?t:{...t,data:{...t.data,...t.data.versions[n]||{content:null},currentVersion:n}}}),this._module=Ye(()=>{var n;const t=((n=this._doc.value)==null?void 0:n.data.module)||this.signals.moduleID.value;return this._treeMap.value.modules.get(t)}),this._lib=Ye(()=>{var n;const t=((n=this._module.value)==null?void 0:n.data.lib)||this.signals.libID.value;return this._treeMap.value.libs.get(t)}),this._viewType=Ye(()=>this._viewInfo.value[0]),this._viewInfo=Ye(()=>{var o;const t=this.signals.mode.value;let n;const i=this.signals.creatingDoc.value,r=this.signals.editingDoc.value;if(t==="create")n=i;else if(t==="edit"){const a=this.getDoc(r==null?void 0:r.id);n=r,a&&n&&(n={...n,collects:a.collects,isCollector:a.isCollector,views:a.views})}else t==="view"&&(n=((o=this._viewingDoc.value)==null?void 0:o.data)||this._getLocalDoc(this.signals.docID.value));return[t,n]}),this._docUsers=Ye(()=>{const t=this._doc.value;if(!t)return[];const{addedBy:n,editedBy:i}=t.data;return[this.getUserInfo(n),i?this.getUserInfo(i):void 0]}),this._hasEditingDoc=Ye(()=>!!this._editingDoc.value),this._editingDoc=Ye(()=>{const[t,n]=this._viewInfo.value;return t==="edit"||t==="create"?n:void 0}),this._canShowLibFiles=Ye(()=>{const t=this.signals.spaceType.value;let{showLibFiles:n}=this.props;return typeof n=="function"?n=n.call(this,t):Array.isArray(n)&&(n=n.includes(t)),n}),this._location=Ye(()=>{var f;const{spaceType:t,spaceID:n,libID:i,moduleID:r,docID:o,pager:a,searchKeys:l,docVersion:c,mode:h,params:u}=this.signals;return{mode:h.value,spaceType:t.value,spaceID:n.value,libID:i.value,moduleID:r.value,docID:o.value,docVersion:c.value,search:(f=l.value)==null?void 0:f.join(" "),filterType:this.filterType,pager:a.value,noSpace:this.props.noSpace,orderBy:"",params:u.value}}),this._filterType=Ye(()=>this.signals.filterType.value[this.signals.mode.value]??"all"),this._viewEffect=ln(()=>{var l,c,h,u;const{libID:t,moduleID:n,docID:i}=this.signals,r=i.value?"doc":n.value?"module":t.value?"lib":"space",o=i.value?(l=this._doc.value)==null?void 0:l.data:n.value?(c=this._module.value)==null?void 0:c.data:t.value?(h=this._lib.value)==null?void 0:h.data:this._space.value,a=this.signals.mode.value;(u=this.props.onSwitchView)==null||u.call(this,a,this._location.value,{type:r,title:o?r==="doc"?o.title:o.name:"",data:o})}),this._modeEffect=ln(()=>{var r,o;const{mode:t}=this.signals;let{useHocuspocus:n}=this.props;const{onModeChange:i}=this.props;n=typeof n=="function"?n(this):n,n&&((o=(r=this.editor)==null?void 0:r.destroyHocuspocusProvider)==null||o.call(r)),i==null||i(this,t.value)}),this._handleDocChange=(t,n)=>{if(n==="create"){const i=this.signals.creatingDoc.value;i&&(i.title!==t.title||i.content!==t.content||i.keywords!==t.keywords||i.html!==t.html)&&(this.signals.creatingDoc.value={...i,...t,changed:!0,contentType:t.contentType||i.contentType})}else if(n==="edit"){const i=this.signals.editingDoc.value;i&&(i.title!==t.title||i.content!==t.content||i.keywords!==t.keywords||i.html!==t.html)&&(this.signals.editingDoc.value={...i,...t,changed:!0,contentType:t.contentType||i.contentType})}},this._getFileActions=t=>{var n;return this.getActions("file",{ui:"doc-view",data:t,doc:(n=this.doc)==null?void 0:n.data})},this._handleSearch=t=>{this.signals.searchKeys.value=vt.getSearchKeys(t)},this._handleFilterTypeClick=t=>{const n=t.target,i=n.getAttribute("data-type");if(i){const r=n.getAttribute("data-view");this.setFilterType(i,r)}},this.selectSpace=this.selectSpace.bind(this),this.selectDoc=this.selectDoc.bind(this),this.selectLib=this.selectLib.bind(this),this.selectModule=this.selectModule.bind(this),this.getUserInfo=this.getUserInfo.bind(this),this.selectDocVersion=this.selectDocVersion.bind(this),this.showFiles=this.showFiles.bind(this),this.getActions=this.getActions.bind(this),this.getItemActions=this.getItemActions.bind(this),this.executeCommand=this.executeCommand.bind(this),this.getTableOptions=this.getTableOptions.bind(this),this.toggleFullscreen=this.toggleFullscreen.bind(this)}get spaceType(){return this.signals.spaceType.value}get spaceID(){return this.signals.spaceID.value}get libID(){return this.signals.libID.value}get moduleID(){return this.signals.moduleID.value}get docID(){return this.signals.docID.value}get docVersion(){return this.signals.docVersion.value}get space(){return this._space.value}get lib(){return this._lib.value}get module(){return this._module.value}get doc(){return this._doc.value}get treeMap(){return this._treeMap.value}get docList(){return this._docList.value}get docUsers(){return this._docUsers.value}get viewInfo(){return this._viewInfo.value}get libList(){return this._libList.value}get spaceList(){return this._spaceList.value}get mode(){return this.signals.mode.value}get canShowLibFiles(){return this._canShowLibFiles.value}get hasEditingDoc(){return this._hasEditingDoc.value}get location(){return this._location.value}get filterType(){return this._filterType.value}get editor(){var e,t;return(t=(e=this._viewRef.current)==null?void 0:e.editor)==null?void 0:t.editor}get fullscreen(){return this.signals.fullscreen.value}get editingDoc(){return this._editingDoc.value}get editingUsers(){var e;return((e=this.signals.editingUsers)==null?void 0:e.value)||[]}_filterDocs(e,t){if(e=e||this.signals.docs.value,e.length){const n=t==null?void 0:t.api,i=t==null?void 0:t.chapter,r=this.signals.searchKeys.value||[],o=this.filterType,a="key"in e[0],{currentUser:l,isMatchFilter:c,noSpace:h}=this.props,u=c?c.bind(this,"doc",o):y=>o==="createdByMe"?y.addedBy===l:o==="editedByMe"?y.editedBy===l:o==="draft"?y.status==="draft":o==="collected"?y.isCollector:!0;if(a&&!r.length)return o!=="all"&&o?e.filter(y=>u(y.data)):e;const f=this.signals.spaceID.value,p=this._treeMap.value,g=["id","title","keywords","addedBy","editedBy",y=>this.getUserInfo(y.addedBy).realname,y=>{const v=y.editedBy;return v?this.getUserInfo(v).realname:void 0}];return e.reduce((y,v)=>{const b=a?v.data:v;if(b.deleted||!i&&b.type==="chapter"||n!==void 0&&!!b.api!==n||o&&!u(b)||r.length&&!vt.isItemMatch(b,r,g))return y;const w=p.libs.get(b.lib);return(h||b.lib===f||w&&w.data.space===f)&&y.push(a?v:p.docs.get(b.id)),y},[])}return[]}_getLocalDoc(e){if(e)return{id:e,type:"text",rawID:F0(e),parent:0,contentType:"doc",content:"",title:"",addedBy:"",lib:this.libID,module:this.moduleID,addedDate:gt(new Date),order:0,local:!0}}loadHomeLibs(){var e;(e=this._homeRef.current)==null||e.loadLibs()}toggleFullscreen(){_.toggleFullscreen({target:document.body,afterEnter:()=>{this.signals.fullscreen.value=!0,_("body").addClass("has-doc-app-fullscreen")},afterExit:()=>{_("body").removeClass("has-doc-app-fullscreen"),this.signals.fullscreen.value=!1}})}toggleViewSideTab(e){var t,n,i;return(i=(n=(t=this._viewRef)==null?void 0:t.current)==null?void 0:n.sidebar)==null?void 0:i.toggleTab(e)}getDefaultState(e){e=e||this.props;const{data:t,fetcher:n,mode:i="home",filterType:r="all",pager:o,search:a,docVersion:l=0,defaultState:c,params:h}=e,u=this.formatData({libTypes:e.libTypes||[],...t},e);return{loading:!!(!t&&n),editingDoc:void 0,creatingDoc:void 0,searchKeys:vt.getSearchKeys(a),fullscreen:!1,filterType:{[i]:r},docVersion:l,mode:i,highlightView:!1,editingUsers:[],pager:o,params:h,...c,...u}}resetState(e){super.resetState(e),requestAnimationFrame(()=>this._afterReset())}getDataSignal(e){const{signals:t}=this;return e==="doc"?t.docs:e==="module"?t.modules:e==="lib"?t.libs:t.spaces}getCurrentItem(e){var t,n,i;return e==="doc"?(t=this._doc.value)==null?void 0:t.data:e==="module"?(n=this._module.value)==null?void 0:n.data:e==="lib"?(i=this._lib.value)==null?void 0:i.data:this._space.value}getSpace(e){return e?this.signals.spaces.value.find(t=>t.id===e):this._space.value}getLib(e){return e?this.treeMap.libs.get(e):this._lib.value}getDoc(e){var t,n;return e=e||((t=this._doc.value)==null?void 0:t.data),typeof e!="object"&&(e=e?(n=this._treeMap.value.docs.get(e))==null?void 0:n.data:void 0),e}getUserInfo(e){const{userMap:t={}}=this.props,n=t[e];return n?typeof n=="string"?{account:e,realname:n}:{...n,account:e}:{account:e,realname:e}}getDownloadUrl(e,t){if(t=t||this.props.downloadUrl,!t)return;let n="";if(e.startsWith("data:"))n=e;else if(/https?:\/\//.test(e)){const i=window.EDITOR_IMAGE_PROXY_ENDPOINT;n=i?`${i}?url=${encodeURIComponent(e)}`:e}else if(e.startsWith("attachment:")){const i=e.substring(11).split("/")[0];n=Te(t,{objectType:"doc",objectID:this.docID,gid:"",title:btoa(i),extra:""})}else n=Te(t,{objectType:"doc",objectID:this.docID,gid:btoa(`g-${e}`),title:"",extra:"editor"});return n}downloadFile(e,t){const n=this.getDownloadUrl(e);if(n)return!t&&e.startsWith("attachment:")&&(t=decodeURIComponent(e.substring(11).split("/")[0])),mi(n,t)}async switchView(e,t){if(!await this.checkEditingDoc())return;t=t||this.mode;const{spaceType:n,spaceID:i,libID:r,moduleID:o,docID:a,params:l,filterType:c,pager:h}=e,{fetchOnChangeSpace:u,fetcher:f}=this.props,p=n&&this.signals.spaceType.value!==n||i!==void 0&&this.signals.spaceID.value!==i,g=u&&f&&p,y={...n?{spaceType:n}:null,...i!==void 0?{spaceID:i}:null,...r!==void 0?{libID:r}:null,...o!==void 0?{moduleID:o}:null,...a!==void 0?{docID:a}:null,...l!==void 0?{params:l}:null,...c!==void 0?{filterType:{...this.signals.filterType.value,[t]:c}}:null,...h!==void 0?{pager:{...this.signals.pager.value,...h}}:null,mode:t};return this.changeState(y,async()=>{g&&await this.load(f,this.signals.spaceType.value,i),a&&t==="edit"?this.startEditDoc(a):t==="create"?this.startCreateDoc():t==="files"?this.showFiles():t==="home"&&this.goHome()})}setFilterType(e,t){this.signals.filterType.value={...this.signals.filterType.value,[t||this.mode]:e}}exportDoc(e="pdf",t){var i;const n=this.editor;if(n instanceof Oi)return(i=n.$)==null?void 0:i.export(e,t)}importDoc(e,t,n){var r,o,a;const i=this.editor;i instanceof Oi&&((r=i.$)==null||r.updateDoc(e,t==="json"?"snapshot":t,n),typeof n=="string"&&((a=(o=this._viewRef.current)==null?void 0:o.editor)==null||a.setTitle(n)))}getLang(e,t=[],n){const{langData:i}=this.props;let r;if(typeof t=="string"?(n=t,r=[]):r=Array.isArray(t)?t:[t],!i)return n??(Array.isArray(e)?e.join("."):e);const o=Array.isArray(e)?ir(i,e):i[e]??n;return typeof o=="function"?o.call(this,...r):typeof o=="string"&&r.length?Te(o,...r):o}getActions(e,t){const{getActions:n}=this.props,i=n?n.call(this,e,t):[];return i!=null&&i.length&&t.ui?i.filter(r=>r&&(!r.ui||r.ui.split(",").includes(t.ui))):i||[]}getFilterTypes(e){const{getFilterTypes:t}=this.props;return t?t.call(this,e)||[]:[["all","All"]]}getTableOptions(e,t){const{getTableOptions:n}=this.props;return n?n.call(this,e,t):e}getPagerItems(){return[{type:"info",text:this.getLang("recTotalFormat","共 {recTotal} 项")},{type:"size-menu",text:this.getLang("recPerPageFormat","每页 {recPerPage} 项"),placement:"top",caret:"up"},{type:"link",page:"first",hint:this.getLang("firstPage","第一页"),icon:"icon-first-page"},{type:"link",page:"prev",hint:this.getLang("prevPage","上一页"),icon:"icon-angle-left"},{type:"info",text:"{page}/{pageTotal}"},{type:"link",page:"next",hint:this.getLang("nextPage","icon-angle-right"),icon:"icon-angle-right"},{type:"link",page:"last",hint:this.getLang("lastPage","最后一页"),icon:"icon-last-page"}]}getPagerOptions(e,t){const{getPagerOptions:n}=this.props,i=n?n.call(this,e,t):e;return i.items||(i.items=this.getPagerItems()),i}getSortableOptions(e){const{getSortableOptions:t}=this.props;return t==null?void 0:t.call(this,e)}getItemActions(e,t,n){const i=t==="current"?this.getCurrentItem(e):typeof t=="number"?this.getDataSignal(e).value.find(r=>r.id===t):t;return i?this.getActions(e,{ui:n,data:i}):(console.warn(`[ZUI] getItemActions: ${e} data with ID "${t}" not found.`),[])}async selectSpace(e,t,n){var a,l;if(!await this.checkEditingDoc())return;e==="_first"&&(e=((a=this.spaceList[0])==null?void 0:a.id)??0);const{fetchOnChangeSpace:i,fetcher:r,autoSelectLib:o}=this.props;if(n===void 0&&(n=!!(i&&r&&(this.signals.spaceID.value!==e||typeof t=="number"&&t!==this.signals.libID.value))),!(this.signals.spaceID.value===e&&!t))return this.changeState({spaceID:e,mode:"list",...t?{libID:typeof t=="number"?t:o&&!n?((l=this.libList[0])==null?void 0:l.data.id)??0:0,moduleID:0,docID:0}:null,...n?{data:void 0,loading:!0}:null},()=>{n&&this.load(r,this.signals.spaceType.value,e)})}async selectDoc(e,t){if(!await this.checkEditingDoc())return;typeof e!="object"&&(e=this.getDoc(e));const n=e?e.id:0;return this.changeState({mode:(e==null?void 0:e.type)==="chapter"?"list":"view",docID:n,...n!==this.signals.docID.value?{docVersion:0}:null,...e?{libID:e.lib,moduleID:e.module}:null,...t!==void 0?{docVersion:+t}:null})}async goHome(){if(await this.checkEditingDoc())return this.changeState({libID:0,moduleID:0,docID:0,mode:"home"})}getDefaultPager(e){const{getDefaultPager:t,preserve:n}=this.props,i=n?rt.get(`${n}:pager:${e}`):null;return t?t.call(this,e):{page:1,recTotal:0,recPerPage:typeof i=="number"?i:20,pageTotal:0}}resetPager(e,t){const n={...this.getDefaultPager(e),...this.signals.pager.value,...t};this.signals.pager.value=n;const{preserve:i}=this.props;i&&rt.set(`${i}:pager:${e}`,n.recPerPage)}async showFiles(){if(this.canShowLibFiles&&await this.checkEditingDoc())return this.changeState({libID:0,moduleID:0,docID:0,mode:"files",pager:this.getDefaultPager("files")})}async selectLib(e,t){if(!await this.checkEditingDoc())return;const n=this._module.value;n&&t===void 0&&n.data.lib!==e&&(t=0),t===void 0&&(t=this.signals.moduleID.value);const i=e?this.treeMap.libs.get(e):null;if(!(e&&!i||t&&!this.treeMap.modules.get(t)))return this.changeState({libID:e,moduleID:t,mode:"list",docID:0})}selectDocVersion(e,t){const n=this.signals.docID.value;t=t||n;const i=this.getDoc(t);i&&(e=Math.max(0,Math.min(+e,i.version??0)),!(t===n&&e===this.signals.docVersion.value)&&this.changeState({docID:t,docVersion:e}))}async selectModule(e,t){if(!await this.checkEditingDoc())return;const n=this._doc.value;return this.changeState({moduleID:e,...t||n&&e!==n.data.id?{docID:0,mode:"list"}:null})}setData(e,t){var r;const{signals:n}=this,i=this.formatData(e,{spaceType:n.spaceType.value,spaceID:n.spaceID.value,libID:n.libID.value,moduleID:n.moduleID.value,docID:n.docID.value});return this.changeState({...i,...t,libTypes:(r=i.libTypes)!=null&&r.length?i.libTypes:n.libTypes.value})}async checkEditingDoc(){if(this._hasEditingDoc.value){const[,e]=this._viewInfo.value;if(e!=null&&e.changed){this.signals.highlightView.value=!0;const t=await Ke.confirm(this.getLang("leaveEditingConfirm","文档编辑中，确定要离开吗？"));if(this.signals.highlightView.value=!1,!t)return!1}await this.changeState({editingDoc:void 0,creatingDoc:void 0,docVersion:0})}return!0}async load(e,t,n,i){var r,o;if(e=e||this.props.fetcher,e){const{signals:a}=this;t=t||a.spaceType.value,n=n||a.spaceID.value;const{noLoading:l=!1,picks:c=[]}=i||{},h=typeof c=="string"?[c]:c;await this.changeState({loading:!l,spaceType:t,spaceID:n});const u=await Et(e,[{spaceType:t,spaceID:n,picks:h,noSpace:!!this.props.noSpace}],void 0,this);await this.setData(h?{spaces:a.spaces.value,libs:a.libs.value,modules:a.modules.value,docs:a.docs.value,spaceID:a.spaceID.value,libTypes:a.libTypes.value,...this.props.autoSelectLib?{libID:((o=(r=u.libs)==null?void 0:r[0])==null?void 0:o.id)??0}:{},...u}:u,l?void 0:{loading:!1})}}isLoadingDoc(e){return this._loadingDocs.has(e)}async loadDoc(e,t,n){var l;let i=this.getDoc(e)||this._getLocalDoc(e);if(!i||((l=this.props.privs)==null?void 0:l.view)===!1)return;if(n=n||this.props.docFetcher,!n){if(i.api)return;n=()=>t?{id:e,content:"",version:t}:{id:e,content:""}}const r=this._loadingDocs;if(r.has(e))return new Promise(c=>{r.get(e).push(c)});r.set(e,[]),t=t||i.version||0;const o=!t||t===i.version||!i.version,a=await Et(n,[{docID:e,version:t}],void 0,this);if(a){const c=o?this.formatDataItem("doc",{...i,...a,id:e,local:!1}):{...i,...a.version?{version:a.version}:null,...a.privs?{privs:a.privs}:null,...a.editable!==void 0?{editable:a.editable}:null,versions:{...i.versions,[t]:this.formatDataItem("doc",a)},local:!1};if(this.props.autoConvertDoc||c.status==="draft")if(c.contentType==="html"&&c.content&&i.$convert===void 0){const h=await mn.htmlToSnap(c.content);c.$convert=!!h}else c.$convert=!1;i=this.update("doc",c,{keepDeleted:!0})}return r.get(e).forEach(c=>c(i)),r.delete(e),i}formatDataItem(e,t,n,i){if(e==="module")t.lib=+(t.lib??t.root),t.parent=+(t.parent??0);else if(e==="lib"){const o=t;o.space=o.space??n,o.space=String(+o.space)===String(o.space)?+o.space:o.space}else e==="space"&&(t.type=t.type??i);if(t.id=js(t.id),t.deleted=typeof t.deleted=="string"?!!JSON.parse(t.deleted):t.deleted,e==="doc"){const o=t;if(o.files){!Array.isArray(o.files)&&typeof o.files=="object"&&(o.files=Object.values(o.files));for(const a of o.files)a.id=+a.id,a.size=+a.size,a.downloads=a.downloads?+a.downloads:0,a.deleted=typeof a.deleted=="string"?!!JSON.parse(a.deleted):a.deleted}o.api===void 0&&(o.api=typeof t.id=="string"&&t.id.startsWith("api.")),o.rawID=F0(t.id),o.product=+(o.product??0),o.project=+(o.project??0),o.execution=+(o.execution??0),o.version=+(o.version??0),o.views=+(o.views??0),o.module=+(o.module??0),o.lib=+(o.lib??0),o.collects=+(o.collects??0),o.contentVersion&&(o.contentVersion=+o.contentVersion,Number.isNaN(o.contentVersion)||(o.currentVersion=o.contentVersion)),o.editable!==void 0&&(o.privs={...o.privs,edit:o.editable}),o.contentType==="attachment"&&(o.contentType="html"),o.parent&&(o.parent=js(o.parent)),o.draft&&(typeof o.draft=="string"?o.draft=o.status==="draft"?{id:0,doc:o.id,content:o.content,contentType:o.contentType,title:o.title,version:0,addedBy:o.addedBy,addedDate:o.addedDate}:null:(o.draft.type&&(o.draft.contentType=o.draft.type),o.draft.rawContent&&(o.draft.content=o.draft.rawContent,delete o.draft.rawContent),o.status==="draft"&&(o.contentType=o.draft.contentType,o.content=o.draft.content))),o.rawContent&&(o.content=o.rawContent,delete o.rawContent),!o.collects&&o.isCollector&&(o.collects=1),o.editedBy===o.addedBy&&o.editedDate===o.addedDate&&(delete o.editedBy,delete o.editedDate)}typeof t.order!="number"&&typeof t.id=="number"&&(t.order=t.id);const{formatDataItem:r}=this.props;return r?r.call(this,e,t,n,i):t}formatData(e,t){let{libID:n=0,moduleID:i=0,docID:r,spaceID:o=0}=t;n&&(n=+n),i&&(i=+i),r&&(r=js(r));const{spaceType:a}=t,{libs:l=[],modules:c=[],docs:h=[],spaces:u=[],spaceID:f,libTypes:p=[]}=e||{};let g,y,v,b;return f&&(o=f),o=js(o),l.forEach(w=>{this.formatDataItem("lib",w,f)}),l.sort((w,S)=>(w.order??w.id)-(S.order??S.id)),u.forEach(w=>{this.formatDataItem("space",w,f,a)}),c.forEach(w=>{this.formatDataItem("module",w,f)}),h.forEach(w=>{this.formatDataItem("doc",w,f)}),r?g=h.find(w=>w.id===r):r=0,g&&!i&&(i=g.module??0),i&&(y=c.find(w=>w.id===i)),n=y?y.lib:n,!n&&this.props.autoSelectLib&&(v=l[0],n=v?v.id:0),n&&(!v||v.id!==n)&&(v=l.find(w=>w.id===n)),o=v?v.space:o,!this.props.noSpace&&u.length&&(b=u.find(w=>w.id===o)),o||(b=u[0],o=b?b.id:o),!o&&l.length&&(o=l[0].space),{spaceType:(b?b.type:a)||"mine",libs:l,modules:c,docs:h,spaces:u,spaceID:o,libID:n,moduleID:i,docID:r,libTypes:p}}batchUpdate(e,t){dr(()=>{Object.keys(e).forEach(n=>{const i=e[n];this.update(n,i)}),t&&this.changeState(t)})}update(e,t,n){const i=!Array.isArray(t),r=i?[t]:t,o=this.getDataSignal(e),a=[],l=o.value,c=this.signals.spaceID.value,h=n==null?void 0:n.keepDeleted;return r.forEach(u=>{const f=js(u.id),p=l.findIndex(y=>y.id===f),g=p>=0?{...l[p],...u}:u;if(this.formatDataItem(e,g,c),g.deleted&&!h)p>=0&&(l[p]=g);else if(p>=0){if(e==="doc"){const y=l[p],v=g,b=v.contentVersion??v.version;y.version!==b&&Object.assign(g,{version:Math.max(y.version,b),versions:{...y.versions,[y.version]:y,[b]:g}})}l[p]=g}else l.push(g);a.push(g)}),o.value=[...l],i?a[0]:a}delete(e,t){Array.isArray(t)||(t=[t]);const n=new Set(t);if(!n.size)return!1;const i=this.getDataSignal(e),r=i.value;return!r||!Array.isArray(r)||!r.length?!1:(dr(()=>{const o=new Set;e==="module"||e==="lib"?t.forEach(l=>{const c=e==="module"?this.treeMap.modules.get(l):this.treeMap.libs.get(l);c&&c.docs.forEach(h=>o.add(h.data.id))}):e==="doc"&&t.forEach(l=>{const c=this.treeMap.docs.get(l);c!=null&&c.docs.length&&Mr(c,[],!0).forEach(h=>o.add(h.id))}),i.value=r.filter(l=>!n.has(l.id)),o.size&&this.delete("doc",[...o]);const a=this.docID;(e==="doc"&&t.includes(a)||o.has(a))&&this.selectDoc(0)}),!0)}startCreateDoc(e,t,n){e=e??this.signals.libID.value,t=t??this.signals.moduleID.value;const i=this.signals.creatingDoc.value;if(!(i&&i.lib===e&&i.module===t))return this.changeState({creatingDoc:this._getCreatingDoc(n),mode:"create"})}cancelCreateDoc(){return this.changeState({creatingDoc:void 0,mode:"list"})}async saveNewDoc(e){var c,h,u,f,p,g,y;await((h=(c=this._viewRef.current)==null?void 0:c.editor)==null?void 0:h.triggerChange(void 0,{getHtml:!0}));const{signals:t}=this,n=t.creatingDoc.value;if(!n)return;if(n.title.trim()===""){await Ke.alert(this.getLang("docTitleRequired","文档标题不能为空。")),(f=(u=this._viewRef.current)==null?void 0:u.editor)==null||f.focusTitle();return}const i=t.spaceID.value,r=t.libID.value,o=t.moduleID.value,a=await((p=this.props.onCreateDoc)==null?void 0:p.call(this,{...n,status:e||"normal",lib:t.libID.value,module:t.moduleID.value},i,r,o));if(!a)return Ke.alert(this.getLang("saveDocFailed","文档保存失败，请稍后重试"));const l=+a.space.split(".")[1];return l!==i&&l===l?(await this.changeState({creatingDoc:void 0}),await this.selectSpace(l,a.lib),this.selectDoc(a)):(a.rawContent&&(a.content=a.rawContent),(y=(g=this._viewRef.current)==null?void 0:g.editor)==null||y.removeCache(),this.changeState({docs:[...t.docs.value,a],docID:a.id,libID:a.lib,moduleID:a.module,creatingDoc:void 0,mode:"view"}))}async startEditDoc(e,t){var l,c;if(e=e||((l=this._doc.value)==null?void 0:l.data),typeof e!="object"&&(e=this.getDoc(e)),!e)return;const n=t==null?void 0:t.loadDoc;if((n===!0||n!==!1&&!e.api&&(e.content===void 0||e.content===null))&&(e=await this.loadDoc(e.id),!e))return;if(e.editable===!1||((c=e.privs)==null?void 0:c.edit)===!1)return Ke.alert(this.getLang("needEditable","您没有当前文档的编辑权限。"));const i=!!((t==null?void 0:t.convert)??e.$convert),{content:r,contentType:o,title:a=""}=e.draft||e;await this.changeState({docID:e.id,libID:e.lib,moduleID:e.module,editingDoc:{...e,title:a,contentType:o,content:r,...t==null?void 0:t.template,changed:!1,$convert:i,$html:i?e.content:void 0},mode:"edit"})}async restoreDoc(e,t){var l,c,h;let n=this.getDoc(e);if(!n)return;t=+t;const i=await this.loadDoc(e,t);if(n={...n,...i},((l=n.privs)==null?void 0:l.edit)===!1||n.editable===!1)return Ke.alert(this.getLang("needEditable","您没有当前文档的编辑权限。"));const r=(c=n.versions)==null?void 0:c[t];if(!r)return;const o=await((h=this.props.onSaveDoc)==null?void 0:h.call(this,{...n,content:r.content,contentType:r.contentType,title:r.title,fromVersion:t}));if(o===!1)return;const a=typeof o=="object"?o.version:n.version+1;if(typeof o=="object"){const u={...n,version:a,contentVersion:a,...o};this.update("doc",u)}this.selectDoc(e,a)}cancelEditDoc(e){return this.changeState({mode:"view",editingDoc:void 0,docVersion:0,...e})}async saveDoc(e){var o,a,l,c,h;await((a=(o=this._viewRef.current)==null?void 0:o.editor)==null?void 0:a.triggerChange(void 0,{getHtml:!0}));const t=this.signals.editingDoc.value;if(!t)return this.cancelEditDoc();const n=this.getDoc(t.id);let i={...n,...t,status:e||"normal"};i.contentType==="doc"&&(i.$convert=!1);const r=await((l=this.props.onSaveDoc)==null?void 0:l.call(this,i));if(r!==!1){if((h=(c=this._viewRef.current)==null?void 0:c.editor)==null||h.removeCache(),r&&(r!==!0&&Object.assign(i,r),i=this.update("doc",i),i.lib!==(n==null?void 0:n.lib))){this.cancelEditDoc(),this.selectDoc(i);return}this.cancelEditDoc()}}_afterReset(){const{fetcher:e,data:t,mode:n,docID:i}=this.props,r=()=>{n==="edit"&&i?this.startEditDoc(i):n==="create"?this.startCreateDoc():n==="files"&&this.showFiles()};e&&!t?this.load().then(r):r()}componentDidMount(){var e;super.componentDidMount(),this._afterReset(),(e=this.props.onMounted)==null||e.call(this)}componentDidUpdate(e){var o;const{fetcher:t,data:n,spaceID:i,spaceType:r}=this.props;t&&!n&&(e.spaceType!==r||e.spaceID!==i)&&this.load(),(o=this.props.onUpdated)==null||o.call(this)}componentWillUnmount(){var e;this._viewEffect(),this._modeEffect(),(e=this.props.onUnmounted)==null||e.call(this)}_getCreatingDoc(e="doc"){const t=tb();return{id:t,rawID:t,type:"text",parent:0,lib:this.signals.libID.value,module:this.signals.moduleID.value,title:"",content:"",contentType:e,addedBy:this.props.currentUser||"",addedDate:gt(new Date,"yyyy-MM-dd HH:mm:ss"),uid:Hs(13).replaceAll("-","_"),order:0}}_getClassName(e){return["doc-app",e.className,this._viewType.value!=="list"?"has-show-view":"",this.signals.fullscreen.value?"is-enter-fullscreen":"",`doc-app-mode-${this.mode}`]}_getProps(e){var t;return{...super._getProps(e),style:{width:nt(e.width),height:nt(e.height)},"data-view":this._viewType.value,"data-lib-type":(t=this._lib.value)==null?void 0:t.data.type,"data-space-type":this.spaceType}}_renderSidebar(e){var h,u;const{libIcon:t,apiLibIcon:n,preserve:i,moduleIcon:r,docIcon:o,chapterIcon:a,currentUser:l}=e,c=this.spaceType;return k(Z_,{key:"sidebar",app:this,className:"surface-light",preserve:i?`${i}-sidebar`:void 0,currentUser:l,libIcon:t,apiLibIcon:n,moduleIcon:r,docIcon:o,chapterIcon:a,spaceType:c,space:this._space.value,libs:this._libList.value,lib:this._lib.value,libTypes:this.signals.libTypes.value,showFiles:this.signals.mode.value==="files",moduleID:((h=this._module.value)==null?void 0:h.data.id)||0,docID:((u=this._doc.value)==null?void 0:u.data.id)||0,getActions:this.getItemActions,onSelectDoc:this.selectDoc,onSelectLib:this.selectLib,onShowFiles:this.canShowLibFiles?this.showFiles:void 0})}_renderFiles(){const e=this.renderCustom("files");if(e!==void 0)return e;const{currentUser:t,fileUrl:n,filesFetcher:i,userMap:r}=this.props;return k(Nh,{key:"files",app:this,userMap:r,objectType:this.spaceType,objectID:this.spaceID,filterType:this.filterType,currentUser:t,onGetUser:this.getUserInfo,fileUrl:n,searchKeys:this.signals.searchKeys.value,filesFetcher:i})}_renderList(e){var c,h;if(this.signals.mode.value==="files")return this._renderFiles();const t=this.renderCustom("list");if(t!==void 0)return t;if(((c=this.lib)==null?void 0:c.data.type)==="api")return k(ew,{app:this,docs:this._docList.value});const{libIcon:n,moduleIcon:i,docIcon:r,userMap:o,canMoveDoc:a}=e,l=this.signals.searchKeys.value;return k(X_,{key:"list",app:this,libIcon:n,moduleIcon:i,docIcon:r,userMap:o,searchKeys:l,docs:this._docList.value,canMoveDoc:a,getActions:this.getActions,getTableOptions:this.getTableOptions,orderBy:(h=this._lib.value)==null?void 0:h.data.orderBy})}_renderView(e){const t=this.renderCustom("view");if(t!==void 0)return t;const[n,i]=this._viewInfo.value;if(!i||i.type==="chapter")return null;const{fileIcon:r,fileUrl:o,preserve:a,historyFetcher:l,uploadUrl:c,downloadUrl:h}=e,[u,f]=this._docUsers.value;return k(Xb,{ref:this._viewRef,app:this,key:n,doc:i,mode:n,onChange:this._handleDocChange,fileIcon:r,fileActions:this._getFileActions,fileUrl:o,creator:u,modifier:f,uploadUrl:c,downloadUrl:h,preserve:a?`${a}-view`:void 0,onGetUser:this.getUserInfo,historyFetcher:l,highlight:this.signals.highlightView.value})}_renderMain(e){const t=this._renderView(e);return k("div",{key:"main",className:`doc-main flex-auto relative min-w-0${t?" show-view":""}`},this._renderList(e),t)}_renderSearchBox(e){let t={rootClass:"doc-app-search w-40 ml-1 mr-3",defaultValue:(this.signals.searchKeys.value||[]).join(" "),onChange:this._handleSearch,placeholder:this.getLang("searchPlaceholder","搜索")};const{getSearchBoxOptions:n}=this.props;return n&&(t=n.call(this,t,{type:e})),k(Ms,{...t})}_renderFilters(){var a;const e=this.renderCustom("filters");if(e!==void 0)return e;const t=this._viewType.value;if(t!=="list"&&t!=="files")return null;const n=this.getFilterTypes(t),i=t==="list",r=this.filterType,o=i?(a=this._docList.value)==null?void 0:a.length:0;return k("div",{className:"row items-center flex-auto justify-end"},n.length?k("menu",{className:"nav nav-compact",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},n.map(([l,c])=>k("li",{key:l,className:"nav-item item"},k("a",{className:l===r?"active rounded-full":"rounded-full","data-type":l,"data-view":t},c,l===r&&o?k("span",{className:"label size-sm canvas ring-0 rounded-full"},o):null)))):null,this._renderSearchBox(t))}_renderToolbar(){var r;const e=this.renderCustom("toolbar");if(e!==void 0)return e;const t=this._viewType.value,n=[],i="toolbar";if(t==="list")n.push(...this.getActions("doc-list",{ui:i}));else if(t==="view"){const o=(r=this._doc.value)==null?void 0:r.data;o&&(o.deleted||n.push(...this.getActions("doc",{ui:i,data:o})))}else t==="edit"?n.push(...this.getActions("doc-edit",{ui:i,data:this.signals.editingDoc.value})):t==="create"&&n.push(...this.getActions("doc-create",{ui:i,data:this.signals.creatingDoc.value}));return k(Xe,{className:"doc-app-toolbar",gap:2,size:"md",items:n})}_renderHeader(e){const t=this.renderCustom("header");return t!==void 0?t:k("div",{key:"header",class:"doc-app-header surface-light row items-center border-b py-1.5 pl-1 pr-2"},k(ab,{app:this,spaceIcon:e.spaceIcon,libIcon:e.libIcon,apiLibIcon:e.apiLibIcon,moduleIcon:e.moduleIcon,libFilesIcon:e.libFilesIcon,noSpace:e.noSpace,docIcon:e.docIcon,spaces:this._spaceList.value,space:this._space.value,libs:this._libList.value,lib:this._lib.value,doc:this._doc.value,docVersion:this.signals.docVersion.value,creatingDoc:this.signals.creatingDoc.value,editingDoc:this.signals.editingDoc.value,showFiles:this.signals.mode.value==="files",module:this._module.value,libPlaceholder:"所有库",onSelectDocVersion:this.selectDocVersion,onSelectLib:this.selectLib,onSelectSpace:this.selectSpace,onSelectModule:this.selectModule,onSelectDoc:this.selectDoc,homeName:e.homeName,getSpaceFetcher:e.getSpaceFetcher,spaceType:this.spaceType,spaceID:this.spaceID},this._renderFilters()),this._renderToolbar())}_renderBody(e){return k("div",{key:"body",class:"doc-app-body flex-auto min-h-0 row items-stretch"},this._renderSidebar(e),this._renderMain(e))}_renderHome(){const e=this.renderCustom("home");return e!==void 0?e:this.spaceType==="product"||this.spaceType==="project"&&window.config.vision!=="lite"?k(Jb,{ref:this._homeRef,app:this}):k(Zb,{ref:this._homeRef,app:this})}_getChildren(e){return this.signals.mode.value==="home"?this._renderHome():this.signals.loading.value?k("div",{key:"loading",class:"doc-loading relative center h-full load-indicator loading tex-gray","data-loading":this.getLang("loadingDocsData","正在加载文档数据...")}):this._space.value?[this._renderHeader(e),this._renderBody(e)]:k("div",{key:"empty-tip",class:"doc-empty-tip center h-full gap-8"},k("div",{className:"relative text-primary"},k(Re,{icon:"file-alt",className:"opacity-10",style:"font-size: 72px; transform: rotate(-30deg); transform-origin: 0 72px;"}),k(Re,{icon:"file-alt",className:"opacity-30 absolute left-0 top-0",style:"font-size: 72px; transform: rotate(-15deg); transform-origin: 0 72px;"}),k(Re,{icon:"file-text",className:"absolute left-0 top-0",style:"font-size: 72px; transform: rotate(0deg); transform-origin: 0 72px;"})),k("div",{className:"text-gray text-lg"},this.getLang("noSpaceTip","这里什么也没有，先创建一个空间再使用吧！")),Xe.render({size:"lg",items:this.getActions("home",{ui:"home-no-space"})},[]))}getCustomRender(e){var t;return(t=this.props.customRenders)==null?void 0:t[e]}renderCustom(e,...t){let n=this.getCustomRender(e);if(typeof n=="function"&&(n=n.call(this,...t)),n!==void 0)return typeof n=="string"?n:k(Se,{key:e,content:n,generatorArgs:t,generatorThis:this})}};Cu.NAME="DocApp",Cu.defaultProps={spaceIcon:"docspace",libIcon:"doclib",apiLibIcon:"interface-lib",moduleIcon:"folder-o",docIcon:"doc",libFilesIcon:"annex-lib",chapterIcon:"list-box",fetchOnChangeSpace:!0,preserve:"doc-app",autoConvertDoc:!0,commands:{},showLibFiles:["product","project","execution"],libColors:["secondary","primary","warning","success","special"].map(s=>`var(--color-${s}-500)`)};async function Im(s,e){const t=await Et(e.docFetcher,[{docID:s,version:0}]);if(!(t!=null&&t.content))return!1;let n="";if(e.type==="html"){if(!await mn.htmlToSnap(t.content))return!1}else try{n=await mn.convertToHtml(t.content,void 0,e.downloadUrl)}catch(o){console.warn("[ZUI] Convert doc to html failed:",o)}const i={content:n};let r;return await _.post(Te(e.migrateUrl,{docID:s}),i,o=>{const a=o;r=a.result==="success"?!0:a.message},"json"),r}async function Bm(s){try{s=s||zt("doc","ajaxGetMigrateDocs");const e=await Et(s);return Array.isArray(e)?{doc:e,html:[]}:e}catch{return{}}}async function Nm(s,e){await mn.loadModule();const{onProgress:t,migrateUrl:n=zt("doc","ajaxMigrateDoc","docID={docID}"),docFetcher:i=zt("doc","ajaxGetDoc","docID={docID}"),downloadUrl:r=zt("file","ajaxQuery","fileID={gid}")}=e||{},o={migrateUrl:n,docFetcher:i,downloadUrl:r};let a=0;const l=s.doc.length+s.html.length,c=["doc","html"];for(const h of c)for(const u of s[h])t==null||t(a,l),await Im(u,{...o,type:h}),await Is(50),a++;return t==null||t(a,l),s}class ku extends ke{constructor(){super(...arguments),this._current=at(0)}migrate(){const{idList:e,docFetcher:t,downloadUrl:n,migrateUrl:i}=this.props;return Nm(e,{docFetcher:t,downloadUrl:n,migrateUrl:i,onProgress:r=>{this._current.value=r}})}componentDidMount(){this.migrate()}render(e){var o;const t=this._current.value,n=e.idList,i=n.doc.length+n.html.length,r=t===i;return k("div",{className:"col gap-4 p-6"},k("div",{class:"row gap-2 items-center"},k("div",{class:`progress progress-striped flex-auto ${r?"":"active"}`},k("div",{class:"progress-bar",style:`width: ${Math.floor(t*100/i)}%`})),k("div",{class:"text-gray"},Math.floor(t*100/i),"%")),r?k("div",{className:"text-center mt-2"},k("button",{type:"button",class:"btn primary",onClick:(o=e.onFinish)==null?void 0:o.bind(this,n)},e.finishText)):k("div",null,Te(e.progressTip,{current:t,total:i})))}static async open(e){let t;const n=Ce();return await Ke.open({type:"custom",ref:n,size:400,content:k(ku,{...e,onFinish:i=>{var r;t=i,(r=n.current)==null||r.hide()}}),custom:{closeBtn:!1}}),t}}async function tw(s){const{preserve:e="DocApp:migratedDocs:v2"}=s||{};if(rt.get(e))return;const{doc:t=[],html:n=[]}=await Bm(s==null?void 0:s.migrateUrl),i=t.length+n.length;if(!i)return;const r={zh_cn:{confirm:"检查到有 {0} 个文档数据需要迁移，是否进行迁移操作？你也可以下次进入文档应用时再进行迁移。",progressTip:"正在迁移文档数据...（{current}/{total}）",finish:"迁移完成"},zh_tw:{confirm:"檢查到有 {0} 个文檔數據需要遷移，是否進行遷移操作？你也可以下次進入文檔應用時再進行遷移。",progressTip:"正在遷移文檔數據...（{current}/{total}）",finish:"遷移完成"},en:{confirm:"There are {0} documents need to be migrated, do you want to migrate them now? You can also migrate them next time when you enter the document application.",progressTip:"Migrating documents...({current}/{total})",finish:"Migrate finished"}},o=r[yf()]||r.en,a=(s==null?void 0:s.confirm)||o.confirm;if(a&&!await Ke.confirm(Te(a,i)))return;const l=(s==null?void 0:s.progressTip)||o.progressTip,c=(s==null?void 0:s.finishText)||o.finish,h=await ku.open({idList:{doc:t,html:n},...s,progressTip:l,finishText:c});return h&&rt.set(e,Date.now()),h}const nw=Object.freeze(Object.defineProperty({__proto__:null,getMigrateDocs:Bm,migrateDoc:Im,migrateDocs:Nm,tryMigrateDocs:tw},Symbol.toStringTag,{value:"Module"}));class Hr extends Ee{}Hr.NAME="DocApp",Hr.Component=Cu,Object.assign(Hr,nw),Hr.register();const gS="",yS="",vS="",xS="",_S="",bS="",wS="",CS="",kS="";class Su extends Ee{}Su.NAME="Dropmenu",Su.Component=Rr;class Fm extends Je{init(){const{echarts:e}=window;if(!e){console.warn("ZUI: ECharts is not loaded.");return}const{responsive:t=!0,theme:n,...i}=this.options,r=e.init(this.element,n);r.setOption(i),t&&_(window).on(`resize.${this.gid}.ECharts.zt`,r.resize),this.chart=r}destroy(){var n;const{echarts:e}=window;if(!e){super.destroy();return}const{responsive:t=!0}=this.options;t&&_(window).off(`resize.${this.gid}.ECharts.zt`),(n=this.chart)==null||n.dispose(),super.destroy()}}Fm.NAME="ECharts";let Du=class extends Ee{};Du.NAME="FileList",Du.Component=Pr;const SS="",Pm=s=>s.replace(/([[\]])/g,"\\$1");class Ua extends Je{constructor(){super(...arguments),this._disabled=!1,this._timer=0}init(){this.$element.on("submit",this.onSubmit.bind(this)).on("input mousedown change",this.onInput.bind(this))}enable(e=!0,t=0){if(this._resetTimer(),t){this._timer=window.setTimeout(()=>{this.enable(e),this._timer=0},t);return}this.$element.toggleClass("loading",!e),this.$element.find('.btn-submit,button[type="submit"]').toggleClass("disabled",!e).prop("disabled",!e),this._disabled=!e}disable(){this.enable(!1)}onInput(e){const t=_(e.target).closest(".has-error");if(!t.length)return;let n=t.attr("name");n||(n=t.find(".pick-value").attr("name"));const i=n?`#${n.split("[")[0]}Tip,#${Pm(n)}Tip`:".form-tip";t.removeClass("has-error"),t.closest(".form-group,.form-batch-control").find(i).remove()}onSubmit(e){var o;if(e.preventDefault(),this._disabled)return;const{element:t}=this,n=_.extend({},this.options);this.emit("before",e,t,n);const i=()=>{this.$element.find(".ajax-form-tip").each(function(){const l=_(this);l.closest(".form-group,.form-batch-control").find(".has-error").removeClass("has-error"),l.remove()}),this.disable();const a=this._processData();this._send(a)},r=(o=n.beforeSubmit)==null?void 0:o.call(n,e,t,n);if(r!==!1){if(r instanceof Promise){r.then(a=>a&&i());return}i()}}submit(){this.element.submit()}reset(){this.element.reset()}destroy(){this._resetTimer()}_resetTimer(){this._timer&&(window.clearTimeout(this._timer),this._timer=0)}_processData(){const{$element:e,options:t}=this;let n=new FormData(this.element),{submitEmptySelectValue:i="",submitNoValueChecks:r}=t;const{submitDisabledValue:o=!0}=t;i!==!1&&(typeof i!="boolean"&&(i=""),e.find("select").each((l,c)=>{const h=_(c),u=h.attr("name");h.is("[disabled]")&&!o||n.has(u)||n.append(u,typeof i=="object"?i[u]:i)})),o&&e.find("[disabled][name]").each((l,c)=>{const h=_(c);if(h.hasClass("not-submit-disabled-value"))return;const u=h.attr("name");n.has(u)||n.append(u,h.val())}),r&&(r=typeof r=="string"?r:"",e.find('[type="checkbox"],[type="radio"]').not(":checked").each((l,c)=>{const h=_(c),u=h.attr("name");n.has(u)||h.is("[disabled]")&&!o||n.append(u,h.data("notCheckedValue")??r)}));const{beforeSend:a}=t;if(a){const l=a(n);l instanceof FormData&&(n=l)}return this.emit("send",n),n}_send(e){const{$element:t,options:n}=this;let i,r;const o=n.url||t.attr("action"),a={method:t.attr("method")||"POST",data:e,headers:t.closest(".modal").length?{"X-ZUI-Modal":"true"}:void 0,dataType:"json",jsonParser:JSON.parse},{optionsModifiers:l}=this.constructor;l.length&&l.forEach(h=>{const u=h.call(this,a);u&&u!==a&&_.extend(!0,a,u)});const c=_.ajax(o,a).success((h,u,f)=>{var p,g,y;h instanceof Blob?(mi(h,(y=(g=(p=f.headers.get("Content-Disposition"))==null?void 0:p.split(";")[1])==null?void 0:g.split("=")[1])==null?void 0:y.replace(/"/g,"")),r={result:"success"}):(r=h,(!r||typeof r!="object")&&(i=new Error("Invalid json format")))}).fail(h=>{i=h}).complete(()=>{var h,u;if(i)this.emit("error",i),console.warn("ZUI: send ajax form failed",i),n.onError?n.onError(i):Ke.showError({size:"lg",error:[`<b>POST:</b> ${o}`,`<b>Error:</b> ${i.message.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}`,`<b>Response:</b> ${c.data}`].join("<br>")});else{const f=(h=n.onResult)==null?void 0:h.call(this,r);if(f===!1)return;f&&(r=_.extend(r,f)),this._handleResult(r)}this.emit("complete",r,i),(u=n.onComplete)==null||u.call(n,r,i),this.enable(!0,i||(r==null?void 0:r.result)!=="success"?0:5e3)})}_showValidateMessage(e){var n;let t;Object.entries(e).forEach(([i,r])=>{Array.isArray(r)&&(r=r.join(""));const o=Pm(i),{$element:a}=this;let l=a.find(`#${o}`);if(l.length||(l=a.find(`[data-form-name="${o}"]`)),l.length||(l=a.find(`[name="${o}"]`)),!l.length&&!i.includes("[")&&(l=a.find(`[name="${o}[]"]`)),!l.length){Ke.alert(r);return}l.hasClass("pick-value")&&(l=l.closest(".pick")),l.addClass("has-error");const c=l.closest(".form-group,.form-batch-control,td");if(c.length){let h=c.find(`#${o}Tip`);h.length||(h=c.find(".form-tip")),h.length||(h=_(`<div class="form-tip ajax-form-tip text-danger pre-line" id="${i}Tip"></div>`).appendTo(c)),h.empty().text(r)}else Ke.alert(r);t||(t=l)}),t&&((n=t[0])==null||n.focus())}_handleResult(e){var l,c;const{options:t}=this;let{message:n}=e;const i=e.result==="success";if(i){if(this.emit("success",e),((l=t.onSuccess)==null?void 0:l.call(t,e))===!1)return;typeof n=="string"&&n.length&&ns.show({content:n,type:"success"})}else{if(this.emit("fail",e),((c=t.onFail)==null?void 0:c.call(t,e))===!1)return;n&&(Array.isArray(n)&&(n=n.join(`
`)),typeof n=="string"&&n.length?Ke.alert(n):typeof n=="object"&&this._showValidateMessage(n))}const r=t.closeModal??e.closeModal;r&&(r!=="onlySuccess"||i)&&Ke.hide(typeof r=="string"&&r!=="onlySuccess"?r:void 0);const o=t.callback??e.callback;if(o){const h=[["options",t],["result",e]];if(typeof o=="string"){const u=_.runJS(o,...h);typeof u=="function"&&!o.endsWith(";")&&u(e)}else if(typeof o=="object"){const u=_.runJS(o.name,...h);typeof u=="function"&&u.apply(this,Array.isArray(o.params)?o.params:[o.params])}}const a=t.load??e.load??e.locate;a&&this.$element.trigger("locate.zt",a)}}Ua.NAME="AjaxForm",Ua.optionsModifiers=[];function Eu(s,e){var a,l;const t=s.result==="success";if(t){if(((a=e.onSuccess)==null?void 0:a.call(e,s))===!1)return}else if(((l=e.onFail)==null?void 0:l.call(e,s))===!1)return;const{message:n}=s;n&&(e.onMessage?e.onMessage(n,s):typeof n=="string"&&n.length&&(t?ns.show({content:n,type:"success"}):Ke.alert(n)));const i=e.closeModal??s.closeModal;i&&Ke.hide(typeof i=="string"?i:void 0);const r=e.callback??s.callback;if(r){const c=[["options",e],["result",s]];if(typeof r=="string"){const h=_.runJS(r,...c);typeof h=="function"&&!r.endsWith(";")&&h(s)}else if(typeof r=="object"){const h=_.runJS(r.name,...c);typeof h=="function"&&h.apply(null,Array.isArray(r.params)?r.params:[r.params])}}const o=e.load??s.load??s.locate;o&&_(e.element||document).trigger("locate.zt",o)}function Mm(s){return typeof s=="string"&&(s=s.split(",").reduce((e,t)=>{const[n,i]=t.trim().split(":");return e[n.trim()]=i.trim(),e},{})),Object.keys(s).reduce((e,t)=>{const n=t.endsWith("?"),i=n?t.substring(0):t;let r=s[i];if(typeof r=="string"){const[o,a]=r.split("~"),l=_(o);if(!l.length)return e;a==="checkedIDList"?r=l.closest("[data-zui-dtable]").dtable("getChecks"):l[0].hasAttribute("data-map-value")?r=l.dataset("mapValue"):l.closest(".pick").length?r=l.closest(".pick").find(".pick-value").val():l.is("input,select,textarea")?r=l.val():r=l.text()}return(n||r!=null&&r!==""&&(!Array.isArray(r)||r.length))&&(e[i]=r),e},{})}async function Ks(s){if(s.confirm)return await Ke.confirm(s.confirm)?Ks({...s,confirm:void 0}):[void 0,new Error("canceled")];if(s={...Ua.DEFAULT,...s},s.beforeSubmit&&await s.beforeSubmit(s)===!1)return[void 0,new Error("canceled")];const{loadingClass:e,element:t}=s;t&&e&&_(t).addClass(e);const{data:n,dataMap:i}=s;let r;n&&(r=Do(n)),i&&(r=Do(Mm(i),r));const{beforeSend:o}=s;if(o){const h=o(r);h instanceof FormData&&(r=h)}let a,l;return await new rr({url:s.url,method:s.method||"POST",body:r,headers:s.headers,dataType:"json"}).success(h=>{l=h,(!l||typeof l!="object")&&(a=new Error("Invalid json format"))}).fail(h=>{a=h,console.warn("ZUI: cannot submit ajax form",h)}).complete(()=>{var h,u,f;if(a)(h=s.onError)==null||h.call(s,a);else{const p=(u=s.onResult)==null?void 0:u.call(null,l);if(p===!1)return;p&&(l=_.extend(l,p)),Eu(l,s)}(f=s.onComplete)==null||f.call(s,l,a),t&&e&&_(t).removeClass(e)}).send(),[l,a]}_.extend(_,{ajaxSubmit:Ks}),_(document).on("click.ajaxSubmit.zui",".ajax-submit",function(s){s.preventDefault();const e=_(this);if(e.is("[disabled],.disabled"))return;const t=e.data();!t.url&&e.is("a")&&(t.url=e.attr("href")||""),t.url&&(t.element=this[0],Ks(t))});class sw extends ke{constructor(e){super(e),this.state={pinnedList:e.pinnedList||[]}}_handlePinnedChange(e){const{pinnedList:t}=this.state;t.includes(e)?t.splice(t.indexOf(e),1):t.push(e),this.setState({pinnedList:t})}_handleSave(){var e,t;(t=(e=this.props).onSave)==null||t.call(e,this.state.pinnedList)}render(e,t){const{tip:n,items:i,saveText:r=Oe.getLang("save"),resetText:o=Oe.getLang("reset"),cancelText:a=Oe.getLang("cancel"),pinnedIcon:l="pinned",unpinnedIcon:c="unpinned"}=e,{pinnedList:h}=t,u=new Set(h);return k("form",{className:"form-setting-form w-80 col gap-3"},k("div",{className:"text-gray mt-2"},n),k("div",{className:"divider opacity-5"}),k("div",{className:"row flex-wrap"},i.map(({text:f,value:p})=>{const g=u.has(p);return k("label",{className:"state size-sm ghost w-1/2 pl-1 pr-2 py-1 flex flex-nowrap gap-2 items-center rounded",onClick:this._handlePinnedChange.bind(this,p)},k(Re,{icon:g?l:c,className:g?"text-primary":"text-gray-400"}),k("div",{className:`flex-auto text-clip${g?"":" text-gray"}`},f))})),k("div",{className:"row flex-nowrap gap-4 mt-2"},k($e,{size:"md",className:"btn-wide",type:"primary",onClick:this._handleSave.bind(this)},r),k($e,{size:"md",className:"btn-wide","data-dismiss":"popover"},a),k($e,{size:"md",type:"primary-ghost",disabled:!h.length,onClick:()=>this.setState({pinnedList:[]})},o)))}}class Rm extends Yt{_getFormItems(){const e=this.$element.closest("form"),t=[],n=[];return e.find(".form-group.is-foldable[data-name]").each((i,r)=>{if(_(r).hasClass("hidden"))return;const o=_(r),a=o.data("name"),l=o.find(".form-label").first();let c=o.data("label");if(c===void 0){const h=l.find(".text");h.length&&(c=h.text())}c===void 0&&(c=l.text().trim()),t.push({value:a,text:c||a}),o.hasClass("is-pinned")&&n.push(a)}),{items:t,pinnedList:n}}_handleSave(e){const{customUrl:t,onSave:n}=this.options,i=()=>{(n==null?void 0:n(e))!==!1&&this.hide();const r=this.$element.closest("form");r.find(".form-group.is-foldable[data-name]").each((o,a)=>{const l=_(a),c=l.data("name");l.toggleClass("is-pinned",e.includes(c))}),r.toggleClass("no-foldable-items",!r.find(".form-group.is-foldable").not(".is-pinned,.hidden").length)};t?Ks({url:t,data:{"fields[]":e},onSuccess:r=>{delete r.callback,i()}}):i()}_getRenderOptions(){const{title:e,tip:t,className:n,saveText:i,resetText:r,cancelText:o}=this.options,{items:a,pinnedList:l}=this._getFormItems();return{...super._getRenderOptions(),title:e,headingClass:"popover-heading transparent px-4 pt-4",contentClass:"px-4 pb-4",titleClass:"text-lg font-bold",content:k(sw,{tip:t,saveText:i,resetText:r,cancelText:o,items:a,pinnedList:l,onSave:this._handleSave.bind(this),onCancel:this.hide.bind(this)}),className:ee("form-setting-popover",n)}}}Rm.NAME="FormSetting";class Lm extends Je{get mode(){return this.$container.hasClass("is-full")?"full":"lite"}get shownFoldItems(){return this.$container.hasClass("show-fold-items")}get $container(){let e=this._$container;if(!e){const{$element:t}=this;e=t.closest(".panel-form,.page-form"),e.length||(e=t),this._$container=e}return e}afterInit(){super.afterInit();const e=[],{$element:t}=this;t.children(".form-group[data-name]").each((a,l)=>{e.push(_(l).attr("data-name"))}),this._fields=e;const{fullModeOrders:n}=this.options;this._fullModefields=typeof n=="string"?[n]:n;let{preserve:i}=this.options;(i===!0||i===void 0)&&(i=t.attr("id")),this._preserveID=i||!1;const r=this.options.mode||(this._preserveID?rt.get(`FormGrid:${this._preserveID}:mode`,this.mode):this.mode);this.toggleMode(r,!1,!0);const{namespace:o}=this;this.$container.on(`click${o}`,".btn-full-form",()=>this.toggleMode("full")).on(`click${o}`,".btn-lite-form",()=>this.toggleMode("lite")).on(`click${o}`,".btn-toggle-fold",()=>this.toggleFold()),t.on(`change${o}`,"[name]",this._handleChange.bind(this)),t.toggleClass("no-foldable-items",!t.find(".form-group.is-foldable").not(".is-pinned,.hidden").length)}getField(e){const{$element:t}=this;let n=t.children(`.form-group[data-name="${e}"]`);if(!n.length)return;const i=t.children(`[data-wrap-before="${e}"]`),r=t.children(`[data-wrap-after="${e}"]`);let o=_();return i.length&&(o=o.add(i)),n.find("script").remove(),n=t.children(`.form-group[data-name="${e}"]`),o=o.add(n),r.length&&(o=o.add(r)),{name:e,wrapBefore:!!i.length,wrapAfter:!!r.length,foldable:n.hasClass("is-foldable"),$ele:n,$group:o}}destroy(){super.destroy(),this.$container.off(this.namespace)}toggleFold(e){e=e??!this.shownFoldItems,this.$container.toggleClass("show-fold-items",e)}openSetting(){this.$container.find(".btn-custom-form").trigger("click")}toggleMode(e,t,n){const i=this.mode;e=e||(i==="full"?"lite":"full"),!(i===e&&!t)&&(this.$container.toggleClass("is-full",e==="full").toggleClass("is-lite",e==="lite"),!n&&this._preserveID&&rt.set(`FormGrid:${this._preserveID}:mode`,e),this.updateOrders())}updateOrders(e,t){e&&(this._fields=e),t&&(this._fullModefields=typeof t=="string"?[t]:t);const{mode:n}=this;n==="full"?(t=this._fullModefields,Array.isArray(t)&&t.forEach(i=>{this.sortFields(i)})):this.sortFields()}sortFields(e){e=e||this._fields,typeof e=="string"&&(e=e.split(","));let t;e.forEach(r=>{const o=this.getField(r);if(o){if(t){const a=t.$group.last();if(o.$group.first()[0]===a[0])return;o.$group.insertAfter(a)}t=o}});const n=this.$element.children(".form-group.is-foldable").first(),i=this.$element.children(`[data-wrap-before="${n.attr("data-name")}"]`);this.$element.children(".panel-form-divider").insertBefore(i.length?i:n)}_handleChange(e){const{autoLoad:t,loadUrl:n}=this.options;if(!t)return;const i=_(e.target).closest("[name]");Object.keys(t).forEach(r=>{const o=t[r];".[#".includes(r[0])||(r=`[name="${r}"]`),i.closest(r).length&&window.loadForm(_.extend({url:n,target:i},typeof o=="string"?{items:o}:o))})}}Lm.NAME="FormGrid";const DS="";class zm extends Je{init(){const{initGantt:e}=this.options;typeof e=="function"&&e()}destroy(){const{destroyGantt:e}=this.options;typeof e=="function"&&e(),super.destroy()}}zm.NAME="Gantt";const ES="";ut(H_);const AS="";let Om=class extends xt{constructor(){super(...arguments),this._searchBox=Ce(),this._menu=Ce(),this._handleChange=e=>{this.setState({value:e.trim()})},this._handleFocus=()=>{this.toggle(!0)},this._handleEenter=()=>{var t;const e=(t=this._menu.current)==null?void 0:t.getActiveKey();e&&this.search(e)},this._handleClickItem=e=>{this.search(e.item.key)}}search(e){var t,n;(t=this.props.onSearch)==null||t.call(this,e,this.state.value),this.toggle(!1,{value:""}),(n=this._searchBox.current)==null||n.blur()}componentDidUpdate(e,t){var i;super.componentDidUpdate(e,t);const n=this._menu.current;this.state.open&&n&&!((i=this._types)!=null&&i.has(n.getActiveKey()))&&n.activeNext()}_getHotkeys(){return this._hotkeys||(this._hotkeys={activeNext:{keys:"ArrowDown",handler:()=>{var e;return(e=this._menu.current)==null?void 0:e.activeNext()}},activePrev:{keys:"ArrowUp",handler:()=>{var e;return(e=this._menu.current)==null?void 0:e.activePrev()}},enter:!0}),this._hotkeys}_renderTrigger(e){return k(Ms,{delay:0,ref:this._searchBox,placeholder:e.searchHint,onChange:this._handleChange,onFocus:this._handleFocus,hotkeys:this._getHotkeys(),onEnter:this._handleEenter,...e.searchBox})}_getItems(e,t){const{items:n,getObjectID:i,getSearchType:r}=e,{value:o}=t;let a=r==null?void 0:r.call(this,o);const l=a&&a[0]==="!";l&&(a=a.slice(1));const c=i?i.call(this,o):Number.isInteger(+o)?+o:!1,h=Number.isInteger(c),u=[],f=n.reduce((y,v)=>(y.set(v.key,v),y),new Map),p="search",g=y=>{var v;return{html:((v=y.text)==null?void 0:v.replace("{0}",o))??o}};if(a&&h){const y=f.get(a);y&&u.push({...y,className:ee(y.className,"w-full"),text:g(y)})}if(!l){const y=f.get(p);u.push({...y,className:ee(y==null?void 0:y.className,"w-full"),text:y?g(y):o})}return h&&n.forEach(y=>{y.key===p||y.key===a||l||u.push({...y,className:ee(y.className,"w-1/2"),text:g(y)})}),this._types=new Set(u.map(y=>y.key)),u}_renderPop(e,t){return k(Lt,{className:"row flex-wrap overflow-auto scrollbar-hover",items:this._getItems(e,t),onClickItem:this._handleClickItem,ref:this._menu,activeOnHover:!0,...e.menu})}};Om.defaultProps={...xt.defaultProps,pickerName:"global-search",hidePopWhenEmpty:!0};class Va extends Ee{}Va.NAME="GlobalSearch",Va.Component=Om,Va.replace=!0;function iw(s,e=1e3){let t=null;return(...n)=>{t&&clearTimeout(t),t=setTimeout(()=>{s(...n),t=null},e)}}const Hm=class Ny extends Je{static async loadModule(){return this.Module||(this.Module=await _.getLib("g6")),this.Module}async afterInit(){const e=await Ny.loadModule();if(this.destroyed)return;const{type:t="TreeGraph",width:n=this.$element.width(),height:i=this.$element.height()||500,responsive:r=!1,data:o,nodeFn:a,edgeFn:l,comboFn:c,...h}=this.options,u=new e[t]({container:this.element,width:n,height:i,...h});a&&u.node(a),l&&u.edge(l),c&&u.combo(c),u.data(o),u.render(),this.instance=u,r&&this.initResizeObserver()}initResizeObserver(){const e=iw(()=>{this.instance.changeSize(this.$element.width(),this.$element.height()),this.instance.render()},500);this.resizeObserver=new ResizeObserver(()=>{e()}),this.resizeObserver.observe(this.element)}destroy(){var e;this.options.responsive&&((e=this.resizeObserver)==null||e.disconnect()),this.instance.destroy(),super.destroy()}};Hm.NAME="Graph";let jm=Hm;_.registerLib("g6",{src:"graph/g6.min.js",check:"G6"}),jm.register();class jr extends Ee{static update(e){_.trigger("load.HistoryPanel",e)}}jr.NAME="HistoryPanel",jr.Component=wu,jr.replace=!0,jr.register();function Au(s){const{objectType:e,objectID:t,actionID:n,url:i,...r}=s;let o=i;return!o&&(n||e&&t)&&(o=zt("action",n?"editComment":"comment",n?`actionID=${n}`:`objectType=${e}&objectID=${t}`)),Ke.open({id:`modal-comment-${n?`edit-${n}`:`${e}-${t}`}`,url:o,hideOthers:!1,...r})}_(document).on("click.zt",'[data-toggle="comment"]',s=>{s.preventDefault();const e=_(s.currentTarget);if(e.is(".disabled,:disabled"))return;const t=e.data();if(e.is("a")){const n=e.attr("href");n&&(t.url=n)}t.objectId?(t.objectID=+t.objectId,delete t.objectId):t.actionId&&(t.actionID=+t.actionId,delete t.actionId),delete t.toggle,Au(t)}),Object.assign(Ke,{comment:Au});const TS="",$S="";class Tu extends Je{init(){this.clipWidth=this.options.defaultWidth,this.clipHeight=this.options.defaultHeight,this.initDom(),this.initSize(),this.bindEvents()}initDom(){this.$canvas=this.$element.find(".canvas"),this.$img=this.$canvas.find("img"),this.$btn=this.$element.find("button");const e=this.$img.prop("src"),{coverColor:t,coverOpacity:n}=this.options;this.$canvas.append([`<div class="cover" style="background: ${t}; opacity: ${n};"></div>`,`<div class="controller" style="width: ${this.clipWidth}px; height: ${this.clipHeight}px">`,["top","right","bottom","left","top-left","top-right","bottom-left","bottom-right"].map(i=>`<div class="control" data-type="${i}"></div>`).join(""),"</div>",'<div class="cliper">',`<img src="${e}"/>`,"</div>"].join("")),this.$controller=this.$canvas.find(".controller"),this.$cliper=this.$canvas.find(".cliper"),this.$chipImg=this.$cliper.find("img")}resetImage(e){this.$img.prop("src",e),this.$chipImg.prop("src",e),this.imgWidth=0,this.left=-1,this.initSize()}initSize(){const{minWidth:e,minHeight:t,ready:n,onSizeError:i}=this.options;if(this.imgWidth)return;const r=a=>{this.imgWidth=a.width,this.imgHeight=a.height,(a.width<e||a.height<t)&&(i==null||i({width:a.width,height:a.height}),this.options.minWidth=Math.min(a.width,e),this.options.minHeight=Math.min(a.height,t)),n==null||n(),this.width=Math.min(this.imgWidth,this.$element.width()),this.$canvas.css("width",this.width),this.height=this.$canvas.height(),(this.left===void 0||this.left<0)&&(this.left=Math.floor((this.width-this.$controller.width())/2),this.top=Math.floor((this.height-this.$controller.height())/2)),this.refreshSize()},o=this.$img[0];o.complete?r(o):o.onload=()=>{r(o)}}refreshSize(e){const{minWidth:t,minHeight:n,fixedRatio:i,defaultWidth:r,defaultHeight:o}=this.options;this.clipWidth=Math.max(t,Math.min(this.width,this.clipWidth)),this.clipHeight=Math.max(n,Math.min(this.height,this.clipHeight)),i&&(e&&e==="height"?(this.clipWidth=Math.max(t,Math.min(this.width,this.clipHeight*r/o)),this.clipHeight=this.clipWidth*o/r):(this.clipHeight=Math.max(n,Math.min(this.height,this.clipWidth*o/r)),this.clipWidth=this.clipHeight*r/o)),this.left=Math.min(this.width-this.clipWidth,Math.max(0,this.left)),this.top=Math.min(this.height-this.clipHeight,Math.max(0,this.top)),this.right=this.left+this.clipWidth,this.bottom=this.top+this.clipHeight,this.$controller.css({left:this.left,top:this.top,width:this.clipWidth,height:this.clipHeight}),this.$cliper.css("clip",`rect(${this.top}px, ${this.left+this.clipWidth}px, ${this.top+this.clipHeight}px, ${this.left}px)`)}getData(){return{originWidth:this.imgWidth,originHeight:this.imgHeight,scaleWidth:this.width,scaleHeight:this.height,width:this.right-this.left,height:this.bottom-this.top,left:this.left,top:this.top,right:this.right,bottom:this.bottom,scaled:this.imgWidth!==this.width||this.imgHeight!==this.height}}bindEvents(){this.$element.on("resize",this.initSize.bind(this)),this.$btn.on("click",e=>{var t,n;(n=(t=this.options).handleBtnClick)==null||n.call(t,e,this.getData())}),this.moveable=new wr(this.$controller,{selector:".control,.controller",move:!1,onMoveStart:()=>{this.startLeft=this.left,this.startTop=this.top,this.startClipWidth=this.clipWidth,this.startClipHeight=this.clipHeight},onMove:(e,t)=>{const n=_(t.target);if(n.is(".controller"))this.left=this.startLeft+t.deltaX,this.top=this.startTop+t.deltaY,this.refreshSize();else{const i=n.data("type");let r=!1;const{minWidth:o,minHeight:a}=this.options;switch(i){case"left":case"top-left":case"bottom-left":this.left=Math.min(this.right-o,Math.max(0,this.startLeft+t.deltaX)),this.clipWidth=this.right-this.left;break;case"right":case"top-right":case"bottom-right":this.clipWidth=Math.min(this.width-this.left,Math.max(o,this.startClipWidth+t.deltaX));break}switch(i){case"top":case"top-left":case"top-right":this.top=Math.min(this.bottom-a,Math.max(0,this.startTop+t.deltaY)),this.clipHeight=this.bottom-this.top,r=!0;break;case"bottom":case"bottom-left":case"bottom-right":this.clipHeight=Math.min(this.height-this.top,Math.max(a,this.startClipHeight+t.deltaY)),r=!0;break}this.refreshSize(r)}}})}destroy(){var e;(e=this.moveable)==null||e.destroy(),super.destroy()}}Tu.NAME="ImgCutter",Tu.DEFAULT={coverColor:"#000",coverOpacity:.6,defaultWidth:128,defaultHeight:128,minWidth:48,minHeight:48,fixedRatio:!0};const qs=class{static get images(){var e;return(e=this.Module)==null?void 0:e.images}static async loadModule(){return this.Module||(this.Module=await _.getLib("mammoth")),this.Module}};qs.convertToHtml=async function(s,e){const{convertToHtml:t}=await qs.loadModule();return t(s,e)},qs.extractRawText=async function(s){const{extractRawText:e}=await qs.loadModule();return e(s)},qs.embedStyleMap=async function(s,e){const{embedStyleMap:t}=await qs.loadModule();return t(s,e)};let rw=qs;_.registerLib("mammoth",{src:["mammoth/mammoth.browser.min.js"],check:"mammoth",type:"module"});const IS="";Object.assign(ns.TypeOptions,{success:{key:"zt-messager-success",icon:"check-circle",type:"success",close:!1},danger:{icon:"exclamation-sign",type:"danger",close:!1}}),Object.assign(ns,{success(s){return ns.show(s,"success")},fail(s){return ns.show(s,"danger")}}),Object.assign(ns.DEFAULT,{time:3e3,className:"messager-lite"});const BS="";function ow(s){return Ke.confirm({iconClass:"warning rounded-full center w-8 h-8 flex-none",type:"custom",custom:{className:"modal-reconfirm",closeBtn:!1},...s})}async function aw(s){const{sortable:e={},onSort:t,items:n,itemProps:i={icon:"move muted",innerClass:"border rounded px-2 canvas cursor-move hover:shadow"},list:r,header:o,message:a,footer:l,...c}=s;let h;const u=(p,g)=>{h=g,t==null||t(p,g)};if(await Ke.confirm({type:"custom",content:k("div",{className:"modal-body sort-view col gap-2"},k(Se,{className:"sort-view-header",content:o}),k(Se,{className:"sort-view-message muted",content:a}),k(Cr,{className:"space-y-2",sortable:e,items:n,itemProps:i,onSort:u,...r}),k(Se,{className:"sort-view-footer",content:l})),...c}))return h}Oe.addLang({zh_cn:{occurredError:"发生了错误"},zh_tw:{occurredError:"發生了錯誤"},en:{occurredError:"An error occurred"}});async function lw(s){const{title:e,mono:t,html:n=!0,copyBtn:i=!0,basePath:r,contentClass:o,error:a,...l}=s;let c=typeof a=="string"?a:(a==null?void 0:a.message)??"",h=t,u=e;n&&(r&&(c=c.split(r).join('<i class="icon icon-file-text opacity-50"></i>/')),c.startsWith(`<br />
`)&&(c=c.replace(`<br />
`,"")),c.startsWith("<!DOCTYPE html")&&(h===void 0&&(h=!1),u===void 0&&(u=_(c).filter("title").text())));const f=Ce();return await Ke.confirm({title:u??Oe.getLang("occurredError"),message:"",type:"custom",custom:{className:"backdrop-blur border-2 border-canvas bg-opacity-80 rounded-xl",headerClass:"text-danger"},content:k("div",{ref:f,className:ee("modal-body",h!==!1?" font-mono":"",o),style:{whiteSpace:h!==!1?"pre-line":"normal"},dangerouslySetInnerHTML:{__html:c}}),actions:[i?{key:"confirm",text:typeof i=="string"?i:Oe.getLang("copy"),icon:"copy",onClick:()=>{const g=f.current;if(navigator.clipboard)navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([g.innerText],{type:"text/plain"}),"text/html":new Blob([g.innerHTML],{type:"text/html"})})]);else{const y=document.createRange();y.selectNode(g),window.getSelection().removeAllRanges(),window.getSelection().addRange(y),document.execCommand("copy"),window.getSelection().removeAllRanges()}}}:null,{key:"cancel",text:Oe.getLang("close")}].filter(Boolean),...l})}Object.assign(Ke,{reconfirm:ow,sortView:aw,showError:lw}),Ke.DEFAULT.backdrop="static",Ke.DEFAULT.request={dataFilter:s=>{if(s[0]==="{")try{const e=JSON.parse(s);if(e.result)return Eu(e,{closeModal:!0}),setTimeout(()=>{_(".modal").each(function(){const t=_(this);t.text().trim().length||t.modal("hide")})},200),""}catch{}return s}},eh.defaultProps.iframeBodyClass="body-modal";function Wm({pri:s="",text:e,className:t}){return s=`${s}`.trim(),e===void 0&&(e=s==="0"||s===""?"":s),k("span",{className:ee(`pri-${s}`,t)},e)}let Wr=class extends xt{constructor(){super(...arguments),this._handleClearBtnClick=e=>{this.setValue(""),e.preventDefault()}}getDefaultState(e){const t=super.getDefaultState(e);if(t.value===void 0&&(e||this.props).required){const n=this._getItems().shift();n&&(t.value=n.value)}return t}_getTriggerProps(e,t){const n=super._getTriggerProps(e,t);return e.disabled&&(n.className=ee(n.className,"disabled")),n}_renderTrigger(e,t){var l;const{value:n}=t,{placeholder:i,required:r}=e,o=n===void 0||n==="",a=!o&&!r;return[k("div",{className:"text"},o?k("span",{class:"placeholder"},i):this._renderItem(t.value,(l=this._getItems().find(({value:c})=>c===n))==null?void 0:l.text,"pri")),a?k($e,{type:"button",class:"btn square btn-close size-xs ghost rounded-full",onClick:this._handleClearBtnClick},k("span",{class:"close"})):null,a?null:k("span",{key:"caret",class:"caret"})]}_getItems(){let{items:e=["",1,2,3,4]}=this.props;return Array.isArray(e)?e=e.map((t,n)=>typeof t=="object"?t:t?{text:`${t}`,value:`${n}`}:{text:"",value:""}):typeof e=="object"&&(e=Object.keys(e).map(t=>({value:t,text:e[t]}))),e=e.filter(({value:t})=>t!==""),e.sort((t,n)=>+t.value-+n.value),e}_renderItem(e,t,n){return k(Wm,{key:n,pri:e,text:t})}_renderPop(){const{value:e}=this.state;return k("div",{className:"pick-pri-list"},this._getItems().map(({value:t,text:n})=>k("button",{key:t,type:"button",class:`btn w-full ${e===t?"primary-pale":"ghost"}`,"data-pick-value":t},this._renderItem(t,n))))}};Wr.defaultProps={...xt.defaultProps,items:["",1,2,3,4],className:"pick-pri form-control",popClass:"pick-pri-pop popup",popWidth:"auto",popMinWidth:56};function Um({severity:s="",text:e,className:t}){s=`${s}`.trim(),e===void 0&&(e=s==="0"||s===""?"":s);const n=`${+e}`!=`${s}`;return k("span",{className:ee(`severity${n?" severity-label":""}`,t),"data-severity":s},n?e:"")}let $u=class extends Wr{_renderItem(e,t,n){return k(Um,{key:n,severity:e,text:t})}};$u.defaultProps={...Wr.defaultProps,items:["",1,2,3,4]};class Iu extends Ee{}Iu.NAME="PriPicker",Iu.Component=Wr;class Bu extends Ee{}Bu.NAME="SeverityPicker",Bu.Component=$u;const NS="",FS="";let Nu=class extends tt{constructor(e){super(e),this._syncPickerData=()=>{const o=this.getFormData();_(this.element).find(".pick-value[name]").each((a,l)=>{const c=_(l),h=c.attr("name").split("[")[0],u=o[h];c.trigger("syncValue",{setValue:u})})},this._handleDeleteQueryClick=(o,a)=>{a.stopPropagation(),this.deleteQuery(o)},this._handleChange=o=>{const a=_(o.target);let l=a.attr("name");if(!l)return;l.endsWith("]")&&(l=l.split("[")[0]);let c=a.val();Array.isArray(c)&&(c=c.join(",")),this.changeData(l,c)},this._handleSubmit=o=>{o.preventDefault(),this.submit()};const{setting:t,preserve:n,module:i}=e;let r;n&&(r=`SearchForm:${typeof n=="string"?n:i}:more`,this._preserveKey=r),this.state={showQueryPanel:!1,setting:t&&t.conditions?t:void 0,more:r?rt.get(r):void 0},this.submit=this.submit.bind(this),this.reset=this.reset.bind(this)}get showMore(){var e;return this.state.more??((e=this.state.setting)==null?void 0:e.more)}get isShow(){return this.state.show??this.props.show}get loaded(){return!!this.state.setting}get groupItemCount(){var e;return((e=this.state.setting)==null?void 0:e.groupItemCount)||3}componentDidMount(){this.props.show&&this.show(),_.on("update.SearchForm.zt",(e,t)=>{t&&t.module===this.props.module&&this.load(t.reset??!0)}),_.on("addQuery.SearchForm.zt",(e,t)=>{t&&t.module===this.props.module&&this.addQuery(t.id,t.text)})}componentDidUpdate(e,t){const{container:n}=this.props;if(n){const i=_(n),{show:r,more:o}=this.state,a=r!==t.show,l=o!==t.more;a&&i.toggleClass("show-search-form",r),(a||l)&&i.trigger("layout.SearchForm.zt",this),l&&this._preserveKey&&rt.set(this._preserveKey,o)}}componentWillUnmount(){_.off(".SearchForm.zt")}async load(e){if(this.state.loading)return;await this.changeState({loading:!0,...e?{data:void 0}:null});const t=this.props.url||zt("search","buildForm",`module=${this.props.module}`);try{const n=await Et(t);await this.changeState({setting:n,loading:!1,clickedReset:!1})}catch{await this.changeState({loading:!1,clickedReset:!1})}e&&this._syncPickerData()}async show(){await this.changeState({show:!0}),this.loaded||await this.load()}toggleQueryPanel(e){return e===void 0&&(e=!this.state.showQueryPanel),this.changeState({showQueryPanel:e})}toggle(e){return e===void 0&&(e=!this.isShow),e?this.show():this.hide()}toggleMore(e){return e===void 0&&(e=!this.showMore),this.changeState({more:e})}hide(){return this.changeState({show:!1})}getFormData(e){var i;e=e||this.state.setting;const t={groupAndOr:"or"},n=this.groupItemCount*2;for(let r=1;r<=n;r++)t[`field${r}`]=((i=this._conditionList[r-1])==null?void 0:i.value)??"",t[`operator${r}`]="=",t[`value${r}`]="",t[`andOr${r}`]="and";return{...t,...e.defaultData,...this.state.data}}getSubmitData(){const e=this._data;return{module:this.props.module,actionURL:this.state.setting.actionURL,groupItems:this.groupItemCount,formType:this.showMore?"more":"lite",...e}}submit(){var n;let e=this.getSubmitData();if(!e)return;const t=(n=this.props.beforeSearch)==null?void 0:n.call(this,e);t!==!1&&(t&&(e=t),Ks({url:this.props.searchUrl||zt("search","buildQuery"),data:e,onSuccess:i=>{var r;return((r=this.props.onSearch)==null?void 0:r.call(this,i))===!1||this._handleSearch(_.extend({success:()=>this.load()},typeof i.load=="string"?{url:i.load}:i.load)),!1}}))}reset(){return this.changeState(e=>{const t=new Array(this.groupItemCount*2).fill(0).reduce((n,i,r)=>(n[`value${r+1}`]="",n),{});return{clickedReset:!0,data:{...e.data,...t}}},this._syncPickerData)}applyQuery(e){var i;const{actionURL:t}=this.state.setting,n=t.replace("myQueryID",String(e));((i=this.props.onSearch)==null?void 0:i.call(this,{result:"success",load:n}))!==!1&&this._handleSearch({url:n,success:()=>this.load(!0)})}deleteQuery(e,t){const{deleteQueryConfirm:n,canDeleteQuery:i}=this.state.setting;if(!t&&n){Ke.confirm(n).then(o=>{o&&this.deleteQuery(e,!0)});return}const r=typeof i=="string"?i.replace("{id}",`${e}`):zt("search","deleteQuery",`queryID=${e}`);Ks({url:r,onSuccess:()=>{const o=this.state.setting,{savedQueryList:a=[]}=o;return this.changeState({setting:{...o,savedQueryList:a.filter(l=>l.id!==e)}}),!1}})}addQuery(e,t){const n=this.state.setting,{savedQueryList:i=[]}=n;i.some(r=>r.id===e)||this.changeState({showQueryPanel:!0,setting:{...n,savedQueryList:[{id:e,text:t},...i]}})}changeData(e,t){const n={[e]:t};if(e.startsWith("field")){const i=t,r=+e.substring(5),{defaultOperator:o,defaultValue:a=""}=this._conditionMap[i];o&&(n[`operator${r}`]=o),n[`value${r}`]=a}else if(e.startsWith("value")){const i=this.getFormData(),r=+e.substring(5),o=i[`field${r}`],{control:a}=this._conditionMap[o];if(a==="date"){const l=t.startsWith("$"),c=i[`operator${r}`];l&&c!=="between"?n[`operator${r}`]="between":!l&&c==="between"&&(n[`operator${r}`]="<=")}}this.changeState(i=>({data:{...i.data,...n}}),this._syncPickerData)}_handleSearch(e){const t=this.element.closest(".modal");let{searchLoader:n=t?{load:"modal",target:t}:"table"}=this.props;const i=_(this.element);let r=i.closest(".tab-pane");typeof n=="string"?(n={load:n},r.length||(r=i.closest("#main"))):t&&(r.length||(r=_(t)));const o=r.find("[data-zui-dtable]");return o.length&&(n.load="table",n.target=o.children(".dtable").attr("id")),typeof e=="string"?n.url=e:typeof e=="object"&&(n={...n,...e}),_.trigger("locate.zt",n),!1}_renderOperators(e,t){var i;const n=this._operatorList;return k(fn,{name:e,items:n,required:!0,defaultValue:t??((i=n[0])==null?void 0:i.value),search:!1,maxItemsCount:0})}_renderControl(e,t,n,i){const r=this._conditionMap[e]||{},{control:o="text"}=r,{controlRenders:a}=this.constructor,l=a[o]||a.text;return o==="date"&&r.datePeriods===void 0&&i.datePeriods&&(r.datePeriods=i.datePeriods),l.call(this,r,t,n??"")}_renderField(e,t,n,i,r){var h;const{conditions:o}=i,a=t*n+e+1,l=!e;this._conditionList||(this._conditionList=o.map(({text:u,name:f})=>({text:u??f,value:f})));const c=r[`field${a}`]??((h=o[a])==null?void 0:h.name);return k("tr",{key:a,className:"search-form-field"},k("td",{className:ee("is-andOr",l?"font-bold text-right nowrap":void 0)},l?(i.groupTitles||[])[t]:this._renderAndOrSelect(`andOr${a}`,r[`andOr${a}`],i)),k("td",{className:"is-condition"},k(fn,{name:`field${a}`,items:this._conditionList,required:!0,defaultValue:c,popMinWidth:"100%",popWidth:"auto",maxItemsCount:0})),k("td",{className:"is-operator"},this._renderOperators(`operator${a}`,r[`operator${a}`])),k("td",{className:"is-control",key:`${c}:${a}`},this._renderControl(c,`value${a}`,r[`value${a}`],i)))}_renderGroup(e,t,n){const{groupItemCount:i}=this,{showMore:r}=this,o=[],a=r?i:1;for(let l=0;l<a;l++)o.push(this._renderField(l,e,i,t,n));return k("div",{className:"search-form-group flex-1",key:e},k("table",{className:"table-fixed w-full"},k("tbody",null,o)))}_renderAndOrSelect(e,t,n){const{andText:i="And",orText:r="Or"}=n;return k(fn,{name:e,items:[{value:"and",text:i},{value:"or",text:r}],defaultValue:t,required:!0,search:!1})}_renderForm(e,t){this._conditionMap={},this._conditionList=e.conditions.map(u=>{const{name:f,text:p}=u;return this._conditionMap[f]=u,{text:p??f,value:f}});const{showMore:n}=this;this._operatorList=(e.operators||"=,!=,>,>=,<,<=".split(",")).map(u=>typeof u=="string"?{text:u,value:u}:u);const i=this.getFormData(e);this._data=i;const{searchBtnText:r="Search",resetBtnText:o="Reset",saveQueryBtnText:a="Save",canSaveQuery:l}=e,{simple:c,noMore:h}=t;return k("form",{key:"form",className:"search-form-wrapper flex-auto py-3 px-2",onSubmit:this._handleSubmit},k("div",{className:"row items-center",onChange:this._handleChange},this._renderGroup(0,e,i),k("div",{className:"col flex-none items-center justify-center px-4 w-24"},this._renderAndOrSelect("groupAndOr",i.groupAndOr,e)),this._renderGroup(1,e,i)),k("div",{className:`toolbar gap-4 justify-center flex-nowrap ${c?"ml-4":"mt-3"}`},k($e,{key:"submit",type:"primary",btnType:"submit"},r),c?null:k($e,{key:"reset",onClick:this.reset},o),c&&h?null:k("div",{className:c?"":"absolute top-0 right-0"},c?null:k($e,{key:"saveQuery",type:"ghost",className:"text-primary","data-toggle":"modal",disabled:!l||this.state.clickedReset,url:l?typeof l=="string"?l:zt("search","saveQuery",`module=${t.module}`):void 0,"data-title":a},a),h?null:k($e,{key:"toggle",type:"ghost",className:"text-primary",icon:n?"chevron-double-up":"chevron-double-down",onClick:this.toggleMore.bind(this,void 0)}))))}_renderQueryPanel(e,t){const{savedQueryList:n=[],saveQueryPanelWidth:i=200,saveQueryPanelTitle:r="Saved queries",canDeleteQuery:o}=t;return k("div",{key:"panel",className:ee("search-form-query sidebar sidebar-right pt-3 transition-none",e?"is-expanded":"is-collapsed"),style:{minHeight:100,width:e?nt(i):0,transition:"none"}},k("div",{class:"sidebar-gutter gutter gutter-border gutter-horz border-default",onClick:this.toggleQueryPanel.bind(this,void 0)},k("button",{class:"gutter-toggle",type:"button"},k("span",{class:"chevron-right"}))),e?k("div",{className:"search-form-query-panel pl-3 h-full col"},k("div",{className:"search-form-query-title font-bold mb-1.5 flex-none"},r),k("ul",{className:"search-form-query-list col items-start gap-1 overflow-auto scrollbar-hover pr-3 pb-2 pt-px pl-0"},n.map(({id:a,text:l,noDelete:c})=>k("li",{key:a,className:`search-form-query-item label gray-pale rounded-full state pl-2 hover:text-primary hover:primary-pale inline-flex gap-1 max-w-full ${o&&!c?"pr-0":"pr-2"}`,onClick:this.applyQuery.bind(this,a)},k("span",{className:"min-w-0 flex-auto overflow-hidden nowrap"},l),o&&!c?k($e,{type:"ghost",className:"size-xs rounded-full flex-none"},k("i",{className:"close",onClick:this._handleDeleteQueryClick.bind(this,a)})):null)))):null)}_getProps(e){return{...super._getProps(e),"data-module":e.module}}_getClassName(e){const t=super._getClassName(e);if(!this.isShow)return[t,"search-form","hidden"];const{setting:n,showQueryPanel:i}=this.state,{showMore:r}=this,o=n==null?void 0:n.savedQueryList;return[t,"search-form",n?"is-loaded":"is-empty",{"is-lite":!r,"is-more":r,"is-simple":e.simple,"show-save-query":o&&i}]}_getChildren(e){if(!this.isShow)return null;const{setting:t,showQueryPanel:n,loading:i}=this.state,r=!e.simple&&t&&t.savedQueryList;return k("div",{className:ee(`search-form-container row gap-3 load-indicator${i?" loading":""}`,e.innerClass),style:`max-height: ${76+44*(this.showMore?this.groupItemCount:1)}px`},t?this._renderForm(t,e):null,r?this._renderQueryPanel(n,t):null)}};Nu.controlRenders={text:(s,e,t)=>k("input",{className:"form-control",type:"text",name:e,value:t,placeholder:s.placeholder,...s.controlProps}),select:(s,e,t)=>{const{items:n=[]}=s;return k(fn,{name:e,items:n,defaultValue:t,placeholder:s.placeholder,popMinWidth:"100%",popWidth:"auto",maxItemsCount:0,...s.controlProps})},date:(s,e,t)=>{const{datePeriods:n}=s,i={};return n&&(i.menu=[...n],i.allowInvalid=!0,i.display=r=>{const o=n.find(a=>a.value===r);return o?o.text:r}),k(Ii,{name:e,defaultValue:t,placeholder:s.placeholder,...i,...s.controlProps})},time:(s,e,t)=>k(pa,{name:e,defaultValue:t,placeholder:s.placeholder,...s.controlProps}),datetime:(s,e,t)=>k(Qc,{name:e,defaultValue:t,placeholder:s.placeholder,...s.controlProps})},Nu.defaultProps={preserve:!0};class tn extends Ee{}tn.NAME="SearchForm",tn.Component=Nu,tn.replace=!0,tn.toggleForm=Fu,tn.update=Vm,tn.addQuery=Km,tn.toggle={convertHref:!0,getOptions(s,e){const t=_(s);if(t.is("a")){const n=t.attr("href");n&&(!e.target&&"#.".includes(n[0])?e.target=n:e.url||(e.url=n))}return e},handler(s,e){Fu({container:_(s).closest(e.container||".modal,#main"),...e})}},tn.register();function Fu(s){typeof s=="string"?s={module:s}:s||(s={module:window.config.currentModule});const e=_(s.container||".modal,#main").first();if(!e.length)return;s.module||(s.module=window.config.currentModule);let t;if(s.target?t=_(s.target,e):(t=e.find(`[${tn.DATA_KEY}],.search-form`),s.module&&(t=t.filter(`[data-module="${s.module}"]`))),!t.length){let i=e.closest(".modal").find(".modal-body");i.length||(i=e.find(".main-content-cell")),i.length||(i=e.find("#mainContent")),t=_("<div/>").attr({"zui-key":"searchForm","data-module":s.module}).prependTo(i.length?i.first():e)}let n=t.zui(tn.NAME);return n?n.$.toggle(s.show):n=new tn(t,{container:e,show:!0,...s}),n}function Vm(s,e){_.trigger("update.SearchForm.zt",{module:s,reset:e})}function Km(s){_.trigger("addQuery.SearchForm.zt",s)}const PS="";class Ka extends Ee{}Ka.NAME="UserAvatar",Ka.Component=zr,Ka.register();const cw={1:"error",2:"warning",4:"parse",8:"notice",16:"core-error",32:"core-warning",64:"compile-error",128:"compile-warning",256:"user-error",512:"user-warning",1024:"user-notice",2048:"strict",4096:"recoverable-error",8192:"deprecated",16384:"user-deprecated",32767:"all"};function qm(s){return typeof s=="number"&&(s=cw[s]),s}function Gm(s){return s=qm(s),s.includes("error")?"error":s.includes("warning")?"warning":"info"}function hw({errors:s,...e}){const t=s.reduce((n,i)=>(n[Gm(i.level)]++,n),{error:0,warning:0,info:0});return k("div",{class:"row items-stretch text-sm","data-hint":"PHP errors",...e},t.error?k("button",{type:"button",class:"state font-bold px-0.5 danger"},k("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"ERR"),t.error):null,t.warning?k("button",{type:"button",class:"state font-bold px-0.5 danger bg-opacity-90"},k("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"WAR"),t.warning):null,t.info?k("button",{type:"button",class:"state font-bold px-0.5 danger bg-opacity-80"},k("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"INF"),t.info):null)}function Zt(s,e,t,n){console.groupCollapsed(`%c${s} %c${e}`,"color: #fff; background-color: #9333ea; padding: 0 0.1em 0 0.25em; border-radius: 0.25em 0 0 0.25em;","color: #9333ea; background-color: #e9d5ff; padding: 0 0.5em; border-radius: 0 0.25em 0.25em 0;",n),console.table(t),console.groupEnd()}function hs(s,e=400,t=100){return s<t?"success":s<e?"warning":"danger"}function gn(s){return s<1e3?`${s.toFixed(0)}ms`:`${(s/1e3).toFixed(2)}s`}function Ym({perf:s,guardState:e,guardData:t}){var l;const n=s.id==="page"?"页面":s.id==="#dtable"?"表格":"部分",i=[],{trace:r,xhprof:o}=s,a=r==null?void 0:r.request;if(e){const c=e==="sending"?"发送中":e==="error"?"发送失败，点击查看":"已发送",h=e==="sending"?"text-warning":e==="error"?"text-danger":"text-success",u=t?`${t.request.module}-${t.request.method}#${t.requestId}`:"",f=Zt.bind(null,"Perf Guard Data",e===!0?"sended":e||"null",t,t==null?void 0:t.requestId);i.push(k("div",{onClick:f,class:`px-0.5 state ${h}`,"data-hint":`性能门禁数据${t?`（${u}）`:""}：${c}`},k("i",{class:e==="sending"?"icon icon-spinner-indicator spin":e===!0?"icon-shield-check":"icon-shield"})),k("div",{class:"muted"},"/"))}if(s.requestEnd){s.clientCache&&i.push(k("div",{class:"px-0.5 state text-success","data-hint":`使用本地缓存渲染：${s.clientCache}`},k("i",{class:"icon-check-circle"})),k("div",{class:"muted"},"/"));const c=s.requestEnd-s.requestBegin;if(i.push(k("div",{class:`px-0.5 state text-${hs(c,500,300)}`,"data-hint":"总加载时间 (好<300ms≤正常<500ms≤差)",onClick:Zt.bind(null,"Trace","Perf",s,s.id)},k("i",{class:"icon-history"})," ",gn(c))),a){const u=a.timeUsed;i.push(k("div",{class:"muted"},"/"),k("div",{class:`px-0.5 state text-${hs(u)}`,"data-hint":"服务器耗时 (好<300≤正常<500≤差)",onClick:Zt.bind(null,"Trace","Request",a,s.id)},k("span",{class:"scale-95 font-bold inline-block"},"S"),gn(u)))}if(s.dataSize){if(a){const u=c-a.timeUsed;i.push(k("div",{class:"muted"},"/"),k("div",{class:`px-0.5 state text-${hs(u,600,200)}`,"data-hint":"网络用时 (好<200≤正常<600≤差)",onClick:Zt.bind(null,"Trace","Request",a,s.id)},k("span",{class:"scale-95 font-bold inline-block"},"N"),gn(u)))}if(i.push(k("div",{class:"px-0.5 state","data-hint":"下载大小",onClick:Zt.bind(null,"Trace","Perf",s,s.id)},k("span",{class:"muted"},k("i",{class:"icon icon-cube"})," ",Dt(s.dataSize,1)))),a){const u=c-a.timeUsed,f=1e3*s.dataSize/u;i.push(k("div",{class:"muted"},"/"),k("div",{class:`px-0.5 state text-${f<102400?"danger":f<1024e3?"warning":"success"}`,"data-hint":"下载速度(B<100KB≤正常<1MB≤G)",onClick:Zt.bind(null,"Trace","Request",a,s.id)},k("i",{class:"icon icon-arrow-down"}),Dt(f,1),"/s"))}}if(s.renderEnd&&s.renderBegin){const u=s.renderEnd-s.renderBegin,f=hs(u,200,50);i.push(k("div",{class:"muted"},"/"),k("div",{class:`px-0.5 state text-${f}`,"data-hint":"浏览器渲染用时 (好<50≤正常<200≤差)",onClick:Zt.bind(null,"Trace","Perf",s,s.id)},k("i",{class:`icon-${f==="danger"?"frown":f==="warning"?"meh":"smile"}`}),gn(u)))}if(a){const{memory:u,querys:f}=a;typeof u=="number"&&i.push(k("div",{class:"muted"},"/"),k("div",{class:`px-0.5 state text-${hs(u*1024,1024e3,102400)}`,"data-hint":"服务器内存占用 (好<10KB≤正常<100KB≤差)",onClick:Zt.bind(null,"Trace","Request",a,s.id)},k("span",{class:"scale-95 font-bold inline-block"},"M"),Dt(u*1024))),typeof f=="number"&&i.push(k("div",{class:"muted"},"/"),k("div",{class:`px-0.5 state text-${hs(f,30,10)}`,"data-hint":"SQL执行次数 (好<30≤正常<10≤差)",onClick:Zt.bind(null,"SQL Query",`${((l=r.sqlQuery)==null?void 0:l.length)??0} queries`,r.sqlQuery,s.id)},k("span",{class:"scale-95 font-bold inline-block"},"Q"),f))}r!=null&&r.files&&i.push(k("div",{class:"muted"},"/"),k("div",{class:"px-0.5 state","data-hint":"服务器加载PHP文件数目",onClick:Zt.bind(null,"Trace",`${r.files.length} php files`,r.files,s.id)},k("span",{class:"muted"},k("i",{class:"icon-file icon-sm scale-75"}),r.files.length)));const h=r==null?void 0:r.profiles;if(h!=null&&h.length){let u=0,f={Duration:0};if(h.forEach(p=>{p.Duration>.3&&u++,p.Duration>f.Duration&&(f=p)}),i.push(k("div",{class:`px-0.5 state text-${hs(u,3,1)}`,"data-hint":"服务器最慢SQL数 (好<3≤正常<1≤差)",onClick:Zt.bind(null,"SQL Query",`${h.length} SQL profiles`,h,s.id)},k("span",{class:"scale-95 font-bold inline-block"},"LQ"),u)),f.Duration){const p=f.Duration*1e3;i.push(k("div",{class:`px-0.5 state text-${hs(p,600,300)}`,"data-hint":"服务器最慢SQL耗时 (好<600≤正常<300≤差)",onClick:Zt.bind(null,"SQL Query",`Slowest SQL query: ${p}ms`,f,s.id)},k("span",{class:"scale-95 font-bold inline-block"},"MLQ"),gn(p)))}}}else i.push(k("div",{class:"muted px-0.5"},"loading..."));return k("div",{class:"zin-perf-btn-list row items-center bg-black text-sm"},k("div",{class:"px-1 bg-canvas bg-opacity-20 self-stretch flex items-center","data-hint":`请求 ${s.id} URL: ${s.url}`},k("span",{class:"muted"},n)),i,o?k("a",{class:"state text-secondary px-0.5",href:o,target:"_blank","data-hint":"打开 xhprof 报告"},"XHP"):null)}function uw(s){Zt("Trace","Error",s,s.message),navigator.clipboard.writeText(`vim +${s.line} ${s.file}`)}function dw({errors:s=[],show:e,basePath:t}){s.length||(e=!1);const n=s.map(i=>{const r=qm(i.level),o=Gm(r),a=o==="error"?"danger":o==="info"?"important":"warning";return k("div",{class:`zin-error-item state ${a}-pale text-fore px-2 py-1 ring ring-darker`,onClick:uw.bind(null,i)},k("div",{class:"zin-error-msg font-bold text-base"},k("strong",{class:`text-${a}`,style:"text-transform: uppercase;"},r)," ",i.message),k("div",{class:"zin-error-info text-sm opacity-60 break-all"},k("strong",null,"vim +",i.line)," ",k("span",{className:"underline"},t?i.file.substring(t.length):i.file)))});return k("div",{class:`zin-errors-panel canvas absolute bottom-full left-0 mono shadow-xl ring rounded fade-from-bottom ${e?"in":"events-none"}`},n)}const MS="";function fw(){const s=navigator.userAgent;let e="Unknown",t="Unknown";return s.indexOf("Chrome")>-1?(e="Chrome",t=s.substring(s.indexOf("Chrome")+7)):s.indexOf("Firefox")>-1?(e="Firefox",t=s.substring(s.indexOf("Firefox")+8)):s.indexOf("Safari")>-1?(e="Safari",t=s.substring(s.indexOf("Safari")+7),s.indexOf("Version")>-1&&(t=s.substring(s.indexOf("Version")+8))):window.StyleMedia&&(e="Edge",t=s.substring(s.indexOf("Edge")+5)),t=t.split(" ")[0],t=t.split(";")[0],t=t.split(")")[0],{name:e,version:t}}let pw=class extends ke{constructor(e){var t,n;super(e),this._timer=0,this._browser=fw(),this._guardData={},this.state={showPanel:e.defaultShow??!0,showZinbar:!!((n=(t=e.defaultData)==null?void 0:t.errors)!=null&&n.length||!rt.get("Zinbar:hidden")),...e.defaultData},this.togglePanel=this.togglePanel.bind(this),this.sendGuardData=this.sendGuardData.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this)}componentDidMount(){document.addEventListener("click",this.handleClickOutside)}componentDidUpdate(){var o,a,l,c;const{pagePerf:e}=this.state;let t="",n="";const i=(a=(o=e==null?void 0:e.trace)==null?void 0:o.sqlQuery)==null?void 0:a.length,r=(c=(l=e==null?void 0:e.trace)==null?void 0:l.request)==null?void 0:c.timeUsed;if(r&&e.renderEnd){const h=e.renderEnd-e.renderBegin,u=r+h,f=[];let p="",g="";u>=500?(p="danger",f.push(`处理时间${gn(u)}超过500ms（后端${gn(r)}，前端${gn(h)}）`)):u>=300&&(p="warning",f.push(`处理时间${gn(u)}超过300ms（后端${gn(r)}，前端${gn(h)}）`)),i&&(i>=60?(g="danger",f.push(`SQL查询超过60次（实际${i}）`)):i>=40&&(g="warning",f.push(`SQL查询超过40次（实际${i}）`))),(p||g)&&(t=p==="danger"||g==="danger"?"danger":"warning",n=[t==="danger"?"页面有性能问题":"页面有优化空间",...f].join("，"))}_("body").z({perf:t,perfMessage:n})}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside)}handleClickOutside(e){const t=e.target;this.state.showPanel&&!t.closest(".zinbar")&&this.setState({showPanel:!1})}async sendGuardData(e=180){var p,g,y;const{guardApi:t}=this.props;if(!t)return;this._timer&&clearTimeout(this._timer);const{pagePerf:n}=this.state;if(!(n!=null&&n.renderEnd))return;if(e){this._timer=window.setTimeout(()=>{this.sendGuardData(0)},e);return}const i=N0(n.url);if(!(i!=null&&i.moduleName))return;this.setState({guardState:"sending"});const{author:r="anonymous",email:o,host:a=location.origin}=this.props,{profiles:l=[],sqlQuery:c=[],request:h}=n.trace||{};l.forEach(v=>{v.DurationOriginal||(v.DurationOriginal=v.Duration,v.Duration=1e3*v.Duration)});const u=c.findIndex(v=>v.includes("SET profiling = ")),f=u>=0?c.length-u-1:c.length;this._guardData={timestamp:Date.now(),identifier:r,email:o,requestId:Hs(),dataVer:3,request:{host:a,url:/https?:/.test(n.url)?n.url:`${a}${n.url}`,module:i.moduleName,method:i.methodName,xhprof:n.xhprof?/https?:/.test(n.xhprof)?n.xhprof:`${a}${n.xhprof}`:null,php:h==null?void 0:h.php,errorCount:((p=this.state.errors)==null?void 0:p.length)||0,errors:this.state.errors??[]},userEnv:{system:navigator.userAgentData?navigator.userAgentData.platform:navigator.platform,userAgent:navigator.userAgent,browser:[this._browser.name,this._browser.version].join(" ")},metrics:{frontend:{renderTime:Math.round(n.renderEnd-n.renderBegin),downloadSize:n.dataSize},backend:{totalTime:h==null?void 0:h.timeUsed,sqlTime:l.reduce((v,b)=>v+b.Duration,0),sqlCount:Math.max(l.length||0,f),sqlDetails:l,phpFileLoaded:((g=n.trace)==null?void 0:g.files.length)||0,phpFiles:(y=n.trace)==null?void 0:y.files,requestMemory:h==null?void 0:h.memory}}};try{const v=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this._guardData),mode:"no-cors"});this._guardData.$response=await v.text(),this.setState({guardState:!0})}catch(v){this._guardData.$error=v,console.error("[ZUI] Send guard data failed:",v,this),this.setState({guardState:"error"})}}update(e,t,n){this.setState(i=>{const r=!(e!=null&&e.id)||e.id==="page",o={};return r?(e&&(o.pagePerf={...i.pagePerf,...e}),t&&(o.errors=t),e!=null&&e.requestEnd||(o.guardState=!1)):(e&&(o.partPerf={...i.partPerf,...e}),t&&(o.errors=[...i.errors??[],...t??[]])),n&&(o.basePath=n),o},this.props.guardApi?this.sendGuardData:void 0)}togglePanel(){this.setState({showPanel:!this.state.showPanel})}toggleZinbar(){const e=!this.state.showZinbar;this.setState({showZinbar:e},()=>{rt.set("Zinbar:hidden",!e)})}render(){const{errors:e,pagePerf:t,partPerf:n,showZinbar:i,basePath:r,guardState:o}=this.state,{fixed:a}=this.props,l=e==null?void 0:e.length;return k("div",{className:ee("zinbar row h-5 items-stretch gap-px inverse bg-opacity-50",a?"relative":"fixed right-0 bottom-0",{collapse:!i}),style:{zIndex:9999}},k("button",{type:"button","data-hint":i?"折叠":"展开",className:`w-4 ${l&&!i?"danger":"bg-inverse"} flex items-center justify-center`,style:{marginLeft:-15},onClick:this.toggleZinbar.bind(this)},k("span",{class:i?"caret-right":"caret-left"})),l?k(hw,{errors:e,onClick:this.togglePanel}):null,t?k(Ym,{perf:t,guardState:o,guardData:this._guardData}):null,n?k(Ym,{perf:n}):null,k(dw,{show:this.state.showPanel,basePath:r,errors:e}))}};class Pu extends Ee{}Pu.NAME="Zinbar",Pu.Component=pw;let Xm=class extends tt{_renderContent(e){const{subtitle:t,subtitleClass:n,content:i,contentClass:r}=e;if(!(!t&&!i))return[A("div",{className:ee("card-content",r),children:[t?A("div",{className:ee("card-subtitle",n),children:A(Se,{content:t})},"subtitle"):null,i?A(Se,{content:i},"extraContent"):null]},"content")]}_renderHeading(e){const{icon:t,prefix:n,prefixClass:i,title:r,titleClass:o,titleUrl:a,titleAttrs:l,suffix:c,suffixClass:h,heading:u,headingClass:f}=e;if(!t&&!n&&!r&&!c&&!u)return;const p=a?"a":"span";return A("div",{className:ee("card-heading",f),children:[t?A(Re,{className:"card-icon",icon:t},"icon"):null,n?A(Se,{className:ee("card-prefix",i),content:n},"prefix"):null,r?A(p,{className:ee("card-title",o),href:a,...l,children:A(Se,{content:r})},"title"):null,c?A(Se,{className:ee("card-suffix",h),content:c},"suffix"):null,u?A(Se,{content:u},"extraHeading"):null]})}_renderHeader(e){const{header:t,headerClass:n}=e;if(t)return A("div",{className:ee("card-header",n),children:A(Se,{content:t},"header")})}_renderFooter(e){const{footer:t,footerClass:n,footActions:i}=e;if(t||i)return A("div",{className:ee("card-footer",n),children:[A(Se,{content:t},"footer"),Xe.render(i,[e],{key:"foot-actions",relativeTarget:e,className:"card-foot-actions",size:"sm"},this)]})}_renderActions(e){return Xe.render(e.actions,[e],{key:"actions",relativeTarget:e,className:"card-actions",size:"sm"},this)}_renderList(e){const{items:t}=e;if(!t)return;const n=Ie({key:"list",className:"card-list"},typeof t=="object"?t:{items:t});return A(kt,{...n})}_renderAvatar(e){const{avatar:t}=e;if(t){const n=typeof t=="function"?t.call(this,e):t;if(n)return n.className=ee("item-avatar",n.className),A(bi,{...n},"avatar")}}_getClassName(e){return["card",e.className,e.selected?"selected":""]}_getChildren(e){return[this._renderActions(e),this._renderHeader(e),this._renderAvatar(e),this._renderHeading(e),this._renderContent(e),this._renderList(e),this._renderFooter(e),e.children]}};class Zm extends Xm{_getClassName(e){return e.className}_getChildren(e){const{innerAttrs:t,innerClass:n,selected:i,innerComponent:r="div"}=e,o=Ie({className:ee("card",n,i?"selected":"")},t);return A(r,{...o,children:super._getChildren(e)})}}let Hi=class extends kt{_getClassName(e){return[super._getClassName(e),e.countPerRow?"card-grid":""]}_getProps(e){const{gap:t,countPerRow:n}=e;return Ie({style:{"--list-gap":t?nt(t):void 0,"--list-count-per-row":n}},super._getProps(e))}_getRenderedItem(e,t){return t}};Hi.NAME="card-list",Hi.TAG="div",Hi.ItemComponents={...kt.ItemComponents,default:Zm,item:Zm},Hi.defaultItemProps={component:"div"};class qa extends Ee{}qa.NAME="Card",qa.Component=Xm,qa.replace=!0;class Mu extends Ee{}Mu.NAME="CardList",Mu.Component=Hi;const RS="",LS="";class ji extends Dn{_getLayoutOptions(){const e=super._getLayoutOptions();return this.options.element||(e[0]={getBoundingClientRect:this._getClickBounding}),e}}ji.NAME="ContextMenu",ji.DEFAULT={...Dn.DEFAULT,name:"contextmenu",trigger:"contextmenu"},ji.register();const zS="",OS="";function mw(s){const{left:e,className:t,top:n,id:i,onMenuBtnClick:r,title:o,width:a,height:l,content:c,loading:h,draggable:u=!0}=s;return A("div",{class:"dashboard-block-cell",style:{left:e,top:n,width:a,height:l},children:A("div",{className:ee("dashboard-block load-indicator",h&&!c?"loading":"",r?"has-more-menu":"",t),draggable:u,"data-id":i,children:[A("div",{class:"dashboard-block-header",children:[A("div",{class:"dashboard-block-title",children:o}),r?A("div",{class:"dashboard-block-actions toolbar",children:A("button",{class:"toolbar-item dashboard-block-action btn square ghost rounded size-sm","data-type":"more",onClick:r,children:A("div",{class:"more-vert"})})}):null]}),_.isPlainObject(c)&&c.html?A(Rn,{className:"dashboard-block-body",executeScript:!0,...c}):A("div",{class:"dashboard-block-body",children:c})]})})}const HS="",jS="",Ru=([s,e,t,n],[i,r,o,a])=>!(s+t<=i||i+o<=s||e+n<=r||r+a<=e),Qm=(s,e)=>s[1]===e[1]?s[0]-e[0]:s[1]-e[1],Ga="Dashboard:Block.cache:";let Jm=class extends ke{constructor(e){super(e),this._ref=Ce(),this._loadTimer=0,this._map=new Map,this._oldMap=new Map,this.tryLoadNext=()=>{clearTimeout(this._loadTimer),this._loadTimer=window.setTimeout(()=>this.loadNext(),100)},this._checkLayout=()=>{const{onLayoutChange:t}=this.props;if(!t)return;const{blocks:n}=this.state,i={};let r=!1;n.forEach(o=>{const[a,l,c,h]=this._map.get(o.id),u=this._oldMap.get(o.id);(!u||u[0]!==a||u[1]!==l||u[2]!==c||u[3]!==h)&&(r=!0,i[o.id]={left:a,top:l,width:c,height:h},this._oldMap.set(o.id,[a,l,c,h]))}),r&&t(i)},this._handleMenuClick=t=>{const n=t.target.closest(".dashboard-block");if(!n)return;const i=n.dataset.id;if(!i)return;const r=this.getBlock(i);if(!r||!r.menu)return;const{menu:o}=r,{onClickMenu:a}=this.props;ji.show({triggerEvent:t,element:t.currentTarget,placement:"bottom-end",menu:{onClickItem:l=>{var c;((c=l.item.data)==null?void 0:c.type)==="refresh"&&this.load(i),a&&a.call(this,l,r)},...o}})},this.state={blocks:this._initBlocks(e.blocks)}}getBlock(e){return this.state.blocks.find(t=>t.id===e)}update(e,t){const{id:n}=e,{blocks:i}=this.state,r=i.findIndex(a=>a.id===n);if(r<0)return;const o=i[r];e.fetch&&e.fetch!==o.fetch&&e.needLoad===void 0&&(e.needLoad=!0),i[r]={...o,...e},this.setState({blocks:i},t)}delete(e){const{blocks:t}=this.state,n=t.findIndex(i=>i.id===e);n<0||(t.splice(n,1),this.setState({blocks:t}))}add(e){e=Array.isArray(e)?e:[e],this.setState({blocks:[...this.state.blocks,...this._initBlocks(e)]})}load(e,t){const n=this.getBlock(e);!n||n.loading||(t=t||n.fetch,t&&this.update({id:e,loading:!0,needLoad:!1},async()=>{try{const i=await _.fetch(t,[e,n],({url:r})=>({url:Te(r,n),dataType:"html"}));this.update({id:e,loading:!1,content:{html:i}},()=>{var r;this._setCache(e,i),(r=this.props.onLoad)==null||r.call(this,n)})}catch(i){const r=A("div",{class:"panel center text-danger p-5",children:["Error: ",i.message]});this.update({id:e,loading:!1,content:r},()=>{var o;(o=this.props.onLoadFail)==null||o.call(this,i,n)})}}))}reset(e){this.setState({blocks:this._initBlocks(e)})}loadNext(){const{blocks:e}=this.state;let t="";for(const n of e){if(n.loading)return;if(!n.visible&&this._isVisible(n.id))return this.update({id:n.id,visible:!0});if(n.needLoad&&n.visible){t=n.id;break}}t.length&&requestAnimationFrame(()=>this.load(t))}_isVisible(e){return!this.props.onlyLoadVisible||!!_(this._ref.current).find(`.dashboard-block[data-id="${e}"]`).isVisible()}_setCache(e,t){const{cache:n}=this.props;if(n)try{typeof n=="string"?rt.set(`${Ga}${n}:${e}`,t):rt.session.set(`${Ga}${e}`,t)}catch(i){console.warn("ZUI: Failed to cache block content.",{id:e,html:t,error:i})}}_getCache(e){const{cache:t}=this.props;if(!t)return;const n=typeof t=="string"?rt.get(`${Ga}${t}:${e}`):rt.session.get(`${Ga}${e}`);if(n)return{html:n}}_initBlocks(e){const{blockFetch:t,blockMenu:n,grid:i}=this.props;return e.map(o=>{const{id:a,size:l,width:c,height:h,left:u=-1,top:f=-1,fetch:p=t,menu:g=n,content:y,...v}=o,[b,w]=this._getBlockSize(c&&h?{width:c,height:h}:l);return{id:`${a}`,width:b,height:w,left:Math.min(u,i-b),top:f,fetch:p,menu:g,content:y??this._getCache(`${a}`),loading:!1,needLoad:!!p,...v}})}_getBlockSize(e){const{blockDefaultSize:t,blockSizeMap:n}=this.props;return e=e??t,typeof e=="string"&&(e=n[e]),e=e||t,Array.isArray(e)||(e=[e.width,e.height]),e}_layout(){const{blocks:e,dragging:t,dropping:n}=this.state,i=this._map;if(i.size){const a=[0,0,0,0];e.sort((l,c)=>Qm(i.get(l.id)||a,i.get(c.id)||a))}i.clear(),t&&n&&i.set(t,n),e.forEach(a=>{a.id!==t&&this._layoutBlock(a)});const r=Array.from(i.entries());r.sort((a,l)=>Qm(a[1],l[1]));let o=0;return r.forEach(([a,l])=>{let c=l[1]-1;for(;c>=0&&this._canMove([l[0],c,l[2],l[3]],a);)c--;c++,l[1]=c,o=Math.max(o,c+l[3])}),n&&(o=Math.max(o,n[1]+n[3])),{blocks:e,height:o}}_initDraggable(){const e=this._ref.current;this._draggable=new br(e,{selector:".dashboard-block",target:()=>e,beforeDrag:(t,n)=>{const i=n.getBoundingClientRect();if(t.clientY-i.top>48)return t.preventDefault(),!1;this._dragOffset=[t.clientX-i.left,t.clientY-i.top]},onDragStart:(t,n)=>{const i=n.dataset.id;i!==void 0&&(this._dragging=this._map.get(i),this.setState({dragging:i}))},onDragOver:t=>{const{cellHeight:n,grid:i}=this.props,r=e.getBoundingClientRect(),[,,o,a]=this._dragging,[l,c]=this._dragOffset,h=Math.min(i-o,Math.max(0,Math.round((t.clientX-r.left-l)/(r.width/i)))),u=Math.max(0,Math.round((t.clientY-r.top-c)/n)),f=this.state.dropping;f&&f[0]===h&&f[1]===u||this.setState({dropping:[h,u,o,a]})},onDragEnd:()=>{const{dragging:t,dropping:n}=this.state,i={dragging:void 0,dropping:void 0},r={};if(t&&n){const{blocks:o}=this.state;o.forEach((a,l)=>{const[c,h]=t===a.id?n:this._map.get(a.id);(a.left!==c||a.top!==h)&&(o[l]={...a,left:c,top:h},r[a.id]={left:c,top:h})}),i.blocks=o}this.setState(i,this._checkLayout),this._dragging=void 0,this._dragOffset=void 0}})}_layoutBlock(e){const{id:t,left:n,top:i,width:r,height:o}=e,a=[n,i,r,o];n<0||i<0?this._appendBlock(t,a):this._insertBlock(t,a)}_canMove(e,t){const{dropping:n}=this.state;if(n&&Ru(e,n))return!1;for(const[i,r]of this._map.entries())if(i!==t&&Ru(r,e))return!1;return!0}_canPlace(e){const{dragging:t}=this.state;return this._canMove(e,t)}_insertBlock(e,t){const{dropping:n}=this.state;for(n&&Ru(t,n)&&(t[1]=n[1]+n[3]);!this._canPlace(t);)t[1]=t[1]+1;this._map.set(e,t)}_appendBlock(e,t){const[n,i,r,o]=t;let a=i;if(n>=0&&i>=0){if(this._canPlace(t)){this._map.set(e,[n,i,r,o]);return}a=-1}let l=n<0?0:n,c=a<0?0:a,h=!1;const u=this.props.grid;for(;!h;){if(this._canPlace([l,c,r,o])){h=!0;break}n<0?(l+=1,l+r>u&&(l=0,c+=1)):c+=1}this._map.set(e,[l,c,r,o])}componentDidMount(){this.loadNext(),_(window).on("scroll",this.tryLoadNext),this._initDraggable();for(const[e,t]of this._map.entries())this._oldMap.set(e,[...t])}componentDidUpdate(e){e.blocks!==this.props.blocks?this.setState({blocks:this._initBlocks(this.props.blocks)}):this.loadNext()}componentWillUnmount(){clearTimeout(this._loadTimer),_(window).off("scroll",this.tryLoadNext),this._draggable.destroy()}render(){const{blocks:e,height:t}=this._layout(),{cellHeight:n,grid:i,emptyBlockContent:r}=this.props,{dropping:o,dragging:a}=this.state,l=this._map;return A("div",{class:"dashboard",children:A("div",{class:"dashboard-blocks",style:{height:t*n},ref:this._ref,children:[o?A("div",{className:"dashboard-drop-shadow",style:{left:`${100*o[0]/i}%`,top:n*o[1],width:`${100*o[2]/i}%`,height:n*o[3]}},"dropping"):null,e.map((c,h)=>{const{id:u,menu:f,content:p,title:g}=c,[y,v,b,w]=u===a&&o?o:l.get(u)||[0,0,c.width,c.height];return A(mw,{id:u,index:h,left:`${100*y/i}%`,top:n*v,width:`${100*b/i}%`,height:n*w,content:p??r,title:g,className:ee(c.needLoad?"need-load":"",p?"has-content":""),onMenuBtnClick:f?this._handleMenuClick:void 0},c.id)})]})})}};Jm.defaultProps={responsive:!1,cache:!0,blocks:[],grid:3,gap:16,cellHeight:64,blockDefaultSize:[1,3],blockMenu:{items:[{text:"Refresh",data:{type:"refresh"}}]},onlyLoadVisible:!0,blockSizeMap:{xs:[1,3],sm:[1,4],md:[1,5],lg:[1,6],xl:[1,8],xsWide:[2,3],smWide:[2,4],mdWide:[2,5],lgWide:[2,6],xlWide:[2,8],xsLong:[3,3],smLong:[3,4],mdLong:[3,5],lgLong:[3,6],xlLong:[3,8]}};class Lu extends Ee{}Lu.NAME="Dashboard",Lu.Component=Jm;function zu(s,e,t,n){if(typeof s=="function"&&(s=s.call(this,e)),typeof s=="string"&&s.length&&(s={url:s}),!s)return Array.isArray(t)?A(Mn,{children:t}):t;const{url:i,...r}=s,{setting:o}=e.col,a={};return o&&Object.keys(o).forEach(l=>{l.startsWith("data-")&&(a[l]=o[l])}),A("a",{href:Te(i,e.row.data),...n,...r,...a,children:t})}function Ou(s,e,t){if(s==null)return;const n=e.row.data;return t=t??(n==null?void 0:n[e.col.name]),typeof s=="function"?s.call(this,t,e):Te(s,{...n,0:t})}function eg(s,e,t,n){var i;return t?(t=t??((i=e.row.data)==null?void 0:i[e.col.name]),t==="0000-00-00 00:00:00"||t==="0000-00-00"?n??"":s===!1?t:(s===!0&&(s="[yyyy-]MM-dd hh:mm"),typeof s=="function"&&(s=s.call(this,t,e)),gt(t,s,n??t))):n??t}function tg(s,e){const{link:t}=e.col.setting,n=zu.call(this,t,e,s[0]);return n&&(s[0]=n),s}function ng(s,e){const{format:t,digits:n}=e.col.setting;let i=s[0];return typeof n=="number"&&!Number.isNaN(Number(i))&&(i=Number(i),n>=0&&(i=i.toFixed(n))),t&&(i=Ou.call(this,t,e,i)),s[0]=i,s}function sg(s,e){const{map:t,mapSplitter:n=",",mapJoiner:i}=e.col.setting;if(t){let r=s[0];typeof r=="string"&&n&&(r=r.split(n)),typeof t=="function"?s[0]=t.call(this,r,e):typeof t=="object"&&(Array.isArray(r)||(r=[r]),s[0]=r.map(o=>t[o]??o).join(i??n))}return s}function ig(s,e,t){const n={};return typeof s=="function"?Object.assign(n,s.call(this,t)):Object.keys(s).forEach(i=>{var o;const r=(o=t.row.data)==null?void 0:o[s[i]];r!==void 0&&(n[i]=r)}),Object.keys(n).length&&e.push({style:n}),e}function rg(s,e,t="[yyyy-]MM-dd hh:mm"){const{formatDate:n=t,invalidDate:i}=e.col.setting;return s[0]=eg.call(this,n,e,s[0],i),s}function Hu(s,e,t=!1){const{html:n=t}=e.col.setting;if(n===!1)return s;const i=s[0],r=n===!0?i:Ou.call(this,n,e,i);return s[0]={html:r},s}const gw=Ze({name:"rich",colTypes:{html:{onRenderCell(s,e){return Hu.call(this,s,e,!0)}},progress:{align:"center",onRenderCell(s,{col:e}){const{progressType:t,barColor:n,barBgColor:i,barHeight:r=6,barWidth:o=64,circleSize:a=24,circleBorderSize:l=1,circleBgColor:c="var(--color-border)",circleColor:h="var(--color-success-500)"}=e.setting,u=s[0];return s[0]=t==="bar"?A(Jo,{className:"rounded-full",width:o,height:r,color:n||h,background:i,percent:u}):A(ea,{percent:u,size:a,circleWidth:l,circleBg:c,circleColor:h,text:!0}),s}},datetime:{formatDate:"[yyyy-]MM-dd hh:mm"},date:{formatDate:"yyyy-MM-dd"},time:{formatDate:"hh:mm"}},onRenderCell(s,e){const{formatDate:t,html:n,hint:i,styleMap:r}=e.col.setting;if(t&&(s=rg.call(this,s,e,t)),s=sg.call(this,s,e),s=ng.call(this,s,e),n?s=Hu.call(this,s,e):s=tg.call(this,s,e),i){let o=e.value;typeof i=="function"?o=i.call(this,e):typeof i=="string"?o=Te(i,e.row.data):typeof s[0]=="string"&&(o=s[0]),s.push({attrs:{title:o}})}return r&&(s=ig.call(this,r,s,e)),s}},{buildIn:!0}),yw={default:(s,e,t)=>{var r,o;const n=(r=s.data)==null?void 0:r[t.name],i=(o=e.data)==null?void 0:o[t.name];return n===i?0:n==null?1:String(n).localeCompare(String(i))},date:(s,e,t)=>{var r,o;const n=et(((r=s.data)==null?void 0:r[t.name])??0),i=et(((o=e.data)==null?void 0:o[t.name])??0);return n.getTime()-i.getTime()},number:(s,e,t)=>{var r,o;const n=(r=s.data)==null?void 0:r[t.name],i=(o=e.data)==null?void 0:o[t.name];return Number.parseFloat(n)-Number.parseFloat(i)}},vw=Ze({name:"sort",defaultOptions:{sort:!1},when:s=>!!s.sort,onCreate(){const{sortBy:s}=this.options;s&&(this.state.sortBy=Array.isArray(s)?s:[s])},onAddRows(s,e){const{sortBy:t}=this.state;if(!t||!t.length)return;const{sort:n}=this.options,i={...yw,...typeof n=="function"?{default:n}:typeof n=="object"?n:{}};return[...s].sort((r,o)=>{for(const{name:a,order:l}of t){const c=e.map[a];if(!c)continue;let h=c.setting.sort;if(h===!0?h=i.default:typeof h=="string"&&(h=i[h]),!h)continue;const u=h.call(this,r,o,c);if(u)return l==="asc"?u:-u}return 0})},onHeaderCellClick(s,e){if(!s.target.closest(".dtable-sort-link"))return;const t=this.getColInfo(e.colName);if(!t||!t.setting.sort)return;const{sortBy:n=[]}=this.state,i=n.findIndex(a=>a.name===t.name),{multiSort:r}=this.options;let o="asc";if(i>=0){const a=n[i].order;a==="asc"?o="desc":a==="desc"&&(o="none"),r&&n.splice(i,1)}r||(n.length=0),this.update({dirtyType:"layout",state:{sortBy:[{name:e.colName,order:o},...n].filter(a=>a.order!=="none")}})},onRenderHeaderCell(s,e){var l;const{col:t}=e,{sortBy:n}=this.state;if(!t.setting.sort)return s;const o=((l=n==null?void 0:n.find(c=>c.name===t.name))==null?void 0:l.order)||"none",a=A("div",{className:`dtable-sort dtable-sort-${o}`});return s[0]=A("a",{className:"dtable-sort-link",href:"javascript:;",children:[s[0],a]}),s.push({outer:!0,attrs:{"data-sort":o}}),s}},{buildIn:!0}),xw={html:{component:Rn}},og=Ze({name:"custom",onRenderCell(s,e){const{col:t}=e;let{custom:n}=t.setting;if(typeof n=="function"&&(n=n.call(this,e)),!n)return s;const i=Array.isArray(n)?n:[n],{customMap:r}=this.options;return i.forEach(o=>{let a;typeof o=="string"?a=o.startsWith("<")?{component:Rn,props:{html:Te(o,{value:e.value,...e.row.data,$value:e.value})}}:{component:o}:a=o;let{component:l}=a;const c=[a];typeof l=="string"&&c.unshift(xw[l],r==null?void 0:r[l]);const h={};c.forEach(f=>{if(f){const{props:p}=f;p&&_.extend(h,typeof p=="function"?p.call(this,e):p),l=f.component||l}},{props:{}});const u=l;s[0]={outer:!0,className:"dtable-custom-cell",children:A(u,{...h})}}),s}}),KS="";function _w(s,e){var a,l;typeof s=="boolean"&&(e=s,s=void 0);const t=this.state.checkedRows,n={},{canRowCheckable:i,allowCheckDisabled:r}=this.options,o=(c,h)=>{const u=i?i.call(this,c):!0;!u||!r&&u==="disabled"||!!t[c]===h||(h?t[c]=!0:delete t[c],n[c]=h)};if(s===void 0?(e===void 0&&(e=!ag.call(this)),(a=this.layout)==null||a.allRows.forEach(({id:c})=>{o(c,!!e)})):(Array.isArray(s)||(s=[s]),s.forEach(c=>{o(c,e??!t[c])})),Object.keys(n).length){const c=(l=this.options.beforeCheckRows)==null?void 0:l.call(this,s,n,t);c&&Object.keys(c).forEach(h=>{const u=i?i.call(this,h):!0;!u||!r&&u==="disabled"||(c[h]?t[h]=!0:delete t[h])}),this.setState({checkedRows:{...t}},()=>{var h;(h=this.options.onCheckChange)==null||h.call(this,n)})}return n}function bw(s){return this.state.checkedRows[s]??!1}function ag(){var i,r;const s=(i=this.layout)==null?void 0:i.allRows.length;if(!s)return!1;const e=this.getChecks().length,{canRowCheckable:t,allowCheckDisabled:n}=this.options;return t?e===((r=this.layout)==null?void 0:r.allRows.reduce((o,a)=>{const l=t?t.call(this,a.id):!0;return o+(!l||!n&&l==="disabled"?0:1)},0)):e===s}function ww(){var e;const s=new Set((e=this.layout)==null?void 0:e.allRows.map(t=>t.id));return Object.keys(this.state.checkedRows).filter(t=>s.has(t))}function Cw(s){const{checkable:e}=this.options;s===void 0&&(s=!e),e!==s&&this.setState({forceCheckable:s})}function lg(s,e,t=!1,n=void 0){return A(wi,{className:"dtable-checkbox",checked:s,disabled:t,label:n})}const cg='input[type="checkbox"],.dtable-checkbox',kw=Ze({name:"checkable",defaultOptions:{checkable:"auto",checkboxRender:lg},when:s=>!!s.checkable,options(s){const{forceCheckable:e}=this.state;return e!==void 0?s.checkable=e:s.checkable==="auto"&&(s.checkable=!!s.cols.some(t=>t.checkbox)),s},state(){return{checkedRows:{}}},methods:{toggleCheckRows:_w,isRowChecked:bw,isAllRowChecked:ag,getChecks:ww,toggleCheckable:Cw},i18n:{zh_cn:{checkedCountInfo:"已选择 {selected} 项",totalCountInfo:"共 {total} 项"},zh_tw:{checkedCountInfo:"已選擇 {selected} 項",totalCountInfo:"共 {total} 項"},en:{checkedCountInfo:"Selected {selected} items",totalCountInfo:"Total {total} items"}},footer:{checkbox(){const s=this.isAllRowChecked();return[A("div",{style:{paddingRight:"calc(3*var(--space))",display:"flex",alignItems:"center"},onClick:()=>this.toggleCheckRows(),children:lg(s,void 0,!1,this.options.checkboxLabel)})]},checkedInfo(s,e){const t=this.getChecks(),{checkInfo:n}=this.options;if(n)return[A(Se,{className:"dtable-check-info",content:n.call(this,t)})];const i=t.length,r=[];return i&&r.push(this.i18n("checkedCountInfo",{selected:i})),r.push(this.i18n("totalCountInfo",{total:e.allRows.length})),[A("div",{className:"dtable-check-info",children:r.join(", ")})]}},onCreate(){const{checkedRows:s}=this.options;s&&this.setState(e=>({checkedRows:{...e.checkedRows,...s.reduce((t,n)=>(t[n]=!0,t),{})}}))},onRenderCell(s,{row:e,col:t}){var c;const{id:n}=e,{canRowCheckable:i}=this.options,r=i?i.call(this,n):!0;if(!r)return s;const{checkbox:o}=t.setting,a=typeof o=="function"?o.call(this,n):o,l=this.isRowChecked(n);if(a){const h=(c=this.options.checkboxRender)==null?void 0:c.call(this,l,n,r==="disabled");s.push(h,{outer:!0,className:"has-checkbox"})}return l&&s.push({outer:!0,className:"is-checked"}),s},onRenderHeaderCell(s,{row:e,col:t}){var o;const{id:n}=e,{checkbox:i}=t.setting;if(typeof i=="function"?i.call(this,n):i){const a=this.isAllRowChecked(),l=(o=this.options.checkboxRender)==null?void 0:o.call(this,a,n);s.push(l,{outer:!0,className:"has-checkbox"})}return s},onHeaderCellClick(s){if(this.data.disableCheckable)return;const e=s.target;if(!e)return;const t=e.closest(cg);t&&this.toggleCheckRows(t.checked)},onCellClick(s,{rowID:e}){if(this.data.disableCheckable)return;const t=_(s.target);if(!t.length||t.closest("btn,a,button.not-checkable,.form-control,.btn").length)return;(t.closest(cg).not(".disabled").length||this.options.checkOnClickRow)&&this.toggleCheckRows(e)}}),hg=Ze({name:"store",defaultOptions:{store:!0},when:s=>!!s.store,data(){return{store:new gr(`DTable:${this.id}`)}}}),YS="",XS="";var ug=(s=>(s.unknown="",s.collapsed="collapsed",s.expanded="expanded",s.hidden="hidden",s.normal="normal",s))(ug||{});function Ya(s){const e=this.data.nestedMap.get(s);if(!e||e.state!=="")return e??{state:"normal",level:-1};if(!e.parent&&!e.children)return e.state="normal",e;const t=e.children&&this.state.nestedState[s];let n=!1,{parent:i}=e;for(;i;){const r=Ya.call(this,i);if(r.state!=="expanded"){n=!0;break}i=r.parent}return e.state=n?"hidden":t?"collapsed":e.children?"expanded":"normal",e.level=e.parent?Ya.call(this,e.parent).level+1:0,e}function Sw(s){return s!==void 0?Ya.call(this,s):this.data.nestedMap}function Dw(s,e){let{nestedState:t}=this.state;const{nestedMap:n}=this.data;if(s==="HEADER")if(e===void 0&&(e=!dg.call(this)),e){const i=n.entries();for(const[r,o]of i)o.state==="expanded"&&(t[r]=!0)}else t={};else{const i=Array.isArray(s)?s:[s];e===void 0&&(e=!t[i[0]]),i.forEach(r=>{const o=n.get(r);e&&(o!=null&&o.children)?t[r]=!0:delete t[r]})}this.update({dirtyType:"layout",state:{nestedState:{...t}}},()=>{const{onNestedChange:i,preserveNested:r}=this.options;i==null||i.call(this),r&&this.data.store.set("nestedState",t)})}function dg(){const s=this.data.nestedMap.values();for(const e of s)if(e.state==="expanded")return!1;return!0}function fg(s,e=1,t,n=0){var i;t||(t=[...s.keys()]);for(const r of t){const o=s.get(r);o&&(o.level===n&&(o.order=e++),(i=o.children)!=null&&i.length&&(e=fg(s,e,o.children,n+1)))}return e}function pg(s,e,t,n){const i=s.getNestedRowInfo(e);return!i||i.state===""||!i.children||i.children.forEach(r=>{n[r]=t,pg(s,r,t,n)}),i}function mg(s,e,t,n,i){var a;const r=s.getNestedRowInfo(e);if(!r||r.state==="")return;((a=r.children)==null?void 0:a.every(l=>{const c=!!(n[l]!==void 0?n[l]:i[l]);return t===c}))&&(n[e]=t),r.parent&&mg(s,r.parent,t,n,i)}const Xa="dtable-nested-toggle",Ew=Ze({name:"nested",plugins:[hg],requireAfter:["sortable"],defaultOptions:{nested:"auto",nestedParentKey:"parent",asParentKey:"asParent",nestedIndent:20,canSortTo(s,e){const{nestedMap:t}=this.data,n=t.get(s.id),i=t.get(e.id);return(n==null?void 0:n.parent)===(i==null?void 0:i.parent)},beforeCheckRows(s,e,t){if(!this.options.checkable||!(s!=null&&s.length)||this.options.noNestedCheck)return;const n={};return Object.entries(e).forEach(([i,r])=>{const o=pg(this,i,r,n);o!=null&&o.parent&&mg(this,o.parent,r,n,t)}),n}},options(s){return s.nested==="auto"&&(s.nested=!!s.cols.some(e=>e.nestedToggle)),s},when:s=>!!s.nested,data(){return{nestedMap:new Map,nestedRowMap:new Map}},state(){return{nestedState:{}}},methods:{getNestedInfo:Sw,toggleRow:Dw,isAllCollapsed:dg,getNestedRowInfo:Ya},onCreate(){let{defaultNestedState:s}=this.options;if(this.options.preserveNested){const e=this.data.store.get("nestedState");e&&(s=e)}if(s===!0){const{data:e,rowKey:t="id"}=this.options;Array.isArray(e)&&(s=e.reduce((n,i)=>(n[typeof i=="string"?i:i[t]]=!0,n),{}))}this.state.nestedState=s||{}},onMounted(){this.options.defaultNestedState===!0&&!this.options.preserveNested&&this.toggleRow("HEADER",!0)},beforeLayout(){this.data.nestedMap.clear(),this.data.nestedRowMap.clear()},onAddRow(s){this.data.nestedRowMap.set(s.id,s)},onAddRows(s){const{nestedMap:e,nestedRowMap:t}=this.data;s.forEach(r=>{var c,h;const o=e.get(r.id)??{state:"",level:0};let a=((c=r.data)==null?void 0:c[this.options.nestedParentKey??"parent"])??[];Array.isArray(a)||(a=[a]);let l;for(a=[...a];a.length;){let u=a.pop();if(u===void 0)continue;if(u=String(u),t.get(u)){l=u;break}}if(o.parent=l==="0"?void 0:l,(h=r.data)!=null&&h[this.options.asParentKey??"asParent"]&&(o.children=[]),e.set(r.id,o),l){let u=e.get(l);u||(u={state:"",level:0},e.set(l,u)),u.children||(u.children=[]),u.children.push(r.id)}});const n=new Map,i=s.length*100;return s=s.filter(r=>{const o=this.getNestedRowInfo(r.id);return n.set(r.id,o),o.state!=="hidden"}),fg(n),s.sort((r,o)=>{const a=n.get(r.id),l=n.get(o.id);return((a==null?void 0:a.order)??i+r.index)-((l==null?void 0:l.order)??i+o.index)}),s},onRenderCell(s,e){var c;const{row:t,col:n}=e,{id:i,data:r}=t,{nestedToggle:o,childLabel:a}=n.setting,l=this.getNestedRowInfo(i);if(a){const h=Number(r[this.options.nestedParentKey||"parent"]);if(!Number.isNaN(h)&&h>0){let u;typeof a=="string"?u=A("span",{className:"dtable-child-label label rounded-full size-sm gray-pale",children:Te(a,r)}):u=A(Se,{className:"dtable-child-label",content:a,generatorThis:e}),s.unshift(u)}}if(o&&(l.children||l.parent)&&s.push(((c=this.options.onRenderNestedToggle)==null?void 0:c.call(this,l,i,n,r))??A("a",{className:`${Xa} state${l.children?"":" is-no-child"}`,children:A("span",{className:"toggle-icon"})}),{outer:!0,className:`is-${l.state}`}),l.level){let{nestedIndent:h=o}=n.setting;h&&(h===!0&&(h=this.options.nestedIndent??12),s.push(A("div",{className:"dtable-nested-indent",style:{width:h*l.level+"px"}})))}return s},onRenderHeaderCell(s,{row:e,col:t}){var i;const{id:n}=e;return t.setting.nestedToggle&&s.push(((i=this.options.onRenderNestedToggle)==null?void 0:i.call(this,void 0,n,t,void 0))??A("a",{className:`${Xa} state`,children:A("span",{className:"toggle-icon"})}),{outer:!0,className:`is-${this.isAllCollapsed()?"collapsed":"expanded"}`}),s},onHeaderCellClick(s){const e=s.target;if(!(!e||!e.closest(`.${Xa}`)))return this.toggleRow("HEADER"),!0},onCellClick(s,{rowID:e}){const t=s.target;if(!(!t||!this.getNestedRowInfo(e).children||!t.closest(`.${Xa}`)))return this.toggleRow(e),!0}});function ju(s,{row:e,col:t}){const{data:n}=e,i=n?n[t.name]:void 0;if(!(i!=null&&i.length))return s;const{avatarClass:r="rounded-full",avatarKey:o=`${t.name}Avatar`,avatarCodeKey:a,avatarNameKey:l=`${t.name}Name`}=t.setting;let{avatarProps:c={}}=t.setting;typeof c=="function"&&(c=c(t,e));const h=(n?n[l]:i)||s[0],u={size:"xs",src:n?n[o]:void 0,text:h,code:a?n?n[a]:void 0:i,...c,className:ee(r,c.className,"flex-none")};if(s[0]=A(bi,{...u}),t.type==="avatarBtn"){const{avatarBtnProps:f}=t.setting,p=typeof f=="function"?f(t,e):f;s[0]=A("button",{type:"button",className:"btn btn-avatar",...p,children:[s[0],A("div",{children:h})]})}else t.type==="avatarName"&&(s[0]=A("div",{className:"flex items-center gap-1",children:[s[0],A("span",{children:h})]}));return s}const Aw=Ze({name:"avatar",colTypes:{avatar:{onRenderCell:ju},avatarBtn:{onRenderCell:ju},avatarName:{onRenderCell:ju}}},{buildIn:!0}),Tw=Ze({name:"sort-type",defaultOptions:{sortType:!0},when:s=>!!s.sortType&&!s.sort,onRenderHeaderCell(s,e){const{col:t}=e,{setting:n}=t;let{sortType:i}=n;if(t.setting.sort!==void 0||i===!1)return s;const{sortLink:r,orderBy:o}=this.options;if(o&&o[t.name]!==void 0&&(i=o[t.name]),i){const a=i===!0?"none":i,l=A("div",{className:`dtable-sort dtable-sort-${a}`});s.push({outer:!0,attrs:{"data-sort":a}});let{sortLink:c=r}=n;if(c){const h=a==="asc"?"desc":"asc";typeof c=="function"&&(c=c.call(this,t,h,a)),typeof c=="string"&&(c={url:c});const{url:u,...f}=c;s[0]=A("a",{className:"dtable-sort-link",href:Te(u,{...n,sortType:h}),...f,children:[typeof s[0]!="object"||P.isValidElement(s[0])?s[0]:t.name,l]})}else s.push(l)}return s}},{buildIn:!0}),Wu=s=>{s.length!==1&&s.forEach((e,t)=>{!t||e.border!==void 0||e.setting.group===s[t-1].setting.group||(e.border="left")})},$w=Ze({name:"group",defaultOptions:{groupDivider:!0},when:s=>!!s.groupDivider,onLayout(s){if(!this.options.groupDivider)return;const{cols:e}=s;Wu(e.left.list),Wu(e.center.list),Wu(e.right.list)}}),tD="",Iw=Ze({name:"header-group",defaultOptions:{headerGroup:!0},data(){return{headerGroups:new Map}},when:s=>!!s.headerGroup,beforeLayout(s){const{headerGroups:e}=this.data;e.clear();const{cols:t}=s;if(!(t!=null&&t.length))return;const n={};return t.forEach((i,r)=>{const{headerGroup:o}=i;if(!o){n[i.name]=r;return}let a=e.get(o);a?a.cols.push(i.name):(a={cols:[i.name],index:r},e.set(o,a)),n[i.name]=a.index+a.cols.length/t.length}),t.sort((i,r)=>n[i.name]-n[r.name]),{headerHeight:!s.headerHeight&&s.rowHeight?s.rowHeight*2:void 0,cols:t}},onRenderHeaderCell(s,{col:e}){const{headerGroup:t}=e.setting;if(t){const n=this.data.headerGroups.get(t),i=this.layout.headerHeight/2;if(e.name===n.cols[0]){const r=n.cols.reduce((a,l)=>{var c;return a+(((c=this.getColInfo(l))==null?void 0:c.realWidth)??0)},0),o={height:i-1,width:r-1};s.push(A("div",{class:"dtable-header-group",style:o,children:t}))}s.push({className:"dtable-header-as-group",style:{paddingTop:i}})}return s}}),Bw=Ze({name:"cellspan",when:s=>!!s.getCellSpan,data(){return{cellSpanMap:new Map,overlayCellSet:new Set}},onLayout(s){const{getCellSpan:e}=this.options;if(!e)return;const{cellSpanMap:t,overlayCellSet:n}=this.data,{rows:i,cols:r,rowHeight:o}=s;t.clear(),n.clear();const a=(l,c,h)=>{const{index:u}=c;l.forEach((f,p)=>{const{index:g}=f,y=`C${g}R${u}`;if(n.has(y))return;const v=e.call(this,{row:c,col:f});if(!v)return;const b=Math.min(v.colSpan||1,l.length-p),w=Math.min(v.rowSpan||1,i.length-h);if(b<=1&&w<=1)return;let S=0;for(let E=0;E<b;E++){S+=l[p+E].realWidth;for(let $=0;$<w;$++){const B=`C${g+E}R${u+$}`;B!==y&&n.add(B)}}t.set(y,{colSpan:b,rowSpan:w,width:S,height:o*w})})};i.forEach((l,c)=>{["left","center","right"].forEach(h=>{a(r[h].list,l,c)})})},onRenderCell(s,{row:e,col:t}){const n=`C${t.index}R${e.index}`;if(this.data.overlayCellSet.has(n))s.push({outer:!0,style:{display:"none",className:"cellspan-overlayed-cell"}});else{const i=this.data.cellSpanMap.get(n);i&&s.push({outer:!0,style:{width:i.width,height:i.height}})}return s}}),Ur=Ze({name:"mousemove",events:{click(s){this.data.ignoreNextClick&&(s.preventDefault(),this.data.ignoreNextClick=void 0)},mousedown(){this.data.ignoreNextClick&&clearTimeout(this.data.ignoreNextClick)},mousemove(s){this.data.mmRafID&&cancelAnimationFrame(this.data.mmRafID),this.data.mmRafID=requestAnimationFrame(()=>{this.emitCustomEvent("mousemovesmooth",s),this.data.mmRafID=0}),s.preventDefault()},document_mousemove(s){this.data.dmmRafID&&cancelAnimationFrame(this.data.dmmRafID),this.data.dmmRafID=requestAnimationFrame(()=>{this.emitCustomEvent("document_mousemovesmooth",s),this.data.mmRafID=0})}},methods:{ignoreNextClick(s=10){this.data.ignoreNextClick&&clearTimeout(this.data.ignoreNextClick),this.data.ignoreNextClick=window.setTimeout(()=>{this.data.ignoreNextClick=void 0},s)}}});function Nw(){var S,E,$,B;const{scrollToMouse:s}=this.data;if(!s)return this.stopScrollToMouse();const{position:e,startTime:t,delay:n}=s;if(!e||Date.now()-t<n)return;const i=(E=(S=this.ref.current)==null?void 0:S.querySelector(".dtable-body"))==null?void 0:E.getBoundingClientRect();if(!i)return;const r=(B=($=this.ref.current)==null?void 0:$.querySelector(".dtable-scroll-center"))==null?void 0:B.getBoundingClientRect(),{maxStep:o,detectPadding:a,speed:l,side:c}=s,{x:h,y:u}=e,{top:f,bottom:p}=i,{left:g,right:y}=r||i;let v=0;h<g-a?v=-Math.max(o,g-a-h):h>y-a&&(v=Math.max(o,h-(y-a)));let b=0;if(u<f-a?b=-Math.max(o,f-a-u):u>p-a&&(b=Math.max(o,u-(p-a))),c){const N=new Set((Array.isArray(c)?c:[c]).reduce((L,V)=>(V==="x"?L.push("left","right"):V==="y"?L.push("top","bottom"):L.push(V),L),[]));(!N.has("left")&&v<0||!N.has("right")&&v>0)&&(v=0),(!N.has("top")&&b<0||!N.has("bottom")&&b>0)&&(b=0)}const w={};v!==0&&(w.scrollLeft=this.layout.scrollLeft+l*v),b!==0&&(w.scrollTop=this.layout.scrollTop+l*b),this.scroll(w)}const Uu=Ze({name:"autoscroll",plugins:[Ur],events:{document_mousemovesmooth(s){if(!this.data.scrollToMouse)return;const{clientX:e,clientY:t}=s;this.data.scrollToMouse.position={x:e,y:t}}},methods:{scrollTo({col:s,row:e,extra:t=2}){const n=this.getColInfo(s),i=this.getRowInfo(e);if(!n&&!i)return!1;const r={},{layout:o}=this;if(n){const{scrollLeft:a,cols:l}=o,c=n.left+n.realWidth;n.left<a?r.scrollLeft=n.left-t:c>l.center.width+a&&(r.scrollLeft=c-l.center.width+t)}if(i){const{scrollTop:a,rowHeight:l,rowsHeight:c}=o,h=i.top+l;i.top<a?r.scrollTop=i.top-t:h>c+a&&(r.scrollTop=h-c+t)}return this.scroll(r),!0},startScrollToMouse(s){const e={interval:60,speed:.5,delay:200,maxStep:this.options.rowHeight,onlyInside:!1,detectPadding:30,startTime:Date.now(),...s};this.data.scrollToMouse=e,clearInterval(this.data.scrollToTimer),this.data.scrollToTimer=window.setInterval(Nw.bind(this),e.interval)},stopScrollToMouse(){clearInterval(this.data.scrollToTimer),this.data.scrollToMouse=void 0}},onUnmounted(){clearInterval(this.data.scrollToTimer)}}),oD="",Fw=Ze({name:"sortable",defaultOptions:{sortable:!0},when:s=>!!s.sortable,plugins:[Ur,Uu],resetState:!0,state(){return{rowOrders:void 0,sortingFrom:void 0,sortingPos:void 0,sortingTo:void 0,sortingSide:void 0}},events:{click(s){s.target.closest(".dtable-sort-link")&&(this.state.rowOrders=void 0)},mousedown(s){var a;if(this.data.disableSortable)return;const{sortHandler:e=".dtable-cell"}=this.options;if(!_(s.target).closest(e).length)return;const i=this.getPointerInfo(s);if(!i||i.rowID==="HEADER")return;const r=this.getRowInfo(i.rowID);if(!r||((a=this.options.onSortStart)==null?void 0:a.call(this,r,s))===!1)return;s.preventDefault();const o=s.clientY;this.data.sortableInfo={from:r,offset:o-i.cellElement.getBoundingClientRect().top,startMouseY:o,lastMouseY:o}},document_mouseup(s){var n;const{sortableInfo:e}=this.data;if(!e)return;this.stopScrollToMouse();const t=this.getSortingState(s);if(t){let i,r;const{sortingFrom:o,sortingTo:a,sortingSide:l}=t;if(a&&l){const c=this.layout.rows.map(p=>p.id),h=[...c],u=o.index,f=a.index;if(!(u===f+1&&l==="after")&&!(u===f-1&&l==="before")){const p=c.splice(u,1);c.splice(f,0,p[0]),i={},r=[],c.forEach((g,y)=>{i[g]=y,r.push(g)}),(h.join()===r.join()||((n=this.options.onSort)==null?void 0:n.call(this,o,a,l,r))===!1)&&(i=void 0,r=void 0)}}(a||Math.abs(e.lastMouseY-e.startMouseY)>4)&&this.ignoreNextClick(),this.disableAnimation(),this.update({dirtyType:"layout",state:c=>_.extend({sortingFrom:void 0,sortingPos:void 0,sortingTo:void 0,sortingSide:void 0},i?{rowOrders:{...c.rowOrders,...i}}:null)},()=>{var c;(c=this.options.onSortEnd)==null||c.call(this,o,a,l,r),setTimeout(()=>{this.data.disableCheckable=void 0},50)})}this.data.sortableInfo=void 0},document_mousemovesmooth(s){const{sortableInfo:e}=this.data;if(!e)return;const t=this.getSortingState(s);t&&(e.state||(this.startScrollToMouse({side:"y"}),this.data.disableCheckable=!0),e.lastMouseY=s.clientY,e.state=t,this.setState(t))}},methods:{getSortingState(s){var B;const{disableSortable:e,sortableInfo:t}=this.data;if(e||!t)return;const{headerHeight:n,footerHeight:i,visibleRows:r,scrollTop:o,rowHeight:a}=this.layout,l=this.element.getBoundingClientRect(),c=l.width,h=l.height-n-i,u=s.clientX-l.left,f=s.clientY-l.top-n;if(u<0||u>c||f<0||f>h)return t.state;const p=f+o,g=r.find(N=>N.top<=p&&N.top+a>p);if(!g)return t.state;const y=t.from,v=g.id!==y.id?g.id:void 0,b=v?this.getRowInfo(v):void 0,w=f,S=p<g.top+a/2?"before":"after";return b&&((B=this.options.canSortTo)==null?void 0:B.call(this,y,b,S))!==!1?{sortingFrom:y,sortingPos:w,sortingTo:b,sortingSide:S}:{sortingFrom:y,sortingPos:w,sortingTo:void 0,sortingSide:void 0}}},onAddRows(s){const{rowOrders:e}=this.state;if(!e)return;const t=s.length*100;return s=s.sort((n,i)=>{const r=e[n.id]??t+n.index,o=e[i.id]??t+i.index;return r-o}),s},beforeRender(s){const{sortingFrom:e}=this.state,{visibleRows:t}=s;e&&(t.some(n=>n.id===e.id)||(s.visibleRows=[...t,e]),s.className=ee(s.className,"dtable-sorting"))},onRenderCell(s,e,t){const{sortingFrom:n,sortingPos:i,sortingTo:r,sortingSide:o}=this.state;if(!n)return s;const a=e.row,l={},c=[];if(n.id===a.id)l.top=i-this.data.sortableInfo.offset+((t.top??a.top)-(a.top-this.layout.scrollTop)),c.push("is-sorting-from");else if(r){const h=r.id===a.id;h&&c.push(`text-primary is-sorting-to is-sorting-to-${o}`),n.index>a.index&&(h&&o==="before"||a.index>r.index)?c.push("is-sorting-before"):n.index<a.index&&(h&&o==="after"||a.index<r.index)&&c.push("is-sorting-after")}return c.length&&s.push({outer:!0,style:l,className:c}),s}}),gg=Ze({name:"pager",state(){const s=this.props.localPager;if(s){const{page:e=1,recTotal:t=0,recPerPage:n=20,pageTotal:i=1}=this.props.footPager||{};return{pager:{page:e,recTotal:t,recPerPage:n,pageTotal:i,...typeof s=="object"?s:null}}}return{}},footer:{pager(){let{footPager:s}=this.options;const{localPager:e}=this.options;return s?(s={items:[{type:"link",page:"first",icon:"icon-first-page"},{type:"link",page:"prev",icon:"icon-angle-left"},{type:"info",text:"{page}/{pageTotal}"},{type:"link",page:"next",icon:"icon-angle-right"},{type:"link",page:"last",icon:"icon-last-page"}],...s},Array.isArray(s.items)&&s.items.forEach(t=>{t.type==="size-menu"&&t.caret===void 0&&(t.caret="up")}),this.options.localPager&&(Object.assign(s,{...typeof e=="object"?e:null,...this.state.pager,recTotal:this.layout.allRows.length,useState:!0}),s.onChangePageInfo=t=>{this.update({dirtyType:"layout",state:n=>({pager:{...n.pager,...t}})})}),[A(Ir,{...s})]):[]}},onAddRows(s){const{localPager:e}=this.options;if(e){const{page:t=1,recPerPage:n=20}={...typeof e=="object"?e:null,...this.state.pager},i=(t-1)*n,r=Math.min(t*n,s.length);return s.slice(i,r)}}}),Pw=Object.freeze(Object.defineProperty({__proto__:null,NestedRowState:ug,avatar:Aw,cellspan:Bw,checkable:kw,custom:og,group:$w,headerGroup:Iw,nested:Ew,pager:gg,renderDatetime:eg,renderDatetimeCell:rg,renderFormat:Ou,renderFormatCell:ng,renderHtmlCell:Hu,renderLink:zu,renderLinkCell:tg,renderMapCell:sg,renderStyleMapCell:ig,rich:gw,sort:vw,sortType:Tw,sortable:Fw},Symbol.toStringTag,{value:"Module"}));class Gs extends Ee{setOptions(e,t){return e=super.setOptions(e,t),e.parent||(e.parent=this.element),e}}Gs.NAME="DTable",Gs.Component=Li,Gs.definePlugin=Ze,Gs.removePlugin=y0,Gs.getPlugin=v0,Gs.plugins=Pw;const cD="",hD="",uD="",dD="",fD="",pD="",mD="";class Vu extends tt{_getClassName(e){return["kanban-header-col",e.className,e.subCols?"has-subs":"",e.parentName!==void 0?"is-sub":""]}_getProps(e){const{width:t,color:n,name:i,gapLeft:r,gapRight:o}=e;return Ie(super._getProps(e),{style:{"--kanban-col-color":n,"--kanban-col-width":nt(t),"--kanban-col-gap-left":nt(r),"--kanban-col-gap-right":nt(o)},"z-col":i})}_getChildren(e){const{prefix:t,prefixClass:n,title:i,titleClass:r,titleAlign:o="center",subtitle:a,subtitleClass:l,icon:c,trailingIcon:h,actions:u,subCols:f}=e;return[A("div",{className:`kanban-header-col-wrapper is-align-${o}`,children:[A("div",{className:"kanban-header-title",children:[c?A(Re,{className:"as-leading-icon",icon:c},"icon"):null,t?A("span",{className:ee("as-prefix",n),children:A(Se,{content:t})},"prefix"):null,i?A("span",{className:ee("as-title",r),title:typeof i=="string"?i:void 0,children:A(Se,{content:i})},"title"):null,a?A("span",{className:ee("as-subtitle",l),children:A(Se,{content:a})},"subtitle"):null,h?A(Re,{className:"as-trailing-icon",icon:h},"trailingIcon"):null]},"title"),Xe.render(u,[e],{key:"actions",className:"kanban-header-col-actions",size:"sm"},this)]},"wrapper"),f?A("div",{className:"kanban-header-sub-cols",children:f.map((p,g)=>A(Vu,{index:g,...p},p.name))},"subs"):null]}}class Mw extends ke{constructor(){super(...arguments),this._ref=Ce()}componentDidMount(){this._ref.current&&(this._sticky=Lo.ensure(this._ref.current,{scrollContainer:".kanban-list"}))}componentWillUnmount(){var e;(e=this._sticky)==null||e.destroy()}render(e){return A("div",{className:"kanban-header",ref:this._ref,children:[A("div",{className:"kanban-header-lane-name"},"name"),A("div",{className:"kanban-header-cols",children:e.cols.map((t,n)=>A(Vu,{index:n,...t},t.name))},"cols")]})}}class yg extends ke{constructor(){super(...arguments),this._listRef=Ce(),this._renderItem=e=>{const{itemRender:t,lane:n,name:i}=this.props;return t.call(this,{item:e,lane:n,col:i})},this._handleScroll=e=>{const{current:t}=this._listRef;t&&_(t).trigger("laneColScroll",e)}}componentDidMount(){const{current:e}=this._listRef;e&&(this._ob=new ResizeObserver(t=>{_(this._listRef.current).trigger("laneColResize",t[0])}),this._ob.observe(e))}componentWillUnmount(){var e;(e=this._ob)==null||e.disconnect()}render(e){const{items:t}=e,{width:n,color:i,content:r,contentClass:o,itemRender:a,itemGap:l,watchSize:c,name:h,lane:u,itemCountPerRow:f,gapLeft:p,gapRight:g,laneColClass:y}=e,v={"--kanban-col-color":i,"--kanban-col-width":nt(n),"--kanban-col-gap-left":nt(p),"--kanban-col-gap-right":nt(g)};return A("div",{className:ee("kanban-lane-col",y),style:v,"z-lane":u,"z-col":h,children:[r?A("div",{className:ee("kanban-col-content",o),children:A(Se,{content:r,generatorThis:this,generatorArgs:[e]})}):null,A("div",{className:"kanban-items scrollbar-thin scrollbar-hover",onScroll:this._handleScroll,children:A(Hi,{forwardRef:c?this._listRef:void 0,itemProps:{className:"kanban-item card-list-item"},items:t,itemRender:a?this._renderItem:void 0,countPerRow:f,gap:l},"list")})]})}}yg.defaultProps={watchSize:!0};class Rw extends tt{_getClassName(e){const{className:t,index:n,maxHeight:i,height:r}=e;return["kanban-lane",t,{"is-first":!n,"is-auto-height":!i&&(!r||r==="auto")}]}_getProps(e){const{height:t,minHeight:n,maxHeight:i,color:r,name:o,gapTop:a,gapBottom:l}=e;return Ie(super._getProps(e),{style:{"--kanban-lane-color":r,height:nt(t),minHeight:nt(n),maxHeight:nt(i),"--kanban-col-gap-top":nt(a),"--kanban-col-gap-bottom":nt(l)},"z-lane":o})}_renderCol(e,t,n,i,r){if(r){const o=r(e,t);o&&(t={...t,...o})}return A(yg,{itemRender:n,lane:e.name,items:i[t.name],...t},t.name)}_getChildren(e){const{title:t,titleClass:n,actions:i,cols:r,items:o={},hideName:a,itemRender:l,getLaneCol:c}=e;return[a?null:A("div",{className:"kanban-lane-name",children:[Xe.render(i,[e],{key:"actions",className:"kanban-lane-actions",size:"sm"},this),A("div",{className:ee("kanban-lane-title",n),title:typeof t=="string"?t:void 0,children:A(Se,{content:t})},"title")]},"name"),A("div",{className:"kanban-lane-cols",children:r.reduce((h,u)=>(u.subCols?u.subCols.forEach(f=>{h.push(this._renderCol(e,f,l,o,c))}):h.push(this._renderCol(e,u,l,o,c)),h),[])},"cols")]}}function Lw(s){const{lanes:e,cols:t,items:n={},itemRender:i,hideLaneName:r,getLaneCol:o}=s;return A("div",{className:"kanban-body",children:e.map((a,l)=>A(Rw,{index:l,cols:t,items:n[a.name],hideName:r,itemRender:i,getLaneCol:o,...a},a.name))})}const Qt=12,zw={left:"right",right:"left",top:"bottom",bottom:"top","":""},us=({from:s,to:e,fromKanban:t,toKanban:n})=>`${t?`${t}_`:""}${s}-${n?`${n}_`:""}${e}`;function vg(s,e){return e==="top"?{x:s.x+s.width/2,y:s.y}:e==="left"?{x:s.x,y:s.y+s.height/2}:e==="right"?{x:s.x+s.width,y:s.y+s.height/2}:{x:s.x+s.width/2,y:s.y+s.height}}function Ow(s,e){return(s.x-e.x)*(s.x-e.x)+(s.y-e.y)*(s.y-e.y)}function Hw(s,e,t,n){const i=t?[t]:["left","right","top","bottom"],r=n?[n]:["left","right","top","bottom"];let o=Number.MAX_SAFE_INTEGER,a={x:0,y:0},l={x:0,y:0};return i.forEach(c=>{r.forEach(h=>{const u=vg(s,c),f=vg(e,h),p=Ow(u,f)*(zw[c]===h?1:2);p<o&&(o=p,t=c,n=h,a=u,l=f)})}),{fromSide:t,toSide:n,fromPos:a,toPos:l}}function jw(s,e){return{x:(s.x+e.x)/2,y:(s.y+e.y)/2}}function xg(s,e){return{x:Math.min(s.x,e.x),y:Math.min(s.y,e.y),width:Math.abs(s.x-e.x),height:Math.abs(s.y-e.y)}}function _g(s,e,t){const n={id:`marker-${e}-${t}-${s}`,orient:"auto",markerUnits:"strokeWidth",refX:e==="start"?0:6,refY:3,markerWidth:6,markerHeight:6,path:{d:"",fill:"currentColor"}};return s==="arrow"?e==="start"?n.path.d="M6,0 L6,6 L0,3 z":n.path.d="M0,0 L0,6 L6,3 z":s==="dot"?n.path.d="M3,3 m-3,0 a 3,3 0 1,1 6,0 a 3,3 0 1,1 -6,0":s==="square"?n.path.d="M0,0 L0,6 L6,6 L6,0 z":s==="diamond"&&(n.path.d="M3,0 L6,3 L3,6 L0,3 z"),n}function Ww(s,e,t,n,i="curve",r=2,o=1){const{x:a,y:l,width:c,height:h}=xg(s,e),u=Qt-a,f=Qt-l;if(i==="curve"){const p=c*(1+Math.max(-.3,Math.min(.3,1-c/50)))*o,g=h*(1+Math.max(-.3,Math.min(.3,1-h/50)))*o,y=r*5,v={a1x:s.x+(t==="left"?-y:t==="right"?y:0),a1y:s.y+(t==="top"?-y:t==="bottom"?y:0),ax:s.x+(t==="left"?-p:t==="right"?p:0),ay:s.y+(t==="top"?-g:t==="bottom"?g:0),bx:e.x+(n==="left"?-(p-y):n==="right"?p-y:0),by:e.y+(n==="top"?-(g-y):n==="bottom"?g-y:0),b1x:e.x+(n==="left"?-y:n==="right"?y:0),b1y:e.y+(n==="top"?-y:n==="bottom"?y:0)};return`M ${s.x+u} ${s.y+f} L ${v.a1x+u} ${v.a1y+f} C ${v.ax+u} ${v.ay+f} ${v.bx+u} ${v.by+f} ${v.b1x+u} ${v.b1y+f} L ${e.x+u} ${e.y+f}`}if(i==="fold"){const p=jw(s,e),g=c/2,y=h/2,v={ax:s.x+(t==="left"?-g:t==="right"?g:0),ay:s.y+(t==="top"?-y:t==="bottom"?y:0),bx:e.x+(n==="left"?-g:n==="right"?g:0),by:e.y+(n==="top"?-y:n==="bottom"?y:0)};return`M ${s.x+u} ${s.y+f} L ${v.ax+u} ${v.ay+f} L ${p.x+u} ${p.y+f} L ${v.bx+u} ${v.by+f} L ${e.x+u} ${e.y+f}`}return`M ${s.x+u} ${s.y+f} L ${e.x+u} ${e.y+f}`}function Uw(s){const{fromRect:e,toRect:t}=s,n=us(s),i={x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top},r={x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top},{fromSide:o,toSide:a,fromPos:l,toPos:c}=Hw(i,r),h=xg(l,c),{x:u,y:f,width:p,height:g}=h;l.x+=Qt-u,l.y+=Qt-f,c.x+=Qt-u,c.y+=Qt-f;const{weight:y=1.5,fromPoint:v,toPoint:b="arrow"}=s,w={left:`${0-Qt}px`,top:`${0-Qt}px`,width:`${p+2*Qt}px`,height:`${g+2*Qt}px`},S={"stroke-width":y,fill:"transparent",stroke:"currentColor","stroke-linejoin":"round","marker-start":v&&v!=="none"?`url(#marker-start-${n}-${v})`:void 0,"marker-end":b&&b!=="none"?`url(#marker-end-${n}-${b})`:void 0,d:Ww(l,c,o,a,s.shape,y)},E={"stroke-width":y+5,"stroke-linejoin":"round",fill:"transparent",stroke:"currentColor",d:S.d,class:"opacity-0"},$={width:p+2*Qt,height:g+2*Qt},B=[];return s.lineStyle==="dashed"?S["stroke-dasharray"]=`${y*3} ${y*3}`:s.lineStyle==="dotted"&&(S["stroke-dasharray"]=`${y} ${y}`),v&&v!=="none"&&B.push(_g(v,"start",n)),b&&b!=="none"&&B.push(_g(b,"end",n)),{x:u,y:f,width:p,height:g,fromSide:o,toSide:a,fromPos:l,toPos:c,nodeStyle:w,svgPathProps:S,svgPathBackProps:E,svgProps:$,markers:B,padding:Qt}}class bg extends ke{constructor(){super(...arguments),this.state={},this._handleMouseHover=e=>{this.setState({hover:e.type==="mouseenter"})},this._onDelete=()=>{var e;(e=this.props.onDelete)==null||e.call(this,this.props)}}render(e,t){const{text:n,textSize:i,color:r,onDelete:o,weight:a=1.5,from:l,to:c}=e,{hover:h}=t,{x:u,y:f,padding:p,width:g,height:y,svgProps:v,markers:b,svgPathProps:w,svgPathBackProps:S,fromPos:E}=Uw(e);return A("div",{className:ee("kanban-link",h?"is-hover":""),style:{left:u,top:f,width:g,height:y,color:r,"--kanban-link-weight":a},"z-from":l,"z-to":c,onMouseEnter:o?this._handleMouseHover:void 0,onMouseLeave:o?this._handleMouseHover:void 0,children:[A("svg",{...v,xmlns:"http://www.w3.org/2000/svg",version:"1.1",children:[b.length?A("defs",{children:b.map(({path:$,id:B,...N})=>A("marker",{...N,id:B,children:A("path",{...$})},B))}):null,A("path",{...S}),A("path",{...w})]}),A("div",{className:"kanban-link-start-point",style:{left:E.x-p,top:E.y-p}}),o?A("div",{className:"kanban-link-delete-btn",children:A("button",{type:"button",className:"btn rounded-full size-sm square primary",onClick:this._onDelete,children:A("i",{className:"close"})})}):null,n?A("div",{className:"kanban-link-text",style:{fontSize:`${i||12}px`},children:n}):null]})}}const Vr=".kanban";class Vw extends ke{constructor(){super(...arguments),this._ref=Ce(),this.state={}}componentDidMount(){const e=this._ref.current,{container:t=".kanban"}=this.props,n=e.closest(t),i=_(n);this._container=n,this._multiKanban=i.find(".kanban").length>1;const r=".kanban-item,.kanban-link-editor-from";i.on(`mouseenter${Vr}`,r,o=>{if(this.state.dragPos)return;clearTimeout(this._leaveTimer);const a=_(o.target).closest(r),l=a.z("key");this.state.from===l||a.hasClass("is-dragging")||this.setState({from:l,fromKanban:this._multiKanban?a.closest(".kanban").z("key"):void 0,to:void 0,fromRect:this._getRect(a.children()[0]),dragPos:void 0})}).on(`mouseleave${Vr}`,r,()=>{this.state.dragPos||(clearTimeout(this._leaveTimer),this._leaveTimer=window.setTimeout(()=>{this._cancelHover(),this._leaveTimer=0},200))}).on(`dragstart${Vr}`,".kanban-item",()=>{this.state.dragPos||this._cancelHover()}).on(`laneColScroll${Vr}`,o=>{const{from:a}=this.state;a&&this.setState({fromRect:this._getRect(_(o.target).find(`.kanban-item[z-key="${a}"]`).children()[0])})}),this._moveable=new wr(e,{selector:".kanban-link-editor-point",move:"none",onMoveStart:()=>{if(!this.state.from)return!1;i.addClass("is-adding-link")},onMove:o=>{const{top:a,left:l}=n.getBoundingClientRect(),c={left:o.clientX-l+n.scrollLeft,top:o.clientY-a+n.scrollTop};let h,u,f;const p=_(o.target).closest(r);p.length&&h!==this.state.from&&(h=p.attr("z-key"),f=this._multiKanban?p.closest(".kanban").z("key"):void 0,u=this._getRect(p.children()[0])),this.setState({dragPos:c,to:h,toKanban:f,toRect:u})},onMoveEnd:()=>{const{from:o,fromKanban:a,to:l,toKanban:c}=this.state,{onAddLink:h}=this.props;(o!==l||a!==c)&&h&&o!==void 0&&l!==void 0&&(h==null||h.call(this,{from:o,fromKanban:a,to:l,toKanban:c})),this._cancelHover(),i.removeClass("is-adding-link")}})}componentWillUnmount(){var t;const e=(t=this._ref.current)==null?void 0:t.closest(".kanban");e&&_(e).off(Vr),this._raf&&cancelAnimationFrame(this._raf)}_getRect(e){const t=e.getBoundingClientRect(),n=this._container,{top:i,left:r}=n.getBoundingClientRect();return{left:t.left-r+n.scrollLeft,top:t.top-i+n.scrollTop,width:t.width,height:t.height}}_cancelHover(){this.setState({from:void 0,to:void 0,fromRect:void 0,dragPos:void 0})}_renderLink(e){const{fromRect:t,toRect:n,from:i,to:r="",dragPos:o}=e;if(!t||!i||!o)return null;const a=n?{left:n.left,top:n.top,right:n.left+n.width,bottom:n.top+n.height}:{left:o.left,top:o.top,right:o.left,bottom:o.top};return A(bg,{from:i,to:r,lineStyle:"dotted",color:"var(--color-primary-500)",fromRect:{left:t.left,top:t.top,right:t.left+t.width,bottom:t.top+t.height},toRect:a},"link")}render(e,t){const{from:n,fromRect:i,to:r,toRect:o}=t;let a,l;return n&&i&&(a=A("div",{className:"kanban-link-editor-from not-moveable","z-key":n,style:i,children:[A("div",{className:"kanban-link-editor-point is-left"}),A("div",{className:"kanban-link-editor-point is-top"}),A("div",{className:"kanban-link-editor-point is-right"}),A("div",{className:"kanban-link-editor-point is-bottom"})]})),r&&o&&(l=A("div",{className:"kanban-link-editor-to","z-key":r,style:o})),A("div",{className:ee("kanban-link-editor"),ref:this._ref,children:[a,l,this._renderLink(t)]})}}const Ku=".kanban";class wg extends ke{constructor(){super(...arguments),this._ref=Ce(),this._watchSet=new Set,this.state={layout:{},scrollTop:0,scrollLeft:0}}componentDidMount(){var i;const{container:e=".kanban"}=this.props,t=(i=this._ref.current)==null?void 0:i.closest(e),n=_(t);this._multiKanban=n.find(".kanban").length>1,n.on(`laneColResize${Ku} laneColScroll${Ku}`,()=>{this._tryUpdateLayout()}),this._container=t,this._tryUpdateLayout()}componentWillUnmount(){const e=this._container;e&&_(e).off(Ku),this._raf&&cancelAnimationFrame(this._raf)}componentDidUpdate(e){(e.links!==this.props.links||e.filters!==this.props.filters)&&this._tryUpdateLayout()}_tryUpdateLayout(){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._updateLayout(),this._raf=0})}_updateLayout(){const e=[...this._watchSet],t=this._container,n=_(t),{top:i,left:r}=t.getBoundingClientRect(),o=t.scrollTop-i,a=t.scrollLeft-r,l={};e.forEach(c=>{const[h,u]=c.split("_"),f=n.find(`${this._multiKanban?`.kanban[z-key="${h}"] `:""}.kanban-item[z-key="${u}"]`).children()[0];if(f&&ur(f,{container:".kanban-lane-col"})){const{top:p,left:g,bottom:y,right:v}=f.getBoundingClientRect();l[c]={top:p+o,left:g+a,bottom:y+o,right:v+a}}}),this.setState({layout:l})}_renderLink(e){const{layout:t}=this.state,{from:n,fromKanban:i="",to:r,toKanban:o=""}=e,a=`${i}_${n}`,l=`${o}_${r}`,c=t[a],h=t[l];return this._watchSet.add(a),this._watchSet.add(l),!c||!h?null:A(bg,{...e,fromRect:c,toRect:h,onDelete:this.props.onDeleteLink},`${n}-${r}`)}_renderLinks(e){const{links:t,filters:n}=e,i=new Set(n),r=o=>{const{from:a,to:l,fromKanban:c="",toKanban:h=""}=o;return this._multiKanban?i.has(`${c}_${a}`)||i.has(`${h}_${l}`)||i.has(c)||i.has(h)||i.has(us(o)):i.has(a)||i.has(l)||i.has(`${a}-${l}`)};return t.reduce((o,a)=>{if(!n||r(a)){const l=this._renderLink(a);l&&o.push(l)}return o},[])}_renderEditor(e){const{editLinks:t,onAddLink:n,container:i}=e;return t?A(Vw,{container:i,onAddLink:n},"editor"):null}render(e){return this._watchSet.clear(),A("div",{className:"kanban-links",ref:this._ref,children:[this._renderLinks(e),this._renderEditor(e)]})}}function Kw(s,e,t){if(!s||!s.length)return[];const{getCol:n,colProps:i,itemCountPerRow:r,itemGap:o}=e;let a=!1;const l=[],c=new Map;return s=s.reduce((h,u,f)=>{if(u=Ie({itemGap:o,itemCountPerRow:r},i,u),n){const p=n.call(this,u);p!==!1&&(u=p||u)}return u.deleted||(typeof u.order=="number"?a=!0:u.order=f,typeof u.name!="string"&&(u.name=String(u.name)),t==null||t.call(this,u),u.parentName!==void 0?(u.parentName=String(u.parentName),l.push(u)):(c.set(u.name,u),h.push(u))),h},[]),l.forEach(h=>{const u=c.get(h.parentName);u&&(u.subCols=jn(u.subCols,[h],"name"))}),a&&(s.sort(Kr),[...c.values()].forEach(h=>{h.subCols&&h.subCols.sort(Kr)})),s}function qw(s,e,t){if(!s||!s.length)return[];const{getLane:n,laneProps:i}=e;let r=!1;return s=s.reduce((o,a,l)=>{if(i&&(a=Ie({},i,a)),n){const c=n.call(this,a);c!==!1&&(a=c||a)}return a.deleted||(typeof a.order=="number"?r=!0:a.order=l,a.color===void 0&&(a.color=`hsl(${43*fc(a.name)%360}deg 40% 50%)`),typeof a.name!="string"&&(a.name=String(a.name)),t==null||t.call(this,a),o.push(a)),o},[]),r&&s.sort(Kr),s}function Cg(s,e,t,n,i){if(!(s!=null&&s.length))return[];const{itemProps:r,getItem:o}=n;let a=!1;return s=s.reduce((l,c)=>{r&&(c=Ie({},r,c));const h=(o==null?void 0:o.call(this,{col:t.name,lane:e.name,item:c,laneInfo:e,colInfo:t}))??c;return h!==!1&&!h.deleted&&(typeof h.order=="number"?a=!0:h.order=l.length-1,l.push(h),i==null||i.call(this,h)),l},[]),a&&s.sort(Kr),s}function Kr(s,e){return s.order-e.order}function jn(s,e,t="key"){if(!s)return e?[...e]:[];const n=[...s];if(e){let i=0;const r=n.reduce((o,a,l)=>(o.set(String(a[t]??l),l),i=Math.max(a.order??l,i),o),new Map);e.forEach(o=>{const a=String(o[t]);r.has(a)?n[r.get(a)]={...n[r.get(a)],...o}:n.push({order:i++,...o})})}return n}function kg(s,e){return Array.isArray(s)?s.map(t=>({...t,[e]:String(t[e])})):Object.keys(s).reduce((t,n)=>{const i=s[n];return Object.keys(i).forEach(r=>{t.push(...(i[r]||[]).map(o=>({...o,lane:n,col:r,[e]:String(o[e])})))}),t},[])}function Sg(s,e){const{items:t=[],...n}=s;return{items:kg(t,e),...n}}function qu(s,e,t){var a;const n=jn(s.lanes,e.lanes,"name"),i=jn(s.cols,e.cols,"name"),r=jn(s.links,(a=e.links)==null?void 0:a.map(l=>(l[t]===void 0&&(l[t]=us(l)),l)),t),o=jn(s.items,kg(e.items||[],t),t);return{lanes:n,cols:i,items:o,links:r}}let qr=class extends tt{constructor(){super(...arguments),this._ref=Ce(),this._raf=0,this._data=new Ts(this._getData.bind(this),()=>{const{getCol:e,colProps:t,itemCountPerRow:n,itemGap:i,getLane:r,laneProps:o,itemProps:a,getItem:l,getLink:c,linkProps:h,responsive:u}=this.props;return[this._kanbanData,e,t,n,i,r,o,a,l,h,c,u]}),this._kanbanData=new Ts(()=>{const{itemKey:e,props:t}=this,{data:n}=t,{data:i,changes:r}=this.state,o=(i||Kl(n)?i:Sg(n,e))||{};return r?qu(o,r,e):o},()=>{const{data:e,changes:t,selected:n}=this.state;return[e,t,n,this.props.data]}),this._handleGlobalClick=e=>{_(e.target).closest(".kanban-item").length||this.select([])},this._onAddLink=async e=>{const{onAddLink:t}=this.props;e[this.itemKey]=us(e),await(t==null?void 0:t.call(this,e))!==!1&&this.addLink(e)},this._onDeleteLink=async e=>{const{onDeleteLink:t}=this.props;await(t==null?void 0:t.call(this,e))!==!1&&this.deleteLink(e)},this._handleMouseMove=e=>{this._hoverTimer&&clearTimeout(this._hoverTimer);const t=this._getElementInfo(e.target),n=(t==null?void 0:t.type)==="item"?t.key:void 0;this._hoverTimer=window.setTimeout(()=>{n!==this.state.hover&&this.setState({hover:n},()=>{_(this._ref.current).trigger("kanbanItemHover",{kanban:this.props.key,hover:n})}),this._hoverTimer=0},!n&&this.state.hover?0:20)},this._handleClick=e=>{if(e.target.closest("a,button"))return;const{onClickItem:t,selectable:n}=this.props,i=this._getElementInfo(e.target);t&&(i==null?void 0:i.type)==="item"&&t.call(this,e,i)===!1||n&&(i==null?void 0:i.type)==="item"&&this.select(i.key,!0)}}get data(){return this._data.cache}get itemKey(){return this.props.itemKey||"id"}componentDidMount(){this._afterRender(!0),this.tryLoad(),this._initDraggable();const{responsive:e,selectable:t}=this.props,n=this._ref.current;if(n&&e){const i=new ResizeObserver(this.updateLayout.bind(this));_(typeof e!="boolean"?e:n.closest(".kanban-list")||n.parentElement).each((o,a)=>{i.observe(a)}),this._rob=i,this.state.containerWidth||this.updateLayout()}t&&_(document).on("click.kanban",this._handleGlobalClick)}componentDidUpdate(){this._afterRender(!1),this.tryLoad()}componentWillUnmount(){var e,t,n;(e=this.props.beforeDestroy)==null||e.call(this),(t=this._draggable)==null||t.destroy(),(n=this._rob)==null||n.disconnect(),this.props.selectable&&_(document).off("click.kanban",this._handleGlobalClick)}getDefaultState(e){return{loading:!1,selected:(e||this.props).defaultSelected,data:void 0,changes:void 0,loadFailed:void 0}}load(){const{data:e,onLoad:t,onLoadFail:n}=this.props;this._loadedSetting=e,this.setState({loading:!0},async()=>{const i={loading:!1};try{const r=Sg(await Et(e,[this],{throws:!0}),this.itemKey);i.data=(t==null?void 0:t.call(this,r))||r}catch(r){i.loadFailed=(typeof n=="function"?n.call(this,r):n)||String(r)}this.setState(i)})}updateLayout(){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0;const e=this._ref.current;if(e){const{responsive:t,laneNameWidth:n=20}=this.props,i=_(typeof t!="boolean"?t:e.closest(".kanban-list")||e.parentElement),r=i[0];let o=i.width()-n-(r.offsetWidth-r.clientWidth);const a=e.closest(".kanban-region");a&&(o-=a.clientWidth-_(a).width()),this.setState({containerWidth:o})}})}tryLoad(){const{loading:e}=this.state,{data:t}=this.props;e||!t||!Kl(t)||t===this._loadedSetting||this.load()}getCol(e){return this.data.colMap.get(String(e))}getLane(e){return e=String(e),this.data.lanes.find(t=>t.name===e)}getItem(e){return this.data.map.get(String(e))}update(e){return this.changeState(t=>({changes:qu({...t.changes},e,this.itemKey)}))}createSnap(){return{date:Date.now(),kanban:this,data:_.extend(!0,{},this._data),restore(){this.kanban.changeState({changes:this.data})}}}addItem(e,t,n){return this.updateItem(e,t,n)}updateItem(e,t,n){const i=Array.isArray(e)?e:[e];return this.update({items:t||n?i.map(r=>({...r,lane:t??r.lane,col:n??r.col})):i})}deleteItem(e){return this.updateItem(Array.isArray(e)?e.map(t=>({[this.props.itemKey||"id"]:t,deleted:!0})):{[this.itemKey]:e,deleted:!0})}updateLane(e){return this.update({lanes:Array.isArray(e)?e:[e]})}addLane(e){return this.updateLane(e)}deleteLane(e){return this.updateLane(Array.isArray(e)?e.map(t=>({name:t,deleted:!0})):{name:e,deleted:!0})}updateCol(e){return this.update({cols:Array.isArray(e)?e:[e]})}addCol(e){return this.updateCol(e)}deleteCol(e){return this.updateCol(Array.isArray(e)?e.map(t=>({name:t,deleted:!0})):{name:e,deleted:!0})}updateLink(e,t){return this.update({links:(Array.isArray(e)?e:[e]).map(n=>({deleted:!1,...n,...t,[this.itemKey]:us(n)}))})}addLink(e){return this.updateLink(e)}deleteLink(e){return this.updateLink(e,{deleted:!0})}select(e,t){let n=Array.isArray(e)?e:e?[e]:[],i=this.state.selected||[];const{onSelect:r}=this.props;return this.changeState(o=>{if(i=o.selected||[],t){const a=new Set(i),l=new Set;return n.forEach(c=>{a.has(c)?a.delete(c):l.add(c)}),n=[...a,...l],{selected:n}}return{selected:n}},()=>{r==null||r(n,i),_(this._ref.current).trigger("kanbanItemSelected",{kanban:this.props.key,selected:n,oldSelected:i})})}_getElementInfo(e){const t=_(e),n=t.closest(".kanban-item");if(n.length){const a=n.attr("z-key");if(a){const l=this.getItem(a);if(l)return{type:"item",key:a,element:e,item:l,lane:l.lane,col:l.col}}}if(t.closest(".kanban-new-item").length)return{type:"newItem",element:e};const r=t.closest(".kanban-header-col,.kanban-lane-col");if(r.length)return{type:"col",element:e,col:r.attr("z-col"),lane:r.attr("z-lane")};const o=t.closest(".kanban-lane").attr("z-lane");if(o!==void 0)return{type:"lane",element:e,lane:o}}_getDropInfo(e,t,n){const i=this._getElementInfo(t);if(!i)return;const r=this._getElementInfo(n);if(!r||r.element.closest(".kanban")!==this.element)return;let o;if(i.type==="item"&&r.type==="col")o="inside";else{const a=n.getBoundingClientRect();i.type==="col"?o=e.clientX<a.left+a.width/2?"before":"after":o=e.clientY<a.top+a.height/2?"before":"after"}return{side:o,event:e,drag:i,drop:r}}_getDropChanges(e){const{drag:t,drop:n}=e,i=this.data,r={},{itemKey:o}=this,a={list:[],lane:n.lane,col:n.col};if(t.type==="item"){const l=t.item,c=i.items[n.lane][n.col],h=[...c],u={[o]:l[o],order:l.order},f=n.col===l.col,p=n.lane===l.lane;if(f&&p&&l[o]===n.item[o])return{changes:r,data:a};f||(u.col=n.col),p||(u.lane=n.lane);let g=!1;if(n.type==="col"&&(!p||!f))h.push(u),g=!0;else if(n.type==="item"){const y=n.item,v=n.col!==l.col||n.lane!==l.lane?-1:h.findIndex(w=>w[o]===l[o]);v>=0&&h.splice(v,1);const b=h.findIndex(w=>w[o]===y[o]);h.splice(e.side==="before"?b:b+1,0,u),g=!0}if(g){r.items=[];let y=-1;h.forEach((v,b)=>{const w=Math.max(0,y+1,v.order??b),S=c[b];y=w,(S!==v||w!==S.order)&&(v={...v,order:w}),v!==S&&r.items.push(v),a.list.push(v[o])})}}else if(t.type==="newItem"){const{onDropNewItem:l}=this.props;let c;if(l?c=l.call(this,e):(c=_(t.element).data(),c!=null&&c.item&&(c=c.item)),c={lane:n.lane,col:n.col,...c},c!=null&&c[o]){const u=[...i.items[n.lane][n.col]];u.push(c),r.items=u,a.list.push(c[o])}}return{changes:r,data:a}}_initDraggable(){const{draggable:e}=this.props,t=this._ref.current;if(!e||!t)return;const{dragTypes:n=["item","newItem"],onDragStart:i,onDrop:r,canDrop:o,dropRules:a}=this.props,l=typeof n=="string"?n.split(","):n,c={item:".kanban-item",lane:".kanban-lane-name",col:".kanban-header-col",newItem:".kanban-new-item"},h=typeof e=="object"?e:{},u=(p,g)=>{_(p).attr({"z-drag-type":g?g.drag.type:null,"z-drop-type":g?g.drop.type:null,"z-drop-side":g?g.side:null})},f={...h,selector:h.selector||l.map(p=>c[p]||"").filter(Boolean).join(","),target:h.target||(p=>{const g=this._getElementInfo(p);if(!g)return;const y={lane:".kanban-lane",col:".kanban-header-col",item:".kanban-item,.kanban-items",newItem:".kanban-item,.kanban-items"}[g.type];return _(t).find(y)}),canDrop:h.canDrop||o||a?(p,g,y)=>{const v=this._getElementInfo(g);if(!v)return!1;const b=this._getElementInfo(y);if(!b||b.element.closest(".kanban")!==this.element)return!1;if(v.type==="item"&&a){const w=v.col,S=b.col,E=v.lane,$=b.lane,B=a[`${E}:${w}`]??a[w];return typeof B=="boolean"?B:!B||B.includes(S)||B.includes(`${$}:${S}`)||B.includes(`${$}:`)}if(o)return o.call(this,v,b)}:void 0,onDragStart:(p,g)=>{var v;const y=this._getElementInfo(g);return y?i?i.call(this,{event:p,drag:y}):(v=h.onDragStart)==null?void 0:v.call(this,p,g):!1},onDragOver:(p,g,y)=>{const v=this._getDropInfo(p,g,y);v&&u(y,v)},onDragLeave:(p,g,y)=>{u(y)},onDrop:(p,g,y)=>{var b;u(y);const v=this._getDropInfo(p,g,y);if(!v)return!1;if(r){const{changes:w,data:S}=this._getDropChanges(v);if(Object.keys(w).length){v.data=S;const E=this.createSnap();r.call(this,w,v,E.restore)!==!1&&this.update(w)}}return(b=h.onDrop)==null?void 0:b.call(this,p,g,y)}};this._draggable=new br(t,f)}_afterRender(e){var t;(t=this.props.afterRender)==null||t.call(this,e)}_getData(){const{itemKey:e,props:t}=this,n=this._kanbanData.value;let i=!1;const{items:r=[]}=n,o={},a=new Map,l=Kw.call(this,n.cols,t,v=>{v.parentName!==void 0&&(i=!0),a.set(v.name,v)}),c=qw.call(this,n.lanes,t,v=>{o[v.name]=l.reduce((b,w)=>(w.subCols?w.subCols.forEach(S=>{b[S.name]=[]}):b[w.name]=[],b),{})}),h=new Set,u=r.reduce((v,b)=>{if(b.deleted)return h.add(b[e]),v;v.set(b[e],b);const w=o[b.lane];if(w){const S=w[b.col];S&&S.push(b)}return v},new Map),{selected:f=[]}=this.state,p=new Set(f),g=v=>{v.selected=p.has(v[e])};c.forEach(v=>{const b=o[v.name];b&&l.forEach(w=>{var S;b[w.name]=Cg.call(this,b[w.name],v,w,t,g),(S=w.subCols)==null||S.forEach(E=>{b[E.name]=Cg.call(this,b[E.name],v,E,t,g)})})});let{links:y=[]}=n;return y=y.reduce((v,b)=>{var w;if(!b.deleted&&u.has(b.from)&&u.has(b.to)&&!h.has(b.from)&&!h.has(b.to)){b[e]===void 0&&(b[e]=us(b));const S=((w=t.getLink)==null?void 0:w.call(this,b))??b;S!==!1&&!S.deleted&&v.push(S)}return v},[]),{cols:l,lanes:c,items:o,map:u,colMap:a,links:y,hasSubCols:i}}_layoutCols(e,t){const{containerWidth:n=0}=this.state,{colsGap:i=8,minColWidth:r=150,maxColWidth:o=600,colWidth:a=200}=t,l=[];let c=0;const h=u=>{const{minWidth:f=r,maxWidth:p=o}=u;let{width:g=a}=u;typeof g=="function"&&(g=g.call(this,u));const y=g==="auto";if(y)g=f;else{const[v,b]=Fs(g);b==="%"?g=n*v/100:g=v}return g=Math.min(p,Math.max(f,g)),c+=g+(c?i:0),u={...u,width:g,maxWidth:p,minWidth:f},y&&l.push(u),u};if(e=e.map(u=>u.subCols?{...u,subCols:u.subCols.map(h)}:h(u)),l.length&&c<n){const u=Math.floor((n-c)/l.length);l.forEach(f=>{f.width=Math.min(f.maxWidth,Math.max(f.minWidth,f.width+u))})}return e}_layoutLanes(e,t){const{laneHeight:n,maxLaneHeight:i,minLaneHeight:r}=t;return!n&&!i&&!r?e:e.map(o=>({height:typeof n=="function"?n.call(this,o):n,maxHeight:i,minHeight:r,...o}))}_getClassName(e){return["kanban",e.className,e.sticky?"kanban-sticky":"",this.data.hasSubCols?"has-sub-cols":""]}_getProps(e){const{laneNameWidth:t,colsGap:n,lanesGap:i,selectable:r,onClickItem:o,showLinkOnHover:a}=e;return Ie(super._getProps(e),{ref:this._ref,style:{"--kanban-lane-name-width":t,"--kanban-cols-gap":nt(n),"--kanban-lanes-gap":nt(i)},onClick:o||r?this._handleClick:void 0,onMouseMove:a?this._handleMouseMove:void 0})}_renderLinks(e){const{links:t=[]}=this.data,{editLinks:n}=e;if(!n&&!t.length)return;const{showLinkOnHover:i,showLinkOnSelected:r}=e;let o;if(r||i){o=[];const{selected:a,hover:l}=this.state;r&&a&&o.push(...a),i&&l&&o.push(l),o=[...new Set(o)]}return A(wg,{links:t,filters:o,editLinks:n,onDeleteLink:n?this._onDeleteLink:void 0,onAddLink:n?this._onAddLink:void 0},"links")}_getChildren(e){const t=this._data.value,{cols:n,lanes:i,items:r}=t,{laneNameWidth:o}=e,a=this._layoutCols(n,e),l=this._layoutLanes(i,e);return[A(Mw,{cols:a},"header"),A(Lw,{itemRender:e.itemRender,getLaneCol:e.getLaneCol,cols:a,lanes:l,items:r,hideLaneName:o===0},"body"),this._renderLinks(e),e.children]}};qr.defaultProps={draggable:!0,sticky:!0,responsive:!0,itemKey:"id",colWidth:200,colsGap:8},qr.customProps=["onDrop","onDragStart"];class Dg extends tt{constructor(){super(...arguments),this._kanbanRefs=new Map,this._needUpdateData=new Map,this._handleClickHeading=e=>{_(e.target).closest("a,.btn,button").not(".kanban-region-toggle").length||this.setState(t=>({collapsed:!t.collapsed}))}}componentDidUpdate(){if(this.state.collapsed)return;const e=this._needUpdateData;[...e.keys()].forEach(t=>{const n=this.getKanban(t);n&&(n.update(e.get(t)),e.delete(t))})}getDefaultState(e){return{collapsed:(e||this.props).collapsed,heading:void 0,items:void 0}}resetState(e,t){this._kanbanRefs.forEach(n=>{var i;return(i=n.current)==null?void 0:i.resetState()}),super.resetState(e,t)}getKanban(e){var t;return(t=this._kanbanRefs.get(String(e)))==null?void 0:t.current}toggle(e){this.setState(t=>({collapsed:e===void 0?!t.collapsed:!e}))}update(e){const{items:t}=e;return t&&(e={...e},e.items=t.map((n,i)=>{const r=String(n.key||i);return n.deleted?{key:r,deleted:!0}:(n.data&&typeof n.data=="object"&&this.getKanban(r)&&(this._needUpdateKanban(r,n.data),n={...n},delete n.data),n)})),new Promise(n=>{this.setState(e.items?i=>({...e,items:jn(i.items,e.items)}):e,n)})}_needUpdateKanban(e,t){const n=this._needUpdateData,i=n.get(e),{kanbanItemKey:r="key"}=this.props;n.set(e,qu(i||{},t,r))}_buildItems(e){const{items:t=[],kanbanProps:n,kanbanItemKey:i="key"}=e;let{items:r}=this.state;r?(r=jn(t,r,i).filter(c=>!c.deleted),r.sort(Kr)):r=t;const o=this._kanbanRefs,a=new Set(o.keys()),l=r.map((c,h)=>{if(c.deleted)return null;const u=Ie({className:"kanban-region-item",key:h},typeof n=="function"?n.call(this,c,h):n,c),f=String(u.key);let p=o.get(f);return p||(p=Ce(),o.set(f,p)),u.ref=p,a.delete(f),A(qr,{"z-key":f,...u})});return a.forEach(c=>{o.delete(c)}),l}_getClassName(e){return["kanban-region",e.className,this.state.collapsed?"is-collapsed":"is-expanded",e.heading?"has-heading":""]}_getChildren(e){const{heading:t,toggleFromHeading:n}=e,{collapsed:i,heading:r}=this.state,o=Ie({className:"kanban-heading",onClick:n?this._handleClickHeading:void 0},typeof t=="function"?t.call(this):t,r);return[t&&A(wn,{...o},"heading"),i?null:this._buildItems(e)]}}const Gu=".kanban";let Eg=class extends tt{constructor(){super(...arguments),this.state={},this._ref=Ce(),this._kanbanRefs=new Map,this._onAddLink=async e=>{const{onAddLink:t,linkItemKey:n}=this.props;e[n]=us(e),await(t==null?void 0:t.call(this,e))!==!1&&this.addLink(e)},this._onDeleteLink=async e=>{const{onDeleteLink:t}=this.props;await(t==null?void 0:t.call(this,e))!==!1&&this.deleteLink(e)}}componentDidMount(){const e=this._ref.current;if(e){const{moveable:t,responsive:n,showLinkOnSelected:i,showLinkOnHover:r}=this.props;if(t&&(this._moveable=new wr(e,_.extend({selector:"self",move:"scroll",onMoveStart:(o,a)=>{const{bottom:l,right:c}=a.getBoundingClientRect();return o.clientY<l&&o.clientY>l-20||o.clientX<c&&o.clientX>c-20?!1:!_(o.target).closest("a,input,.btn,.state,.kanban-item,.not-moveable").length}},typeof t=="object"?t:null))),i&&_(e).on(`kanbanItemSelected${Gu}`,(o,a)=>{this.setState(l=>({selected:{...l.selected,[a.kanban]:a.selected}}))}),r&&_(e).on(`kanbanItemHover${Gu}`,(o,{kanban:a,hover:l})=>{this.setState({hover:l===void 0?l:`${a}_${l}`})}),n){const o=new ResizeObserver(this._tryUpdateLayout.bind(this));(typeof n!="boolean"?_(n):_(e).parent()).each((l,c)=>{o.observe(c)}),this._rob=o}}}componentWillUnmount(){var t,n;(t=this._moveable)==null||t.destroy(),(n=this._rob)==null||n.disconnect();const e=this._ref.current;e&&_(e).off(Gu)}getDefaultState(e){return{linkChanges:void 0}}resetState(e,t){this._kanbanRefs.forEach(n=>{var i;(i=n.current)==null||i.resetState()}),super.resetState(e,t)}getKanban(e){const t=String(e),n=this._kanbanRefs;if(n.has(t))return n.get(t).current;let i=null;const r=Array.from(n.values());for(const o of r){const a=o.current;if(a instanceof Dg&&(i=a.getKanban(e),i))break}return i||null}updateKanban(e,t){const n=this.getKanban(e);return n?n.update(t):Promise.reject(new Error(`[ZUI] Kanban not found: ${e}`))}updateLayout(){const e=this._ref.current;if(!e)return;const t=_(e),n=t.width(),i=t.height();this.setState({width:n,height:i})}updateLink(e,t){return this.changeState(n=>{let i=Array.isArray(e)?e:[e];return t&&(i=i.map(r=>({...r,...t}))),{linkChanges:jn(n.linkChanges,i,this.props.linkItemKey)}})}addLink(e){return this.updateLink(e)}deleteLink(e){return this.updateLink(e,{deleted:!0})}_tryUpdateLayout(){this._layoutTimer&&cancelAnimationFrame(this._layoutTimer),this._layoutTimer=requestAnimationFrame(()=>{this.updateLayout(),this._layoutTimer=0})}_getClassName(e){return["kanban-list",e.className,e.sticky?"has-sticky":"",e.moveable?"is-moveable":"",e.scrollbarHover?"scrollbar-hover":""]}_getProps(e){const{width:t,height:n}=e,i=typeof t=="function"?t.call(this):t,r=typeof n=="function"?n.call(this):n,{width:o,height:a}=this.state??{};return Ie(super._getProps(e),{ref:this._ref,style:{width:i,height:r,"--kanban-list-width":`${o||t}px`,"--kanban-list-height":`${a||n}px`}})}_getLinks(e){const{linkChanges:t=[]}=this.state,{links:n=[],getLink:i,linkItemKey:r}=e;return jn(n,t,this.props.linkItemKey).reduce((o,a)=>{const l=i==null?void 0:i.call(this,a);return l!==!1&&(a=l||a,a.deleted||(a[r]||(a[r]=us(a)),o.push(a))),o},[])}_renderLinks(e){const t=this._getLinks(e),{editLinks:n}=e;if(!n&&!t.length)return;const{showLinkOnHover:i,showLinkOnSelected:r}=e;let o;if(t.length&&(r||i)){o=[];const{selected:a={},hover:l}=this.state;r&&a&&Object.keys(a).forEach(c=>{const h=a[c];h.length&&o.push(...h.map(u=>`${c}_${u}`))}),i&&l&&o.push(l),o=[...new Set(o)]}return A(wg,{container:".kanban-list",links:t,filters:o,editLinks:n,onDeleteLink:n?this._onDeleteLink:void 0,onAddLink:n?this._onAddLink:void 0},"links")}_getChildren(e){const{items:t=[],kanbanProps:n,showLinkOnSelected:i,showLinkOnHover:r,selectable:o,editLinks:a}=e,l=this._kanbanRefs,c=new Set(l.keys()),h=[...t.map((f,p)=>{n&&(f=typeof n=="function"?n.call(this,f,p):_.extend({},n,f));const g=String(f.key??p);let y=l.get(g);y||(y=Ce(),l.set(g,y)),c.delete(g);const v=f.heading!==void 0||f.items;return(i||r||o)&&(v?f.kanbanProps={showLinkOnSelected:i,showLinkOnHover:r,selectable:o,...f.kanbanProps}:f={showLinkOnSelected:i,showLinkOnHover:r,selectable:o,...f}),a&&(v?f.items=(f.items||[]).map(w=>({...w,editLinks:!1})):f={...f,editLinks:!1}),A(v?Dg:qr,{ref:y,sticky:e.sticky,...f,"z-key":g},g)}),e.children];c.forEach(f=>{l.delete(f)});const u=this._renderLinks(e);return u&&h.push(u),h}};Eg.defaultProps={moveable:!0,sticky:!0,responsive:!0,scrollbarHover:!0,linkItemKey:"id"};class Gr extends Ee{}Gr.NAME="Kanban",Gr.replace=!0,Gr.Component=qr,Gr.register();class Yr extends Ee{update(e,t){if(e=Array.isArray(e)?e:[e],t)return this.render({items:e});const n=this.options.items||[],i=new Map(n.map((o,a)=>[o.key,a])),r=[...n];return e.forEach(o=>{if(i.has(o.key)){const a=i.get(o.key);r[a]={...n[a],...o}}else r.push(o)}),this.render({items:r.filter(o=>!o.deleted)})}}Yr.NAME="KanbanList",Yr.replace=!0,Yr.Component=Eg,Yr.register();const gD="",yD="",vD="",xD="",_D="",bD="",wD="",CD="",kD="",SD="",Gw="nav",Yu='[data-toggle="tab"]',Yw="active";class Xr extends Je{constructor(){super(...arguments),this._timer=0}active(e){const t=this.$element,n=t.find(Yu);let i=e?_(e).closest(Yu):n.filter(`.${Yw}`);if(!i.length&&(i=t.find(Yu).first(),!i.length))return;n.removeClass("active"),i.addClass("active");const r=i.attr("href")||i.data("target"),o=i.data("name")||r,a=t.closest(".tabs"),l=a.length?a.find(r):_(r);l.length&&(l.parent().children(".tab-pane").removeClass("active in"),l.addClass("active").trigger("show",[o]),this.emit("show",o),this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{l.addClass("in").trigger("shown",[o]),this.emit("shown",o),this._timer=0},10))}}Xr.NAME="Tabs",Xr.toggle={name:"tab",handler(s,e){const t=_(s),n=t.closest(`.${Gw}`);n.length&&Xr.ensure(n,e).active(t)}},Xr.register();function Xw(s){const[e,t]=s.split(":"),n=e[0]==="-"?{name:e.substring(1),disabled:!0}:{name:e};return t!=null&&t.length&&(n.type="dropdown",n.items=t.split(",").reduce((i,r)=>(r=r.trim(),r.length&&i.push(r[0]==="-"?{name:r.substring(1),disabled:!0}:{name:r}),i),[])),n}const Zw=(s,e)=>{var i;s.url&&(s.url=Te(s.url,e.row.data));const t={row:e.row.id,col:e.col.name},n=((i=s.dropdown)==null?void 0:i.items)||s.items;return n&&n.forEach(r=>(r.url&&(r.url=Te(r.url,e.row.data)),r.data=t,r)),s.data=t,s},Ag=s=>s?(typeof s=="string"&&(s=s.split("|")),s.map(e=>typeof e=="string"?Xw(e):e).filter(Boolean)):[],Qw=Ze({name:"actions",colTypes:{actions:{onRenderCell(s,e){var h;const{row:t,col:n}=e,i=Ag(((h=t.data)==null?void 0:h[n.name])||n.setting.actions);if(!i.length)return s;const{actionsSetting:r,actionsMap:o,actionsCreator:a=this.options.actionsCreator,actionItemCreator:l=this.options.actionItemCreator||Zw}=n.setting,c={items:(a==null?void 0:a(e))??i.map(u=>{const{name:f,...p}=u;if(o&&f){Object.assign(p,o[f],{...p});const{buildProps:y}=p;typeof y=="function"&&(delete p.buildProps,Object.assign(p,y(s,e)))}const{items:g}=p;if(p.disabled&&(delete p.url,delete p["data-toggle"]),g&&p.type==="dropdown"){const{dropdown:y={placement:"bottom-end"}}=p;y.menu={className:"menu-dtable-actions"},y.items=g.map(v=>{const b=typeof v=="string"?{name:v}:{...v};return b.name&&o&&o[b.name]&&Object.assign(b,o[b.name],{...b}),b.disabled?(delete b.url,delete b["data-toggle"]):b.url&&(b.url=Te(b.url,t.data)),b}),p.dropdown=y,delete p.items}return l?l(p,e):p}),btnProps:{btnType:"ghost",size:"sm",className:"text-primary"},...r};return s[0]=A(Xe,{...c}),s}}},beforeLayout(s){!Array.isArray(s.data)||!s.data.length||s.cols.forEach((e,t)=>{if(e.type!=="actions"||e.width)return;const{actionsMap:n={}}=e,r=Ag(s.data[0][e.name]).reduce((o,a)=>{const l=a.name?n[a.name]:null;return l&&l.type==="dropdown"&&l.caret&&!l.text?o+16:o+24},24);s.cols[t]={...e,width:r}})}}),Jw=Ze({name:"toolbar",footer:{toolbar(){const{footToolbar:s,showToolbarOnChecked:e}=this.options;return e&&!this.getChecks().length?[]:[s?Xe.render(s,[this],{gap:2}):null]}}}),AD="",Tg=function(s,e){var i,r;const{col:t}=e,{sortColFrom:n}=this.state;if(n){n.name===t.name&&s.push({outer:!0,className:"is-sorting-from-col"});const o=(r=(i=this.data.sortColInfo)==null?void 0:i.colOffsetMap)==null?void 0:r[t.name];typeof o=="number"&&s.push({outer:!0,className:"is-sorting-col-move",style:{left:t.left+o}})}return s},e1=Ze({name:"sort-col",when:s=>!!s.sortCol,plugins:[Ur,Uu],resetState:!0,state(){return{colOrders:{},sortColFrom:void 0,sortingColPos:void 0,sortingColTo:void 0,sortingColSide:void 0}},events:{mousedown(s){var r;if(this.data.disableSortCol)return;const e=this.getPointerInfo(s);if(!e||e.rowID!=="HEADER")return;const t=this.getColInfo(e.colName);if(!t||((r=this.options.onSortColStart)==null?void 0:r.call(this,t,s))===!1)return;_(s.target).closest("a,button,img").attr("draggable","false").length&&s.preventDefault(),s.preventDefault();const n=s.clientX,{cellElement:i}=e;this.data.sortColInfo={from:t,element:i,offset:n-i.getBoundingClientRect().left,startMouseX:n,lastMouseX:n},_(i).zuiCall("ContextMenu.hide")},document_mouseup(s){var n;const{sortColInfo:e}=this.data;if(!e)return;this.stopScrollToMouse();const t=this.getSortingColState(s);if(t){let i,r;const{from:o,to:a,side:l}=t;if(a){if(o.name===a.name)i={};else if(l){const c=this.layout.cols[o.side].list,h=o.sideIndex,u=a.sideIndex,f=c.splice(h,1);c.splice(u+(l==="after"?1:0),0,f[0]),i={},r=[],c.forEach(({name:p},g)=>{i[p]=g+1,r.push(p)}),((n=this.options.onSortCol)==null?void 0:n.call(this,o,a,l,r))===!1&&(i=void 0,r=void 0)}Math.abs(e.lastMouseX-e.startMouseX)>4&&this.ignoreNextClick()}this.disableAnimation(),this.update({dirtyType:"layout",state:_.extend({sortColFrom:void 0,sortingColPos:void 0,sortingColTo:void 0,sortingColSide:void 0},i?{colOrders:{...this.state.colOrders,...i}}:null)},()=>{var c;(c=this.options.onSortColEnd)==null||c.call(this,o,a,l,r)})}this.data.sortColInfo=void 0},document_mousemovesmooth(s){const{sortColInfo:e}=this.data;if(!e)return;const t=this.getSortingColState(s);t&&(e.state||this.startScrollToMouse({side:"x"}),e.lastMouseX=s.clientX,e.state=t,this.setState({sortColFrom:t.from,sortingColPos:t.pos,sortingColTo:t.to,sortingColSide:t.side}))}},methods:{getSortingColState(s){var v;const{disableSortCol:e,sortColInfo:t}=this.data;if(e||!t)return;const{from:n,element:i}=t,o=_(i).closest(".dtable-cells")[0].getBoundingClientRect(),a=s.clientX-o.left,{cols:l,scrollLeft:c}=this.layout,h=l[n.side].list;if(h.length<=1)return t.state;const u=c+a,f=h.find(b=>b.visible&&b.left<=u&&b.left+b.width>u);if(!f)return t.state;const p=u<f.left+f.width/2?"before":"after";return n.side===f.side&&((v=this.options.canSortColTo)==null?void 0:v.call(this,n,f,p))!==!1?{from:n,pos:a+c,to:f,side:n.name!==f.name?p:void 0}:{from:n,pos:a,to:void 0,side:void 0}}},onAddCol(s){const{colOrders:e={}}=this.state,t=e[s.name];t!==void 0&&(s.order=t)},beforeRender(s){const{sortColFrom:e,sortingColTo:t,sortingColSide:n}=this.state;if(e&&t){s.className=ee(s.className,"has-sorting-col");const i=[...s.cols[e.side].list],r=e.sideIndex,o=t.sideIndex,a=i.splice(r,1);i.splice(o+(n==="after"?1:0),0,a[0]);let l=0;const c={};i.forEach(h=>{const u=l-h.left;u&&(c[h.name]=u),l+=h.realWidth}),this.data.sortColInfo.colOffsetMap=c}},onRenderHeaderCell(s,e,t,n){const{sortCol:i}=this.options;return i&&(this.layout.cols[e.col.side].list.length>1&&(i===!0||Array.isArray(i)&&i.includes(e.col.name)||typeof i=="function"&&i.call(this,e.col))&&s.push({outer:!0,className:"is-sortable-col"}),s=Tg.call(this,s,e,t,n)),s},onRenderCell:Tg}),$D="";function $g(s,e,t){const{colResizing:n}=s.state;if(!n)return;const i=Math.round(e.clientX-n.startX);if(!i&&!t)return;const r={};t&&(r.colResizing=void 0);const{colName:o}=n;let a=s.getColInfo(o);if(!a)return s.update({dirtyType:"layout",state:r});r.colsSizes={...s.state.colsSizes,[o]:n.startSize+i},s.update({dirtyType:"layout",state:r},t?()=>{var l;if(a=s.getColInfo(o),a){const c=s.data.colOriginSize.get(o);(l=s.options.onColResize)==null||l.call(s,o,a.width-c,a)}}:void 0),e.stopPropagation(),e.preventDefault()}const Ig=Ze({name:"resize",when:s=>!!s.colResize,plugins:[Ur],resetState(s){var e;return{colsSizes:((e=s.cols)==null?void 0:e.reduce((t,n)=>(n.extraWidth!==void 0&&(t[n.name]=n.extraWidth),t),{}))||{}}},state(){var s;return{colsSizes:((s=this.props.cols)==null?void 0:s.reduce((e,t)=>(t.extraWidth!==void 0&&(e[t.name]=t.extraWidth),e),{}))||{}}},data(){return{colOriginSize:new Map}},events:{mousedown(s){const e=s.target.closest(".dtable-col-splitter");if(!e)return;const t=e.closest(".dtable-cell"),n=t==null?void 0:t.dataset.col;if(n)return this.setState({colResizing:{colName:n,startSize:this.state.colsSizes[n]??0,startX:s.clientX}},()=>{_(t).zuiCall("ContextMenu.hide")}),!1},dblclick(s){var i;const e=s.target.closest(".dtable-col-splitter");if(!e)return;const t=(i=e.closest(".dtable-cell"))==null?void 0:i.dataset.col;if(!t)return;const{colsSizes:n}=this.state;n[t]&&(delete n[t],this.update({dirtyType:"layout",state:{colResizing:void 0,colsSizes:{...n}}},()=>{var r;(r=this.options.onColResize)==null||r.call(this,t,0,this.getColInfo(t))}))},document_mouseup(s){if(this.state.colResizing)return $g(this,s,!0),!1},document_mousemovesmooth(s){if(this.state.colResizing)return $g(this,s),!1}},methods:{isColResizable(s){if(typeof s=="string"&&(s=this.getColInfo(s)),!s||s.side!=="left"&&s.sideIndex===this.layout.cols[s.side].list.length-1)return;let e=s.setting.colResize??this.options.colResize;return typeof e=="function"&&(e=e.call(this,s.name)),!!e}},onRenderHeaderCell(s,{col:e}){var t;return this.isColResizable(e)&&(s.push({className:"has-col-splitter",children:A("div",{className:"dtable-col-splitter no-cell-event"}),outer:!0}),((t=this.state.colResizing)==null?void 0:t.colName)===e.name&&s.push({className:"has-col-resizing",outer:!0})),s},onRenderCell(s,{col:e}){var t;return((t=this.state.colResizing)==null?void 0:t.colName)===e.name&&s.push({className:"is-col-resizing",outer:!0}),s},onAddCol(s){const e=this.state.colsSizes[s.name]??s.setting.extraWidth;typeof e=="number"&&(this.data.colOriginSize.set(s.name,s.width),s.width=b0(s.width+e,s.setting.minWidth,s.setting.maxWidth))},onRender(){if(this.state.colResizing)return{className:"has-col-resizing"}}}),BD="",t1=Ze({name:"contextmenu",when:s=>!!s.contextmenu,events:{contextmenu(s){const e=this.getPointerInfo(s);if(!e)return;const t=this.getContextMenuItems(s,e);if(!t||!t.length)return;s.preventDefault();const n=_(e.cellElement).addClass("has-contextmenu-show");e.cellElement.classList.add("active"),ji.show({items:t,key:`dtable-ctx-${this.id}`,triggerEvent:s,hideOthers:!0,onHide(){n.removeClass("has-contextmenu-show")}})}},methods:{getContextMenuItems(s,e){const{contextmenu:t}=this.options;if(typeof t=="function")return t.call(this,s,e);if(!t||Array.isArray(t))return t;const{header:n,cell:i}=t;return e.rowID==="HEADER"?typeof n=="function"?n.call(this,s,e):n:typeof i=="function"?i.call(this,s,e):i}}});function Bg(s,e){if(typeof e=="string"&&(e=s.getColInfo.call(s,e)),!e)return{};const{colBorders:t}=s.state,{side:n,sideIndex:i}=e,r=s.layout.cols[n].list,o=i>0?r[i-1]:null,a=r[i+1];return{prevName:o==null?void 0:o.name,nextName:a==null?void 0:a.name,prev:o?t[o.name]??o.setting.border:void 0,next:a?t[a.name]??a.setting.border:void 0}}function Wi(s,e){return s===e||s===!0}const n1=Ze({name:"custom-col",when:s=>!!s.customCol,plugins:[t1],resetState:!0,options(s){return s.customCol&&!s.contextmenu&&(s.contextmenu={header:(e,t)=>{var o,a;const n=this.getColBorder(t.colName),i=l=>{const c={width:"12px",margin:"0 2px",height:"12px",border:"1px dotted var(--color-border-strong)"},h="2px solid var(--color-border-strong)";return l==="left"?c.borderLeft=h:l==="right"?c.borderRight=h:l===!0&&(c.borderLeft=h,c.borderRight=h),A("span",{style:c})},r=((o=this.getColInfo(t.colName))==null?void 0:o.setting.required)||!((a=this.options.canSetColVisibility)!=null&&a.call(this,t.colName,!1));return[{icon:i(n),text:this.i18n("setDivider"),items:[{text:this.i18n("leftDivider"),icon:i("left"),selected:n==="left",onClick:()=>this.setColBorder(t.colName,"left")},{text:this.i18n("rightDivider"),icon:i("right"),selected:n==="right",onClick:()=>this.setColBorder(t.colName,"right")},{text:this.i18n("allDivider"),icon:i(!0),selected:n===!0,onClick:()=>this.setColBorder(t.colName,!0)},{text:this.i18n("noDivider"),icon:i(!1),selected:!n,onClick:()=>this.setColBorder(t.colName,!1)}]},{text:this.i18n("hideCol"),icon:"eye-off",disabled:r,onClick:r?void 0:()=>this.setColVisibility(t.colName,!1)}]}}),s},state(){return{colBorders:{},colVisibility:{}}},methods:{getColBorder(s,e=!0){const t=this.getColInfo(s);if(!t)return!1;const{colBorders:n}=this.state,i=n[s]??t.setting.border;if(i===!0||!e)return i;const{prev:r,next:o}=Bg(this,t),a=i==="left"||Wi(r,"right"),l=i==="right"||Wi(o,"left");return a&&l?!0:a?"left":l?"right":!1},setColBorder(s,e){if(this.getColBorder(s,!1)===e)return;const{onSetColBorder:n}=this.options,{prev:i,next:r,prevName:o,nextName:a}=Bg(this,s);this.update({dirtyType:"layout",state:l=>{const c={...l.colBorders,[s]:e};return!Wi(e,"left")&&Wi(i,"right")&&(c[o]=!1),!Wi(e,"right")&&Wi(r,"left")&&(c[a]=!1),{colBorders:c}}},n?()=>{n.call(this,s,e,this.state.colBorders)}:void 0)},setColVisibility(s,e){const{onSetColVisibility:t}=this.options;this.update({dirtyType:"options",state:n=>({colVisibility:{...n.colVisibility,[s]:e}})},t?()=>{t.call(this,s,e)}:void 0)}},onAddCol(s){const{colBorders:e}=this.state;e[s.name]!==void 0&&(s.border=e[s.name])},beforeLayout(s){const{colVisibility:e}=this.state;Object.keys(e).length&&s.cols&&(s.cols=s.cols.map(t=>(e[t.name]!==void 0&&(t={...t,hidden:!e[t.name]}),t)))},i18n:{zh_cn:{setDivider:"设置分割线",leftDivider:"左侧",rightDivider:"右侧",allDivider:"两侧",noDivider:"无",hideCol:"隐藏此列"},zh_tw:{setDivider:"設置分割線",leftDivider:"左側",rightDivider:"右側",allDivider:"兩側",noDivider:"無",hideCol:"隱藏此列"},en:{setDivider:"Set divider",leftDivider:"Left Side",rightDivider:"Right Side",allDivider:"Both Sides",noDivider:"No Divider",hideCol:"Hide this column"}}}),PD="";function Xu(s,e,t){if(t){if(typeof t=="object"){const n=t[s];return typeof n=="string"?n:typeof n=="object"&&n?n.realname:void 0}if(typeof t=="function")return t(s,e)}}function Ng(s,e,t){let n;if(typeof s=="function"?n=s(e,t):typeof s=="object"&&(n=s[e]),n)return k(Re,{className:"dtable-cell-icon",icon:n})}Ze({name:"zentao",plugins:["group","checkable","nested",Qw,Jw,gg,e1,Ig,n1],defaultOptions:{colHover:"header",rowHeight:36,striped:!1,responsive:"window,parent,.search-form,~document_layout",checkable:"auto",nested:"auto",width:"100%",footer:void 0,showToolbarOnChecked:!0,checkOnClickRow:!0,groupDivider:!0,preserveNested:!0,extraHeight:"+",height(s){var r;const e=(r=this.element)==null?void 0:r.closest(".modal-dialog"),t=_(e||"body");let n=this.options.extraHeight;typeof n=="string"&&(n[0]==="+"&&(n=(e?".modal-header,.modal-footer,.search-form,36,#featureBar,":"#header,#mainMenu,#mainNavbar,.search-form,")+n.slice(1)),n=n.split(",")),Array.isArray(n)||(n=[n]);const i=n.reduce((o,a)=>a?typeof a=="number"||/^\d+$/.test(a)?o+Number(a):o+(t.find(a).outerHeight()||0):o,0);return Math.min(s,window.innerHeight-(e?64:1)-i)}},options(s){var l;const{checkable:e,footToolbar:t,footPager:n,footer:i}=s;if(i===void 0){const c=[];if(e&&c.push("checkbox"),t){const h=Array.isArray(t)?{items:t}:t;c.push("toolbar"),h.btnProps=_.extend({btnType:"primary",size:"sm"},h.btnProps),typeof h=="object"&&(typeof h.items=="function"&&(h.items=h.items.call(this)),Array.isArray(h.items)&&h.items.forEach(u=>{if((u==null?void 0:u.type)==="dropdown"){const f=u.menu||u["data-menu"];f&&f.searchBox&&(f.searchPlacement===void 0&&(f.searchPlacement="bottom"),f.maxHeight||(f.maxHeight=480))}})),s.footToolbar=h}e&&c.push("checkedInfo"),n&&c.push("flex","pager"),c.length&&(s.footer=c)}const r={"data-load":"table","data-selector":"dtable","data-target":s.id,...s.loadOptions},o=s.loadPartial||((l=this.parent||this.element)==null?void 0:l.closest(".modal"));o&&(r["data-partial"]=!0),n&&(n.btnProps=_.extend({type:"ghost",size:"sm"},n.btnProps),n.items&&n.items.forEach(c=>{c.type==="size-menu"?_.extend(!0,c,{itemProps:o?{...r,...c.itemProps}:{"data-app":"current",...c.itemProps},placement:"top"}):c.type==="link"&&_.extend(c,r)}));let{sortLink:a}=s;if(a&&(typeof a=="string"&&(a={url:a}),typeof a=="object"&&(a=_.extend(r,a)),s.sortLink=a),s.customCols){s.colResize===void 0&&(s.colResize=!0),s.sortCol===void 0&&(s.sortCol=!0);const c=()=>{this.trySaveColsSetting()};s.sortCol&&!s.onSortColEnd&&(s.onSortColEnd=c),s.colResize&&!s.on&&(s.onColResize=c),s.customCol===void 0&&(s.customCol=!0),s.customCol&&(s.onSetColBorder||(s.onSetColBorder=c),s.onSetColVisibility||(s.onSetColVisibility=c),s.canSetColVisibility||(s.canSetColVisibility=h=>{const u=this.getColInfo(h);return!u||u.side!=="center"?!1:this.layout.cols[u.side].list.length>1}))}return s},i18n:{zh_cn:{unassigned:"未指派"},zh_tw:{unassigned:"未指派"},en:{unassigned:"Unassigned"}},colTypes:{id:{width:60,fixed:"left",align:"center",sortType:!0,maxWidth:120},checkID:{width:80,fixed:"left",align:"left",sortType:!0,checkbox:!0,maxWidth:160},title:{width:.44,fixed:"left",align:"left",sortType:!0,flex:1,hint:!0,maxWidth:600},shortTitle:{width:.2,align:"left",sortType:!0,fixed:"left",checkbox:!0,flex:1,hint:!0,maxWidth:250},nestedTitle:{width:.5,align:"left",sortType:!0,fixed:"left",flex:1,nestedToggle:!0,nestedIndent:20,hint:!0,maxWidth:650},shortNestedTitle:{width:.33,align:"left",sortType:!0,fixed:"left",flex:1,nestedToggle:!0,nestedIndent:20,hint:!0,maxWidth:300},status:{width:80,align:"center",sortType:!0,onRenderCell(s,{col:e,row:t}){var o,a;const n=(o=t.data)==null?void 0:o[e.name];let i,r;return typeof n=="string"?(i=n,r=(a=e.setting.statusMap)==null?void 0:a[n]):typeof n=="object"&&n&&({name:i,label:r}=n),s[0]=k("span",{class:`${e.setting.statusClassPrefix??"status-"}${i}`},r??i),s}},user:{width:80,align:"center",sortType:!0,onRenderCell(s,{col:e,row:t,value:n}){const{userMap:i=this.options.userMap,userJoiner:r=" "}=e.setting;if(Array.isArray(n))s[0]=n.map(o=>Xu(o,t,i)).filter(Boolean).join(r);else{const o=Xu(n,t,i);o!==void 0&&(s[0]=o)}return s}},assign:{width:108,align:"left",sortType:!0,cellClass:"px-1.5",onRenderCell(s,e){const{col:t,row:n,value:i}=e,{options:r}=this,{userMap:o=r.userMap,currentUser:a=r.currentUser,assignLink:l,unassignedText:c=r.unassignedText||this.i18n("unassigned")}=t.setting,h=!i,u=i==="closed",f=h?c:Xu(i,n,o)??i;return s[0]=l?zu(l,e,[k("i",{className:"icon icon-hand-right"}),k("span",null,f)],{"data-toggle":u?void 0:"modal",className:`dtable-assign-btn${a===i?" is-me":""}${h?" is-unassigned":""}${u?" disabled":""}`}):f,s}},avatar:{width:44,align:"center",sortType:!0},avatarName:{width:108,align:"left",sortType:!0},avatarBtn:{width:108,align:"left",sortType:!0},category:{width:80,align:"center",flex:1,hint:!0},desc:{width:160,align:"left",flex:1,hint:!0},text:{width:136,align:"left",flex:1,hint:!0},icon:{width:52,align:"center",cellClass:"px-1",onRenderCell(s,{row:e,col:t,value:n}){const{iconRender:i}=t.setting,r=Ng(i,n,e);return r&&(s[0]=r),s}},pri:{width:68,align:"center",cellClass:"px-1",sortType:!0,onRenderCell(s,{col:e,value:t}){const{priList:n=this.options.priList||{}}=e.setting,i=n[t]??t;return s[0]=k(Wm,{pri:t,text:i}),s}},severity:{width:92,align:"center",cellClass:"px-1",sortType:!0,onRenderCell(s,{col:e,value:t}){const{severityList:n=this.options.severityList||{}}=e.setting,i=n[t]??t;return s[0]=k(Um,{severity:t,text:i}),s}},burn:{width:88,align:"center",onRenderCell(s,{col:e}){const t=s[0];if(!t)return s;const{burn:n}=e.setting,i={data:t,className:"border-b",width:64,height:24,responsive:!1,...n};return s[0]=k(gh,{...i}),s}},date:{width:96,align:"center",sortType:!0},time:{width:64,align:"center",sortType:!0},datetime:{width:128,align:"center",sortType:!0},progress:{width:64,align:"center",sortType:!0},money:{width:96,align:"right",sortType:!0},count:{width:92,align:"right",sortType:!0},number:{width:64,align:"center",sortType:!0,digits:-1},percent:{width:64,align:"center",sortType:!0,format(s){return typeof s=="string"&&s.endsWith("%")?s:`${s}%`}},actions:{minWidth:120,align:"left",fixed:"right"}},methods:{trySaveColsSetting(){this.data.saveColsSettingTimer&&clearTimeout(this.data.saveColsSettingTimer),this.data.saveColsSettingTimer=window.setTimeout(()=>{this.saveColsSetting(),this.data.saveColsSettingTimer=0},200)},getColsSetting(){const{colOrders:s,colsSizes:e,colBorders:t,colVisibility:n}=this.state,i={},r=(o,a)=>{const l=i[o];l?Object.assign(l,a):i[o]={id:o,...a}};return s&&Object.keys(s).forEach(o=>{r(o,{order:s[o]})}),e&&Object.keys(e).forEach(o=>{r(o,{extraWidth:e[o]})}),t&&Object.keys(t).forEach(o=>{r(o,{border:t[o]})}),n&&Object.keys(n).forEach(o=>{r(o,{show:n[o]})}),Object.values(i)},async saveColsSetting(){const s=this.getColsSetting();if(!s.length)return;const{saveFieldsUrl:e}=this.options.customCols||{};if(!e)return;const t=JSON.stringify(s);t!==this.data.lastSavedColsSetting&&(this.data.lastSavedColsSetting=t,await _.post(e,{fields:t}))}},onRenderCell(s,{row:e,col:t,value:n}){const{iconRender:i}=t.setting;if(i&&t.type!=="icon"){const r=Ng(i,n,e);r&&s.push(r)}return s},onRender(){const{customCols:s}=this.options;if(!s)return;const{custom:e,setGlobal:t,reset:n,resetGlobal:i}=s;return{children:k("div",{className:"absolute gap-1.5 pr-1.5 top-0 right-0 z-20 row items-center",style:"background:var(--dtable-header-bg);height: calc(var(--dtable-header-height) - 2px)"},k("div",{className:"w-px border-l h-5"}),k("a",{className:"btn ghost square size-sm rounded","data-toggle":"dropdown","data-placement":"bottom-end"},k("i",{class:"icon icon-cog-outline"})),k("menu",{class:"dropdown-menu menu"},e&&k("li",{class:"menu-item"},k("a",{href:e.url,"data-toggle":"modal"},e.text)),t&&k("li",{class:"menu-item"},k("a",{class:"ajax-submit",href:t.url},t.text)),n&&k("li",{class:"menu-item"},k("a",{class:"ajax-submit",href:n.url},n.text)),i&&k("li",{class:"menu-item"},k("a",{class:"ajax-submit",href:i.url},i.text))))}},onUpdated(){const{updateCheckedRows:s}=this.options;s&&s!==this.data.updateCheckedRows&&(this.data.updateCheckedRows=s,this.toggleCheckRows(s,!0))}},{buildIn:!0});const RD="",Zr=s=>`${s.col.name}[${s.row.id}]`,Qr=(s,e,t,n="value")=>{const i=Zr(e),r=s.data.formData[i]??e.value;return{[n]:r,className:"form-control",onChange:o=>s.setFormData(i,o instanceof Event?o.currentTarget.value:o),...t}};function Zu(s){const e=Zr(s);let t=this.data.pickRefs.get(e);return t||(t=Ce(),this.data.pickRefs.set(e,t)),Qr(this,s,{ref:t},"defaultValue")}const s1={input:{component:"input",props(s){return Qr(this,s,{type:"text"})}},select:{component:function(s){const{items:e,defaultValue:t,...n}=s;return k("select",{...n},e.map(i=>k("option",{key:i.value,value:i.value},i.text)))},props(s){return Qr(this,s)}},picker:{component:fn,props:Zu},datePicker:{component:Ii,props(s){return Qr(this,s,{className:"flex-auto",icon:"calendar"},"defaultValue")}},timePicker:{component:pa,props(s){return Qr(this,s,{className:"flex-auto",icon:"time"},"defaultValue")}},priPicker:{component:Wr,props:Zu},severityPicker:{component:$u,props:Zu}};Ze({name:"form",plugins:[og],data(){return{formData:{},pickRefs:new Map}},colTypes:{control:{custom(s){let{control:e}=s.col.setting;if(typeof e=="function"&&(e=e.call(this,s)),!e)return;typeof e=="string"&&(e={type:e});const{controlMap:t}=this.options,{type:n}=e,i={name:Zr(s)};let r;if([s1[n],t==null?void 0:t[n],e].forEach(o=>{if(o){const{props:a}=o;a&&_.extend(i,typeof a=="function"?a.call(this,s):a),r=o.component||r}}),!!r)return{component:r,props:i}}}},methods:{setFormData(s,e,t){var r,o;const{formData:n}=this.data;n[s]=e,t||(r=this.options.onFormChange)==null||r.call(this,s,e,n);const i=this.data.pickRefs.get(s);i&&((o=i.current)==null||o.setValue(e))},getFormData(s=!0){let{formData:e}=this.data;if(!s)return e;const{rows:t,cols:n}=this.layout,i=t.reduce((r,o)=>(n.list.forEach(a=>{var l;a.setting.control&&(r[Zr({col:a,row:o})]=(l=o.data)==null?void 0:l[a.name])}),r),{});return e=_.extend(i,e),s===!0?e:e[s]},resetFormData(){this.data.formData={};const{rows:s,cols:e}=this.layout;s.forEach(t=>{e.list.forEach(n=>{var r,o;if(!n.setting.control)return;const i=this.data.pickRefs.get(Zr({col:n,row:t}));i&&((o=i.current)==null||o.setValue(((r=t.data)==null?void 0:r[n.name])??""))})})}}});function Qu(s,e){return Object.entries(e).reduce((t,[n,i])=>{const r=t[n];return r?i===void 0?delete t[n]:Object.keys(i).forEach(o=>{const a=i[o];a===void 0?delete r[o]:r[o]=a}):i!==void 0&&(t[n]=i),t},s)}function Jr(s){return Object.entries(s).reduce((e,[t,n])=>(e&&typeof n=="object"&&(e[t]={...n}),e),{})}const Fg=Ze({name:"draft",defaultOptions:{draft:!0,selectAllOnFocus:!0,history:20},when:s=>!!s.draft,state(){return{stagingDraft:{},appliedDraft:{}}},methods:{getCellDraftValue(s,e){const t=this.getRowInfo(s);if(!t)return;const n=this.getColInfo(e);if(!n)return;const{id:i}=t,{name:r}=n,o=this.state.stagingDraft[i];if(o&&r in o)return o[r];const a=this.state.appliedDraft[i];return a&&r in a?a[r]:this.getCellValue(t,n)},getRowDraftData(s,e){const t=this.getRowInfo(s);return t?this.layout.cols.list.reduce((n,i)=>{if(!(e!=null&&e.includeIndexCol)&&i.name==="INDEX")return n;const r=this.getCellDraftValue(t,i);return n[i.name]=r===void 0?e==null?void 0:e.emptyCellValue:r,n},{}):{}},getColDraftData(s,e){const t=this.getColInfo(s);return t?this.layout.rows.reduce((n,i)=>{const r=this.getCellDraftValue(i,t);return n[i.id]=r===void 0?e==null?void 0:e.emptyCellValue:r,n},e!=null&&e.includeHeaderRow?{HEADER:this.getCellDraftValue("HEADER",t)}:{}):{}},stageDraft(s,e){var r;const{stagingDraft:t}=this.state;if(((r=this.options.onStageDraft)==null?void 0:r.call(this,s,t))===!1)return;const n=Jr(t);Qu(t,s);const i=()=>{var o,a;(o=e==null?void 0:e.callback)==null||o.call(e,s),(a=this.options.afterStageDraft)==null||a.call(this,s,this.state.stagingDraft,n,{skipUpdate:!!(e!=null&&e.skipUpdate)})};e!=null&&e.skipUpdate?i():this.update(i)},applyDraft(s,e){const{stagingDraft:t,appliedDraft:n}=this.state,i=Jr(n);Object.entries(s).forEach(([o,a])=>{const l=t[o];l&&typeof a=="object"&&(a===null?delete t[o]:Object.keys(a).forEach(h=>{l[h]===a[h]&&delete l[h]}),Object.keys(l).length||delete t[o]);const c=n[o];c?a===null?delete n[o]:Object.assign(c,a):a!==null&&(n[o]=a)});const r=()=>{var o,a;(o=e==null?void 0:e.callback)==null||o.call(e,s),(a=this.options.afterApplyDraft)==null||a.call(this,s,this.state.appliedDraft,i)};e!=null&&e.skipUpdate?r():this.forceUpdate(r)},renderDraftCell(s,{col:e,row:t}){let n=this.getCellDraftValue(t,e)??"";return typeof n=="string"&&!n.length&&t.id==="HEADER"&&(n=e.name),s[0]={children:n,attrs:{title:n}},s}},onRenderCell(s,...e){return this.options.skipRenderDraftCell?s:this.renderDraftCell(s,...e)},onRenderHeaderCell(s,...e){return this.options.skipRenderDraftCell?s:this.renderDraftCell(s,...e)}}),OD="";function Pg(s,e,t){return s.every(n=>e[n]===t[n])}const i1=Ze({name:"editable",plugins:[Fg],defaultOptions:{editable:!0,selectAllOnFocus:!0,history:20,skipRenderDraftCell:!0,emptyCellValue:""},when:s=>!!s.editable,events:{dblclick(s){this.editCell(this.getPointerInfo(s))},click(s){const e=this.getPointerInfo(s);e&&e.cellElement.classList.contains("is-selected")&&this.editCell(e)}},data(){return{editingInputRef:Ce()}},methods:{isCellEditing(s,e){const{editingCell:t}=this.state;return!!t&&t.rowID===s&&t.colName===e},editCell(s){const{editable:e,headerEditable:t}=this.options;s&&(typeof e=="function"&&!e(s.rowID,s.colName)||!t&&s.rowID==="HEADER")&&(s=void 0),this.data.editingInputRef.current=null,this.data.needAutoFocus=!0,this.setState({editingCell:s?{colName:s.colName,rowID:s.rowID}:void 0})},deleteCells(s){const e={},{emptyCellValue:t}=this.options;return s.forEach(n=>{const i=e[n.rowID];i?i[n.colName]=t:e[n.rowID]={[n.colName]:t}}),Object.keys(e).length?(this.stageDraft(e),!0):!1},deleteRows(s,e){Array.isArray(s)||(s=[s]);const t=this.layout.cols.list.reduce((u,f)=>(f.name!=="HEADER"&&u.push(f.name),u),[]),n=s.reduce((u,f)=>{const p=this.getRowInfo(f);return p&&p.id!=="HEADER"&&u.push(p),u},[]).sort((u,f)=>u.index-f.index);if(!n.length)return;const i=new Set(n.map(u=>u.index)),r=new Map,o=this.layout.rows,a=o.length,{emptyCellValue:l}=this.options;let c=n[0].index;for(let u=c+1;u<a;u++){if(i.has(u))continue;const f=o[u];r.set(c,this.getRowDraftData(f,{emptyCellValue:l})),c++}const h={};c=n[0].index;for(let u=c;u<a;u++){const f=o[u],p=this.getRowDraftData(f,{emptyCellValue:l}),g=r.get(u)||{};Pg(t,p,g)||(h[f.id]=g)}Object.keys(h).length&&this.stageDraft(h,{skipUpdate:e==null?void 0:e.skipUpdate})},deleteCols(s,e){Array.isArray(s)||(s=[s]);const t=s.reduce((u,f)=>{const p=this.getColInfo(f);return p&&p.name!=="INDEX"&&u.push(p),u},[]).sort((u,f)=>u.index-f.index);if(!t.length)return;const n=new Set(t.map(u=>u.index)),i=new Map,{cols:{list:r}}=this.layout,o=r.length,a=this.layout.rows.reduce((u,f)=>(u.push(f.id),u),["HEADER"]),{emptyCellValue:l}=this.options;let c=t[0].index;for(let u=c+1;u<o;u++){if(n.has(u))continue;const f=r[u];i.set(c,this.getColDraftData(f,{emptyCellValue:l,includeHeaderRow:!0})),c++}const h={};c=t[0].index;for(let u=c;u<o;u++){const f=r[u],p=this.getColDraftData(f,{emptyCellValue:l,includeHeaderRow:!0}),g=i.get(u)||{};if(!Pg(a,p,g))for(const y of a)h[y]||(h[y]={}),h[y][f.name]=g[y]??l}Object.keys(h).length&&this.stageDraft(h,{skipUpdate:e==null?void 0:e.skipUpdate})},handleEditingInputChange(s){var o,a;const e=(o=s.target)==null?void 0:o.value,{editingCell:t}=this.state;if(typeof e!="string"||!t)return;const{rowID:n,colName:i}=t,r=this.getCellDraftValue(n,i);r!==e&&((a=this.options.onEditCell)==null?void 0:a.call(this,{rowID:n,colName:i,value:e,oldValue:r}))!==!1&&this.stageDraft({[n]:{[i]:e}})},handleEditingInputBlur(){this.editCell()},handleEditingKeyDown(s){var e;s.key==="Enter"?(e=this.data.editingInputRef.current)==null||e.blur():s.key==="Esc"&&this.editCell()},renderEditableCell(s,{col:e,row:t},n){const{id:i}=t;if(this.isCellEditing(i,e.name)){const r=`${this.getCellDraftValue(i,e.name)??""}`;return[{outer:!0,className:"is-editing",children:A("input",{ref:this.data.editingInputRef,class:"dtable-editing-input",type:"text",defaultValue:r,style:{textAlign:e.setting.align},onChange:this.handleEditingInputChange,onBlur:this.handleEditingInputBlur,onKeyDown:this.handleEditingKeyDown,onPaste:this.options.onPasteToCell})}]}return this.renderDraftCell(s,{row:t,col:e},n)}},onUpdated(){const s=this.data.editingInputRef.current;s&&this.data.needAutoFocus&&(this.data.needAutoFocus=!1,s.focus({preventScroll:!0}),this.options.selectAllOnFocus&&s.select())},onRender(){return{className:{"dtable-editable":this.options.editable,"dtable-editing":this.state.editingCell}}},onRenderCell(...s){return this.renderEditableCell(...s)},onRenderHeaderCell(...s){return this.renderEditableCell(...s)}}),jD="",r1=/C(\d+)R(\d+)/i,o1=/(?:C(\d+))?(?:R(\d+))?/i;function Mg(s){const e=r1.exec(s);if(!e||e.length<3)return;const[,t,n]=e;return{col:+t,row:+n}}function Ju(s){const e=o1.exec(s);if(!e)return;const[,t=-1,n=-1]=e,i=+t,r=+n;return{col:i,row:r}}function ed(s){const e=[],t=Ju(s);if(!t)return e;const{col:n,row:i}=t;if(n>=0)if(i>=0)e.push({col:n,row:i});else{const r=this.layout.rows.length;for(let o=0;o<r;o++)e.push({col:n,row:o})}else if(i>=0){const{cols:r}=this.layout,o=r.list.length;for(let a=0;a<o;a++)e.push({col:a,row:i})}return e}function Rg(s){const[e,t]=s.split(":");if(e){if(!t)return ed.call(this,e)}else return t?ed.call(this,t):[];const n=Ju(e),i=Ju(t);if(!n||!i)return[];const r=Math.min(n.col,i.col),o=Math.max(n.col,i.col),a=Math.min(n.row,i.row),l=Math.max(n.row,i.row),c=[],h=Object.keys(this.layout.cols.map).length;for(let u=r;u<=o;u++)if(a<0||l<0){const f=this.layout.rows.length;for(let p=0;p<f;p++)c.push({col:u,row:p})}else for(let f=a;f<=l;f++)if(u<0)for(let p=0;p<h;p++)c.push({col:p,row:f});else c.push({col:u,row:f});return c}function a1(s){return s.reduce((e,t)=>(typeof t=="object"?e.push(t):t.includes(":")?e.push(...Rg.call(this,t)):e.push(...ed.call(this,t)),e),[])}function td(s,e){const{col:t,row:n}=s,i=[];if(t>=0&&i.push(`C${t}`),n>=0&&i.push(`R${n}`),e){const r=td(e);r&&i.push(":",r)}return i.join("")}function nd(s,e){const{selectable:t}=s.options;return typeof t=="function"?t.call(s,e):!!t}function sd(s,e={}){var f;Array.isArray(s)||(s=[s]);let t=a1.call(this,s);const n=(f=this.options.beforeSelectCells)==null?void 0:f.call(this,t);n&&(t=n);const{clearBefore:i=!0,deselect:r,selecting:o,callback:a}=e,{selectingMap:l,selectedMap:c}=this.state,h=o?l:c;l.clear(),i&&c.clear();let u=!1;return r?t.forEach(p=>{if(!nd(this,p))return;const{col:g,row:y}=p,v=h.get(g);v&&(v.delete(y),v.size||h.delete(g)),u=!0}):t.forEach(p=>{if(!nd(this,p))return;const{col:g,row:y}=p,v=h.get(g);v?v.add(y):h.set(g,new Set([y])),u=!0}),u?(this.update({},()=>{var p;a==null||a.call(this,t),(p=this.options.onSelectCells)==null||p.call(this,t)}),t):[]}function l1(s){const{selectedMap:e}=this.state;let t=-1,n=-1;for(const[i,r]of e.entries()){n=n<0?i:Math.min(i,n);const o=Math.min(...r);t=t<0?o:Math.min(o,t)}if(!(t<0||n<0)&&(s==="down"?t++:s==="up"?t--:s==="left"?n--:n++,t>=0&&n>=0&&t<this.layout.rows.length&&n<this.layout.cols.list.length)){const i={col:n,row:t};if(nd(this,i))return this.scrollTo(i),this.selectCells([i]),i}}function c1(s,e){return sd.call(this,s,{...e,selecting:!0})}function h1(s,e){return sd.call(this,s,{...e,deselect:!0})}function u1(){const{cols:s}=this.layout,e=s.list.length,t=this.layout.rows.length,{selectedMap:n}=this.state,i=typeof this.options.selectable=="function"?this.options.selectable:!1;for(let r=0;r<e;r++){let o=n.get(r);o||(o=new Set,n.set(r,o));for(let a=0;a<t;a++)i&&!i({row:a,col:r})||o.add(a)}this.forceUpdate()}function d1(){const{selectedMap:s}=this.state;return s.size?(s.clear(),this.forceUpdate(),!0):!1}function f1(s){var t;const e=typeof s=="string"?Mg(s):s;return e?((t=this.state.selectedMap.get(e.col))==null?void 0:t.has(e.row))??!1:!1}function Lg(s,e){for(const[,t]of s.state.selectedMap.entries())if(t.has(e))return!0;for(const[,t]of s.state.selectingMap.entries())if(t.has(e))return!0;return!1}function p1(s){var t;const e=(t=this.getRowInfo(s))==null?void 0:t.index;return typeof e!="number"?!1:this.layout.cols.list.every(n=>n.name==="INDEX"||this.isCellSelected({col:n.index,row:e}))}function m1(s){var n;const e=(n=this.getColInfo(s))==null?void 0:n.index;if(typeof e!="number")return!1;const{rows:t}=this.layout;return t.every(i=>this.isCellSelected({col:e,row:i.index}))}function zg(s,e){var t,n;return!!((t=s.state.selectedMap.get(e))!=null&&t.size||(n=s.state.selectingMap.get(e))!=null&&n.size)}function g1(s){var t;const e=typeof s=="string"?Mg(s):s;return e?((t=this.state.selectingMap.get(e.col))==null?void 0:t.has(e.row))??!1:!1}function y1(){const s=[];for(const[e,t]of this.state.selectedMap.entries())for(const n of t)s.push({col:e,row:n});return s}function v1(){const s=[];for(const[t,n]of this.state.selectedMap.entries())n.size&&s.push(t);return[...new Set(s)].map(t=>this.getColInfo(t)).filter(t=>t&&this.isColSelected(t)).sort((t,n)=>t.index-n.index)}function x1(){const s=[];for(const[,t]of this.state.selectedMap.entries())s.push(...t);return[...new Set(s)].map(t=>this.getRowInfo(t)).filter(t=>t&&this.isRowSelected(t)).sort((t,n)=>t.index-n.index)}function _1(){let s=0;for(const e of this.state.selectedMap.values())s+=e.size;return s}function id(s,e,t){var c,h;const n=s.getPointerInfo(e);if(!n||n.target.closest("input,textarea,[contenteditable]"))return;const{rowID:i,colName:r}=n,o=((c=s.getColInfo(r))==null?void 0:c.index)??-1;if(o<0)return;const a=i==="HEADER";if(a&&(t!=null&&t.ignoreHeaderCell))return;const l=a?-1:((h=s.getRowInfo(i))==null?void 0:h.index)??-1;return{col:o,row:l}}const b1=Ze({name:"selectable",defaultOptions:{selectable:!0,markSelectRange:!0},when:s=>!!s.selectable,plugins:[Ur],state(){return{selectedMap:new Map,selectingMap:new Map}},methods:{selectCells:sd,selectNextCell:l1,selectingCells:c1,deselectCells:h1,isCellSelected:f1,isCellSelecting:g1,isRowSelected:p1,isColSelected:m1,hasCellSelectInRow:Lg,hasCellSelectInCol:zg,getSelectedCols:v1,getSelectedRows:x1,getSelectedCells:y1,selectAllCells:u1,deselectAllCells:d1,getSelectedCellsSize:_1},events:{mousedown(s){if(this.data.disableSelectable)return;const e=id(this,s);s.button!==0&&(!e||this.isCellSelected(e)||e.row<0&&this.isColSelected(e.col)||e.col<1&&this.isRowSelected(e.row))||(this.data.selectingStart=e,this.startScrollToMouse(),e&&s.stopPropagation())},document_mouseup(s){const{selectingStart:e}=this.data;if(this.stopScrollToMouse(),!e)return;this.data.selectingStart=void 0;const t=id(this,s);if(t){const n=td(e,t);n&&(requestAnimationFrame(()=>this.selectCells(n)),s.stopPropagation())}},document_click(s){const e=s.target;if(!e)return;const{ignoreDeselectOn:t}=this.options;e.closest(`#${this.id}${t?`,${t}`:""}`)||this.deselectAllCells()},mousemovesmooth(s){const e=this,{selectingStart:t}=e.data;if(!t)return;const n=id(e,s);if(!n)return;const i=td(t,n);i&&(e.selectingCells(i),s.preventDefault(),s.stopPropagation())}},onRender(){if(this.options.selectable)return{className:"dtable-selectable"}},onRenderCell(s,{row:e,col:t}){const n=this.getRowInfo(e.id);if(!n)return s;const i={col:t.index,row:n.index};return this.isCellSelecting(i)?s.push({outer:!0,className:"is-select is-selecting"}):this.isCellSelected(i)&&s.push({outer:!0,className:"is-select is-selected"}),this.options.markSelectRange&&t.name==="INDEX"&&(this.isRowSelected(n)?s.push({outer:!0,className:"is-row-selected has-cell-selected"}):Lg(this,n.index)&&s.push({outer:!0,className:"has-cell-selected"})),s},onRenderHeaderCell(s,{col:e}){return this.options.markSelectRange&&e.name!=="INDEX"&&zg(this,e.index)&&(s.push({outer:!0,className:"has-cell-selected"}),this.isColSelected(e)&&s.push({outer:!0,className:"is-col-selected"})),s}}),w1=Ze({name:"hotkey",when:s=>!!s.hotkeys,onMounted(){const{hotkeys:s}=this.options;if(!s)return;const e={};if(Object.keys(s).forEach(n=>{const i=s[n];n.split(",").forEach(r=>{r=r.trim(),r.length&&(e[r]=i)})}),!Object.keys(e).length)return;const t=`dtable_${this.id}`;_(this.element).hotkeys(e,{scope:t}),this.data.hotkeysScope=t},onUnmounted(){this.data.hotkeysScope&&_(this.element).unbindHotkeys(this.data.hotkeysScope)}});function Za(s,e){const t=new Set([...Object.keys(s),...Object.keys(e)]);return Array.from(t).reduce((n,i)=>{const r=s[i]||{},o=e[i]||{};if(r===o)return n;const a=new Set([...Object.keys(r),...Object.keys(o)]),l={};let c=!1;return a.forEach(h=>{const u=r[h],f=o[h];u!==f&&(l[h]=u,c=!0)}),c&&(n[i]=l),n},{})}const C1=Ze({name:"history",plugins:[hg,Fg],defaultOptions:{history:!0,historyTarget:"staging",historyThreshold:10},when:s=>!!s.history,options(s){const{afterApplyDraft:e,afterStageDraft:t,historyTarget:n,history:i}=s;return{afterApplyDraft:i&&n==="applied"?(r,o,a)=>{e&&e.call(this,r,o,a),this.addHistory({after:Za(o,a),before:Za(a,o)})}:e,afterStageDraft:i&&n!=="applied"?(r,o,a,l)=>{t&&t.call(this,r,o,a,l),this.addHistory({after:Za(o,a),before:Za(a,o)})}:t}},data(){return{historyIdx:1}},state(){return{historyCursor:0,historyItems:[]}},methods:{addHistory(s){let{historyCursor:e,historyItems:t}=this.state;e>0&&(t.splice(0,e).forEach(r=>{typeof r=="number"&&this.data.store.session.remove(`HISTORY:${this.id}:${r}`)}),e=0),t=[s,...t];const{historyThreshold:n}=this.options;if(n&&t.length>n)for(let i=n;i<t.length;i++){const r=t[i];if(typeof r=="number")break;const o=this.data.historyIdx++;this.data.store.session.set(`HISTORY:${this.id}:${o}`,r),t[i]=o}this.setState({historyCursor:e,historyItems:t})},getHistory(s){if(typeof s=="object")return s;const{historyCursor:e,historyItems:t}=this.state;s===void 0&&(s=e);const n=t[s];return typeof n=="number"?this.data.store.session.get(`HISTORY:${this.id}:${n}`):n},applyHistory(s,e,t){const n={historyCursor:s},i=this.options.historyTarget==="applied",{appliedDraft:r,stagingDraft:o}=this.state,a=Jr((i?r:o)??{});i?n.appliedDraft=Qu(r,e):n.stagingDraft=Qu(o,e),this.setState(n,()=>{var c;t==null||t();const l=Object.entries(e).reduce((h,[u,f])=>{if(f){const p={};Object.entries(f).forEach(([g,y])=>{p[g]=y===void 0?this.getCellDraftValue(u,g):y}),h[u]=p}return h},{});(c=this.options.onHistoryApplied)==null||c.call(this,l,i?r:o??{},a)})},undoHistory(s){if(!this.canUndoHistory())return!1;const{historyCursor:e}=this.state,t=this.getHistory(e);return t?(this.applyHistory(e+1,Jr(t.before),s),!0):!1},redoHistory(s){if(!this.canRedoHistory())return!1;const{historyCursor:e}=this.state,t=this.getHistory(e-1);return t?(this.applyHistory(e-1,Jr(t.after),s),!0):!1},canUndoHistory(){const{historyCursor:s,historyItems:e}=this.state;return e.length>0&&s<e.length},canRedoHistory(){return this.state.historyCursor>0}}}),KD="";function k1(s,e){const{colsCount:t,rowsCount:n}=s.getGridSize(),{cols:i=[]}=e,{showRowIndex:r,defaultColWidth:o}=s.options,a=[];r!==!1&&a.push({width:`${n+1}`.length*8+24,name:"INDEX",fixed:"left",align:"right",title:"#",...i.find(l=>l.name==="INDEX")});for(let l=0;l<t;++l){const c=`C${l+1}`,h={name:c,width:o,...i.find(u=>u.name===c)};a.push(h)}return{cols:a,data:n}}function S1(s,e,t){var n,i;return e.name==="INDEX"?s.id==="HEADER"?t:s.index+1:s.id!=="HEADER"?(i=(n=this.options.datasource.data)==null?void 0:n[+s.id])==null?void 0:i[+e.name.replace("C","")-1]:t}function Qa(s,e,t){s.selectNextCell(t)&&(e.preventDefault(),e.stopPropagation())}const D1={delete(s){_(s.target).is("input,textarea")||this.deleteSelections()},cut(){this.cutSelections()},selectAll(s){this.state.editingCell||(this.selectAllCells(),s.preventDefault())},paste(){this.pasteToSelection()},copy(s){this.copySelections(),s.preventDefault()},focus(){const s=this.getSelectedCells()[0];if(!s)return;const e=this.getColInfo(s.col),t=this.getRowInfo(s.row);!e||!t||this.editCell({rowID:t.id,colName:e.name})},cancel(){this.deselectAllCells()},undo(){this.undoHistory()},redo(){this.redoHistory()},selectRight(s){Qa(this,s,"right")},selectLeft(s){Qa(this,s,"left")},selectDown(s){Qa(this,s,"down")},selectUp(s){Qa(this,s,"up")}};function Og(s,e){Array.isArray(s)||(s=[s]);let t=0,n=0;const i=e==null?void 0:e.ignoreEmptyCell;return s.forEach(r=>{Object.entries(r).forEach(([o,a])=>{o!=="HEADER"&&(t=Math.max(t,+o+1),n=Math.max(n,...Object.keys(a).map(l=>i&&Hg(a[l])||l[0]!=="C"?0:+l.replace("C",""))))})}),{maxRow:t,maxCol:n}}function E1(){const{minRows:s=1,minCols:e=1,extraRows:t=0,extraCols:n=0,datasource:i}=this.options,{data:r=[],cols:o=[]}=i,{stagingDraft:a,appliedDraft:l}=this.state,{maxRow:c,maxCol:h}=Og([a,l]);return{rowsCount:Math.max(c,r.length+t,s,this.data.rowsCount??0),colsCount:Math.max(h,e,o.length,r.reduce((u,f)=>Math.max(u,f.length),0)+n,this.data.colsCount??0)}}function A1(s=1,e){const{rowsCount:t}=this.getGridSize();let n=t;return typeof s=="number"?n=t+Math.max(s,0):Array.isArray(s)&&(n=t+Math.max(s.length,0),this.stageDraft(s.reduce((i,r,o)=>(Array.isArray(r)&&(r=r.reduce((a,l,c)=>(a[`C${c+1}`]=l,a),{})),i[t+o]=r,i),{}),{skipUpdate:!0})),n>t?(this.data.rowsCount=n,e!=null&&e.skipUpdate||this.update({dirtyType:"options"},()=>{(e==null?void 0:e.select)!==!1&&this.selectCells(`R${t}:R${n-1}`),(e==null?void 0:e.autoScroll)!==!1&&this.scrollTo({row:n-1,col:0})}),!0):!1}function T1(s=1,e){const{colsCount:t}=this.getGridSize();let n=t;const{showRowIndex:i}=this.options;return typeof s=="number"?n=t+Math.max(s,0):Array.isArray(s)&&(n=t+Math.max(s.length,0),this.stageDraft(s.reduce((r,o,a)=>(o.forEach((l,c)=>{const h=r[c],u=`C${t+a+(i?1:0)}`;h?h[u]=l:r[c]={[u]:l}}),r),{}),{skipUpdate:!0})),n>t?(this.data.colsCount=n,e!=null&&e.skipUpdate||this.update({dirtyType:"options"},()=>{(e==null?void 0:e.select)!==!1&&this.selectCells(`C${t+(i?1:0)}:C${n-1+(i?1:0)}`),(e==null?void 0:e.autoScroll)!==!1&&this.scrollTo({col:n-(i?0:1),row:0})}),!0):!1}function $1(s,e){const t=this.getGridSize(),n=Math.max(0,(s.rowsCount??0)-t.rowsCount),i=Math.max(0,(s.colsCount??0)-t.colsCount);return n&&this.appendRows(n,{skipUpdate:!0,select:!1}),i&&this.appendCols(i,{skipUpdate:!0,select:!1}),n||i?(e!=null&&e.skipUpdate||this.update({dirtyType:"options"}),!0):!1}function Hg(s){return s==null||typeof s=="string"&&!s.length}function jg(s){let e=0,t=0;return s.forEach((n,i)=>{n.forEach((r,o)=>{Hg(r)||(e=Math.max(e,o),t=Math.max(t,i))})}),s.slice(0,t+1).map(n=>n.slice(0,e+1))}Ze({name:"datagrid",plugins:[i1,b1,w1,Ig,C1,Uu],defaultOptions:{defaultColWidth:80,headerEditable:!0,minRows:20,minCols:10,extraRows:5,extraCols:5,showRowIndex:!0,rowHover:!1,colHover:!1,cellHover:!0,bordered:!0,striped:!1,datagridHotkeys:{},cellValueSplitter:"	",cellValueGetter:S1,hotkeys:{},autoExpandGrid:!0},options(s){const{datagridHotkeys:e,datasource:t,hotkeys:n,editable:i,selectable:r,beforeSelectCells:o,showRowIndex:a,colResize:l,onPasteToCell:c,afterStageDraft:h}=s,u={delete:"Delete,Backspace",selectAll:"$mod+a",paste:"$mod+v",copy:"$mod+c",focus:"Enter",cancel:"Escape",cut:"$mod+x",redo:"$mod+Shift+z",undo:"$mod+z",selectRight:"Tab,ArrowRight",selectLeft:"ArrowLeft",selectDown:"ArrowDown",selectUp:"ArrowUp"};return{hotkeys:{...n,...Object.entries({...u,...e}).reduce((p,[g,y])=>{var v;return y&&(p[y===!0?u[g]:y]=(v=D1[g])==null?void 0:v.bind(this)),p},{})},colResize:l?p=>(typeof l!="function"||l.call(this,p))&&p!=="INDEX":!1,editable:i?(p,g)=>typeof i=="function"&&!i(p,g)?!1:g!=="INDEX":!1,selectable:r?p=>typeof r=="function"&&!r(p)?!1:p.col>=(a?1:0):!1,beforeSelectCells:a?p=>(p.every(g=>g.col===0)&&(p=Rg.call(this,`R${Math.min(...p.map(g=>g.row))}:R${Math.max(...p.map(g=>g.row))}`)),o?o.call(this,p):p):o,...k1(this,t),onPasteToCell:p=>{var y;const g=(y=p.clipboardData)==null?void 0:y.getData("text");typeof g=="string"&&(g.includes("	")||g.includes(`
`))&&this.state.editingCell&&(this.pasteCells(this.state.editingCell,{data:g}),p.preventDefault()),c==null||c.call(this,p)},afterStageDraft:(p,g,y,v)=>{h==null||h.call(this,p,g,y,v);const{autoExpandGrid:b}=this.options;if(!b)return;const{maxCol:w,maxRow:S}=Og(g,{ignoreEmptyCell:!0}),{extraCols:E=1,extraRows:$=1}=this.options;this.expandGridSize({rowsCount:S+(typeof b=="number"?b:$),colsCount:w+(typeof b=="number"?b:E)},v)}}},methods:{deleteSelections(){const s=[];for(const[e,t]of this.state.selectedMap.entries()){const n=this.getColInfo(e);if(n)for(const i of t){const r=this.getRowInfo(i);r&&s.push({colName:n.name,rowID:r.id})}}return this.deleteCells(s)},deleteSelectedRows(){const s=this.getSelectedRows();return s.length?(this.deleteRows(s),this.deselectAllCells(),!0):!1},deleteSelectedCols(){const s=this.getSelectedCols();return s.length?(this.deleteCols(s),this.deselectAllCells(),!0):!1},copySelectedCols(){const s=this.getSelectedCols();if(!s.length)return!1;const e=this.layout.rows.length,t=[];for(let i=-1;i<e;++i)t.push(s.map(r=>{const o=this.getCellDraftValue(i,r);return i===-1&&o===r.name?"":o}));const n=jg(t).map(i=>i.join("	")).join(`
`);return navigator.clipboard.writeText(n),!0},clearSelectedCols(){const s=this.getSelectedCols();if(!s.length)return!1;const e={},{emptyCellValue:t}=this.options;return[this.getRowInfo("HEADER"),...this.layout.rows].forEach(n=>{const i={};s.forEach(r=>{const o=this.getCellDraftValue(n,r);o!=null&&o!==t&&(i[r.name]=t)}),Object.keys(i).length&&(e[n.id]=i)}),Object.keys(e).length?(this.stageDraft(e),!0):!1},async pasteToSelectedCol(){const s=this.getSelectedCols();return s.length?await this.pasteCells({colName:s[0].name,rowID:"HEADER"}):!1},cutSelectedCols(){return this.copySelectedCols(),this.clearSelectedCols()},copySelections(){const s=this.getSelectedCells();if(!s.length)return!1;let e=Number.MAX_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER;s.forEach(r=>{e=Math.min(r.col,e),t=Math.min(r.row,t)});const n=[];s.forEach(r=>{const o=this.getCellDraftValue(r.row,r.col);let a=n[r.row-t];a||(a=[],n[r.row-t]=a),a[r.col-e]=o});const i=jg(n).map(r=>r.join("	")).join(`
`);return navigator.clipboard.writeText(i),!0},cutSelections(){return this.copySelections(),this.deleteSelections()},async pasteCells(s,e){var f,p;let t=-1,n=-1;if("colName"in s){const g=this.getColInfo(s.colName),y=this.getRowInfo(s.rowID);if(!g||!y)return!1;t=g.index,n=y.index}else t=s.col,n=s.row;let i=e==null?void 0:e.data;if(i===void 0)try{const g="clipboard-read";if((await navigator.permissions.query({name:g})).state==="denied")return(f=this.options.onReadClipboardFail)==null||f.call(this),!1;i=await navigator.clipboard.readText()}catch{return(p=this.options.onReadClipboardFail)==null||p.call(this),!1}if(!i.length)return!1;const r={},o=[],a=(e==null?void 0:e.expandCells)!==!1;let l=!1,c=0,h=0;const u=i.split(/\r?\n/);return u.forEach((g,y)=>{var S;if(!g.trim().length&&y===u.length-1)return;const v=y+n;let b=(S=this.getRowInfo(v))==null?void 0:S.id;if(b===void 0){if(!a)return;l=!0,b=`${v}`}let w=r[b];w||(w={},r[b]=w),g.split("	").forEach((E,$)=>{var L;const B=$+t;let N=(L=this.getColInfo(B))==null?void 0:L.name;if(N===void 0){if(!a)return;l=!0,N=`C${B}`}w[N]=E,o.push({col:B,row:v}),c=Math.max(c,v),h=Math.max(h,B)})}),this.stageDraft(r,{skipUpdate:!0}),(e==null?void 0:e.select)!==!1&&this.selectCells(o),this.update({dirtyType:l?"options":void 0},()=>{e!=null&&e.autoscroll&&this.scrollTo({col:h,row:c})}),!0},pasteToSelection(){const s=this.getSelectedCells();if(!s.length)return Promise.resolve(!1);const e=s[0];return this.pasteCells(e)},getGridSize:E1,appendRows:A1,appendCols:T1,expandGridSize:$1},onRender(){return{className:"dtable-datagrid"}}});const GD="",YD="",XD="",ZD="",QD="",JD="",eE="",tE="",nE="",sE="",iE="",rE="",oE="",aE="",lE="",cE="";var Wg=11;function I1(s,e){var t=e.attributes,n,i,r,o,a;if(!(e.nodeType===Wg||s.nodeType===Wg)){for(var l=t.length-1;l>=0;l--)n=t[l],i=n.name,r=n.namespaceURI,o=n.value,r?(i=n.localName||i,a=s.getAttributeNS(r,i),a!==o&&(n.prefix==="xmlns"&&(i=n.name),s.setAttributeNS(r,i,o))):(a=s.getAttribute(i),a!==o&&s.setAttribute(i,o));for(var c=s.attributes,h=c.length-1;h>=0;h--)n=c[h],i=n.name,r=n.namespaceURI,r?(i=n.localName||i,e.hasAttributeNS(r,i)||s.removeAttributeNS(r,i)):e.hasAttribute(i)||s.removeAttribute(i)}}var Ja,B1="http://www.w3.org/1999/xhtml",Ot=typeof document>"u"?void 0:document,N1=!!Ot&&"content"in Ot.createElement("template"),F1=!!Ot&&Ot.createRange&&"createContextualFragment"in Ot.createRange();function P1(s){var e=Ot.createElement("template");return e.innerHTML=s,e.content.childNodes[0]}function M1(s){Ja||(Ja=Ot.createRange(),Ja.selectNode(Ot.body));var e=Ja.createContextualFragment(s);return e.childNodes[0]}function R1(s){var e=Ot.createElement("body");return e.innerHTML=s,e.childNodes[0]}function L1(s){return s=s.trim(),N1?P1(s):F1?M1(s):R1(s)}function el(s,e){var t=s.nodeName,n=e.nodeName,i,r;return t===n?!0:(i=t.charCodeAt(0),r=n.charCodeAt(0),i<=90&&r>=97?t===n.toUpperCase():r<=90&&i>=97?n===t.toUpperCase():!1)}function z1(s,e){return!e||e===B1?Ot.createElement(s):Ot.createElementNS(e,s)}function O1(s,e){for(var t=s.firstChild;t;){var n=t.nextSibling;e.appendChild(t),t=n}return e}function rd(s,e,t){s[t]!==e[t]&&(s[t]=e[t],s[t]?s.setAttribute(t,""):s.removeAttribute(t))}var Ug={OPTION:function(s,e){var t=s.parentNode;if(t){var n=t.nodeName.toUpperCase();n==="OPTGROUP"&&(t=t.parentNode,n=t&&t.nodeName.toUpperCase()),n==="SELECT"&&!t.hasAttribute("multiple")&&(s.hasAttribute("selected")&&!e.selected&&(s.setAttribute("selected","selected"),s.removeAttribute("selected")),t.selectedIndex=-1)}rd(s,e,"selected")},INPUT:function(s,e){rd(s,e,"checked"),rd(s,e,"disabled"),s.value!==e.value&&(s.value=e.value),e.hasAttribute("value")||s.removeAttribute("value")},TEXTAREA:function(s,e){var t=e.value;s.value!==t&&(s.value=t);var n=s.firstChild;if(n){var i=n.nodeValue;if(i==t||!t&&i==s.placeholder)return;n.nodeValue=t}},SELECT:function(s,e){if(!e.hasAttribute("multiple")){for(var t=-1,n=0,i=s.firstChild,r,o;i;)if(o=i.nodeName&&i.nodeName.toUpperCase(),o==="OPTGROUP")r=i,i=r.firstChild;else{if(o==="OPTION"){if(i.hasAttribute("selected")){t=n;break}n++}i=i.nextSibling,!i&&r&&(i=r.nextSibling,r=null)}s.selectedIndex=t}}},eo=1,Vg=11,Kg=3,qg=8;function ds(){}function H1(s){if(s)return s.getAttribute&&s.getAttribute("id")||s.id}function j1(s){return function(t,n,i){if(i||(i={}),typeof n=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var r=n;n=Ot.createElement("html"),n.innerHTML=r}else n=L1(n);else n.nodeType===Vg&&(n=n.firstElementChild);var o=i.getNodeKey||H1,a=i.onBeforeNodeAdded||ds,l=i.onNodeAdded||ds,c=i.onBeforeElUpdated||ds,h=i.onElUpdated||ds,u=i.onBeforeNodeDiscarded||ds,f=i.onNodeDiscarded||ds,p=i.onBeforeElChildrenUpdated||ds,g=i.skipFromChildren||ds,y=i.addChild||function(ce,ne){return ce.appendChild(ne)},v=i.childrenOnly===!0,b=Object.create(null),w=[];function S(ce){w.push(ce)}function E(ce,ne){if(ce.nodeType===eo)for(var _e=ce.firstChild;_e;){var pe=void 0;ne&&(pe=o(_e))?S(pe):(f(_e),_e.firstChild&&E(_e,ne)),_e=_e.nextSibling}}function $(ce,ne,_e){u(ce)!==!1&&(ne&&ne.removeChild(ce),f(ce),E(ce,_e))}function B(ce){if(ce.nodeType===eo||ce.nodeType===Vg)for(var ne=ce.firstChild;ne;){var _e=o(ne);_e&&(b[_e]=ne),B(ne),ne=ne.nextSibling}}B(t);function N(ce){l(ce);for(var ne=ce.firstChild;ne;){var _e=ne.nextSibling,pe=o(ne);if(pe){var J=b[pe];J&&el(ne,J)?(ne.parentNode.replaceChild(J,ne),V(J,ne)):N(ne)}else N(ne);ne=_e}}function L(ce,ne,_e){for(;ne;){var pe=ne.nextSibling;(_e=o(ne))?S(_e):$(ne,ce,!0),ne=pe}}function V(ce,ne,_e){var pe=o(ne);if(pe&&delete b[pe],!_e){var J=c(ce,ne);if(J===!1||(J instanceof HTMLElement&&(ce=J),s(ce,ne),h(ce),p(ce,ne)===!1))return}ce.nodeName!=="TEXTAREA"?M(ce,ne):Ug.TEXTAREA(ce,ne)}function M(ce,ne){var _e=g(ce,ne),pe=ne.firstChild,J=ce.firstChild,le,re,oe,He,Be;e:for(;pe;){for(He=pe.nextSibling,le=o(pe);!_e&&J;){if(oe=J.nextSibling,pe.isSameNode&&pe.isSameNode(J)){pe=He,J=oe;continue e}re=o(J);var ot=J.nodeType,De=void 0;if(ot===pe.nodeType&&(ot===eo?(le?le!==re&&((Be=b[le])?oe===Be?De=!1:(ce.insertBefore(Be,J),re?S(re):$(J,ce,!0),J=Be,re=o(J)):De=!1):re&&(De=!1),De=De!==!1&&el(J,pe),De&&V(J,pe)):(ot===Kg||ot==qg)&&(De=!0,J.nodeValue!==pe.nodeValue&&(J.nodeValue=pe.nodeValue))),De){pe=He,J=oe;continue e}re?S(re):$(J,ce,!0),J=oe}if(le&&(Be=b[le])&&el(Be,pe))_e||y(ce,Be),V(Be,pe);else{var be=a(pe);be!==!1&&(be&&(pe=be),pe.actualize&&(pe=pe.actualize(ce.ownerDocument||Ot)),y(ce,pe),N(pe))}pe=He,J=oe}L(ce,J,re);var nn=Ug[ce.nodeName];nn&&nn(ce,ne)}var F=t,K=F.nodeType,X=n.nodeType;if(!v){if(K===eo)X===eo?el(t,n)||(f(t),F=O1(t,z1(n.nodeName,n.namespaceURI))):F=n;else if(K===Kg||K===qg){if(X===K)return F.nodeValue!==n.nodeValue&&(F.nodeValue=n.nodeValue),F;F=n}}if(F===n)f(t);else{if(n.isSameNode&&n.isSameNode(F))return;if(V(F,n,v),w)for(var ae=0,ue=w.length;ae<ue;ae++){var ye=b[w[ae]];ye&&$(ye,ye.parentNode,!1)}}return!v&&F!==t&&t.parentNode&&(F.actualize&&(F=F.actualize(t.ownerDocument||Ot)),t.parentNode.replaceChild(F,t)),F}}var W1=j1(I1);function od(s,e,t={}){const n=_(s);if(typeof e=="string"&&!e.length){t.childrenOnly?n.empty():n.replaceWith(document.createTextNode(""));return}if(e===null){n.remove();return}const i="z-zui-inited",{getNodeKey:r,onElUpdated:o,onBeforeElUpdated:a,onBeforeElChildrenUpdated:l,executeScript:c=!0,...h}=t,u=new Set;W1(s,e,{...h,getNodeKey:function(f){const p=r==null?void 0:r(f);if(p!==void 0)return p;if(f instanceof Element&&f.tagName==="BODY")return f.tagName;if(f.getAttribute)return f.getAttribute("zui-key")??f.id},onBeforeElUpdated(f,p){const g=a==null?void 0:a(f,p);if(g!==void 0)return g;if(f.classList.contains("preserve-on-morph"))return!1;if(f.classList.contains("no-morph")||f.hasAttribute("zui-create")!==p.hasAttribute("zui-create")||f.tagName==="IFRAME"&&!f.classList.contains("morph")||f.tagName==="ZEN-EDITOR"||f.tagName.includes("-")&&f.isEqualNode(p))return f.replaceWith(p),!1;if(f.tagName==="SCRIPT"&&c){const v=p.textContent;v&&_(f).addClass("zui-js-run").parent().runJS(v)}const y=_(f);if((f.hasAttribute("zui-create")||f.hasAttribute("data-zui"))&&(!p.childNodes.length||y.zui()instanceof Ee)){if(f.isEqualNode(p))u.add(f);else{let v=!0;Array.from(p.attributes).forEach(b=>{const{name:w,value:S}=b;w==="class"?y.addClass(S):f.getAttribute(w)!==S&&((w==="zui-create"||w.startsWith("zui-create-"))&&(v=!1),f.setAttribute(w,S))}),v&&u.add(f)}return!1}return!0},onBeforeElChildrenUpdated(f,p){const g=l==null?void 0:l(f,p);return g!==void 0?g:f.classList.contains("no-morph")?!1:!f.tagName.includes("-")},onElUpdated(f){if(o==null||o(f),f.tagName!=="SCRIPT"){f.hasAttribute(i)&&f.removeAttribute(i);const p=or(f);Object.values(p).forEach(g=>{if(g instanceof Je){const{ATTR_KEY:y,DATA_KEY:v}=g.constructor;f.setAttribute(y,""),f.setAttribute(v,`${g.gid}`)}})}}}),n.zuiInit({update:"reset",beforeCreate:f=>!u.has(f)}),u.forEach(f=>{_(f).trigger("skipMorph")}),c&&n.find("script:not(.zui-js-run)").each((f,p)=>{const g=p.textContent;g&&n.runJS(g)})}_.fn.morph=function(s,e){return this.each((t,n)=>{od(n,s,e)})},_.fn.morphInner=function(s,e){return this.each((t,n)=>{od(n,s,{...e,childrenOnly:!0})})};function ad(s){const e=_(s);e.css({minHeight:0}).css({minHeight:Math.max(32,e[0].scrollHeight)})}_.fn.autoHeight=function(){return this.each(function(){const s=_(this);s.data("auto-height")||s.on("input paste change",function(){ad(this)}).data("auto-height",!0),ad(s),setTimeout(()=>ad(s),100)})},_.fn._append=_.fn.append,_.fn._prepend=_.fn.prepend,_.fn._before=_.fn.before,_.fn._after=_.fn.after,_.fn._html=_.fn.html;function tl(s,e){return typeof e=="string"&&(e.includes("zui-create")||e.includes("zui-init"))&&s.zuiInit(),s}function U1(s){return!!s&&s.nodeType===1}_.extend(_.fn,{append(...s){return tl(this._append(...s),s.join(""))},prepend(...s){return tl(this._prepend(...s),s.join(""))},before(...s){const e=this.parent();return this._before(...s),tl(e,s.join("")),this},after(...s){const e=this.parent();return this._after(...s),tl(e,s.join("")),this},html(s,e){if(!arguments.length)return this[0]&&this[0].innerHTML;if(s===void 0)return this;const t=/<script[\s>]/.test(s);return typeof e=="boolean"&&(e={zuiInit:e}),this.each((n,i)=>{U1(i)&&(t?_(i).empty()._append(s):i.innerHTML=s,(e==null?void 0:e.zuiInit)!==!1&&_(i).zuiInit())})}});const V1=Object.freeze(Object.defineProperty({__proto__:null,createLink:zt,parseLink:N0,parseUrlParams:B0},Symbol.toStringTag,{value:"Module"}));window.$&&Object.assign(window.$,{...V1,parseRawData:Gl}),P.$=_,P.Ajax=rr,P.AjaxForm=Ua,P.Avatar=Fc,P.BUILD=1747356558548,P.BUILD_MODE=Py,P.BatchForm=U_,P.BtnGroup=Pc,P.Burn=yh,P.Bus=Mf,P.Card=qa,P.CardList=Mu,P.ColorPicker=$i,P.CommonList=mr,P.Component=Je,P.ComponentFromReact=Ee,P.Computed=Ts,P.ContextMenu=ji,P.Custom=Yo,P.CustomContent=Se,P.CustomContentClass=vp,P.CustomRender=kc,P.DTable=Gs,P.Dashboard=Lu,P.DataHub=$p,P.DatePicker=ga,P.DatetimePicker=ya,P.Dexie=kr,P.DocApp=Hr,P.Draggable=br,P.Dropdown=Dn,P.Dropmenu=Su,P.ECharts=Fm,P.Editor=mn,P.Entity=Wx,P.FileList=Du,P.FileSelector=wa,P.FormGrid=Lm,P.FormSetting=Rm,P.Gantt=zm,P.GlobalSearch=Va,P.Graph=jm,P.HElement=tt,P.HElementSignals=Cc,P.HistoryPanel=jr,P.HtmlContent=Rn,P.Icon=Re,P.ImageSelector=Ca,P.ImgCutter=Tu,P.Kanban=Gr,P.KanbanList=Yr,P.List=yr,P.Mammoth=rw,P.Menu=Zo,P.Messager=ns,P.Modal=Ke,P.ModalBase=Ni,P.ModalTrigger=Pi,P.Moveable=wr,P.Nav=oh,P.NestedList=vr,P.PageEditor=Ha,P.Pager=ah,P.Pick=Ea,P.Picker=Aa,P.Popover=Yt,P.PopoverPanel=ka,P.Portal=Sc,P.PriPicker=Iu,P.ProgressCircle=ta,P.PropModSymbol=Ux,P.PropModification=Vx,P.RangeSet=Hx,P.ReactComponent=ke,P.SearchBox=Ta,P.SearchForm=tn,P.SearchMenu=Qo,P.SearchTree=dh,P.SeverityPicker=Bu,P.Sidebar=Ia,P.Signal=yt,P.Sortable=na,P.SortableList=sa,P.SortableTree=ia,P.Sticky=Lo,P.TIME_DAY=gi,P.Tabs=Xr,P.TimePicker=ma,P.Toolbar=uh,P.Tooltip=Ri,P.Tree=Ba,P.Upload=Na,P.UploadImgs=fh,P.UserAvatar=Ka,P.VERSION=Fy,P.Zinbar=Pu,P.addDate=Wf,P.addQueryToSearchForm=Km,P.ajaxSubmit=Ks,P.batch=dr,P.bindCommands=Ho,P.bindHotkeys=oc,P.bus=bn,P.cash=_,P.classes=ee,P.clearData=Ev,P.cmp=jx,P.computed=Ye,P.convertBytes=Fn,P.cookie=Sp,P.create=Mo,P.createDate=et,P.createFormData=Do,P.createPortal=_p,P.createRef=Ce,P.deepCall=Zn,P.deepGet=ir,P.deepGetPath=gf,P.defineFn=Wv,P.delay=Is,P.disableScroll=Ff,P.dom=ix,P.downloadFile=mi,P.effect=ln,P.enterFullscreen=Of,P.evalValue=$s,P.executeCommand=pc,P.executeCommands=Vf,P.fetchData=Et,P.formatBytes=Dt,P.formatDate=gt,P.formatDateSpan=Qv,P.formatString=Te,P.getClassList=ql,P.getComponent=lr,P.getFullscreenElement=Po,P.getHotkeysMap=rc,P.getReactComponent=gp,P.getUniqueCode=fc,P.getZData=fi,P.h=k,P.hotkeys=Hv,P.i18n=Oe,P.init=hc,P.initGlobalComponents=cc,P.isDiff=Eo,P.isFetchSetting=Kl,P.isNotEmptyString=Cv,P.isSameDay=es,P.isSameMonth=uc,P.isSameWeek=Gv,P.isSameYear=cr,P.isToday=Yv,P.isTomorrow=Zv,P.isValidDate=dc,P.isYesterday=Xv,P.jsRaw=Av,P.liveQuery=Lx,P.mapFormData=Mm,P.mergeProps=Ie,P.mergeRanges=zx,P.morph=od,P.nextGid=Bt,P.parseCommand=zo,P.parseCommands=Uf,P.parseRawData=Gl,P.parseSize=Fs,P.processSubmitResult=Eu,P.rangesOverlap=Ox,P.reactComponents=wc,P.readFile=nx,P.registerComponent=Hf,P.registerGlobalCommand=Jv,P.registerGlobalListener=Pf,P.registerReactComponent=ut,P.removeUndefinedProps=nc,P.render=Ns,P.renderCustomContent=Go,P.renderCustomResult=yp,P.replacePrefix=Kx,P.runJS=hr,P.selectFile=tx,P.setFormDataValue=As,P.setZData=Yl,P.shareData=_f,P.showCommentModal=Au,P.signal=at,P.store=rt,P.storeData=Ao,P.takeData=or,P.toCssSize=nt,P.toggleFullscreen=lc,P.toggleSearchForm=Fu,P.uid=Hs,P.unbindCommands=jo,P.unbindHotkeys=ac,P.untracked=hx,P.updateSearchForm=Vm,Object.defineProperty(P,Symbol.toStringTag,{value:"Module"})});
